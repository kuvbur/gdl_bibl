!Fence_with_Gate
!DPI_Studio_2000


if ddd=0 then end


mulz zzyzx/2.00
!
!
!!!Pillars and base!!
!
!!base
!
!material mb
!add -da/2,-0.06,0
!prism_      83,     0.1,
!		   -0.075,     0.3,     15,
!			0.075,     0.3,     15,
!			0.075,     0.0,     15,
!		   -0.075,     0.0,     15,
!		   -0.075,     0.3,     -1,
!		   -0.005,     0.24,     79,
!		   -0.007679,     0.25,     79,
!		   -0.015,     0.257321,     79,
!		   -0.025,     0.26,     79,
!		   -0.035,     0.257321,     79,
!		   -0.042321,     0.25,     79,
!		   -0.045,     0.24,     79,
!		   -0.042321,     0.23,     79,
!		   -0.035,     0.222679,     79,
!		   -0.025,     0.22,     79,
!		   -0.015,     0.222679,     79,
!		   -0.007679,     0.23,     79,
!		   -0.005,     0.24,     -1,
!			0.045,     0.24,     79,
!			0.042321,     0.25,     79,
!			0.035,     0.257321,     79,
!			0.025,     0.26,     79,
!			0.015,     0.257321,     79,
!			0.007679,     0.25,     79,
!			0.005,     0.24,     79,
!			0.007679,     0.23,     79,
!			0.015,     0.222679,     79,
!			0.025,     0.22,     79,
!			0.035,     0.222679,     79,
!			0.042321,     0.23,     79,
!			0.045,     0.24,     -1,
!			0.045,     0.15,     79,
!			0.042321,     0.16,     79,
!			0.035,     0.167321,     79,
!			0.025,     0.17,     79,
!			0.015,     0.167321,     79,
!			0.007679,     0.16,     79,
!			0.005,     0.15,     79,
!			0.007679,     0.14,     79,
!			0.015,     0.132679,     79,
!			0.025,     0.13,     79,
!			0.035,     0.132679,     79,
!			0.042321,     0.14,     79,
!			0.045,     0.15,     -1,
!		   -0.005,     0.15,     79,
!		   -0.007679,     0.16,     79,
!		   -0.015,     0.167321,     79,
!		   -0.025,     0.17,     79,
!		   -0.035,     0.167321,     79,
!		   -0.042321,     0.16,     79,
!		   -0.045,     0.15,     79,
!		   -0.042321,     0.14,     79,
!		   -0.035,     0.132679,     79,
!		   -0.025,     0.13,     79,
!		   -0.015,     0.132679,     79,
!		   -0.007679,     0.14,     79,
!		   -0.005,     0.15,     -1,
!		   -0.005,     0.06,     79,
!		   -0.007679,     0.07,     79,
!		   -0.015,     0.077321,     79,
!		   -0.025,     0.08,     79,
!		   -0.035,     0.077321,     79,
!		   -0.042321,     0.07,     79,
!		   -0.045,     0.06,     79,
!		   -0.042321,     0.05,     79,
!		   -0.035,     0.042679,     79,
!		   -0.025,     0.04,     79,
!		   -0.015,     0.042679,     79,
!		   -0.007679,     0.05,     79,
!		   -0.005,     0.06,     -1,
!			0.045,     0.06,     79,
!			0.042321,     0.07,     79,
!			0.035,     0.077321,     79,
!			0.025,     0.08,     79,
!			0.015,     0.077321,     79,
!			0.007679,     0.07,     79,
!			0.005,     0.06,     79,
!			0.007679,     0.05,     79,
!			0.015,     0.042679,     79,
!			0.025,     0.04,     79,
!			0.035,     0.042679,     79,
!			0.042321,     0.05,     79,
!			0.045,     0.06,     -1
!del 1
!
!if el=1 then
!add da/2,-0.06,0
!prism_      83,     0.1,
!		   -0.075,     0.3,     15,
!			0.075,     0.3,     15,
!			0.075,     0.0,     15,
!		   -0.075,     0.0,     15,
!		   -0.075,     0.3,     -1,
!		   -0.005,     0.24,     79,
!		   -0.007679,     0.25,     79,
!		   -0.015,     0.257321,     79,
!		   -0.025,     0.26,     79,
!		   -0.035,     0.257321,     79,
!		   -0.042321,     0.25,     79,
!		   -0.045,     0.24,     79,
!		   -0.042321,     0.23,     79,
!		   -0.035,     0.222679,     79,
!		   -0.025,     0.22,     79,
!		   -0.015,     0.222679,     79,
!		   -0.007679,     0.23,     79,
!		   -0.005,     0.24,     -1,
!			0.045,     0.24,     79,
!			0.042321,     0.25,     79,
!			0.035,     0.257321,     79,
!			0.025,     0.26,     79,
!			0.015,     0.257321,     79,
!			0.007679,     0.25,     79,
!			0.005,     0.24,     79,
!			0.007679,     0.23,     79,
!			0.015,     0.222679,     79,
!			0.025,     0.22,     79,
!			0.035,     0.222679,     79,
!			0.042321,     0.23,     79,
!			0.045,     0.24,     -1,
!			0.045,     0.15,     79,
!			0.042321,     0.16,     79,
!			0.035,     0.167321,     79,
!			0.025,     0.17,     79,
!			0.015,     0.167321,     79,
!			0.007679,     0.16,     79,
!			0.005,     0.15,     79,
!			0.007679,     0.14,     79,
!			0.015,     0.132679,     79,
!			0.025,     0.13,     79,
!			0.035,     0.132679,     79,
!			0.042321,     0.14,     79,
!			0.045,     0.15,     -1,
!		   -0.005,     0.15,     79,
!		   -0.007679,     0.16,     79,
!		   -0.015,     0.167321,     79,
!		   -0.025,     0.17,     79,
!		   -0.035,     0.167321,     79,
!		   -0.042321,     0.16,     79,
!		   -0.045,     0.15,     79,
!		   -0.042321,     0.14,     79,
!		   -0.035,     0.132679,     79,
!		   -0.025,     0.13,     79,
!		   -0.015,     0.132679,     79,
!		   -0.007679,     0.14,     79,
!		   -0.005,     0.15,     -1,
!		   -0.005,     0.06,     79,
!		   -0.007679,     0.07,     79,
!		   -0.015,     0.077321,     79,
!		   -0.025,     0.08,     79,
!		   -0.035,     0.077321,     79,
!		   -0.042321,     0.07,     79,
!		   -0.045,     0.06,     79,
!		   -0.042321,     0.05,     79,
!		   -0.035,     0.042679,     79,
!		   -0.025,     0.04,     79,
!		   -0.015,     0.042679,     79,
!		   -0.007679,     0.05,     79,
!		   -0.005,     0.06,     -1,
!			0.045,     0.06,     79,
!			0.042321,     0.07,     79,
!			0.035,     0.077321,     79,
!			0.025,     0.08,     79,
!			0.015,     0.077321,     79,
!			0.007679,     0.07,     79,
!			0.005,     0.06,     79,
!			0.007679,     0.05,     79,
!			0.015,     0.042679,     79,
!			0.025,     0.04,     79,
!			0.035,     0.042679,     79,
!			0.042321,     0.05,     79,
!			0.045,     0.06,     -1
!del 1
!endif


!!Pillars and Grids!!

resol 12

material mp

!!Fix pillars
!
!addx -da/2+0.025
!cylind 2,0.02
!addx da-0.05
!cylind 2,0.02
!del 2


if gt="No Gate" then

dpa=da-0.05
gosub 1000

else

if gt="Single Gate" then

dpa=da-0.13

addx -dpa/2
rotz oa
addx dpa/2

add -dpa/2,0,0.12
cylind 1.88,0.02
addx dpa
cylind 1.88,0.02
del 2
gosub 1000

del 3

else

dpa=da/2-0.085

addx -da/2+0.065+dpa/2

addx -dpa/2
rotz  oa
addx  dpa/2

add -dpa/2,0,0.12
cylind 1.88,0.02
addx dpa
cylind 1.88,0.02
del 2
gosub 1000

del 4


addx da/2-0.065-dpa/2

addx  dpa/2
rotz  -oa
addx  -dpa/2

material mp
resol 12

add -dpa/2,0,0.12
cylind 1.88,0.02
addx dpa
cylind 1.88,0.02
del 2
gosub 1000

del 4


endif


endif






end






!!Grid subroutine!!

1000:

!!Horizontal Grid

material ma

addx -dpa/2
cutpoly 12,
0.02,     0.0,
0.017321,     0.01,
0.01,     0.017321,
0.0,     0.02,
-0.01,     0.017321,
-0.017321,     0.01,
-0.02,     0.0,
-0.017321,    -0.01,
-0.01,    -0.017321,
0.0,    -0.02,
0.01,    -0.017321,
0.017321,    -0.01
addx dpa
cutpoly 12,
0.02,     0.0,
0.017321,     0.01,
0.01,     0.017321,
0.0,     0.02,
-0.01,     0.017321,
-0.017321,     0.01,
-0.02,     0.0,
-0.017321,    -0.01,
-0.01,    -0.017321,
0.0,    -0.02,
0.01,    -0.017321,
0.017321,    -0.01
del 2


resol 8
add -dpa/2,0.004,0.20
roty 90

for i=1 to 4 step 1
cylind dpa,0.00225
add -0.045,0.0089,0
cylind dpa,0.00225
add -0.045,-0.0089,0
cylind dpa,0.00225
del 2
addx -0.56
next i

del 6

cutend
cutend


!!Vertical Grid

dk=0.0725                   !preferred Grid spacing
t=dpa-0.04                  !full lenght
nk=t/dk                     !number of spaces in real number
nv=int(nk)                  !number of spaces in integer number

dv=t/nv                     !real Grid spacing


add (-dpa/2)+0.02+(dv/2),0, 0.18

for i=1 to nv step 1
tube 9,16,1+2+16+32,
-0.0022,     0.00004,     1,
-0.001541,    -0.001551,     1,
 0.00005,    -0.00221,     1,
 0.001641,    -0.001551,     1,
 0.0023,     0.00004,     1,
 0.001641,     0.001631,     1,
 0.00005,     0.00229,     1,
-0.001541,     0.001631,     1,
-0.0022,     0.00004,     1,

0,0,-1,0,
0,0,0,0,
0,0,0.0207,0,
0,0.017,0.065,0,
0,0,0.1093,0,
0,0,0.5807,0,
0,0.017,0.625,0,
0,0,0.6693,0,
0,0,1.1407,0,
0,0.017,1.185,0,
0,0,1.2293,0,
0,0,1.7007,0,
0,0.017,1.745,0,
0,0,1.7893,0,
0,0,1.82,0,
0,0,2.00,0
addx dv
next i

del nv+1


return
