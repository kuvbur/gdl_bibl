endd=0
dim null2[][]
dim razmt[]
nrazmt = 0
n=REQUEST ("window_show_dim", "", show_x)
n=REQUEST ("door_show_dim", "", show_y)
if GLOB_CONTEXT = 2 or GLOB_CONTEXT = 3 or GLOB_CONTEXT = 4 then
	parameters abs_nach_x = koord_x_all[1][1] + SYMB_POS_X
	parameters abs_nach_y = koord_y_all[1][1] + SYMB_POS_Y
	parameters abs_nach_z = koord_z_all[1][1] + SYMB_POS_Z
	parameters abs_rot = SYMB_ROTANGLE
endif
koord_x_all=null2
koord_y_all=null2
koord_z_all=null2
!!!!--------------Границы объекта
!		6-----7
!	   /|    /|
!	  5-----8 |
!	  | 2   | 3
!	  |/    |/ dlin_st_model
!	  1-----4   
!------Координаты вершин ограничевающего параллелипипеда---------
coord_vnsh[1][1]=0
coord_vnsh[1][2]=0
coord_vnsh[1][3]=0
coord_vnsh[2][1]=0
coord_vnsh[2][2]=ogr_y
coord_vnsh[2][3]=0
coord_vnsh[3][1]=ogr_x
coord_vnsh[3][2]=ogr_y
coord_vnsh[3][3]=0
coord_vnsh[4][1]=ogr_x
coord_vnsh[4][2]=0
coord_vnsh[4][3]=0
coord_vnsh[5][1]=0
coord_vnsh[5][2]=0
coord_vnsh[5][3]=ogr_z
coord_vnsh[6][1]=0
coord_vnsh[6][2]=ogr_y
coord_vnsh[6][3]=ogr_z
coord_vnsh[7][1]=ogr_x
coord_vnsh[7][2]=ogr_y
coord_vnsh[7][3]=ogr_z
coord_vnsh[8][1]=ogr_x
coord_vnsh[8][2]=0
coord_vnsh[8][3]=ogr_z
!------Координаты вершин ограничевающего параллелипипеда по защитным слоям---------
coord_vn[1][1]=0+zash_x_1
coord_vn[1][2]=0+zash_y_1
coord_vn[1][3]=0+zash_z_1
coord_vn[2][1]=0+zash_x_1
coord_vn[2][2]=ogr_y-zash_y_2
coord_vn[2][3]=0+zash_z_1
coord_vn[3][1]=ogr_x-zash_x_2
coord_vn[3][2]=ogr_y-zash_y_2
coord_vn[3][3]=0+zash_z_1
coord_vn[4][1]=ogr_x-zash_x_2
coord_vn[4][2]=0+zash_y_1
coord_vn[4][3]=0+zash_z_1
coord_vn[5][1]=0+zash_x_1
coord_vn[5][2]=0+zash_y_1
coord_vn[5][3]=ogr_z-zash_z_2
coord_vn[6][1]=0+zash_x_1
coord_vn[6][2]=ogr_y-zash_y_2
coord_vn[6][3]=ogr_z-zash_z_2
coord_vn[7][1]=ogr_x-zash_x_2
coord_vn[7][2]=ogr_y-zash_y_2
coord_vn[7][3]=ogr_z-zash_z_2
coord_vn[8][1]=ogr_x-zash_x_2
coord_vn[8][2]=0+zash_y_1
coord_vn[8][3]=ogr_z-zash_z_2
!-----------------------------------
!Константы и сбросы
EPS=0.001
unID=1
uID=1
!=============================================================================
!---------------Расчёт количества и расположения стержней по Х
if rX then
	kol_vo_x=0
	i=1
	for i=1 to n_x
			if i=1 then
				nach_t=coord_vn[1][1]
			nrazmt = nrazmt + 1
			razmt[nrazmt] = nach_t
			else
				nach_t=koord_x[i-1]
			endif
		if i<=vardim1(shag_x_m)  then
			HOTSPOT2 nach_t, coord_vn[1][2], unID, shag_x_m[i], 1+128:unID=unID+1
			HOTSPOT2 nach_t+shag_x_m[i], coord_vn[1][2], unID, shag_x_m[i], 2:unID=unID+1
			HOTSPOT2 nach_t, coord_vn[2][2], unID, shag_x_m[i], 1+128:unID=unID+1
			HOTSPOT2 nach_t+shag_x_m[i], coord_vn[2][2], unID, shag_x_m[i], 2:unID=unID+1
			HOTSPOT nach_t, coord_vn[1][2],coord_vn[1][3], unID, shag_x_m[i], 1+128:unID=unID+1
			HOTSPOT nach_t+shag_x_m[i], coord_vn[1][2],coord_vn[1][3], unID, shag_x_m[i], 2:unID=unID+1
			HOTSPOT nach_t, coord_vn[2][2],coord_vn[1][3], unID, shag_x_m[i], 1+128:unID=unID+1
			HOTSPOT nach_t+shag_x_m[i], coord_vn[2][2], coord_vn[1][3], unID, shag_x_m[i], 2:unID=unID+1
			HOTSPOT nach_t, coord_vn[5][2],coord_vn[5][3], unID, shag_x_m[i], 1+128:unID=unID+1
			HOTSPOT nach_t+shag_x_m[i], coord_vn[5][2],coord_vn[5][3], unID, shag_x_m[i], 2:unID=unID+1
			HOTSPOT nach_t, coord_vn[6][2],coord_vn[6][3], unID, shag_x_m[i], 1+128:unID=unID+1
			HOTSPOT nach_t+shag_x_m[i], coord_vn[6][2], coord_vn[6][3], unID, shag_x_m[i], 2:unID=unID+1
		endif
		if nach_t+shag_x_m[i]>=coord_vn[3][1] or i=n_x then shag_x_m[i]=coord_vn[3][1]-nach_t-r_arm
		if shag_x_m[i]<=0 and i>1 then shag_x_m[i]=min_rast_svet_diam !Отрицательным шаг не бывает
		if i=1 then shag_x_m[i]=r_arm !Нижняя граница
		if perem_shag and i>1 then
			text2 nach_t+shag_x_m[i]/2,by_vn/2,i
			HOTSPOT2 nach_t, by_vn/2, unID, shag_x_dopm[i], 1+128:unID=unID+1
			HOTSPOT2 nach_t+shag_x_dopm[i], by_vn/2, unID, shag_x_dopm[i], 2:unID=unID+1
			HOTSPOT nach_t, by_vn/2,hz_vn/2, unID, shag_x_dopm[i], 1+128:unID=unID+1
			HOTSPOT nach_t+shag_x_dopm[i], by_vn/2,hz_vn/2, unID, shag_x_dopm[i], 2:unID=unID+1
		endif
		if perem_shag=0 then
			shag=shag_x_dop
		else
			shag=shag_x_dopm[i]
		endif
		if 	not(shag_x_dopm[i+1]-shag_x_m[i+1]) and perem_shag and shag_osn="По Х" then
			otv=1
			nach_otv=i
		else
			otv=0
		endif
		koord_x[i]=nach_t+shag_x_m[i]-(r_arm)*(i=1) !Координаты основных стержней
		kol_vo_x=kol_vo_x+1!Общее количество стержней
		if shag_x_m[i]>shag+diam_arm and (shag_osn="По X" or shag_dop="По X") then gosub "dop_sterjen_x" !Раскладка доп. стержней при превышении шага
		koord_x_all[kol_vo_x][1]=nach_t+shag_x_m[i]-(zash_x_1+r_arm)*(otv=1)*(i=nach_otv)+(zash_x_1+r_arm)*(otv=1)*(i=nach_otv+1) !Массив координат общего количества стержней
		koord_x_all[kol_vo_x][2]=1!Массив координат общего количества стержней
	next i
else
	parameters koord_x_all[1][1]=coord_vn[1][1]!+r_arm
	parameters koord_x_all[1][2]=1
	kol_vo_x=1
endif

!!---------------Расчёт количества и расположения стержней по Y
if rY then
	kol_vo_y=0
	i=1
	for i=1 to n_y
		if i=1 then
			nach_t=coord_vn[1][2]
			nrazmt = nrazmt + 1
			razmt[nrazmt] = nach_t
		else
			nach_t=koord_y[i-1]
		endif
		if i<=vardim1(shag_y_m) then
			HOTSPOT2 coord_vn[1][1], nach_t, unID, shag_y_m[i], 1+128:unID=unID+1
			HOTSPOT2 coord_vn[1][1], nach_t+shag_y_m[i], unID, shag_y_m[i], 2:unID=unID+1
			HOTSPOT2 coord_vn[4][1], nach_t, unID, shag_y_m[i], 1+128:unID=unID+1
			HOTSPOT2 coord_vn[4][1], nach_t+shag_y_m[i], unID, shag_y_m[i], 2:unID=unID+1
			HOTSPOT coord_vn[1][1], nach_t,coord_vn[1][3], unID, shag_y_m[i], 1+128:unID=unID+1
			HOTSPOT coord_vn[1][1], nach_t+shag_y_m[i],coord_vn[1][3], unID, shag_y_m[i], 2:unID=unID+1
			HOTSPOT coord_vn[4][1], nach_t,coord_vn[1][3], unID, shag_y_m[i], 1+128:unID=unID+1
			HOTSPOT coord_vn[4][1], nach_t+shag_y_m[i],coord_vn[1][3], unID, shag_y_m[i], 2:unID=unID+1
			HOTSPOT coord_vn[5][1], nach_t,coord_vn[5][3], unID, shag_y_m[i], 1+128:unID=unID+1
			HOTSPOT coord_vn[5][1], nach_t+shag_y_m[i],coord_vn[5][3], unID, shag_y_m[i], 2:unID=unID+1
			HOTSPOT coord_vn[8][1], nach_t,coord_vn[8][3], unID, shag_y_m[i], 1+128:unID=unID+1
			HOTSPOT coord_vn[8][1], nach_t+shag_y_m[i],coord_vn[8][3], unID, shag_y_m[i], 2:unID=unID+1
		endif
		if nach_t+shag_y_m[i]>=coord_vn[3][2] or i=n_y then shag_y_m[i]=coord_vn[3][2]-nach_t-r_arm
		if shag_y_m[i]<=0 and i>1 then shag_y_m[i]=min_rast_svet_diam !Отрицательным шаг не бывает
		if i=1 then shag_y_m[i]=r_arm !Нижняя граница
		if perem_shag and i>1 then
			text2 ax_vn/2,nach_t+shag_y_m[i]/2,i
			HOTSPOT2 ax_vn/2,nach_t,  unID, shag_y_dopm[i], 1+128:unID=unID+1
			HOTSPOT2 ax_vn/2,nach_t+shag_y_dopm[i], unID, shag_y_dopm[i], 2:unID=unID+1
			HOTSPOT  ax_vn/2,nach_t,hz_vn/2, unID, shag_y_dopm[i], 1+128:unID=unID+1
			HOTSPOT  ax_vn/2,nach_t+shag_y_dopm[i],hz_vn/2, unID, shag_y_dopm[i], 2:unID=unID+1
		endif
		if perem_shag=0 then
			shag=shag_y_dop
		else
			shag=shag_y_dopm[i]
		endif
		if not(shag_y_dopm[i+1]-shag_y_m[i+1]) and perem_shag and shag_osn="По Y" then
			otv=1
			nach_otv=i
		else
			otv=0
		endif
		koord_y[i]=nach_t+shag_y_m[i]-(r_arm)*(i=1) !Координаты основных стержней
		kol_vo_y=kol_vo_y+1!Общее количество стержней
		if shag_y_m[i] > shag+diam_arm and (shag_osn="По Y" or shag_dop="По Y") then gosub "dop_sterjen_y" !Раскладка доп. стержней при превышении шага
		koord_y_all[kol_vo_y][1]=nach_t+shag_y_m[i]-(zash_y_1+r_arm)*(otv=1)*(i=nach_otv)+(zash_y_1+r_arm)*(otv=1)*(i=nach_otv+1)!Массив координат общего количества стержней
		koord_y_all[kol_vo_y][2]=1!Массив координат общего количества стержней
	next i
else
	parameters koord_y_all[1][1]=coord_vn[1][2]!+r_arm
	parameters koord_y_all[1][2]=1
	kol_vo_y=1
endif
!!!---------------Расчёт количества и расположения стержней по Z
if rZ then
	kol_vo_z=0
	i=1
	for i=1 to n_z
		if i=1 then
			nach_t=coord_vn[1][3]
			nrazmt = nrazmt + 1
			razmt[nrazmt] = nach_t
		else
			nach_t=koord_z[i-1]
		endif
		if i<=vardim1(shag_z_m) then
			HOTSPOT coord_vn[1][1], coord_vn[1][2],nach_t, unID, shag_z_m[i], 1+128:unID=unID+1
			HOTSPOT coord_vn[1][1], coord_vn[1][2],nach_t+shag_z_m[i], unID, shag_z_m[i], 2:unID=unID+1
			HOTSPOT coord_vn[2][1], coord_vn[2][2],nach_t, unID, shag_z_m[i], 1+128:unID=unID+1
			HOTSPOT coord_vn[2][1], coord_vn[2][2],nach_t+shag_z_m[i], unID, shag_z_m[i], 2:unID=unID+1
			HOTSPOT coord_vn[3][1], coord_vn[3][2],nach_t, unID, shag_z_m[i], 1+128:unID=unID+1
			HOTSPOT coord_vn[3][1], coord_vn[3][2],nach_t+shag_z_m[i], unID, shag_z_m[i], 2:unID=unID+1
			HOTSPOT coord_vn[4][1], coord_vn[4][2],nach_t, unID, shag_z_m[i], 1+128:unID=unID+1
			HOTSPOT coord_vn[4][1], coord_vn[4][2],nach_t+shag_z_m[i], unID, shag_z_m[i], 2:unID=unID+1
		endif
		if nach_t+shag_z_m[i]>=coord_vn[5][3] or i=n_z then shag_z_m[i]=coord_vn[5][3]-nach_t-r_arm
		if shag_z_m[i]<=0 and i>1 then shag_z_m[i]=min_rast_svet_diam !Отрицательным шаг не бывает
		if perem_shag and i>1 then
			HOTSPOT  ax_vn/2,by_vn/2,nach_t, unID, shag_z_dopm[i], 1+128:unID=unID+1
			HOTSPOT  ax_vn/2,by_vn/2,nach_t+shag_z_dopm[i], unID, shag_z_dopm[i], 2:unID=unID+1
		endif
		if i=1 then shag_z_m[i]=r_arm !Нижняя граница
		if perem_shag=0 then
			shag=shag_z_dop
		else
			shag=shag_z_dopm[i]
		endif
		if not(shag_z_dopm[i+1]-shag_z_m[i+1]) and perem_shag and shag_osn="По Z" then
			otv=1
			nach_otv=i
		else
			otv=0
		endif
		koord_z[i]=nach_t+shag_z_m[i]-(r_arm)*(i=1) !Координаты основных стержней
		kol_vo_z=kol_vo_z+1!Общее количество стержней
		if shag_z_m[i]>shag+r_arm and shag_osn="По Z" then gosub "dop_sterjen_z" !Раскладка доп. стержней при превышении шага
		koord_z_all[kol_vo_z][1]=nach_t+shag_z_m[i]-(zash_z_2+r_arm)*(otv=1)*(i=nach_otv)+(zash_z_2+r_arm)*(otv=1)*(i=nach_otv+1)!Массив координат общего количества стержней
		koord_z_all[kol_vo_z][2]=1!Массив координат общего количества стержней
	next i
else
	parameters koord_z_all[1][1]=coord_vn[1][3]+r_arm*(shag_osn<>"По Z")
	parameters koord_z_all[1][2]=1
	kol_vo_z=1
endif
"fin":

nrazmt = nrazmt + 1
razmt[nrazmt] = ax_vn

!parameters nrazm = nrazmt
!parameters razm = razmt
!add2 razm[1],0
!for i = 2 to nrazm
!	razms = razm[i] - razm[i-1]
!	sstxt = str("%.0mm", razms)
!!str("%.0",n)+"x"+str("%.0mm", shag)+"="+
!	call "Размеры" PARAMETERS all, dl = razms,sstxt = sstxt, h = h, dx=dxx[i],dy=dyy[i]
!	add2 razms,0
!next i
!del nrazm


endd=1
!---------------Дополнительные стержни по Х
if endd=0 then
text2 0,0,"!!!!"  !Если верите, что компьютеры добрые, то эту проверку можно убрать.
"dop_sterjen_x":
n_dop=int(shag_x_m[i]/shag)
	nach=i-1 !Начальная позиция
	j=1
	for j=1 to n_dop
		if shag_x_m[i]-shag*j<shag then
			koord_dop=shag*(j-1)+((shag_x_m[i]-shag*(j-1))*0.5)
			koord_dop = round_int(koord_dop * krat) / krat
!			if pokaz_osn=0 then
				hotspot2 nach_t+koord_dop,coord_vn[1][2]
				hotspot2 nach_t+koord_dop,coord_vn[2][2]
				hotspot2 nach_t+shag*(j-1),coord_vn[1][2]
				hotspot2 nach_t+shag*(j-1),coord_vn[2][2]
				gosub "addrazm"
!			endif
		else
			koord_dop=shag*j
		endif
		if j=1 then 
			hotspot2 nach_t+koord_dop,coord_vn[1][2]
			hotspot2 nach_t+koord_dop,coord_vn[2][2]
			nrazmt = nrazmt + 1
			razmt[nrazmt] = nach_t+koord_dop
		endif
		koord_x_all[kol_vo_x][1]=nach_t+koord_dop
		koord_x_all[kol_vo_x][2]=2
		kol_vo_x=kol_vo_x+1 !Общее количество стержней
	next j
	return
endif
!!---------------Дополнительные стержни по Y
if endd=0 then
text2 0,0,"!!!!"  !Если верите, что компьютеры добрые, то эту проверку можно убрать.
"dop_sterjen_y":
n_dop=int(shag_y_m[i]/shag)
	nach=i-1 !Начальная позиция
	j=1
	for j=1 to n_dop
		if shag_y_m[i]-shag*j<shag then
			koord_dop=shag*(j-1)+((shag_y_m[i]-shag*(j-1))*0.5)
			koord_dop = round_int(koord_dop * krat) / krat
!			if pokaz_osn=0 then
				hotspot2 coord_vn[1][1],nach_t+koord_dop
				hotspot2 coord_vn[3][1],nach_t+koord_dop
				hotspot2 coord_vn[1][1],nach_t+shag*(j-1)
				hotspot2 coord_vn[3][1],nach_t+shag*(j-1)
				gosub "addrazm"
!			endif
		else
			koord_dop=shag*j
		endif
		if j=1 then 
			hotspot2 coord_vn[1][1],nach_t+koord_dop
			hotspot2 coord_vn[3][1],nach_t+koord_dop
			nrazmt = nrazmt + 1
			razmt[nrazmt] = nach_t+koord_dop
		endif
		parameters koord_y_all[kol_vo_y][1]=nach_t+koord_dop
		parameters koord_y_all[kol_vo_y][2]=2
		kol_vo_y=kol_vo_y+1 !Общее количество стержней
	next j
	return
endif
!!---------------Дополнительные стержни по Z
if endd=0 then
text2 0,0,"!!!!"  !Если верите, что компьютеры добрые, то эту проверку можно убрать.
"dop_sterjen_z":
n_dop=int(shag_z_m[i]/shag)
	nach=i-1 !Начальная позиция
	j=1
	for j=1 to n_dop
		if shag_z_m[i]-shag*j<shag then
			koord_dop=shag*(j-1)+(shag_z_m[i]-shag*(j-1))*0.5
			koord_dop = round_int(koord_dop * krat) / krat
!			if pokaz_osn=0 then
				hotspot coord_vn[1][1],coord_vn[1][2],nach_t+koord_dop
				hotspot coord_vn[2][1],coord_vn[2][2],nach_t+koord_dop
				hotspot coord_vn[3][1],coord_vn[3][2],nach_t+koord_dop
				hotspot coord_vn[4][1],coord_vn[4][2],nach_t+koord_dop
				hotspot coord_vn[1][1],coord_vn[1][2],nach_t+shag*(j-1)
				hotspot coord_vn[2][1],coord_vn[2][2],nach_t+shag*(j-1)
				hotspot coord_vn[3][1],coord_vn[3][2],nach_t+shag*(j-1)
				hotspot coord_vn[4][1],coord_vn[4][2],nach_t+shag*(j-1)
				gosub "addrazm"
!			endif
		else
			koord_dop=shag*j
		endif
		if j=1 then 
			hotspot coord_vn[1][1],coord_vn[1][2],nach_t+koord_dop
			hotspot coord_vn[3][1],coord_vn[3][2],nach_t+koord_dop
			nrazmt = nrazmt + 1
			razmt[nrazmt] = nach_t+koord_dop
		endif
		parameters koord_z_all[kol_vo_z][1]=nach_t+koord_dop
		parameters koord_z_all[kol_vo_z][2]=2
		kol_vo_z=kol_vo_z+1 !Общее количество стержней
	next j
	return
endif

if endd=0 then
	"addrazm":
	if (koord_dop - shag*(j-1))<>shag then
		nrazmt = nrazmt + 1
		razmt[nrazmt] = nach_t+shag*(j-1)
		nrazmt = nrazmt + 1
		razmt[nrazmt] = nach_t+koord_dop
	endif
	return
endif
