!------------------------
! Reinforcement
! 2012, Eptar Kft.
!------------------------
define style "styleDimTopAnchor" stylefont,heightfontdim,2,0
define style "styleDimBottomAnchor" stylefont,heightfontdim,8,0
pen peniron
fill filliron
line_type ltiron
unidstart=unid
if _iirontype=iron_type_rebar then
if _ironsubtype=type_rebar_normal then gosub 100+10+iview
if _ironsubtype=type_rebar_polygon then gosub 100+20+iview
endif
if _iirontype=iron_type_stirrup then
if _ironsubtype=type_stirrup_normal then gosub 200+10+iview
if _ironsubtype=type_stirrup_polygon then gosub 200+20+iview
endif
if _iirontype=iron_type_mesh then
gosub 300+iview
endif
end unid
112:
if _iendtype1=1|_iendtype1=2|_iendtype1=3 then
_leftendx=0
else
_leftendx=_endlength1+abs(_offset1)
endif
if _iendtype2=1|_iendtype2=2|_iendtype2=3 then
_rightendx=_fulllength
else
_rightendx=_fulllength-_endlength2-abs(_offset2)
endif
pen peniron
line2 _leftendx,0,_rightendx,0
hotline2 _leftendx,0,_rightendx,0
if bshowdimtext then
style "styleDimBottomAnchor"
pen penfont
!!!!!!text2 _leftendx+(_rightendx-_leftendx)/2,0,str( "%.0mm",abs(_rightendx-_leftendx) )
endif
if _iendtype1=4|_iendtype1=5|_iendtype1=6 then
pen peniron
line2 0,_offset1,_endlength1,_offset1
line2 _endlength1,_offset1,_endlength1+abs(_offset1),0
hotline2 0,_offset1,_endlength1,_offset1
hotline2 _endlength1,_offset1,_endlength1+abs(_offset1),0
if bshowdimtext&sqr(2*_offset1**2)>eps then
style "styleDimBottomAnchor"
pen penfont
text2 _endlength1/2,_offset1,str( "%.0mm",abs(_endlength1) )
add2 _endlength1,_offset1
rot2 45*(1-2*(_offset1>=0) )
text2 sqr(2*_offset1**2)/2,0,str( "%.0mm",sqr(2*_offset1**2) )
pen peniron
del 2
endif
endif
if _iendtype1=5|_iendtype1=6 then add2 0,_offset1
if _iendtype1=2|_iendtype1=3|_iendtype1=5|_iendtype1=6 then
pen peniron
line2 0,0,0,-_endheight1
hotline2 0,0,0,-_endheight1
if bshowdimtext then
style "styleDimBottomAnchor"
rot2 90
pen penfont
text2-_endheight1/2,0,str( "%.0mm",abs(_endheight1) )
del 1
endif
if _iendtype1=3|_iendtype1=6 then
pen peniron
line2 0,-_endheight1,_turnbacklength1,-_endheight1
hotline2 0,-_endheight1,_turnbacklength1,-_endheight1
if bshowdimtext then
style "styleDimTopAnchor"
pen penfont
text2 _turnbacklength1/2,-_endheight1,str( "%.0mm",abs(_turnbacklength1) )
endif
endif
endif
if _iendtype1=5|_iendtype1=6 then del 1
if _iendtype2=4|_iendtype2=5|_iendtype2=6 then
pen peniron
line2 _fulllength,_offset2,_fulllength-_endlength2,_offset2
line2 _fulllength-_endlength2,_offset2,_fulllength-_endlength2-abs(_offset2),0
hotline2 _fulllength,_offset2,_fulllength-_endlength2,_offset2
hotline2 _fulllength-_endlength2,_offset2,_fulllength-_endlength2-abs(_offset2),0
if bshowdimtext&sqr(2*_offset2**2)>eps then
style "styleDimBottomAnchor"
pen penfont
text2 _fulllength-_endlength2/2,_offset2,str( "%.0mm",abs(_endlength2) )
add2 _fulllength-_endlength2,_offset2
rot2-45*(1-2*(_offset2>=0) )
text2-sqr(2*_offset2**2)/2,0,str( "%.0mm",sqr(2*_offset2**2) )
del 2
endif
endif
if _iendtype2=5|_iendtype2=6 then add2 0,_offset2
if _iendtype2=2|_iendtype2=3|_iendtype2=5|_iendtype2=6 then
pen peniron
line2 _fulllength,0,_fulllength,-_endheight2
hotline2 _fulllength,0,_fulllength,-_endheight2
if bshowdimtext then
rot2 90
style "styleDimTopAnchor"
pen penfont
text2-_endheight2/2,-_fulllength,str( "%.0mm",abs(_endheight2) )
del 1
endif
if _iendtype2=3|_iendtype2=6 then
pen peniron
line2 _fulllength,-_endheight2,_fulllength-_turnbacklength2,-_endheight2
hotline2 _fulllength,-_endheight2,_fulllength-_turnbacklength2,-_endheight2
if bshowdimtext then
style "styleDimTopAnchor"
pen penfont
text2 _fulllength-_turnbacklength2+_turnbacklength2/2,-_endheight2,str( "%.0mm",abs(_turnbacklength2) )
endif
endif
endif
if _iendtype2=5|_iendtype2=6 then del 1
if _iendtype1=1|_iendtype1=2|_iendtype1=3 then
_leftpos=0
else
_leftpos=_offset1
endif
if _iendtype2=1|_iendtype2=2|_iendtype2=3 then
_rightpos=0
else
_rightpos=_offset2
endif
if benablehsedit then
if benablefulllengthedit then
hotspot2 0,_rightpos,unid,fulllength,1+128:unid=unid+1
hotspot2 fulllength,_rightpos,unid,fulllength,2:unid=unid+1
hotspot2-1,_rightpos,unid,fulllength,3:unid=unid+1
else
unid=unid+3
endif
if _iendtype1=2|_iendtype1=3|_iendtype1=5|_iendtype1=6 then
hotspot2 0,_leftpos,unid,endheight1,1+128:unid=unid+1
hotspot2 0,_leftpos-_endheight1,unid,endheight1,2:unid=unid+1
hotspot2 0,_leftpos+1,unid,endheight1,3:unid=unid+1
if _iendtype1=3|_iendtype1=6 then
hotspot2 0,_leftpos-_endheight1,unid,turnbacklength1,1+128:unid=unid+1
hotspot2 _turnbacklength1,_leftpos-_endheight1,unid,turnbacklength1,2:unid=unid+1
hotspot2-1,_leftpos-_endheight1,unid,turnbacklength1,3:unid=unid+1
else
unid=unid+3
endif
else
unid=unid+6
endif
if _iendtype2=2|_iendtype2=3|_iendtype2=5|_iendtype2=6 then
hotspot2 _fulllength,_rightpos,unid,endheight2,1+128:unid=unid+1
hotspot2 _fulllength,_rightpos-_endheight2,unid,endheight2,2:unid=unid+1
hotspot2 _fulllength,_rightpos+1,unid,endheight2,3:unid=unid+1
if _iendtype2=3|_iendtype2=6 then
hotspot2 _fulllength,_rightpos-_endheight2,unid,turnbacklength2,1+128:unid=unid+1
hotspot2 _fulllength-_turnbacklength2,_rightpos-_endheight2,unid,turnbacklength2,2:unid=unid+1
hotspot2 _fulllength+1,_rightpos-_endheight2,unid,turnbacklength2,3:unid=unid+1
else
unid=unid+3
endif
else
unid=unid+6
endif
if _iendtype1=4|_iendtype1=5|_iendtype1=6 then
hotspot2 0,_leftpos,unid,endlength1,1+128:unid=unid+1
hotspot2 _endlength1,_leftpos,unid,endlength1,2:unid=unid+1
hotspot2-1,_leftpos,unid,endlength1,3:unid=unid+1
hotspot2 _endlength1,0,unid,offset1,1+128:unid=unid+1
hotspot2 _endlength1,_offset1,unid,offset1,2:unid=unid+1
hotspot2 _endlength1,-1,unid,offset1,3:unid=unid+1
hotspot2 _endlength1+abs(_offset1),0,unid:unid=unid+1
else
unid=unid+7
endif
if _iendtype2=4|_iendtype2=5|_iendtype2=6 then
hotspot2 _fulllength,_rightpos,unid,endlength2,1+128:unid=unid+1
hotspot2 _fulllength-_endlength2,_rightpos,unid,endlength2,2:unid=unid+1
hotspot2 _fulllength+1,_rightpos,unid,endlength2,3:unid=unid+1
hotspot2 _fulllength-_endlength2,0,unid,offset2,1+128:unid=unid+1
hotspot2 _fulllength-_endlength2,_offset2,unid,offset2,2:unid=unid+1
hotspot2 _fulllength-_endlength2,-1,unid,offset2,3:unid=unid+1
hotspot2 _fulllength-_endlength2-abs(_offset2),0,unid:unid=unid+1
else
unid=unid+7
endif
endif
return
122:
if not(bnullhotspot) then
if benablehsedit then
for i=1 to vardim1(rebarprevcoords)
unid=unidstart+(i-1)*20
hotspot2 0,rebarprevcoords[i][2],unid,rebarprevcoords[i][1],1+128:unid=unid+1
hotspot2-1,rebarprevcoords[i][2],unid,rebarprevcoords[i][1],3:unid=unid+1
hotspot2 rebarprevcoords[i][1],rebarprevcoords[i][2],unid,rebarprevcoords[i][1],2:unid=unid+1
hotspot2 rebarprevcoords[i][1],0,unid,rebarprevcoords[i][2],1+128:unid=unid+1
hotspot2 rebarprevcoords[i][1],-1,unid,rebarprevcoords[i][2],3:unid=unid+1
hotspot2 rebarprevcoords[i][1],rebarprevcoords[i][2],unid,rebarprevcoords[i][2],2:unid=unid+1
next i
for i=1 to __nironpoint-not(_bclosedpolygon)
if i<=vardim1(rebararcpoints) then
hotspot2 _halfpoints[i][1],_halfpoints[i][2],unid,rebararcpoints[i],1:unid=unid+1
hotspot2 _halfpoints[i][5],_halfpoints[i][6],unid,rebararcpoints[i],3:unid=unid+1
hotspot2 _halfpoints[i][3],_halfpoints[i][4],unid,rebararcpoints[i],2:unid=unid+1
gosub "arcSign"
endif
if i<=vardim1(rebarnewpoint) then
hotspot2 0,rebarnewpoint[i][2],unid,rebarnewpoint[i][1],1+128:unid=unid+1
hotspot2-1,rebarnewpoint[i][2],unid,rebarnewpoint[i][1],3:unid=unid+1
hotspot2 rebarnewpoint[i][1],rebarnewpoint[i][2],unid,rebarnewpoint[i][1],2:unid=unid+1
hotspot2 rebarnewpoint[i][1],0,unid,rebarnewpoint[i][2],1+128:unid=unid+1
hotspot2 rebarnewpoint[i][1],-1,unid,rebarnewpoint[i][2],3:unid=unid+1
hotspot2 rebarnewpoint[i][1],rebarnewpoint[i][2],unid,rebarnewpoint[i][2],2:unid=unid+1
gosub "newPointSign"
endif
next i
else
for i=1 to __nironpoint
unid=unidstart+(i-1)*20
hotspot2 __ironpointcoords[i][1],__ironpointcoords[i][2],unid
next i
endif
endif
gosub "drawPolygonIron"
return
213:
add2 0,-_hoopy/2*0
if bdetailedsection then
put _cxr-_bendradius*_s45-_jointlength*_s45,_cyt+_bendradius*_s45-_jointlength*_s45,1,
_cxr-_bendradius*_s45,_cyt+_bendradius*_s45,1,
_hoopx,_cyt,1001,
_hoopx,_cyb,1,
_cxr,0,1001,
_cxl,0,1,
0,_cyb,1001,
0,_cyt,1,
_cxl,_hoopy,1001,
_cxr,_hoopy,1,
-1,0,800,
_cxr-sqr(2*_bendradius*_d-_d**2),_hoopy-_d,1001,
_cxl,_hoopy-_d,1,
_d,_cyt,1001,
_d,_cyb,1,
_cxl,_d,1001,
_cxr,_d,1,
_hoopx-_d,_cyb,1001,
_hoopx-_d,_cyt,1,
_cxr-(_bendradius-_d)*_s45,_cyt+(_bendradius-_d)*_s45,1001,
_cxr-_bendradius*_s45-_jointlength*_s45+_d*_s45,_cyt+_bendradius*_s45-_jointlength*_s45-_d*_s45,1
poly2_b(nsp/3),1+2+4,penfilliron,penfillbgiron,
get(nsp)
put _hoopx-_d,_cyt,1,
0,-1,800,
_cxr+(_bendradius-_d)*_s45,_cyt-(_bendradius-_d)*_s45,1001,
_cxr+(_bendradius-_d)*_s45-_jointlength*_s45,_cyt-(_bendradius-_d)*_s45-_jointlength*_s45,1,
_cxr+_bendradius*_s45-_jointlength*_s45,_cyt-_bendradius*_s45-_jointlength*_s45,1,
_cxr+_bendradius*_s45,_cyt-_bendradius*_s45,1,
_hoopx-_d,_cyt-sqr(2*_bendradius*_d-_d**2),1001,
_hoopx-_d,_cyt,1
poly2_b(nsp/3),1+2+4,penfilliron,penfillbgiron,
get(nsp)
else
poly2_b 12,1,0,0,
_cxr-_bendradius*_s45-_jointlength*_s45,_cyt+_bendradius*_s45-_jointlength*_s45,1,
_cxr-_bendradius*_s45,_cyt+_bendradius*_s45,1,
_hoopx,_cyt,1001,
_hoopx,_cyb,1,
_cxr,0,1001,
_cxl,0,1,
0,_cyb,1001,
0,_cyt,1,
_cxl,_hoopy,1001,
_cxr,_hoopy,1,
_cxr+_bendradius*_s45,_cyt-_bendradius*_s45,1001,
_cxr+_bendradius*_s45-_jointlength*_s45,_cyt-_bendradius*_s45-_jointlength*_s45,1
endif
if bshowdimtext then
pen penfont
style "styleDimTopAnchor"
text2 _hoopx/2,0,str( "%.0mm",abs(_hoopx) )
rot2 90
style "styleDimBottomAnchor"
text2 _hoopy/2,0,str( "%.0mm",abs(_hoopy) )
del 1
endif
hotline2 _bendradius,0,_hoopx-_bendradius,0
hotarc2 _hoopx-_bendradius,_bendradius,_bendradius,270,360
hotline2 _hoopx,_bendradius,_hoopx,_hoopy-_bendradius
hotarc2 _hoopx-_bendradius,_hoopy-_bendradius,_bendradius,0,90
hotline2 _hoopx-_bendradius,_hoopy,_bendradius,_hoopy
hotarc2 _bendradius,_hoopy-_bendradius,_bendradius,90,180
hotline2 0,_hoopy-_bendradius,0,_bendradius
hotarc2 _bendradius,_bendradius,_bendradius,180,270
return
223:
if not(bnullhotspot) then
if benablehsedit then
for i=1 to vardim1(stirrupprevcoords)
unid=unidstart+(i-1)*20
hotspot2 0,stirrupprevcoords[i][2],unid,stirrupprevcoords[i][1],1+128:unid=unid+1
hotspot2-1,stirrupprevcoords[i][2],unid,stirrupprevcoords[i][1],3:unid=unid+1
hotspot2 stirrupprevcoords[i][1],stirrupprevcoords[i][2],unid,stirrupprevcoords[i][1],2:unid=unid+1
hotspot2 stirrupprevcoords[i][1],0,unid,stirrupprevcoords[i][2],1+128:unid=unid+1
hotspot2 stirrupprevcoords[i][1],-1,unid,stirrupprevcoords[i][2],3:unid=unid+1
hotspot2 stirrupprevcoords[i][1],stirrupprevcoords[i][2],unid,stirrupprevcoords[i][2],2:unid=unid+1
next i
for i=1 to __nironpoint-not(_bclosedpolygon)
if i<=vardim1(stirruparcpoints) then
hotspot2 _halfpoints[i][1],_halfpoints[i][2],unid,stirruparcpoints[i],1:unid=unid+1
hotspot2 _halfpoints[i][5],_halfpoints[i][6],unid,stirruparcpoints[i],3:unid=unid+1
hotspot2 _halfpoints[i][3],_halfpoints[i][4],unid,stirruparcpoints[i],2:unid=unid+1
gosub "arcSign"
endif
if i<=vardim1(stirrupnewpoint) then
hotspot2 0,stirrupnewpoint[i][2],unid,stirrupnewpoint[i][1],1+128:unid=unid+1
hotspot2-1,stirrupnewpoint[i][2],unid,stirrupnewpoint[i][1],3:unid=unid+1
hotspot2 stirrupnewpoint[i][1],stirrupnewpoint[i][2],unid,stirrupnewpoint[i][1],2:unid=unid+1
hotspot2 stirrupnewpoint[i][1],0,unid,stirrupnewpoint[i][2],1+128:unid=unid+1
hotspot2 stirrupnewpoint[i][1],-1,unid,stirrupnewpoint[i][2],3:unid=unid+1
hotspot2 stirrupnewpoint[i][1],stirrupnewpoint[i][2],unid,stirrupnewpoint[i][2],2:unid=unid+1
gosub "newPointSign"
endif
next i
else
for i=1 to __nironpoint
unid=unidstart+(i-1)*20
hotspot2 __ironpointcoords[i][1],__ironpointcoords[i][2],unid
next i
endif
endif
gosub "drawPolygonIron"
return
301:
add2 0,-_nety/2
if bcalledfromlist then
visibley[1][1]=min(visibley[1][1],_nety-0.01)
visibley[1][2]=min(visibley[1][2],_nety-0.01)
visiblex[1][1]=min(visiblex[1][1],_netx-0.01)
visiblex[1][2]=min(visiblex[1][2],_netx-0.01)
endif
i=1
_yact=_nety*500
while i<10000&_yact>_nety-visibley[1][1]-eps do
_yact=_yact-_nety
i=i+1
endwhile
i=1
while i<10000&_yact<_nety+visibley[1][2]+eps do
line2-visiblex[1][1],_yact,_netx+visiblex[1][2],_yact
_yact=_yact+_nety
i=i+1
endwhile
i=1
_xact=_netx*500
while i<10000&_xact>-visiblex[1][1]-eps+_netx do
_xact=_xact-_netx
i=i+1
endwhile
i=1
while i<10000&_xact<_netx+visiblex[1][2]+eps do
line2 _xact,-visibley[1][1],_xact,_nety+visibley[1][2]
_xact=_xact+_netx
i=i+1
endwhile
if bshowdimtext then
style "styleDimTopAnchor"
pen penfont
text2 _netx/2,0,str( "%.0mm",abs(_netx) )
rot2 90
style "styleDimBottomAnchor"
text2 _nety/2,0,str( "%.0mm",abs(_nety) )
del 1
endif
if benablehsedit then
hotspot2 0,0,unid,netx,1+256:unid=unid+1
hotspot2 _netx,0,unid,netx,2:unid=unid+1
hotspot2-1,0,unid,netx,3:unid=unid+1
hotspot2 0,_nety,unid,netx,1+256:unid=unid+1
hotspot2 _netx,_nety,unid,netx,2:unid=unid+1
hotspot2-1,_nety,unid,netx,3:unid=unid+1
hotspot2 0,0,unid,nety,1+256:unid=unid+1
hotspot2 0,_nety,unid,nety,2:unid=unid+1
hotspot2 0,-1,unid,nety,3:unid=unid+1
hotspot2 _netx,0,unid,nety,1+256:unid=unid+1
hotspot2 _netx,_nety,unid,nety,2:unid=unid+1
hotspot2 _netx,-1,unid,nety,3:unid=unid+1
endif
del 1
return
"drawPolygonIron":
line_type ltiron
style "styleDimBottomAnchor"
if bshowdimtext then
pen penfont
for i=1 to __nironpoint-not(_bclosedpolygon)
add2 _halfpoints[i][3],_halfpoints[i][4]
rot2 _lineangle[i]
text2 0,0,str( "%.0mm",abs(_sidelength[i]) )
del 2
next i
endif
gosub "bendCalculation"
pen peniron
for i=1 to npoint-1
if detisarc[i] then
vx=detpoints[i][1]-detarccenter[i][1]
vy=detpoints[i][2]-detarccenter[i][2]
gosub "directionAngle"
startangle=angle
if detarcangle[i]<0 then startangle=startangle-abs(detarcangle[i])
arc2 detarccenter[i][1],detarccenter[i][2],detradiusdist[i],startangle,startangle+abs(detarcangle[i])
hotarc2 detarccenter[i][1],detarccenter[i][2],detradiusdist[i],startangle,startangle+abs(detarcangle[i])
else
line2 detpoints[i][1],detpoints[i][2],detpoints[i+1][1],detpoints[i+1][2]
hotline2 detpoints[i][1],detpoints[i][2],detpoints[i+1][1],detpoints[i+1][2]
endif
next i
if boffset then
dim offsetedcoords[][2]
gosub "offcetCalculate"
for i=1 to __nironpoint-not(_bclosedpolygon)
if _isarc[i] then
if boffsetdebug then
arc2 _arccenter[i][1],_arccenter[i][2],abs(_radiusdistance[i]+__ironarcpoints[i]+offsetdist),offsetarcangle[i][2],offsetarcangle[i][2]+abs(offsetarcangle[i][1])
endif
hotarc2 _arccenter[i][1],_arccenter[i][2],abs(_radiusdistance[i]+__ironarcpoints[i]+offsetdist),offsetarcangle[i][2],offsetarcangle[i][2]+abs(offsetarcangle[i][1])
else
if i=__nironpoint then
if boffsetdebug then
line2 offsetedcoords[i][1],offsetedcoords[i][2],offsetedcoords[1][1],offsetedcoords[1][2]
endif
hotline2 offsetedcoords[i][1],offsetedcoords[i][2],offsetedcoords[1][1],offsetedcoords[1][2]
else
if boffsetdebug then
line2 offsetedcoords[i][1],offsetedcoords[i][2],offsetedcoords[i+1][1],offsetedcoords[i+1][2]
endif
hotline2 offsetedcoords[i][1],offsetedcoords[i][2],offsetedcoords[i+1][1],offsetedcoords[i+1][2]
endif
endif
next i
endif
return
"arcSign":
pen penfont
line_type 1
add2 _halfpoints[i][3],_halfpoints[i][4]
rot2 _lineangle[i]
add2 _signsize[i],-_signoffset*(_signsize[i]/_signl)
rect2-_signsize[i]*2,-_signsize[i],0,_signsize[i]
arc2-_signsize[i],-_signsize[i]/2,_signsize[i]*0.75,0,180
del 3
return
"newPointSign":
pen penfont
line_type 1
add2 __ironnewpoint[i][1],__ironnewpoint[i][2]
rot2 _lineangle[i]
add2-_signsize[i],-_signoffset*(_signsize[i]/_signl)
rect2 0,-_signsize[i],_signsize[i]*2,_signsize[i]
add2 _signsize[i],0
line2-_signsize[i]*0.75,-_signsize[i]/2,0,_signsize[i]/2
line2 _signsize[i]*0.75,-_signsize[i]/2,0,_signsize[i]/2
del 4
return