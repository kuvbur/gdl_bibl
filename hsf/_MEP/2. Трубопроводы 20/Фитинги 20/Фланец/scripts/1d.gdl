EPS = 0.00001strmm_txt = ""if SetProgram = 0 then	call "Показ_систем" PARAMETERS All isMep=0, isEqp=1 RETURNED_PARAMETERS show_elelse	call "Показ_систем" PARAMETERS All isMep=1, isEqp=1 RETURNED_PARAMETERS show_el, syst_nameendifis_error = 0error_msg = ""success = LIBRARYGLOBAL ("Libraryflobals-mep", "show_axis", show_axis)success = LIBRARYGLOBAL ("Libraryflobals-mep", "show_conventions", show_conventions)success = LIBRARYGLOBAL ("Libraryflobals-mep", "gs_detlevel_2D_m",gs_detlevel_2D_m)success = LIBRARYGLOBAL ("Libraryflobals-mep", "gs_detlevel_3D_m", gs_detlevel_3D_m)dim tflange_type[] : dim flange_type_fname_arr[] : dim iflange_type[] : i=0i=i+1 : tflange_type[i] = "Плоский приварной (тип 01)" : flange_type_fname_arr[i] = "фл_т1_33259" : iflange_type[i] = 1i=i+1 : tflange_type[i] = "Свободный на приварном кольце (тип 02)" : flange_type_fname_arr[i] = "фл_т2_33259": iflange_type[i] = 2i=i+1 : tflange_type[i] = "Приварной встык / воротниковый (тип 11)" : flange_type_fname_arr[i] = "фл_т11_33259": iflange_type[i] = 11dim mrf2d_read_file[] : mrf2d_read_file[1] = ""dim mrf2d_koeff[][]mrf2d_read_file[1] = "фл_т1_33259_вес"mrf2d_read_file[2] = "фл_т1_33259"mrf2d_read_file[3] = "фл_т2_33259"mrf2d_read_file[4] = "фл_т11_33259"for i=1 to vardim1(mrf2d_read_file)	for j=1 to 12		mrf2d_koeff[i][j] = 1	next jnext imrf2d_koeff[1][1]=1/1000for i=2 to vardim1(mrf2d_read_file)	mrf2d_koeff[i][1]=1/1000	mrf2d_koeff[i][3]=1/1000	mrf2d_koeff[i][4]=1/1000	mrf2d_koeff[i][5]=1/1000	mrf2d_koeff[i][6]=1/1000	mrf2d_koeff[i][8]=1/1000	mrf2d_koeff[i][9]=1/1000	mrf2d_koeff[i][10]=1/1000	mrf2d_koeff[i][11]=1/1000	mrf2d_koeff[i][12]=1/1000next ireload_txt = 1dim tflange_subtype[] : dim iflange_subtype[] : dim suffflange_subtype[] : i=0i=i+1 : tflange_subtype[i] = "Исп. А. Плоскость" : iflange_subtype[i] = i : suffflange_subtype[i] = "A"i=i+1 : tflange_subtype[i] = "Исп. В. Соединительный выступ" : iflange_subtype[i] = i : suffflange_subtype[i] = "B"i=i+1 : tflange_subtype[i] = "Исп. С. Шип" : iflange_subtype[i] = i : suffflange_subtype[i] = "C"i=i+1 : tflange_subtype[i] = "Исп. D. Паз" : iflange_subtype[i] = i : suffflange_subtype[i] = "D"i=i+1 : tflange_subtype[i] = "Исп. F. Впадина" : iflange_subtype[i] = i : suffflange_subtype[i] = "F"i=i+1 : tflange_subtype[i] = "Исп. Е. Выступ" : iflange_subtype[i] = i : suffflange_subtype[i] = "E"i=i+1 : tflange_subtype[i] = "Исп. К. Под линзовую прокладку" : iflange_subtype[i] = i : suffflange_subtype[i] = "K"i=i+1 : tflange_subtype[i] = "Исп. L. Шип" : iflange_subtype[i] = i : suffflange_subtype[i] = "L"i=i+1 : tflange_subtype[i] = "Исп. М. Паз" : iflange_subtype[i] = i : suffflange_subtype[i] = "M"i=i+1 : tflange_subtype[i] = "Исп. J. Под прокладку овального сечения" : iflange_subtype[i] = i : suffflange_subtype[i] = "J"dim tflange_pressure[] : dim iflange_pressure[] : i=0i=i+1 : tflange_pressure[i] = "PN16" : iflange_pressure[i] = 16*10i=i+1 : tflange_pressure[i] = "PN1" : iflange_pressure[i] = 1*10i=i+1 : tflange_pressure[i] = "PN2.5" : iflange_pressure[i] = 2.5*10i=i+1 : tflange_pressure[i] = "PN6" : iflange_pressure[i] = 6*10i=i+1 : tflange_pressure[i] = "PN10" : iflange_pressure[i] = 10*10i=i+1 : tflange_pressure[i] = "PN25" : iflange_pressure[i] = 25*10!!! ------------------- Обработка ошибок ---------------------if (flange_dn-0.02)<EPS then 	is_error = 1	flange_dn = 108/1000endiferror_msg = ""is_error = 0if not(haskey(flange_dict_all.is_read)) then	is_error = 1	error_msg = "Ошибка макроса чтения файла"else	if flange_dict_all.is_read = 0 then		is_error = 1		error_msg = "Ни один файл не прочитан"	endifendifif not(is_error) then	for i=1 to vardim1(mrf2d_read_file)		if haskey(flange_dict_all.file) then			if haskey(flange_dict_all.file[i].is_read) then				if flange_dict_all.file[i].is_read=0 then					is_error = 1					error_msg = "Файл не "+ mrf2d_read_file[i] +" прочитан"				endif			else				is_error = 1				error_msg = "Файл не "+ mrf2d_read_file[i] +" прочитан"			endif		else			is_error = 1			error_msg = "Файл не "+ mrf2d_read_file[i] +" прочитан"		endif	next iendifif is_error then	reload_txt = 1	goto "m_end"endifdZx = 0 : dZy = 0 : dZz = 0dx = 0 : dy = 0 : dz = 0 : rx1 = 0 : ry1 = 0 : dirAngOnXYPlane = 0if SetProgram then	dZx = -MEP_Position[3][2]*MEP_Position[2][3]+MEP_Position[3][3]*MEP_Position[2][2]	dZy = -MEP_Position[3][3]*MEP_Position[2][1]+MEP_Position[3][1]*MEP_Position[2][3]	dZz = -MEP_Position[3][1]*MEP_Position[2][2]+MEP_Position[3][2]*MEP_Position[2][1]	rx1 = MEP_Position[1][1]	ry1 = MEP_Position[1][2]	rz1 = MEP_Position[1][3]	rx2 = rx1+MEP_Position[2][1]*MEP_StraightLength	ry2 = ry1+MEP_Position[2][2]*MEP_StraightLength	rz2 = rz1+MEP_Position[2][3]*MEP_StraightLength	dx = rx2-rx1	dy = ry2-ry1	dz = rz2-rz1	if abs(dz)<EPS then dz = 0	if abs(dx)<EPS then dx = 0	if abs(dy)<EPS then dy = 0	IF ABS(dZz-1) < EPS THEN		arCosVal = MEP_Position[3][1]/1		IF ABS(arCosVal) > 1 AND SGN(arCosVal) = -1 THEN arCosVal = -1		IF ABS(arCosVal) > 1 AND SGN(arCosVal) = 1 THEN arCosVal = 1		dirAngOnXYPlane = ACS(arCosVal)-90		IF SGN(MEP_Position[3][2]) = -1 THEN dirAngOnXYPlane = 180-dirAngOnXYPlane	ELSE		IF ABS(dx)>EPS OR ABS(dy)>EPS THEN			arCosVal = dx/(SQR(dx^2+dy^2))			IF ABS(arCosVal) > 1 AND SGN(arCosVal) = -1 THEN arCosVal = -1			IF ABS(arCosVal) > 1 AND SGN(arCosVal) = 1 THEN arCosVal = 1			dirAngOnXYPlane = ACS(arCosVal)			IF SGN(dy) = -1 THEN dirAngOnXYPlane = 360-dirAngOnXYPlane		ENDIF	ENDIFendifflange_full_t = flange_t + flange_t1 + flange_t2"m_end":