
! Contact person: <NJ>

! =============================================================================
! 3D detail level settings
! =============================================================================

! -----------------------------------------------------------------------------
! Sunshading Detail Level control
! -----------------------------------------------------------------------------

LOD3D_SIMPLEPLANE = 1
LOD3D_DETAILEDPLANE = 2
LOD3D_SIMPLEPANEL = 3
LOD3D_DETAILEDPANEL = 4

lod3D_sunShade = 0
if lod3D = 1 then lod3D_sunShade = LOD3D_SIMPLEPANEL		! Simple 3D
if lod3D = 2 then lod3D_sunShade = LOD3D_DETAILEDPANEL		! Detailed 3D


! =============================================================================
! Wallhole Structure
! =============================================================================

call "WallholeStructure" parameters all A = A, B = B,
	AC_Sill_To_Curr_Story	= AC_Sill_To_Curr_Story,
	ac_wallhole_width		= ac_wallhole_width,
	ac_wallhole_height		= ac_wallhole_height,
	ac_reveal_width			= ac_wallhole_width  - gs_reveal_left - gs_reveal_right,
	ac_reveal_height		= ac_wallhole_height - gs_reveal_top  - gs_reveal_bottom,
	refWidth				= refWidth,
	leftWidth				= leftWallholeWidth,
	rightWidth				= rightWallholeWidth,
	iRevealType				= iRevealType,
	iSillRevealType			= iSillRevealType,
	iBoardRevealType		= iBoardRevealType,
	leftWallholeRevealPnts	= leftWallholeRevealPnts,
	rightWallholeRevealPnts	= rightWallholeRevealPnts,
	iRevealPointsIdx		= iRevealPointsIdx,
	revealInnerLeft			= revealInnerLeft,
	revealInnerRight		= revealInnerRight,
	iClosureType			= iClosureType,
	radSill					= radSill,
	radBoard				= radBoard,
	WOD						= WOD,
	overSizeLeft			= overSizeLeft,
	overSizeRight			= overSizeRight,
	overSizeUpper			= overSizeUpper,
	overSizeLower			= overSizeLower,
! --- Function Control Parameters
	bEnableParapetInset		= bEnableParapetInset,
	bEnableMasonryArch		= bEnableMasonryArch,
	bEnableFaschen			= bEnableFaschen,
! --- Macro Control Parameters
	isWindow				= 1,
	gs_IsCurved				= gs_IsCurved,
	bParalellInCurvedWalls	= bParalellInCurvedWalls,
! --- Corner Functions
	bLeftCornerFunction		= bLeftCornerFunction,
	leftCornerAngle			= leftCornerAngle,
	leftConnWallThk			= leftConnWallThk,
	bRightCornerFunction	= bRightCornerFunction,
	rightCornerAngle		= rightCornerAngle,
	rightConnWallThk		= rightConnWallThk,
! --- sunShade wallhole size modification
	includeBoxHeight		= _includeBoxHeight,
! --- Turn Plaster
	possibleSkinTurnIn		= possibleSkinTurnIn,
	possibleSkinTurnOut		= possibleSkinTurnOut,
	gs_turn_plaster_show_3D	= gs_turn_plaster_show_3D,
	thkPlasterAtSillLeft	= thkPlasterAtSillLeft,
	thkPlasterAtSillRight	= thkPlasterAtSillRight,
	thkPlasterAtSillTop		= thkPlasterAtSillTop,
	thkPlasterAtSillBottom	= thkPlasterAtSillBottom,
	thkPlasterAtBoardLeft	= thkPlasterAtBoardLeft,
	thkPlasterAtBoardRight	= thkPlasterAtBoardRight,
	thkPlasterAtBoardTop	= thkPlasterAtBoardTop,
	thkPlasterAtBoardBottom	= thkPlasterAtBoardBottom,
! --- Casing
	bDrawOutsideTrim		= bDrawOutsideTrim,
	bDrawInsideTrim			= bDrawInsideTrim,
! --- String Resources
	stWallContourLine		= stWallContourLine,
	stMasonryArchTypes		= stMasonryArchTypes,
	stMasonryArchStructure	= stMasonryArchStructure,
! --- Parapet
	iParapetBottom			= iParapetBottom,
	iParapetSize			= iParapetSize,
	bShowAddHotspotsForIS	= bShowAddHotspotsForIS


! =============================================================================
! Wallhole Framing
! =============================================================================

if lod3D > 0 then

	gs_sill_pen_3D	= 0
	gs_board_pen_3D	= 0

	call "WallholeFraming" parameters all A = A,
		refWidth				= refWidth,
		leftWidth				= leftWidth,
		rightWidth				= rightWidth,
		iRevealType				= iRevealType,
		iSillRevealType			= iSillRevealType,
		leftWallFrameRevealPnts	= leftWallholeRevealPnts,
		rightWallFrameRevealPnts= rightWallholeRevealPnts,
		iRevealPointsIdx		= iRevealPointsIdx,
		revealInnerLeft			= revealInnerLeft,
		revealInnerRight		= revealInnerRight,
		radSill					= radSill,
		radBoard				= radBoard,
		WOD						= WOD,
		overSizeLeft			= overSizeLeft,
		overSizeRight			= overSizeRight,
		overSizeUpper			= overSizeUpper,
		overSizeLower			= overSizeLower,
	! --- Function Control Parameters
		bEnableSill				= bEnableSill,
		bEnableBoard			= bEnableBoard,
		bEnableThreshold		= bEnableThreshold,
		bEnableCasing			= bEnableCasing,
		bEnableShutter			= bEnableShutter,
		bEnableCustomCornerLeft		= bEnableCustomCornerLeft,
		bEnableCustomCornerRight	= bEnableCustomCornerRight,
		bBoardInPolyWall		= bBoardInPolyWall,
	! --- Macro Control Parameters
		isWindow				= 1,
		gs_IsCurved				= gs_IsCurved,
		bParalellInCurvedWalls	= bParalellInCurvedWalls,
		bCasingTolerance		= 0,
		bSillPlaneCut			= bSillPlaneCut,
		bBoardPlaneCut			= bBoardPlaneCut,
	! --- Corner Functions
		bLeftCornerFunction		= bLeftCornerFunction,
		leftCornerAngle			= leftCornerAngle,
		leftConnWallThk			= leftConnWallThk,
		bRightCornerFunction	= bRightCornerFunction,
		rightCornerAngle		= rightCornerAngle,
		rightConnWallThk		= rightConnWallThk,
	! --- sunShade wallhole size modification
		includeBoxHeight		= _includeBoxHeight,
	! --- Turn Plaster
		gs_turn_plaster_show_3D	= gs_turn_plaster_show_3D,
		thkPlasterAtSillLeft	= thkPlasterAtSillLeft,
		thkPlasterAtSillRight	= thkPlasterAtSillRight,
		thkPlasterAtSillTop		= thkPlasterAtSillTop,
		thkPlasterAtSillBottom	= thkPlasterAtSillBottom,
		thkPlasterAtBoardLeft	= thkPlasterAtBoardLeft,
		thkPlasterAtBoardRight	= thkPlasterAtBoardRight,
		thkPlasterAtBoardTop	= thkPlasterAtBoardTop,
		thkPlasterAtBoardBottom	= thkPlasterAtBoardBottom,
	! --- Frame Sizes
		gs_frame_width			= 0,
		gs_frame_width_left		= 0,
	! --- String Resources
		stSillTypes				= stSillTypes,
		stBsilldetlevel 		= stBsilldetlevel,

		lod3D_sunShade			= lod3D_sunShade
endif


! =============================================================================
! Returned Parameters
! =============================================================================

if gs_stack_top then
	gs_frame_ovhg_top_out	= 0
	gs_frame_ovhg_top_in	= 0
else
	if iRevealType = REVEAL_SLANTED then
		gs_frame_ovhg_top_out	= overSize + gs_tolerance_upper + WIDO_FRAME_THICKNESS * tan(gs_reveal_top_angle)
		gs_frame_ovhg_top_in	= overSize + gs_tolerance_upper
	else
		gs_frame_ovhg_top_out	= overSize + gs_tolerance_upper
		gs_frame_ovhg_top_in	= overSize + gs_tolerance_upper
	endif
endif

if gs_stack_bottom then
	gs_frame_ovhg_bottom_out	= 0
	gs_frame_ovhg_bottom_in		= 0
else
	if iRevealType = REVEAL_SLANTED & (not(bDrawSill) & not(bDrawBoard)) then
		gs_frame_ovhg_bottom_out	= overSizeLower + gs_tolerance_lower + WIDO_FRAME_THICKNESS * tan(gs_reveal_bottom_angle)
		gs_frame_ovhg_bottom_in		= overSizeLower + gs_tolerance_lower
	else
		gs_frame_ovhg_bottom_out	= overSizeLower + gs_tolerance_lower
		gs_frame_ovhg_bottom_in		= overSizeLower + gs_tolerance_lower
	endif
endif

if iRevealType = REVEAL_SLANTED & not(WIDO_REVEAL_SIDE) then
	temp = gs_frame_ovhg_top_in
	gs_frame_ovhg_top_in = gs_frame_ovhg_top_out
	gs_frame_ovhg_top_out = temp

	temp = gs_frame_ovhg_bottom_in
	gs_frame_ovhg_bottom_in = gs_frame_ovhg_bottom_out
	gs_frame_ovhg_bottom_out = temp
endif


! =============================================================================

addPrmX = offsWindowX
addPrmY = gs_tolerance_lower
addPrmZ = 0
mulPrmX = 1
mulPrmY = 1

if not(bShowReveal) then
	leftUnitWidth	= min(-leftWallFrameRevealPnts[idxFrameStartRevealLeft][1], -leftWallFrameRevealPnts[idxFrameEndRevealLeft][1])
	rightUnitWidth	= min(rightWallFrameRevealPnts[idxFrameStartRevealRight][1], rightWallFrameRevealPnts[idxFrameEndRevealRight][1])

	ac_unit_width = leftUnitWidth + rightUnitWidth - cornerPostXRight - cornerPostXLeft
endif

end ac_unit_width,
	ac_unit_height,
	gs_frame_ovhg_left_out,
	gs_frame_ovhg_right_out,
	gs_frame_ovhg_top_out,
	gs_frame_ovhg_bottom_out,
	gs_frame_ovhg_left_in,
	gs_frame_ovhg_right_in,
	gs_frame_ovhg_top_in,
	gs_frame_ovhg_bottom_in,
	bMirrored,

	mulPrmX, 0,					 0,					 addPrmX,
	0,		 mulPrmY * cos(-90),-sin(-90),			 addPrmY,
	0,		 mulPrmY * sin(-90), mulPrmY * cos(-90),-addPrmZ,

	bShowAddHotspots, bShowAddHotspotsForIS

