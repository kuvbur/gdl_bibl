
EPS = 0.0001

CABINET				= 0
SIMPLE_DESK			= 1
LAYOUT_ISLAND		= 2
LAYOUT_LINEAR		= 3
WS_SOLO				= 4

TTOP_L_SHAPED		= 1
TTOP_STRAIGHT		= 2
TTOP_ARCHED_45		= 3
TTOP_ARCHED_60		= 4
TTOP_ARCHED_90		= 5
TTOP_ARCHED_135		= 6
TTOP_ARCHED_180		= 7
TTOP_ARCHED_360		= 8
TTOP_ARCHED_C_TOP	= 9
TTOP_ARCHED_P_TOP	= 10
TTOP_RECT			= 11

dim	stDeskAngle[2]
	stDeskAngle[1] = `90°`
	stDeskAngle[2] = `120°`

dim stOfficeCab[4]
	stOfficeCab[1] = `Нет`
	stOfficeCab[2] = `Cо Стороны 1`
	stOfficeCab[3] = `Cо Стороны 2`
	stOfficeCab[4] = `Обе Стороны`

OFFICECAB_NONE		= 0
OFFICECAB_SIDE1		= 1
OFFICECAB_SIDE2		= 2
OFFICECAB_BOTH		= 3

STRAIGHT			= 1
ROUNDED				= 2

bOfficeCab1				= gs_bOfficeCab * (iTableTopType = TTOP_L_SHAPED) + (gs_officeCab_m = OFFICECAB_SIDE1 or gs_officeCab_m = OFFICECAB_BOTH) * (iTableTopType = TTOP_STRAIGHT)
bOfficeCab2				= (gs_officeCab_m = OFFICECAB_SIDE2 or gs_officeCab_m = OFFICECAB_BOTH) * (iTableTopType = TTOP_STRAIGHT)
bOfficeCabForExtDesk1	= (iExtraDeskCab = OFFICECAB_SIDE1 or iExtraDeskCab = OFFICECAB_BOTH)
bOfficeCabForExtDesk2	= (iExtraDeskCab = OFFICECAB_SIDE2 or iExtraDeskCab = OFFICECAB_BOTH)

if iExtraDeskCab = 3 then
	maxExtDeskCabWidth = MIN(gs_officeCab_width, (extraDeskWidth - 0.2) / 2)
else
	maxExtDeskCabWidth = MIN(gs_officeCab_width, extraDeskWidth - 0.2)
endif

if bCalledAsExtension then
	cabWidth1 = maxExtDeskCabWidth
	cabWidth2 = maxExtDeskCabWidth
else
	if bPartOfLayout or bPartOfWsSolo then
		cabWidth1 = gs_officeCab_width
		cabWidth2 = gs_officeCab_width
	else
		cabWidth1 = gs_officeCab_width
		cabWidth2 = gs_officeCab_width_2
	endif
endif

tableTopAngle		= iDeskAngle

CHAIR_POS_STRAIGHT	= 1
CHAIR_POS_L_CORNER	= 2
CHAIR_POS_L_SIDE	= 3

if iTableTopType = TTOP_STRAIGHT and bCalledAsExtension then
	tableLength1	= extraDeskWidth
	tableDepth1		= extraDeskDepth
endif

bShowKeyboard		= 1
bShowMonitor		= 1
maxComputerOffset	= 0.2
keyboarDistFromEdge	= 0.05
minDeskDepth		= 0.4 + keyboarDistFromEdge

if iTableTopType = TTOP_L_SHAPED then
	innerCornerDist	= SQR(tableDepth1 ** 2 + innerCornerPos ** 2)
	if iDeskAngle = 90 then
		if innerCornerDist < 0.6 + keyboarDistFromEdge then bShowKeyboard	= 0
		if innerCornerDist < 0.35 + keyboarDistFromEdge then bShowMonitor	= 0
	else
		if innerCornerDist < 0.52 + keyboarDistFromEdge then bShowKeyboard	= 0
		if innerCornerDist < 0.27 + keyboarDistFromEdge then bShowMonitor	= 0
	endif
else
	if tableDepth1 < 0.4 then bShowKeyboard	= 0
endif

computerPosModX		= 0
computerPosModY		= 0
computerPosModYY	= 0
computerPosModXX	= 0
computerPosModXX2	= 0
if tableDepth2 < minDeskDepth then
	computerPosModX		= minDeskDepth - tableDepth2
	if bShowMonitor then
		if (tableDepth2 - minDeskDepth) < -COS(iDeskAngle / 2) * maxComputerOffset then
			computerPosModYY	= -COS(iDeskAngle / 2) * maxComputerOffset
			computerPosModXX2	= (tableDepth2 - minDeskDepth) - computerPosModYY * TAN(iDeskAngle / 2)\
								- ((tableDepth2 - minDeskDepth) + COS(iDeskAngle / 2) * maxComputerOffset) / SIN(iDeskAngle / 2)
		else
			computerPosModYY	= (tableDepth2 - minDeskDepth)
			computerPosModXX2	= computerPosModYY - computerPosModYY * TAN(iDeskAngle / 2)
		endif
	endif
endif

if tableDepth1 < minDeskDepth then
	computerPosModY		= minDeskDepth - tableDepth1
	if bShowMonitor then
		if (tableDepth1 - minDeskDepth) < -COS(iDeskAngle / 2) * maxComputerOffset then
			computerPosModXX	= -SIN(iDeskAngle / 2) * maxComputerOffset
			computerPosModXX2	= ((tableDepth1 - minDeskDepth) + COS(iDeskAngle / 2) * maxComputerOffset) / TAN(iDeskAngle / 2)
		else
			computerPosModXX	= (tableDepth1 - minDeskDepth) * TAN(iDeskAngle / 2)
			computerPosModXX2	= 0
		endif
	endif
endif

if chairPos = CHAIR_POS_STRAIGHT then
	if NOT(bCalledAsExtension) then
		deskChairOrigPosX	= tableLength1 / 2
		deskChairOrigPosY	= tableDepth1
		chairAngle			= 0

		computerOrigPosX	= tableLength1 / 2
		computerOrigPosY	= tableDepth1 - keyboarDistFromEdge + computerPosModY
	else
		deskChairOrigPosX	= 0
		deskChairOrigPosY	= tableDepth1
		chairAngle			= 0

		computerOrigPosX	= 0
		computerOrigPosY	= tableDepth1 - keyboarDistFromEdge + computerPosModY
	endif
endif
if chairPos = CHAIR_POS_L_CORNER then
	deskChairOrigPosX	= innerCornerPos
	deskChairOrigPosY	= tableDepth1
	chairAngle			= (90 - iDeskAngle / 2)

	if bShowKeyboard then
		computerOrigPosX	= innerCornerPos - keyboarDistFromEdge * COS(iDeskAngle / 2) + computerPosModX + computerPosModXX + computerPosModXX2 * (iDeskAngle = 120)
		computerOrigPosY	= tableDepth1 - keyboarDistFromEdge * SIN(iDeskAngle / 2) + computerPosModY + computerPosModYY
	else
		computerOrigPosX	= (0.35 + 0.4 / 2 / TAN(iDeskAngle / 2) + 0.03 / TAN(iDeskAngle / 2)) * COS(iDeskAngle / 2)
		computerOrigPosY	= (0.35 + 0.4 / 2 / TAN(iDeskAngle / 2) + 0.03 / TAN(iDeskAngle / 2)) * SIN(iDeskAngle / 2)
	endif
endif
if chairPos = CHAIR_POS_L_SIDE then
	deskChairOrigPosX	= tableLength1 - (tableLength1 - tableDepth2) / 2
	deskChairOrigPosY	= tableDepth1

	computerOrigPosX	= tableLength1 - (tableLength1 - tableDepth2) / 2
	computerOrigPosY	= tableDepth1 - keyboarDistFromEdge + computerPosModY
	chairAngle			= 0
endif

betaForChairPos = 0
if iTableTopType = TTOP_L_SHAPED and ABS(tableChairDistX) > EPS and ABS(tableChairDistY) > EPS then
	alphaForChairPos = ATN(COS(tableTopAngle - 90) / (tableChairDistY / tableChairDistX - SIN(tableTopAngle - 90)))
	betaForChairPos = tableTopAngle - 90 - alphaForChairPos
endif

extraDeskChairDistX	= tableLength1 / 2 - cabWidth1 * bOfficeCabForExtDesk1 - (tableLength1 - cabWidth1 * bOfficeCabForExtDesk1 - cabWidth2 * bOfficeCabForExtDesk2) / 2


