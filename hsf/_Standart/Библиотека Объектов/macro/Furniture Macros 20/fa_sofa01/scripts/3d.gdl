
!! Sofa 01.gsm

IF gs_detlevel_3D_m=0 THEN END

IF GLOB_CONTEXT>20 and GLOB_CONTEXT<40 THEN gs_detlevel_3D_m=1
IF gs_detlevel_3D_m=1 THEN gs_resol=4

yyy=zzyzx-0.0342-gs_seat_height+0.0875

IF gs_shadow=0 THEN SHADOW OFF

unID = gs_hotspotUnIdBegin
HOTSPOT 0,0,0,unID : unID=unID+1
HOTSPOT A,0,0,unID : unID=unID+1
HOTSPOT A,B,0,unID : unID=unID+1
HOTSPOT 0,B,0,unID : unID=unID+1

HOTSPOT 0,B,ZZYZX,unID : unID=unID+1
HOTSPOT A,B,ZZYZX,unID : unID=unID+1

!	unID=1
!
!	!!! *** X Dimension
!	HOTSPOT 0,0,0,unID, A,1+256 : unID=unID+1
!	HOTSPOT -1,0,0,unID, A,3 : unID=unID+1
!	HOTSPOT A,0,0,unID, A,2 : unID=unID+1
!
!	HOTSPOT 0,B,0,unID, A,1+256 : unID=unID+1
!	HOTSPOT -1,B,0,unID, A,3 : unID=unID+1
!	HOTSPOT A,B,0,unID, A,2 : unID=unID+1
!
!	!!! *** X Dimension
!	HOTSPOT 0,0,0,unID, B,1+256 : unID=unID+1
!	HOTSPOT 0,-1,0,unID, B,3 : unID=unID+1
!	HOTSPOT 0,B,0,unID, B,2 : unID=unID+1
!
!	HOTSPOT A,0,0,unID, B,1+256 : unID=unID+1
!	HOTSPOT A,-1,0,unID, B,3 : unID=unID+1
!	HOTSPOT A,B,0,unID, B,2 : unID=unID+1

ADD a/2,b/2,0

!	hotspot a/2-0.15, -b/2+b-yyy/TAN(75)-0.1672+COS(75)*(yyy/SIN(75)), 0, unID, zzyzx, 1+128: unID=unID+1
!	hotspot a/2-0.15, -b/2+b-yyy/TAN(75)-0.1672+COS(75)*(yyy/SIN(75)), -1, unID, zzyzx, 3: unID=unID+1
!	hotspot a/2-0.15, -b/2+b-yyy/TAN(75)-0.1672+COS(75)*(yyy/SIN(75)), zzyzx, unID, zzyzx, 2: unID=unID+1
!
!	hotspot -a/2+0.15, -b/2+b-yyy/TAN(75)-0.1672+COS(75)*(yyy/SIN(75)), 0, unID, zzyzx, 1+128: unID=unID+1
!	hotspot -a/2+0.15, -b/2+b-yyy/TAN(75)-0.1672+COS(75)*(yyy/SIN(75)), -1, unID, zzyzx, 3: unID=unID+1
!	hotspot -a/2+0.15, -b/2+b-yyy/TAN(75)-0.1672+COS(75)*(yyy/SIN(75)), zzyzx, unID, zzyzx, 2: unID=unID+1

! Hotspot editing !
!IF gs_full_edit=1 THEN
!
!	hotspot -a/2+0.15, -b/2, 0, unID, gs_seat_height, 1+128: unID=unID+1
!	hotspot -a/2+0.15, -b/2, -1, unID, gs_seat_height, 3: unID=unID+1
!	hotspot -a/2+0.15, -b/2, gs_seat_height, unID, gs_seat_height, 2: unID=unID+1
!
!	hotspot a/2-0.15, -b/2, 0, unID, gs_seat_height, 1+128: unID=unID+1
!	hotspot a/2-0.15, -b/2, -1, unID, gs_seat_height, 3: unID=unID+1
!	hotspot a/2-0.15, -b/2, gs_seat_height, unID, gs_seat_height, 2: unID=unID+1
!
!	hotspot -a/2, -b/2, 0, unID, arm_h, 1+128: unID=unID+1
!	hotspot -a/2, -b/2, -1, unID, arm_h, 3: unID=unID+1
!	hotspot -a/2, -b/2, arm_h, unID, arm_h, 2: unID=unID+1
!
!	hotspot a/2, -b/2, 0, unID, arm_h, 1+128: unID=unID+1
!	hotspot a/2, -b/2, -1, unID, arm_h, 3: unID=unID+1
!	hotspot a/2, -b/2, arm_h, unID, arm_h, 2: unID=unID+1
!ENDIF

ADD -a/2,-b/2,0

IF seat_num_m=1 THEN i=1
IF seat_num_m=2 THEN i=2
IF seat_num_m=3 THEN i=3

IF gs_leg_type_m=1 THEN k=1
IF gs_leg_type_m=2 THEN k=2
IF gs_leg_type_m=3 THEN k=3
IF gs_leg_type_m=4 THEN k=4
IF gs_leg_type_m=5 THEN k=5
IF not(bLeg) THEN k=0

PEN gs_cont_pen
!! MATERIAL gs_leg_mat
GOSUB 10+k

MATERIAL gs_sofa_mat
RESOL gs_resol

ADD 0.15, 0, leg_h

ROTY 90
PRISM_ 8, a-0.30,
	-0.02, 0.02, 15,
	-gs_seat_height+0.15+leg_h, 0.02, 15,
	-gs_seat_height+0.15+leg_h,  b-yyy/TAN(75)-0.1672, 15,
	-(gs_seat_height-leg_h)+0.0875,  b-yyy/TAN(75)-0.1672, 15,
	-(gs_seat_height-leg_h)+0.0875,  b-yyy/TAN(75)-0.03, 15,
	-arm_h+leg_h+0.02, b-yyy/TAN(75)-0.03+(arm_h-gs_seat_height+0.0675)/TAN(75), 15,
	-arm_h+leg_h+0.02, b-0.02, 15,
	-0.02, b-0.02, 15
DEL 1

ROTY -90
CALL "fa_cushion" parameters gs_detlevel_3D_m=gs_detlevel_3D_m,cush_a=arm_h-leg_h,
cush_b=b,cush_h=0.15,r1=0.02,r2=0.01,gs_resol=gs_resol,cush_mat=gs_sofa_mat
DEL 1

ADDX a-0.15
ROTY -90
CALL "fa_cushion" parameters gs_detlevel_3D_m=gs_detlevel_3D_m,cush_a=arm_h-leg_h,
cush_b=b,cush_h=0.15,r1=0.02,r2=0.01,gs_resol=gs_resol,cush_mat=gs_sofa_mat
DEL 3

ADD 0.15, 0, gs_seat_height-0.15
FOR ii=1 TO i
	ADDX (a-0.30)/i*(ii-1)
	CALL "fa_cushion" parameters gs_detlevel_3D_m=gs_detlevel_3D_m,cush_a=(a-0.30)/i,
	cush_b=b-yyy/TAN(75)-0.1672,
	cush_h=0.15,r1=0.02,r2=0.01,gs_resol=gs_resol,cush_mat=gs_cush_mat

	ADD 0, b-yyy/TAN(75)-0.03, 0.15-0.08750
	ROTX 75
	CALL "fa_cushion" parameters gs_detlevel_3D_m=gs_detlevel_3D_m,cush_a=(a-0.30)/i,
	cush_b=yyy/SIN(75),cush_h=0.15,
	r1=0.02,r2=0.01,gs_resol=gs_resol,cush_mat=gs_cush_mat
	DEL 3
NEXT ii

DEL TOP

END

10:
leg_h=0
RETURN

11:
ADD 0.0525, 0.02, 0
CALL "fa_sofalegtyp" PARAMETERS sofaleg_typ_m=1, a=a-0.105, b=b-0.04, gs_detlevel_3D_m=gs_detlevel_3D_m,
gs_resol=ResolLeg,gs_cont_pen=gs_cont_pen, gs_leg_mat=gs_leg_mat
DEL 1
RETURN

12:
ADD 0.06, 0.04, 0
CALL "fa_sofalegtyp" PARAMETERS sofaleg_typ_m=2, a=a-0.12, b=b-0.08, leg_h=leg_h, gs_detlevel_3D_m=gs_detlevel_3D_m,
gs_resol=ResolLeg,gs_cont_pen=gs_cont_pen, gs_leg_mat=gs_leg_mat
DEL 1
RETURN

13:
ADD 0.075, 0.075, 0
CALL "fa_sofalegtyp" PARAMETERS sofaleg_typ_m=3, a=a-0.15, b=b-0.15, leg_h=leg_h, gs_detlevel_3D_m=gs_detlevel_3D_m,
gs_resol=ResolLeg,gs_cont_pen=gs_cont_pen, gs_leg_mat=gs_leg_mat
DEL 1
RETURN

14:
ADD 0.02, 0.075, 0
CALL "fa_sofalegtyp" PARAMETERS sofaleg_typ_m=4, a=a-0.04, b=b-0.15, leg_h=leg_h, gs_detlevel_3D_m=gs_detlevel_3D_m,
gs_resol=ResolLeg,gs_cont_pen=gs_cont_pen, gs_leg_mat=gs_leg_mat
DEL 1
RETURN

15:
ADD 0.075, 0.085, 0
CALL "fa_sofalegtyp" PARAMETERS sofaleg_typ_m=5, a=a-0.15, b=b-0.17, leg_h=leg_h, ur=0.055, lr=0.045,
gs_cont_pen=gs_cont_pen, gs_leg_mat=gs_leg_mat
DEL 1
RETURN
