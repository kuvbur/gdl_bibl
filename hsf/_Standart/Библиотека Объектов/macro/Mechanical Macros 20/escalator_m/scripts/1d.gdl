
! ==============================================================================
! escalator_m
! ==============================================================================


EPS=0.0001

DET2D_OFF			= 0
DET2D_SIMPLE		= 1
DET2D_MIDDLE		= 2
DET2D_DETAILED		= 3

ESCALATOR = 1
MOVING_WALKWAY = 2

! iBalustradeType
BALUSTRADE_SOLID	= 1
BALUSTRADE_GLAZED	= 2

balustradeWidth = 0.18
balustradeHeight = 1
balustradeGlassWidth = 0.012
handrailRubberWidth = 0.08
handrailRubberThk = 0.03
balustradeRadius = 0.45
combLength = 0.4
trussLowerRadMin = 1.23
trussUpperRadMin = 0.2
landingHeightMin = trussLowerRadMin * (1 - cos(inclination)) + trussUpperRadMin * (1 - cos(inclination)) + 0.01

if iObjectType = ESCALATOR then
	if GLOB_MODPAR_NAME = "inclination" then
		riser = tread * sin(inclination)
		parameters riser = riser
	else
		if riser > tread then
			riser = tread * sin(inclination)
			parameters riser = riser
		endif
		inclination = asn(riser/tread)
		parameters inclination = inclination
	endif
else
	riser = tread * sin(inclination)
	parameters riser = riser
endif
if landingHeight > 0 then
	if (landingHeight - (int(landingHeight/riser)-1)*riser)/2 > riser*0.75 then
		nTread = int(landingHeight/riser) + 2
	else
		nTread = int(landingHeight/riser) + 1
	endif
	if nTread < 2 then nTread = 2

	riserBegin = (landingHeight - (nTread - 2) * riser) / 2
	if iObjectType = ESCALATOR then
		totalTreadLength = 5 * tread + 2 * tread * cos(asn(riserBegin/tread)) + (nTread - 2) * tread * cos(asn(riser/tread))
		nLowerLandingTread = 3
		nUpperLandingTread = 2
	else
		inclTreadLength = 2 * tread * cos(asn(riserBegin/tread)) + (nTread - 2) * tread * cos(asn(riser/tread))
		nLowerLandingTread = int((A - 2 * landingLength - inclTreadLength) / (2 * tread))
		if 2 * nLowerLandingTread * tread + 2 * tread * cos(asn(riserBegin/tread)) + (nTread - 2) * tread * cos(asn(riser/tread)) < A - 2 * landingLength - combLength then
			nLowerLandingTread = int((A - 2 * landingLength - inclTreadLength) / (2 * tread)) + 1
		endif
		nUpperLandingTread = nLowerLandingTread
		totalTreadLength = (nLowerLandingTread + nUpperLandingTread) * tread + 2 * tread * cos(asn(riserBegin/tread)) + (nTread - 2) * tread * cos(asn(riser/tread))
	endif
else
	inclination = 0
	riser = 0
	hideparameter "inclination"
	lock "inclination"
	nTread = int((A - 2 * landingLength)/tread)
	riserBegin = 0
	totalTreadLength = nTread * tread
	nLowerLandingTread = 3
	nUpperLandingTread = 3
endif
