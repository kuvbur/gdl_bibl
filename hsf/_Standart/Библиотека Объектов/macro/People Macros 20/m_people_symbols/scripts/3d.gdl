
pen cont_pen_3d

if not(gs_shadow) then shadow off

if show_in_3D then

	dx = GLOB_EYEPOS_X - GLOB_TARGPOS_X
	dy = GLOB_EYEPOS_Y - GLOB_TARGPOS_Y

	if GLOB_CONTEXT <> 4 then					! 3D view

		if SYMB_MIRRORED then
			signMirrored = 1
		else
			signMirrored = -1
		endif

		if abs(dx) > EPS then
			cameraAngle = atn(abs(dy/dx))
		else
			cameraAngle = 90
		endif

		rotAng = 0
		if dx < 0 then
			rotAng = 180
			signDx = -1
		else
			signDx = 1
		endif
		if dy < 0 then
			signDy = -1
		else
			signDy = 1
		endif

		rotAng = 90 + (SYMB_ROTANGLE + rotAng - cameraAngle * signDx * signDy) * signMirrored

		rotz rotAng

		mul -signMirrored, 1, 1

		gosub "3D_detailed"

		del 2

	else	! glob_context = 4 -- S/E

		gosub "3D_detailed"

	endif

endif


! ==============================================================================
end ! end ! end ! end ! end ! end ! end ! end ! end ! end ! end ! end ! end ! en
! ==============================================================================

! ------------------------------------------------------------------------------
"3D_detailed":
! ------------------------------------------------------------------------------

	gosub "symbol_cont"

	rotx 90
	gosub "min_max"
	mul a/abs(xMax-xMin), b/yMax, 1

	gosub "hotspots_3D"

	material material_body

	if iSymbol_type = SYMBOL_MAN_DOG or \
		iSymbol_type = SYMBOL_GROUP_1 or \
		iSymbol_type = SYMBOL_GROUP_3 or \
		iSymbol_type = SYMBOL_WOMAN_BALL then
			if iSymbol_type = SYMBOL_MAN_DOG then
				prism_ 123,		0.01,
				   get(123*3)
				prism_ 181,		0.01,
				   get(181*3)
			endif
			if iSymbol_type = SYMBOL_GROUP_1 then
				prism_ 62,		0.01,
				   get(62*3)
				prism_ 169,		0.01,
				   get(169*3)
			endif
			if iSymbol_type = SYMBOL_GROUP_3 then
				prism_ 64,		0.01,
				   get(64*3)
				prism_ 100,		0.01,
				   get(100*3)
			endif
			if iSymbol_type = SYMBOL_WOMAN_BALL then
				prism_ 10,		0.01,
				   get(10*3)
				prism_ 163,		0.01,
				   get(163*3)
			endif
	else
		prism_ (NSP/3),		0.01,
		   get(NSP)
	endif

	for j = 1 to 2
		gosub "line_contour"
		for i=1 to NSP/4
			lin_	get(2), 0, get(2), 0
		next i
		addz 0.01
	next j
	del 1

	end
return
