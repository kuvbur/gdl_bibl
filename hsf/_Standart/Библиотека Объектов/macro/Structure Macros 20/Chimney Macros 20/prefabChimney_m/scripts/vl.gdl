
! ==============================================================================
! prefabChimney_m
! ==============================================================================


call "FM_types" parameters all

dim stDetail[2]
	stDetail[1]=`Детальный`
	stDetail[2]=`Откл.`

values "gs_detlevel_3D" stDetail
values "gs_detlevel_3D_m" 1, 0

if GLOB_MODPAR_NAME = "gs_detlevel_3D" then
	gs_detlevel_3D_m = 1	! Detailed
	if gs_detlevel_3D = stDetail[2] then gs_detlevel_3D_m = 0
	parameters gs_detlevel_3D_m = gs_detlevel_3D_m
else
	gs_detlevel_3D = stDetail[1]
	if gs_detlevel_3D_m = 0 then gs_detlevel_3D = stDetail[2]
	parameters gs_detlevel_3D = gs_detlevel_3D
endif

if gs_cont_pen=0 then parameters gs_cont_pen=2
if gs_fill_pen=0 then parameters gs_fill_pen=91

values "gs_resol" range [3,)
values "zzyzx" range [_nPrefabUnitMIN * prefabUnitHeight + 0.6 + bShowCap * (coneHeight + 0.01),] step _nPrefabUnitMIN * prefabUnitHeight + 0.6 + bShowCap * (coneHeight + 0.01), prefabUnitHeight

values "zCornerPointsPos" range [_nPrefabUnitMIN * prefabUnitHeight, ZZYZX - 0.6]

if GLOB_MODPAR_NAME = "ZZYZX" then
	zTopDoorPos1 = min(zTopDoorPos1, (nPrefabUnit - 0.5) * prefabUnitHeight)
	parameters zTopDoorPos1 = zTopDoorPos1

	if bDoubleFlue then
		zTopDoorPos2 = min(zTopDoorPos2, (nPrefabUnit - 0.5) * prefabUnitHeight)
		parameters zTopDoorPos2 = zTopDoorPos2
	endif
else
	if bDoubleFlue then
		_maxTopDoorPos = max(zTopDoorPos1, zTopDoorPos2)
	else
		_maxTopDoorPos = zTopDoorPos1
	endif

	zCornerPointsPos[1][1] = max(zCornerPointsPos[1][1], _maxTopDoorPos + prefabUnitHeight/2)
	zCornerPointsPos[1][2] = max(zCornerPointsPos[1][2], _maxTopDoorPos + prefabUnitHeight/2)
	zCornerPointsPos[2][1] = max(zCornerPointsPos[2][1], _maxTopDoorPos + prefabUnitHeight/2)
	zCornerPointsPos[2][2] = max(zCornerPointsPos[2][2], _maxTopDoorPos + prefabUnitHeight/2)

	parameters	zCornerPointsPos = zCornerPointsPos

	ZZYZX = max(ZZYZX, 0.6 + max(zCornerPointsPos[1][1], zCornerPointsPos[1][2], zCornerPointsPos[2][1], zCornerPointsPos[2][2])) 
	parameters	ZZYZX = ZZYZX
endif


values{2} "iFlueShape"	FLUESHAPE_CIRCLE,		stFlueShape[1],
						FLUESHAPE_RECTANGLE,	stFlueShape[2]

values{2} "iSymbolType"	SYMBOL_STYLE1,	stSymbolType[1],
						SYMBOL_STYLE2,	stSymbolType[2]


values "flueDia" range [0.08,)
values "flueWidth" range [0.08 + 2 * _insParamThk,)
values "flueDepth" range [0.08 + 2 * _insParamThk,)

zTopDoorPosMax = ZZYZX - 0.6 - prefabUnitHeight/2 

if bDoubleFlue then
	values "flueDia2" range [0.08,)
	values "flueWidth2" range [0.08 + 2 * _insParamThk,)
	values "flueDepth2" range [0.08 + 2 * _insParamThk,)

	values "nSmokeCon" range [0, min(nSmokeConMax,9)]
	values "nSmokeCon2" range [0, min(nSmokeConMax,9)]

	! ==========================================================================
	! Flue 1 - Connection Angle Values
	! ==========================================================================
	values "doorAngle1" 0, 180, 270
	values "topDoorAngle1" 0, 180, 270

	values "smokeAngle_1" 0, 180, 270
	values "smokeAngle_2" 0, 180, 270
	values "smokeAngle_3" 0, 180, 270
	values "smokeAngle_4" 0, 180, 270
	values "smokeAngle_5" 0, 180, 270
	values "smokeAngle_6" 0, 180, 270
	values "smokeAngle_7" 0, 180, 270
	values "smokeAngle_8" 0, 180, 270
	values "smokeAngle_9" 0, 180, 270

	! ==========================================================================
	! Flue 2 - Connection Angle Values
	! ==========================================================================
	values "doorAngle2" 0, 90, 180
	values "topDoorAngle2" 0, 90, 180

	values "smokeAngle_10" 0, 90, 180
	values "smokeAngle_11" 0, 90, 180
	values "smokeAngle_12" 0, 90, 180
	values "smokeAngle_13" 0, 90, 180
	values "smokeAngle_14" 0, 90, 180
	values "smokeAngle_15" 0, 90, 180
	values "smokeAngle_16" 0, 90, 180
	values "smokeAngle_17" 0, 90, 180
	values "smokeAngle_18" 0, 90, 180

	if nSmokeCon = 0 then
		values "zTopDoorPos1" range [(2.5 + 2 * bShowBase) * prefabUnitHeight, zTopDoorPosMax] step (2.5 + 2 * bShowBase) * prefabUnitHeight, prefabUnitHeight
	else
		values "zTopDoorPos1" range [zSmokePos[nSmokeCon] + prefabUnitHeight, zTopDoorPosMax] step zSmokePos[nSmokeCon] + prefabUnitHeight, prefabUnitHeight
	endif
	if nSmokeCon2 = 0 then
		values "zTopDoorPos2" range [(2.5 + 2 * bShowBase) * prefabUnitHeight, zTopDoorPosMax] step (2.5 + 2 * bShowBase) * prefabUnitHeight, prefabUnitHeight
	else
		values "zTopDoorPos2" range [zSmokePos[9 + nSmokeCon2] + prefabUnitHeight, zTopDoorPosMax] step zSmokePos[nSmokeCon2 + 9] + prefabUnitHeight, prefabUnitHeight
	endif

	if ventilation then
		! ======================================================================
		! Double with Ventilation
		! ======================================================================
		values "A" range [2 * 0.08 + 4 * (_insParamThk + minWallThk) + 0.04, )
		values "B" range [0.08 + 2 * (_insParamThk + minWallThk), )

		if GLOB_MODPAR_NAME = "A" | GLOB_MODPAR_NAME = "B" then
			if iFlueShape = FLUESHAPE_CIRCLE then
				_minWidth = 2 * min(flueDia, flueDia2) + 4 * _insParamThk + 4 * minWallThk + 0.04
				_minDepth = min(flueDia, flueDia2) + 2 * (_insParamThk + minWallThk)
			else
				_minWidth = 2 * min(flueWidth, flueWidth2) + 4 * minWallThk + 0.04
				_minDepth = min(flueDepth, flueDepth2) + 2 * minWallThk
			endif

			if	(A - _minWidth) < -EPS	|\
				(B - _minDepth) < -EPS	then

				flueDia		= min(B - 2 * (_insParamThk + minWallThk), (A - 4 * _insParamThk - 4 * minWallThk - 0.04) / 2)

				if (A - _minWidth) < -EPS then
					flueWidth	= (A - 4 * minWallThk - 0.04) / 2
				endif

				if (B - _minDepth) < -EPS then
					flueDepth	= (B - 2 * minWallThk)
				endif

				flueDia2	= flueDia

				if GLOB_MODPAR_NAME = "A" then
					flueWidth2	= min(flueWidth, flueWidth2)
				endif

				flueDepth2	= min(flueDepth2, B - 2 * minWallThk)
			else
				if iFlueShape = FLUESHAPE_CIRCLE then
					if (flueDia - flueDia2) > EPS then
						flueDia		= min(flueDia, B - 2 * (_insParamThk + minWallThk), A - 4 * _insParamThk - 4 * minWallThk - flueDia2 - 0.04)
						flueDia2	= flueDia2
					else
						flueDia		= flueDia
						flueDia2	= min(flueDia2, B - 2 * (_insParamThk + minWallThk), A - 4 * _insParamThk - 4 * minWallThk - flueDia - 0.04)
					endif
				else
					if (flueWidth - flueWidth2) > EPS then
						flueWidth	= min(flueWidth, A - 4 * minWallThk - flueWidth2 - 0.04)
						flueWidth2	= flueWidth2
					else
						flueWidth	= flueWidth
						flueWidth2	= min(flueWidth2, A - 4 * minWallThk - flueWidth - 0.04)
					endif

					if (flueDepth - flueDepth2) > EPS then
						flueDepth	= min(flueDepth, B - 2 * minWallThk)
						flueDepth2	= flueDepth2
					else
						flueDepth	= flueDepth
						flueDepth2	= min(flueDepth2, B - 2 * minWallThk)
					endif
				endif
			endif

			parameters	flueDia		= flueDia,
						flueWidth	= flueWidth,
						flueDepth	= flueDepth,
						flueDia2	= flueDia2,
						flueWidth2	= flueWidth2,
						flueDepth2	= flueDepth2
		else
			if iFlueShape = FLUESHAPE_CIRCLE then
				flueWidth	= flueDia + 2 * _insParamThk
				flueDepth	= flueDia + 2 * _insParamThk
				flueWidth2	= flueDia2 + 2 * _insParamThk
				flueDepth2	= flueDia2 + 2 * _insParamThk

				A = max(A, flueDia + flueDia2 + 4 * _insParamThk + 4 * minWallThk + 0.04)
				B = max(B, max(flueDia, flueDia2) + 2 * (_insParamThk + minWallThk))

				parameters	flueWidth	= flueWidth,
							flueDepth	= flueDepth,
							flueWidth2	= flueWidth2,
							flueDepth2	= flueDepth2
			else
				flueDia		= min(flueDepth, flueWidth) - 2 * _insParamThk
				flueDia2	= min(flueDepth2, flueWidth2) - 2 * _insParamThk

				A = max(A, flueWidth + flueWidth2 + 4 * minWallThk + 0.04)
				B = max(B, max(flueDepth, flueDepth2) + 2 * minWallThk)

				parameters	flueDia		= flueDia,
							flueDia2	= flueDia2
			endif

			parameters	A	= A,
						B	= B
		endif
	else
		! ======================================================================
		! Double without Ventilation
		! ======================================================================
		values "A" range [2 * 0.08 + 4 * _insParamThk + 3 * minWallThk, )
		values "B" range [0.08 + 2 * (_insParamThk + minWallThk), )

		if GLOB_MODPAR_NAME = "A" | GLOB_MODPAR_NAME = "B" then
			if iFlueShape = FLUESHAPE_CIRCLE then
				_minWidth = 2 * min(flueDia, flueDia2) + 4 * _insParamThk + 3 * minWallThk
				_minDepth = min(flueDia, flueDia2) + 2 * (_insParamThk + minWallThk)
			else
				_minWidth = 2 * min(flueWidth, flueWidth2) + 3 * minWallThk
				_minDepth = min(flueDepth, flueDepth2) + 2 * minWallThk
			endif

			if	(A - _minWidth) < -EPS	|\
				(B - _minDepth) < -EPS	then

				flueDia		= min(B - 2 * (_insParamThk + minWallThk), (A - 4 * _insParamThk - 3 * minWallThk) / 2)

				if (A - _minWidth) < -EPS then
					flueWidth	= (A - 3 * minWallThk) / 2
				endif

				if (B - _minDepth) < -EPS then
					flueDepth	= (B - 2 * minWallThk)
				endif

				flueDia2	= flueDia

				if GLOB_MODPAR_NAME = "A" then
					flueWidth2	= min(flueWidth, flueWidth2)
				endif

				flueDepth2	= min(flueDepth2, B - 2 * minWallThk)
			else
				if iFlueShape = FLUESHAPE_CIRCLE then
					if (flueDia - flueDia2) > EPS then
						flueDia		= min(flueDia, B - 2 * (_insParamThk + minWallThk), A - 4 * _insParamThk - 3 * minWallThk - flueDia2)
						flueDia2	= flueDia2
					else
						flueDia		= flueDia
						flueDia2	= min(flueDia2, B - 2 * (_insParamThk + minWallThk), A - 4 * _insParamThk - 3 * minWallThk - flueDia)
					endif
				else
					if (flueWidth - flueWidth2) > EPS then
						flueWidth	= min(flueWidth, A - 3 * minWallThk - flueWidth2)
						flueWidth2	= flueWidth2
					else
						flueWidth	= flueWidth
						flueWidth2	= min(flueWidth2, A - 3 * minWallThk - flueWidth)
					endif

					if (flueDepth - flueDepth2) > EPS then
						flueDepth	= min(flueDepth, B - 2 * minWallThk)
						flueDepth2	= flueDepth2
					else
						flueDepth	= flueDepth
						flueDepth2	= min(flueDepth2, B - 2 * minWallThk)
					endif
				endif
			endif

			parameters	flueDia		= flueDia,
						flueWidth	= flueWidth,
						flueDepth	= flueDepth,
						flueDia2	= flueDia2,
						flueWidth2	= flueWidth2,
						flueDepth2	= flueDepth2
		else
			if iFlueShape = FLUESHAPE_CIRCLE then
				flueWidth	= flueDia + 2 * _insParamThk
				flueDepth	= flueDia + 2 * _insParamThk
				flueWidth2	= flueDia2 + 2 * _insParamThk
				flueDepth2	= flueDia2 + 2 * _insParamThk

				A = max(A, flueDia + flueDia2 + 4 * _insParamThk + 3 * minWallThk)
				B = max(B, max(flueDia, flueDia2) + 2 * (_insParamThk + minWallThk))

				parameters	flueWidth	= flueWidth,
							flueDepth	= flueDepth,
							flueWidth2	= flueWidth2,
							flueDepth2	= flueDepth2
			else
				flueDia		= min(flueDepth, flueWidth) - 2 * _insParamThk
				flueDia2	= min(flueDepth2, flueWidth2) - 2 * _insParamThk

				A = max(A, flueWidth + flueWidth2 + 3 * minWallThk)
				B = max(B, max(flueDepth, flueDepth2) + 2 * minWallThk)

				parameters	flueDia		= flueDia,
							flueDia2	= flueDia2
			endif

			parameters	A	= A,
						B	= B
		endif
	endif


	if iFlueShape = FLUESHAPE_CIRCLE then
		flueRadius2 = flueDia2/2
	else
		flueRadius2 = flueWidth2/2
	endif
	parameters flueRadius2 = flueRadius2
else
	values "nSmokeCon" range [0, min(nSmokeConMax,10)]

	! ==========================================================================
	! Single Flue - Connection Angle Values
	! ==========================================================================
	if ventilation then
		values "doorAngle1" 0, 180, 270
		values "topDoorAngle1" 0, 180, 270

		values "smokeAngle_1" 0, 180, 270
		values "smokeAngle_2" 0, 180, 270
		values "smokeAngle_3" 0, 180, 270
		values "smokeAngle_4" 0, 180, 270
		values "smokeAngle_5" 0, 180, 270
		values "smokeAngle_6" 0, 180, 270
		values "smokeAngle_7" 0, 180, 270
		values "smokeAngle_8" 0, 180, 270
		values "smokeAngle_9" 0, 180, 270
		values "smokeAngle_10" 0, 180, 270
	else
		values "doorAngle1" 0, 90, 180, 270
		values "topDoorAngle1" 0, 90, 180, 270

		values "smokeAngle_1" 0, 90, 180, 270
		values "smokeAngle_2" 0, 90, 180, 270
		values "smokeAngle_3" 0, 90, 180, 270
		values "smokeAngle_4" 0, 90, 180, 270
		values "smokeAngle_5" 0, 90, 180, 270
		values "smokeAngle_6" 0, 90, 180, 270
		values "smokeAngle_7" 0, 90, 180, 270
		values "smokeAngle_8" 0, 90, 180, 270
		values "smokeAngle_9" 0, 90, 180, 270
		values "smokeAngle_10" 0, 90, 180, 270
	endif

	if nSmokeCon = 0 then
		values "zTopDoorPos1" range [(2.5 + 2 * bShowBase) * prefabUnitHeight, zTopDoorPosMax] step (2.5 + 2 * bShowBase) * prefabUnitHeight, prefabUnitHeight
	else
		values "zTopDoorPos1" range [zSmokePos[nSmokeCon] + prefabUnitHeight, zTopDoorPosMax] step zSmokePos[nSmokeCon] + prefabUnitHeight, prefabUnitHeight
	endif

	if ventilation then
		! ======================================================================
		! Single with Ventilation
		! ======================================================================
		values "A" range [0.08 + 2 * _insParamThk + 3 * minWallThk + 0.04,)
		values "B" range [0.08 + 2 * (_insParamThk + minWallThk), )

		if GLOB_MODPAR_NAME = "A" | GLOB_MODPAR_NAME = "B" then
			flueDia		= min(flueDia, B - 2 * (_insParamThk + minWallThk), A - 2 * _insParamThk - 3 * minWallThk - 0.04)
			flueWidth	= min(flueWidth, A - 3 * minWallThk - 0.04)
			flueDepth	= min(flueDepth, B - 2 * minWallThk)

			parameters	flueDia		= flueDia,
						flueWidth	= flueWidth,
						flueDepth	= flueDepth
		else
			if iFlueShape = FLUESHAPE_CIRCLE then
				flueWidth	= max(flueWidth, flueDia + 2 * _insParamThk)
				flueDepth	= max(flueDepth, flueDia + 2 * _insParamThk)

				A = max(A, flueDia + 2 * _insParamThk + 3 * minWallThk + 0.04)
				B = max(B, flueDia + 2 * (_insParamThk + minWallThk))

				parameters	flueWidth	= flueWidth,
							flueDepth	= flueDepth
			else
				flueDia		= min(flueDepth, flueWidth) - 2 * _insParamThk

				A = max(A, flueWidth + 3 * minWallThk + 0.04)
				B = max(B, flueDepth + 2 * minWallThk)

				parameters	flueDia		= flueDia
			endif

			parameters	A	= A,
						B	= B
		endif
	else
		! ======================================================================
		! Single without Ventilation
		! ======================================================================
		values "A" range [0.08 + 2 * (_insParamThk + minWallThk), )
		values "B" range [0.08 + 2 * (_insParamThk + minWallThk), )

		if GLOB_MODPAR_NAME = "A" | GLOB_MODPAR_NAME = "B" then
			flueDia		= min(flueDia, A - 2 * (_insParamThk + minWallThk), B - 2 * (_insParamThk + minWallThk))
			flueWidth	= min(flueWidth, A - 2 * minWallThk)
			flueDepth	= min(flueDepth, B - 2 * minWallThk)

			parameters	flueDia		= flueDia,
						flueWidth	= flueWidth,
						flueDepth	= flueDepth
		else
			if iFlueShape = FLUESHAPE_CIRCLE then
				flueWidth	= max(flueWidth, flueDia + 2 * _insParamThk)
				flueDepth	= max(flueDepth, flueDia + 2 * _insParamThk)

				A = max(A, flueDia + 2 * (_insParamThk + minWallThk))
				B = max(B, flueDia + 2 * (_insParamThk + minWallThk))

				parameters	flueWidth	= flueWidth,
							flueDepth	= flueDepth
			else
				flueDia		= min(flueDepth, flueWidth) - 2 * _insParamThk

				A = max(A, flueWidth + 2 * minWallThk)
				B = max(B, flueDepth + 2 * minWallThk)

				parameters	flueDia		= flueDia
			endif

			parameters	A	= A,
						B	= B
		endif
	endif
endif


if iFlueShape = FLUESHAPE_CIRCLE then
	flueRadius = flueDia/2
else
	flueRadius = flueWidth/2
endif
parameters flueRadius = flueRadius


if iFlueShape = FLUESHAPE_RECTANGLE then
	bShowCap = 0
	parameters bShowCap = bShowCap

	lock "bShowCap"
endif

if not(bShowCap) then
	lock "matCap"
	hideparameter "matCap"
endif
if not(bShowBase) & not(bTopDoor) then
	lock "matDoor"
	hideparameter "matDoor"
endif
if not(bShowBase) then
	lock "doorAngle1", "doorAngle2"
	hideparameter "doorAngle1", "doorAngle2"
endif
if not(bTopDoor) then
	lock "topDoorAngle1", "zTopDoorPos1", "topDoorAngle2", "zTopDoorPos2"
	hideparameter "topDoorAngle1", "zTopDoorPos1", "topDoorAngle2", "zTopDoorPos2"
endif
if not(bTopCover) then
	lock "topCoverThk", "matTopCover"
	hideparameter "topCoverThk", "matTopCover"
endif

if iFlueShape = FLUESHAPE_CIRCLE then
	lock "flueWidth", "flueDepth"
	hideparameter "flueWidth", "flueDepth"

	if bDoubleFlue then
		lock "flueWidth2", "flueDepth2"
		hideparameter "flueWidth2", "flueDepth2"
	endif
else
	lock "flueDia"
	hideparameter "flueDia"

	if bDoubleFlue then
		lock "flueDia2"
		hideparameter "flueDia2"
	endif
endif

parameters ac_bottomlevel = 0
parameters ac_toplevel = ZZYZX


! ==============================================================================
! MEP
! ==============================================================================

if bTopDoor then
	zSmokeConMax1 = zTopDoorPos1 - prefabUnitHeight
	zSmokeConMax2 = zTopDoorPos2 - prefabUnitHeight
else
	zSmokeConMax1 = nPrefabUnit * prefabUnitHeight
	zSmokeConMax2 = nPrefabUnit * prefabUnitHeight
endif

if bDoubleFlue then
	if GLOB_MODPAR_NAME = "nSmokeCon" then
		ConStatus_1 = 1
		ConStatus_2 = 1
		ConStatus_3 = 1
		ConStatus_4 = 1
		ConStatus_5 = 1
		ConStatus_6 = 1
		ConStatus_7 = 1
		ConStatus_8 = 1
		ConStatus_9 = 1
	endif

	if nSmokeCon < 9 then
		ConStatus_9 = 0
		hideparameter "ConStatus_9"
	endif
	if nSmokeCon < 8 then
		ConStatus_8 = 0
		hideparameter "ConStatus_8"
	endif
	if nSmokeCon < 7 then
		ConStatus_7 = 0
		hideparameter "ConStatus_7"
	endif
	if nSmokeCon < 6 then
		ConStatus_6 = 0
		hideparameter "ConStatus_6"
	endif
	if nSmokeCon < 5 then
		ConStatus_5 = 0
		hideparameter "ConStatus_5"
	endif
	if nSmokeCon < 4 then
		ConStatus_4 = 0
		hideparameter "ConStatus_4"
	endif
	if nSmokeCon < 3 then
		ConStatus_3 = 0
		hideparameter "ConStatus_3"
	endif
	if nSmokeCon < 2 then
		ConStatus_2 = 0
		hideparameter "ConStatus_2"
	endif
	if nSmokeCon < 1 then
		ConStatus_1 = 0
		hideparameter "ConStatus_1"
	endif

	parameters	ConStatus_1 = ConStatus_1,
				ConStatus_2 = ConStatus_2,
				ConStatus_3 = ConStatus_3,
				ConStatus_4 = ConStatus_4,
				ConStatus_5 = ConStatus_5,
				ConStatus_6 = ConStatus_6,
				ConStatus_7 = ConStatus_7,
				ConStatus_8 = ConStatus_8,
				ConStatus_9 = ConStatus_9


	if GLOB_MODPAR_NAME = "nSmokeCon2" then
		ConStatus_10 = 1
		ConStatus_11 = 1
		ConStatus_12 = 1
		ConStatus_13 = 1
		ConStatus_14 = 1
		ConStatus_15 = 1
		ConStatus_16 = 1
		ConStatus_17 = 1
		ConStatus_18 = 1
	endif

	if nSmokeCon2 < 9 then
		ConStatus_18 = 0
		hideparameter "ConStatus_18"
	endif
	if nSmokeCon2 < 8 then
		ConStatus_17 = 0
		hideparameter "ConStatus_17"
	endif
	if nSmokeCon2 < 7 then
		ConStatus_16 = 0
		hideparameter "ConStatus_16"
	endif
	if nSmokeCon2 < 6 then
		ConStatus_15 = 0
		hideparameter "ConStatus_15"
	endif
	if nSmokeCon2 < 5 then
		ConStatus_14 = 0
		hideparameter "ConStatus_14"
	endif
	if nSmokeCon2 < 4 then
		ConStatus_13 = 0
		hideparameter "ConStatus_13"
	endif
	if nSmokeCon2 < 3 then
		ConStatus_12 = 0
		hideparameter "ConStatus_12"
	endif
	if nSmokeCon2 < 2 then
		ConStatus_11 = 0
		hideparameter "ConStatus_11"
	endif
	if nSmokeCon2 < 1 then
		ConStatus_10 = 0
		hideparameter "ConStatus_10"
	endif

	parameters	ConStatus_10 = ConStatus_10,
				ConStatus_11 = ConStatus_11,
				ConStatus_12 = ConStatus_12,
				ConStatus_13 = ConStatus_13,
				ConStatus_14 = ConStatus_14,
				ConStatus_15 = ConStatus_15,
				ConStatus_16 = ConStatus_16,
				ConStatus_17 = ConStatus_17,
				ConStatus_18 = ConStatus_18

else
	if GLOB_MODPAR_NAME = "nSmokeCon" then
		ConStatus_1 = 1
		ConStatus_2 = 1
		ConStatus_3 = 1
		ConStatus_4 = 1
		ConStatus_5 = 1
		ConStatus_6 = 1
		ConStatus_7 = 1
		ConStatus_8 = 1
		ConStatus_9 = 1
		ConStatus_10 = 1
	endif

	if nSmokeCon < 10 then
		ConStatus_10 = 0
		hideparameter "ConStatus_10"
	endif
	if nSmokeCon < 9 then
		ConStatus_9 = 0
		hideparameter "ConStatus_9"
	endif
	if nSmokeCon < 8 then
		ConStatus_8 = 0
		hideparameter "ConStatus_8"
	endif
	if nSmokeCon < 7 then
		ConStatus_7 = 0
		hideparameter "ConStatus_7"
	endif
	if nSmokeCon < 6 then
		ConStatus_6 = 0
		hideparameter "ConStatus_6"
	endif
	if nSmokeCon < 5 then
		ConStatus_5 = 0
		hideparameter "ConStatus_5"
	endif
	if nSmokeCon < 4 then
		ConStatus_4 = 0
		hideparameter "ConStatus_4"
	endif
	if nSmokeCon < 3 then
		ConStatus_3 = 0
		hideparameter "ConStatus_3"
	endif
	if nSmokeCon < 2 then
		ConStatus_2 = 0
		hideparameter "ConStatus_2"
	endif
	if nSmokeCon < 1 then
		ConStatus_1 = 0
		hideparameter "ConStatus_1"
	endif

	parameters	ConStatus_1 = ConStatus_1,
				ConStatus_2 = ConStatus_2,
				ConStatus_3 = ConStatus_3,
				ConStatus_4 = ConStatus_4,
				ConStatus_5 = ConStatus_5,
				ConStatus_6 = ConStatus_6,
				ConStatus_7 = ConStatus_7,
				ConStatus_8 = ConStatus_8,
				ConStatus_9 = ConStatus_9,
				ConStatus_10 = ConStatus_10
endif

if isMEPEnabled then

	if not(ConStatus_1) & not(ConStatus_2) & not(ConStatus_3) & not(ConStatus_4) & not(ConStatus_5) & \
		not(ConStatus_6) & not(ConStatus_7) & not(ConStatus_8) & not(ConStatus_9) & not(ConStatus_10) then
		lock "gs_con_mat"
		hideparameter "gs_con_mat"
	endif

	DIM shape_typ_to_validation[3]
		shape_typ_to_validation[1] = 0		! Rectangle
		shape_typ_to_validation[2] = 1		! Circle
		shape_typ_to_validation[3] = 0		! Oval

					! --- CONNECTIONS --- !

	if bDoubleFlue then
		parameters MEP_NumberConnections = 9 + nSmokeCon2
	else
		parameters MEP_NumberConnections = nSmokeCon
	endif

	! --- 1th CONNECTION --- !

	ConID = 1
	if bDoubleFlue then
		ConName = `Соединение Дымохода 1 (Канал 1)`
	else
		ConName = `Соединение Дымохода 1`
	endif

	if abs(smokeAngle_1) < eps then
		ConDVecX = 0
		ConDVecY = -1
		ConDVecZ = 0

		ConWVecX = 1
		ConWVecY = 0
		ConWVecZ = 0

		parameters ConPosX_1 = -A/2 + flueRadius + diff
		parameters ConPosY_1 = -B/2
	endif
	if abs(smokeAngle_1 - 90) < eps then
		ConDVecX = 1
		ConDVecY = 0
		ConDVecZ = 0

		ConWVecX = 0
		ConWVecY = -1
		ConWVecZ = 0

		parameters ConPosX_1 = A/2
		parameters ConPosY_1 = 0
	endif
	if abs(smokeAngle_1 - 180) < eps then
		ConDVecX = 0
		ConDVecY = 1
		ConDVecZ = 0

		ConWVecX = 1
		ConWVecY = 0
		ConWVecZ = 0

		parameters ConPosX_1 = -A/2 + flueRadius + diff
		parameters ConPosY_1 = B/2
	endif
	if abs(smokeAngle_1 - 270) < eps then
		ConDVecX = -1
		ConDVecY = 0
		ConDVecZ = 0

		ConWVecX = 0
		ConWVecY = -1
		ConWVecZ = 0

		parameters ConPosX_1 = -A/2
		parameters ConPosY_1 = 0
	endif

	parameters ConWidth_1 = 2 * flueRadius
	parameters ConDepth_1 = ConWidth_1
	values "ConLength_1" RANGE [0, ]

	zSmokeConMin = 2.5 * prefabUnitHeight + 2 * bShowBase * prefabUnitHeight
	if nSmokeCon = 1 then
		values "ConPosZ_1" range [zSmokeConMin, zSmokeConMax1] step zSmokeConMin, prefabUnitHeight
	endif
	if nSmokeCon > 1 then
		values "ConPosZ_1" range [zSmokeConMin, ConPosZ_2 - prefabUnitHeight] step zSmokeConMin, prefabUnitHeight
	endif

	call "MEP_m_ConnectionsACL_4" parameters SetProgram = SetProgram,
		gs_Connections = gs_Connections,
		MEP_NumConnectionData = MEP_NumConnectionData,
		MEP_StrConnectionData = MEP_StrConnectionData,
		MEP_NumberConnections = MEP_NumberConnections,
		gs_AddConnections = gs_AddConnections,
		ConName = ConName,
		ConID = ConID,
		ConPosX = ConPosX_1,
		ConPosY = ConPosY_1,
		ConPosZ = ConPosZ_1,
		ConDVecX = ConDVecX,
		ConDVecY = ConDVecY,
		ConDVecZ = ConDVecZ,
		ConWVecX = ConWVecX,
		ConWVecY = ConWVecY,
		ConWVecZ = ConWVecZ,

		ConNominalWidth = ConNominalWidth_1,
		ConNominalDepth = ConNominalDepth_1,
		ConWidth = ConWidth_1,
		ConDepth = ConDepth_1,
		ConLength = ConLength_1,
		ConWallThickness = ConWallThickness_1,
		ConConnectorWidth = ConConnectorWidth_1,
		ConConnectorDepth = ConConnectorDepth_1,
		ConConnectorWidth2 = ConConnectorWidth2_1,
		ConToolType = ConToolType_1,
		ConStatus = ConStatus_1,
		ConType_1 = ConType_1,
		ConConnectorType_1 = ConConnectorType_1,
		ConSystem_1 = ConSystem_1,
		shape_typ_to_validation = shape_typ_to_validation,
		MEP_enabled_geometry_mod = 1

	parameters MEP_ConInfo[ConID][1] = STR(ConToolType_1, 1, 0)
	parameters MEP_ConInfo[ConID][2] = ConName
	parameters MEP_ConInfo[ConID][3] = "0"

	! --- 2nd CONNECTION --- !

	ConID = 2
	if bDoubleFlue then
		ConName = `Соединение Дымохода 2 (Канал 1)`
	else
		ConName = `Соединение Дымохода 2`
	endif

	if abs(smokeAngle_2) < eps then
		ConDVecX = 0
		ConDVecY = -1
		ConDVecZ = 0

		ConWVecX = 1
		ConWVecY = 0
		ConWVecZ = 0

		parameters ConPosX_2 = -A/2 + flueRadius + diff
		parameters ConPosY_2 = -B/2
	endif
	if abs(smokeAngle_2 - 90) < eps then
		ConDVecX = 1
		ConDVecY = 0
		ConDVecZ = 0

		ConWVecX = 0
		ConWVecY = -1
		ConWVecZ = 0

		parameters ConPosX_2 = A/2
		parameters ConPosY_2 = 0
	endif
	if abs(smokeAngle_2 - 180) < eps then
		ConDVecX = 0
		ConDVecY = 1
		ConDVecZ = 0

		ConWVecX = 1
		ConWVecY = 0
		ConWVecZ = 0

		parameters ConPosX_2 = -A/2 + flueRadius + diff
		parameters ConPosY_2 = B/2
	endif
	if abs(smokeAngle_2 - 270) < eps then
		ConDVecX = -1
		ConDVecY = 0
		ConDVecZ = 0

		ConWVecX = 0
		ConWVecY = -1
		ConWVecZ = 0

		parameters ConPosX_2 = -A/2
		parameters ConPosY_2 = 0
	endif

	parameters ConWidth_2 = 2 * flueRadius
	parameters ConDepth_2 = ConWidth_2
	values "ConLength_2" RANGE [0, ]
	if nSmokeCon = 2 then
		values "ConPosZ_2" range [ConPosZ_1 + prefabUnitHeight, zSmokeConMax1] step ConPosZ_1 + prefabUnitHeight, prefabUnitHeight
	endif
	if nSmokeCon > 2 then
		values "ConPosZ_2" range [ConPosZ_1 + prefabUnitHeight, ConPosZ_3 - prefabUnitHeight] step ConPosZ_1 + prefabUnitHeight, prefabUnitHeight
	endif

	call "MEP_m_ConnectionsACL_4" parameters SetProgram = SetProgram,
		gs_Connections = gs_Connections,
		MEP_NumConnectionData = MEP_NumConnectionData,
		MEP_StrConnectionData = MEP_StrConnectionData,
		MEP_NumberConnections = MEP_NumberConnections,
		gs_AddConnections = gs_AddConnections,
		ConName = ConName,
		ConID = ConID,
		ConPosX = ConPosX_2,
		ConPosY = ConPosY_2,
		ConPosZ = ConPosZ_2,
		ConDVecX = ConDVecX,
		ConDVecY = ConDVecY,
		ConDVecZ = ConDVecZ,
		ConWVecX = ConWVecX,
		ConWVecY = ConWVecY,
		ConWVecZ = ConWVecZ,

		ConNominalWidth = ConNominalWidth_2,
		ConNominalDepth = ConNominalDepth_2,
		ConWidth = ConWidth_2,
		ConDepth = ConDepth_2,
		ConLength = ConLength_2,
		ConWallThickness = ConWallThickness_2,
		ConConnectorWidth = ConConnectorWidth_2,
		ConConnectorDepth = ConConnectorDepth_2,
		ConConnectorWidth2 = ConConnectorWidth2_2,
		ConToolType = ConToolType_2,
		ConStatus = ConStatus_2,
		ConType_2 = ConType_2,
		ConConnectorType_2 = ConConnectorType_2,
		ConSystem_2 = ConSystem_2,
		shape_typ_to_validation = shape_typ_to_validation,
		MEP_enabled_geometry_mod = 1

	parameters MEP_ConInfo[ConID][1] = STR(ConToolType_2, 1, 0)
	parameters MEP_ConInfo[ConID][2] = ConName
	parameters MEP_ConInfo[ConID][3] = "0"

	! --- 3rd CONNECTION --- !

	ConID = 3
	if bDoubleFlue then
		ConName = `Соединение Дымохода 3 (Канал 1)`
	else
		ConName = `Соединение Дымохода 3`
	endif

	if abs(smokeAngle_3) < eps then
		ConDVecX = 0
		ConDVecY = -1
		ConDVecZ = 0

		ConWVecX = 1
		ConWVecY = 0
		ConWVecZ = 0

		parameters ConPosX_3 = -A/2 + flueRadius + diff
		parameters ConPosY_3 = -B/2
	endif
	if abs(smokeAngle_3 - 90) < eps then
		ConDVecX = 1
		ConDVecY = 0
		ConDVecZ = 0

		ConWVecX = 0
		ConWVecY = -1
		ConWVecZ = 0

		parameters ConPosX_3 = A/2
		parameters ConPosY_3 = 0
	endif
	if abs(smokeAngle_3 - 180) < eps then
		ConDVecX = 0
		ConDVecY = 1
		ConDVecZ = 0

		ConWVecX = 1
		ConWVecY = 0
		ConWVecZ = 0

		parameters ConPosX_3 = -A/2 + flueRadius + diff
		parameters ConPosY_3 = B/2
	endif
	if abs(smokeAngle_3 - 270) < eps then
		ConDVecX = -1
		ConDVecY = 0
		ConDVecZ = 0

		ConWVecX = 0
		ConWVecY = -1
		ConWVecZ = 0

		parameters ConPosX_3 = -A/2
		parameters ConPosY_3 = 0
	endif

	parameters ConWidth_3 = 2 * flueRadius
	parameters ConDepth_3 = ConWidth_3
	values "ConLength_3" RANGE [0, ]
	if nSmokeCon = 3 then
		values "ConPosZ_3" range [ConPosZ_2 + prefabUnitHeight, zSmokeConMax1] step ConPosZ_2 + prefabUnitHeight, prefabUnitHeight
	endif
	if nSmokeCon > 3 then
		values "ConPosZ_3" range [ConPosZ_2 + prefabUnitHeight, ConPosZ_4 - prefabUnitHeight] step ConPosZ_2 + prefabUnitHeight, prefabUnitHeight
	endif

	call "MEP_m_ConnectionsACL_4" parameters SetProgram = SetProgram,
		gs_Connections = gs_Connections,
		MEP_NumConnectionData = MEP_NumConnectionData,
		MEP_StrConnectionData = MEP_StrConnectionData,
		MEP_NumberConnections = MEP_NumberConnections,
		gs_AddConnections = gs_AddConnections,
		ConName = ConName,
		ConID = ConID,
		ConPosX = ConPosX_3,
		ConPosY = ConPosY_3,
		ConPosZ = ConPosZ_3,
		ConDVecX = ConDVecX,
		ConDVecY = ConDVecY,
		ConDVecZ = ConDVecZ,
		ConWVecX = ConWVecX,
		ConWVecY = ConWVecY,
		ConWVecZ = ConWVecZ,

		ConNominalWidth = ConNominalWidth_3,
		ConNominalDepth = ConNominalDepth_3,
		ConWidth = ConWidth_3,
		ConDepth = ConDepth_3,
		ConLength = ConLength_3,
		ConWallThickness = ConWallThickness_3,
		ConConnectorWidth = ConConnectorWidth_3,
		ConConnectorDepth = ConConnectorDepth_3,
		ConConnectorWidth2 = ConConnectorWidth2_3,
		ConToolType = ConToolType_3,
		ConStatus = ConStatus_3,
		ConType_3 = ConType_3,
		ConConnectorType_3 = ConConnectorType_3,
		ConSystem_3 = ConSystem_3,
		shape_typ_to_validation = shape_typ_to_validation,
		MEP_enabled_geometry_mod = 1

	parameters MEP_ConInfo[ConID][1] = STR(ConToolType_3, 1, 0)
	parameters MEP_ConInfo[ConID][2] = ConName
	parameters MEP_ConInfo[ConID][3] = "0"

	! --- 4th CONNECTION --- !

	ConID = 4
	if bDoubleFlue then
		ConName = `Соединение Дымохода 4 (Канал 1)`
	else
		ConName = `Соединение Дымохода 4`
	endif

	if abs(smokeAngle_4) < eps then
		ConDVecX = 0
		ConDVecY = -1
		ConDVecZ = 0

		ConWVecX = 1
		ConWVecY = 0
		ConWVecZ = 0

		parameters ConPosX_4 = -A/2 + flueRadius + diff
		parameters ConPosY_4 = -B/2
	endif
	if abs(smokeAngle_4 - 90) < eps then
		ConDVecX = 1
		ConDVecY = 0
		ConDVecZ = 0

		ConWVecX = 0
		ConWVecY = -1
		ConWVecZ = 0

		parameters ConPosX_4 = A/2
		parameters ConPosY_4 = 0
	endif
	if abs(smokeAngle_4 - 180) < eps then
		ConDVecX = 0
		ConDVecY = 1
		ConDVecZ = 0

		ConWVecX = 1
		ConWVecY = 0
		ConWVecZ = 0

		parameters ConPosX_4 = -A/2 + flueRadius + diff
		parameters ConPosY_4 = B/2
	endif
	if abs(smokeAngle_4 - 270) < eps then
		ConDVecX = -1
		ConDVecY = 0
		ConDVecZ = 0

		ConWVecX = 0
		ConWVecY = -1
		ConWVecZ = 0

		parameters ConPosX_4 = -A/2
		parameters ConPosY_4 = 0
	endif

	parameters ConWidth_4 = 2 * flueRadius
	parameters ConDepth_4 = ConWidth_4
	values "ConLength_4" RANGE [0, ]
	if nSmokeCon = 4 then
		values "ConPosZ_4" range [ConPosZ_3 + prefabUnitHeight, zSmokeConMax1] step ConPosZ_3 + prefabUnitHeight, prefabUnitHeight
	endif
	if nSmokeCon > 4 then
		values "ConPosZ_4" range [ConPosZ_3 + prefabUnitHeight, ConPosZ_5 - prefabUnitHeight] step ConPosZ_3 + prefabUnitHeight, prefabUnitHeight
	endif

	call "MEP_m_ConnectionsACL_4" parameters SetProgram = SetProgram,
		gs_Connections = gs_Connections,
		MEP_NumConnectionData = MEP_NumConnectionData,
		MEP_StrConnectionData = MEP_StrConnectionData,
		MEP_NumberConnections = MEP_NumberConnections,
		gs_AddConnections = gs_AddConnections,
		ConName = ConName,
		ConID = ConID,
		ConPosX = ConPosX_4,
		ConPosY = ConPosY_4,
		ConPosZ = ConPosZ_4,
		ConDVecX = ConDVecX,
		ConDVecY = ConDVecY,
		ConDVecZ = ConDVecZ,
		ConWVecX = ConWVecX,
		ConWVecY = ConWVecY,
		ConWVecZ = ConWVecZ,

		ConNominalWidth = ConNominalWidth_4,
		ConNominalDepth = ConNominalDepth_4,
		ConWidth = ConWidth_4,
		ConDepth = ConDepth_4,
		ConLength = ConLength_4,
		ConWallThickness = ConWallThickness_4,
		ConConnectorWidth = ConConnectorWidth_4,
		ConConnectorDepth = ConConnectorDepth_4,
		ConConnectorWidth2 = ConConnectorWidth2_4,
		ConToolType = ConToolType_4,
		ConStatus = ConStatus_4,
		ConType_4 = ConType_4,
		ConConnectorType_4 = ConConnectorType_4,
		ConSystem_4 = ConSystem_4,
		shape_typ_to_validation = shape_typ_to_validation,
		MEP_enabled_geometry_mod = 1

	parameters MEP_ConInfo[ConID][1] = STR(ConToolType_4, 1, 0)
	parameters MEP_ConInfo[ConID][2] = ConName
	parameters MEP_ConInfo[ConID][3] = "0"

	! --- 5th CONNECTION --- !

	ConID = 5
	if bDoubleFlue then
		ConName = `Соединение Дымохода 5 (Канал 1)`
	else
		ConName = `Соединение Дымохода 5`
	endif

	if abs(smokeAngle_5) < eps then
		ConDVecX = 0
		ConDVecY = -1
		ConDVecZ = 0

		ConWVecX = 1
		ConWVecY = 0
		ConWVecZ = 0

		parameters ConPosX_5 = -A/2 + flueRadius + diff
		parameters ConPosY_5 = -B/2
	endif
	if abs(smokeAngle_5 - 90) < eps then
		ConDVecX = 1
		ConDVecY = 0
		ConDVecZ = 0

		ConWVecX = 0
		ConWVecY = -1
		ConWVecZ = 0

		parameters ConPosX_5 = A/2
		parameters ConPosY_5 = 0
	endif
	if abs(smokeAngle_5 - 180) < eps then
		ConDVecX = 0
		ConDVecY = 1
		ConDVecZ = 0

		ConWVecX = 1
		ConWVecY = 0
		ConWVecZ = 0

		parameters ConPosX_5 = -A/2 + flueRadius + diff
		parameters ConPosY_5 = B/2
	endif
	if abs(smokeAngle_5 - 270) < eps then
		ConDVecX = -1
		ConDVecY = 0
		ConDVecZ = 0

		ConWVecX = 0
		ConWVecY = -1
		ConWVecZ = 0

		parameters ConPosX_5 = -A/2
		parameters ConPosY_5 = 0
	endif

	parameters ConWidth_5 = 2 * flueRadius
	parameters ConDepth_5 = ConWidth_5
	values "ConLength_5" RANGE [0, ]
	if nSmokeCon = 5 then
		values "ConPosZ_5" range [ConPosZ_4 + prefabUnitHeight, zSmokeConMax1] step ConPosZ_4 + prefabUnitHeight, prefabUnitHeight
	endif
	if nSmokeCon > 5 then
		values "ConPosZ_5" range [ConPosZ_4 + prefabUnitHeight, ConPosZ_6 - prefabUnitHeight] step ConPosZ_4 + prefabUnitHeight, prefabUnitHeight
	endif

	call "MEP_m_ConnectionsACL_4" parameters SetProgram = SetProgram,
		gs_Connections = gs_Connections,
		MEP_NumConnectionData = MEP_NumConnectionData,
		MEP_StrConnectionData = MEP_StrConnectionData,
		MEP_NumberConnections = MEP_NumberConnections,
		gs_AddConnections = gs_AddConnections,
		ConName = ConName,
		ConID = ConID,
		ConPosX = ConPosX_5,
		ConPosY = ConPosY_5,
		ConPosZ = ConPosZ_5,
		ConDVecX = ConDVecX,
		ConDVecY = ConDVecY,
		ConDVecZ = ConDVecZ,
		ConWVecX = ConWVecX,
		ConWVecY = ConWVecY,
		ConWVecZ = ConWVecZ,

		ConNominalWidth = ConNominalWidth_5,
		ConNominalDepth = ConNominalDepth_5,
		ConWidth = ConWidth_5,
		ConDepth = ConDepth_5,
		ConLength = ConLength_5,
		ConWallThickness = ConWallThickness_5,
		ConConnectorWidth = ConConnectorWidth_5,
		ConConnectorDepth = ConConnectorDepth_5,
		ConConnectorWidth2 = ConConnectorWidth2_5,
		ConToolType = ConToolType_5,
		ConStatus = ConStatus_5,
		ConType_5 = ConType_5,
		ConConnectorType_5 = ConConnectorType_5,
		ConSystem_5 = ConSystem_5,
		shape_typ_to_validation = shape_typ_to_validation,
		MEP_enabled_geometry_mod = 1

	parameters MEP_ConInfo[ConID][1] = STR(ConToolType_5, 1, 0)
	parameters MEP_ConInfo[ConID][2] = ConName
	parameters MEP_ConInfo[ConID][3] = "0"

	! --- 6th CONNECTION --- !

	ConID = 6
	if bDoubleFlue then
		ConName = `Соединение Дымохода 6 (Канал 1)`
	else
		ConName = `Соединение Дымохода 6`
	endif

	if abs(smokeAngle_6) < eps then
		ConDVecX = 0
		ConDVecY = -1
		ConDVecZ = 0

		ConWVecX = 1
		ConWVecY = 0
		ConWVecZ = 0

		parameters ConPosX_6 = -A/2 + flueRadius + diff
		parameters ConPosY_6 = -B/2
	endif
	if abs(smokeAngle_6 - 90) < eps then
		ConDVecX = 1
		ConDVecY = 0
		ConDVecZ = 0

		ConWVecX = 0
		ConWVecY = -1
		ConWVecZ = 0

		parameters ConPosX_6 = A/2
		parameters ConPosY_6 = 0
	endif
	if abs(smokeAngle_6 - 180) < eps then
		ConDVecX = 0
		ConDVecY = 1
		ConDVecZ = 0

		ConWVecX = 1
		ConWVecY = 0
		ConWVecZ = 0

		parameters ConPosX_6 = -A/2 + flueRadius + diff
		parameters ConPosY_6 = B/2
	endif
	if abs(smokeAngle_6 - 270) < eps then
		ConDVecX = -1
		ConDVecY = 0
		ConDVecZ = 0

		ConWVecX = 0
		ConWVecY = -1
		ConWVecZ = 0

		parameters ConPosX_6 = -A/2
		parameters ConPosY_6 = 0
	endif

	parameters ConWidth_6 = 2 * flueRadius
	parameters ConDepth_6 = ConWidth_6
	values "ConLength_6" RANGE [0, ]
	if nSmokeCon = 6 then
		values "ConPosZ_6" range [ConPosZ_5 + prefabUnitHeight, zSmokeConMax1] step ConPosZ_5 + prefabUnitHeight, prefabUnitHeight
	endif
	if nSmokeCon > 6 then
		values "ConPosZ_6" range [ConPosZ_5 + prefabUnitHeight, ConPosZ_7 - prefabUnitHeight] step ConPosZ_5 + prefabUnitHeight, prefabUnitHeight
	endif

	call "MEP_m_ConnectionsACL_4" parameters SetProgram = SetProgram,
		gs_Connections = gs_Connections,
		MEP_NumConnectionData = MEP_NumConnectionData,
		MEP_StrConnectionData = MEP_StrConnectionData,
		MEP_NumberConnections = MEP_NumberConnections,
		gs_AddConnections = gs_AddConnections,
		ConName = ConName,
		ConID = ConID,
		ConPosX = ConPosX_6,
		ConPosY = ConPosY_6,
		ConPosZ = ConPosZ_6,
		ConDVecX = ConDVecX,
		ConDVecY = ConDVecY,
		ConDVecZ = ConDVecZ,
		ConWVecX = ConWVecX,
		ConWVecY = ConWVecY,
		ConWVecZ = ConWVecZ,

		ConNominalWidth = ConNominalWidth_6,
		ConNominalDepth = ConNominalDepth_6,
		ConWidth = ConWidth_6,
		ConDepth = ConDepth_6,
		ConLength = ConLength_6,
		ConWallThickness = ConWallThickness_6,
		ConConnectorWidth = ConConnectorWidth_6,
		ConConnectorDepth = ConConnectorDepth_6,
		ConConnectorWidth2 = ConConnectorWidth2_6,
		ConToolType = ConToolType_6,
		ConStatus = ConStatus_6,
		ConType_6 = ConType_6,
		ConConnectorType_6 = ConConnectorType_6,
		ConSystem_6 = ConSystem_6,
		shape_typ_to_validation = shape_typ_to_validation,
		MEP_enabled_geometry_mod = 1

	parameters MEP_ConInfo[ConID][1] = STR(ConToolType_6, 1, 0)
	parameters MEP_ConInfo[ConID][2] = ConName
	parameters MEP_ConInfo[ConID][3] = "0"

	! --- 7th CONNECTION --- !

	ConID = 7
	if bDoubleFlue then
		ConName = `Соединение Дымохода 7 (Канал 1)`
	else
		ConName = `Соединение Дымохода 7`
	endif

	if abs(smokeAngle_7) < eps then
		ConDVecX = 0
		ConDVecY = -1
		ConDVecZ = 0

		ConWVecX = 1
		ConWVecY = 0
		ConWVecZ = 0

		parameters ConPosX_7 = -A/2 + flueRadius + diff
		parameters ConPosY_7 = -B/2
	endif
	if abs(smokeAngle_7 - 90) < eps then
		ConDVecX = 1
		ConDVecY = 0
		ConDVecZ = 0

		ConWVecX = 0
		ConWVecY = -1
		ConWVecZ = 0

		parameters ConPosX_7 = A/2
		parameters ConPosY_7 = 0
	endif
	if abs(smokeAngle_7 - 180) < eps then
		ConDVecX = 0
		ConDVecY = 1
		ConDVecZ = 0

		ConWVecX = 1
		ConWVecY = 0
		ConWVecZ = 0

		parameters ConPosX_7 = -A/2 + flueRadius + diff
		parameters ConPosY_7 = B/2
	endif
	if abs(smokeAngle_7 - 270) < eps then
		ConDVecX = -1
		ConDVecY = 0
		ConDVecZ = 0

		ConWVecX = 0
		ConWVecY = -1
		ConWVecZ = 0

		parameters ConPosX_7 = -A/2
		parameters ConPosY_7 = 0
	endif

	parameters ConWidth_7 = 2 * flueRadius
	parameters ConDepth_7 = ConWidth_7
	values "ConLength_7" RANGE [0, ]
	if nSmokeCon = 7 then
		values "ConPosZ_7" range [ConPosZ_6 + prefabUnitHeight, zSmokeConMax1] step ConPosZ_6 + prefabUnitHeight, prefabUnitHeight
	endif
	if nSmokeCon > 7 then
		values "ConPosZ_7" range [ConPosZ_6 + prefabUnitHeight, ConPosZ_8 - prefabUnitHeight] step ConPosZ_6 + prefabUnitHeight, prefabUnitHeight
	endif

	call "MEP_m_ConnectionsACL_4" parameters SetProgram = SetProgram,
		gs_Connections = gs_Connections,
		MEP_NumConnectionData = MEP_NumConnectionData,
		MEP_StrConnectionData = MEP_StrConnectionData,
		MEP_NumberConnections = MEP_NumberConnections,
		gs_AddConnections = gs_AddConnections,
		ConName = ConName,
		ConID = ConID,
		ConPosX = ConPosX_7,
		ConPosY = ConPosY_7,
		ConPosZ = ConPosZ_7,
		ConDVecX = ConDVecX,
		ConDVecY = ConDVecY,
		ConDVecZ = ConDVecZ,
		ConWVecX = ConWVecX,
		ConWVecY = ConWVecY,
		ConWVecZ = ConWVecZ,

		ConNominalWidth = ConNominalWidth_7,
		ConNominalDepth = ConNominalDepth_7,
		ConWidth = ConWidth_7,
		ConDepth = ConDepth_7,
		ConLength = ConLength_7,
		ConWallThickness = ConWallThickness_7,
		ConConnectorWidth = ConConnectorWidth_7,
		ConConnectorDepth = ConConnectorDepth_7,
		ConConnectorWidth2 = ConConnectorWidth2_7,
		ConToolType = ConToolType_7,
		ConStatus = ConStatus_7,
		ConType_7 = ConType_7,
		ConConnectorType_7 = ConConnectorType_7,
		ConSystem_7 = ConSystem_7,
		shape_typ_to_validation = shape_typ_to_validation,
		MEP_enabled_geometry_mod = 1

	parameters MEP_ConInfo[ConID][1] = STR(ConToolType_7, 1, 0)
	parameters MEP_ConInfo[ConID][2] = ConName
	parameters MEP_ConInfo[ConID][3] = "0"

	! --- 8th CONNECTION --- !

	ConID = 8
	if bDoubleFlue then
		ConName = `Соединение Дымохода 8 (Канал 1)`
	else
		ConName = `Соединение Дымохода 8`
	endif

	if abs(smokeAngle_8) < eps then
		ConDVecX = 0
		ConDVecY = -1
		ConDVecZ = 0

		ConWVecX = 1
		ConWVecY = 0
		ConWVecZ = 0

		parameters ConPosX_8 = -A/2 + flueRadius + diff
		parameters ConPosY_8 = -B/2
	endif
	if abs(smokeAngle_8 - 90) < eps then
		ConDVecX = 1
		ConDVecY = 0
		ConDVecZ = 0

		ConWVecX = 0
		ConWVecY = -1
		ConWVecZ = 0

		parameters ConPosX_8 = A/2
		parameters ConPosY_8 = 0
	endif
	if abs(smokeAngle_8 - 180) < eps then
		ConDVecX = 0
		ConDVecY = 1
		ConDVecZ = 0

		ConWVecX = 1
		ConWVecY = 0
		ConWVecZ = 0

		parameters ConPosX_8 = -A/2 + flueRadius + diff
		parameters ConPosY_8 = B/2
	endif
	if abs(smokeAngle_8 - 270) < eps then
		ConDVecX = -1
		ConDVecY = 0
		ConDVecZ = 0

		ConWVecX = 0
		ConWVecY = -1
		ConWVecZ = 0

		parameters ConPosX_8 = -A/2
		parameters ConPosY_8 = 0
	endif

	parameters ConWidth_8 = 2 * flueRadius
	parameters ConDepth_8 = ConWidth_8
	values "ConLength_8" RANGE [0, ]
	if nSmokeCon = 8 then
		values "ConPosZ_8" range [ConPosZ_7 + prefabUnitHeight, zSmokeConMax1] step ConPosZ_7 + prefabUnitHeight, prefabUnitHeight
	endif
	if nSmokeCon > 8 then
		values "ConPosZ_8" range [ConPosZ_7 + prefabUnitHeight, ConPosZ_9 - prefabUnitHeight] step ConPosZ_7 + prefabUnitHeight, prefabUnitHeight
	endif

	call "MEP_m_ConnectionsACL_4" parameters SetProgram = SetProgram,
		gs_Connections = gs_Connections,
		MEP_NumConnectionData = MEP_NumConnectionData,
		MEP_StrConnectionData = MEP_StrConnectionData,
		MEP_NumberConnections = MEP_NumberConnections,
		gs_AddConnections = gs_AddConnections,
		ConName = ConName,
		ConID = ConID,
		ConPosX = ConPosX_8,
		ConPosY = ConPosY_8,
		ConPosZ = ConPosZ_8,
		ConDVecX = ConDVecX,
		ConDVecY = ConDVecY,
		ConDVecZ = ConDVecZ,
		ConWVecX = ConWVecX,
		ConWVecY = ConWVecY,
		ConWVecZ = ConWVecZ,

		ConNominalWidth = ConNominalWidth_8,
		ConNominalDepth = ConNominalDepth_8,
		ConWidth = ConWidth_8,
		ConDepth = ConDepth_8,
		ConLength = ConLength_8,
		ConWallThickness = ConWallThickness_8,
		ConConnectorWidth = ConConnectorWidth_8,
		ConConnectorDepth = ConConnectorDepth_8,
		ConConnectorWidth2 = ConConnectorWidth2_8,
		ConToolType = ConToolType_8,
		ConStatus = ConStatus_8,
		ConType_8 = ConType_8,
		ConConnectorType_8 = ConConnectorType_8,
		ConSystem_8 = ConSystem_8,
		shape_typ_to_validation = shape_typ_to_validation,
		MEP_enabled_geometry_mod = 1

	parameters MEP_ConInfo[ConID][1] = STR(ConToolType_8, 1, 0)
	parameters MEP_ConInfo[ConID][2] = ConName
	parameters MEP_ConInfo[ConID][3] = "0"

	! --- 9th CONNECTION --- !

	ConID = 9
	if bDoubleFlue then
		ConName = `Соединение Дымохода 9 (Канал 1)`
	else
		ConName = `Соединение Дымохода 9`
	endif

	if abs(smokeAngle_9) < eps then
		ConDVecX = 0
		ConDVecY = -1
		ConDVecZ = 0

		ConWVecX = 1
		ConWVecY = 0
		ConWVecZ = 0

		parameters ConPosX_9 = -A/2 + flueRadius + diff
		parameters ConPosY_9 = -B/2
	endif
	if abs(smokeAngle_9 - 90) < eps then
		ConDVecX = 1
		ConDVecY = 0
		ConDVecZ = 0

		ConWVecX = 0
		ConWVecY = -1
		ConWVecZ = 0

		parameters ConPosX_9 = A/2
		parameters ConPosY_9 = 0
	endif
	if abs(smokeAngle_9 - 180) < eps then
		ConDVecX = 0
		ConDVecY = 1
		ConDVecZ = 0

		ConWVecX = 1
		ConWVecY = 0
		ConWVecZ = 0

		parameters ConPosX_9 = -A/2 + flueRadius + diff
		parameters ConPosY_9 = B/2
	endif
	if abs(smokeAngle_9 - 270) < eps then
		ConDVecX = -1
		ConDVecY = 0
		ConDVecZ = 0

		ConWVecX = 0
		ConWVecY = -1
		ConWVecZ = 0

		parameters ConPosX_9 = -A/2
		parameters ConPosY_9 = 0
	endif

	parameters ConWidth_9 = 2 * flueRadius
	parameters ConDepth_9 = ConWidth_9
	values "ConLength_9" RANGE [0, ]
	if nSmokeCon = 9 then
		values "ConPosZ_9" range [ConPosZ_8 + prefabUnitHeight, zSmokeConMax1] step ConPosZ_8 + prefabUnitHeight, prefabUnitHeight
	endif
	if not(bDoubleFlue) & nSmokeCon > 9 then
		values "ConPosZ_9" range [ConPosZ_8 + prefabUnitHeight, ConPosZ_10 - prefabUnitHeight] step ConPosZ_8 + prefabUnitHeight, prefabUnitHeight
	endif

	call "MEP_m_ConnectionsACL_4" parameters SetProgram = SetProgram,
		gs_Connections = gs_Connections,
		MEP_NumConnectionData = MEP_NumConnectionData,
		MEP_StrConnectionData = MEP_StrConnectionData,
		MEP_NumberConnections = MEP_NumberConnections,
		gs_AddConnections = gs_AddConnections,
		ConName = ConName,
		ConID = ConID,
		ConPosX = ConPosX_9,
		ConPosY = ConPosY_9,
		ConPosZ = ConPosZ_9,
		ConDVecX = ConDVecX,
		ConDVecY = ConDVecY,
		ConDVecZ = ConDVecZ,
		ConWVecX = ConWVecX,
		ConWVecY = ConWVecY,
		ConWVecZ = ConWVecZ,

		ConNominalWidth = ConNominalWidth_9,
		ConNominalDepth = ConNominalDepth_9,
		ConWidth = ConWidth_9,
		ConDepth = ConDepth_9,
		ConLength = ConLength_9,
		ConWallThickness = ConWallThickness_9,
		ConConnectorWidth = ConConnectorWidth_9,
		ConConnectorDepth = ConConnectorDepth_9,
		ConConnectorWidth2 = ConConnectorWidth2_9,
		ConToolType = ConToolType_9,
		ConStatus = ConStatus_9,
		ConType_9 = ConType_9,
		ConConnectorType_9 = ConConnectorType_9,
		ConSystem_9 = ConSystem_9,
		shape_typ_to_validation = shape_typ_to_validation,
		MEP_enabled_geometry_mod = 1

	parameters MEP_ConInfo[ConID][1] = STR(ConToolType_9, 1, 0)
	parameters MEP_ConInfo[ConID][2] = ConName
	parameters MEP_ConInfo[ConID][3] = "0"

	if bDoubleFlue then

		! --- 10th CONNECTION --- !

		ConID = 10
		ConName = `Соединение Дымохода 1 (Канал 2)`

		if abs(smokeAngle_10) < eps then
			ConDVecX = 0
			ConDVecY = -1
			ConDVecZ = 0

			ConWVecX = 1
			ConWVecY = 0
			ConWVecZ = 0

			parameters ConPosX_10 = A/2 - flueRadius2 - diff
			parameters ConPosY_10 = -B/2
		endif
		if abs(smokeAngle_10 - 90) < eps then
			ConDVecX = 1
			ConDVecY = 0
			ConDVecZ = 0

			ConWVecX = 0
			ConWVecY = -1
			ConWVecZ = 0

			parameters ConPosX_10 = A/2
			parameters ConPosY_10 = 0
		endif
		if abs(smokeAngle_10 - 180) < eps then
			ConDVecX = 0
			ConDVecY = 1
			ConDVecZ = 0

			ConWVecX = 1
			ConWVecY = 0
			ConWVecZ = 0

			parameters ConPosX_10 = A/2 - flueRadius - diff
			parameters ConPosY_10 = B/2
		endif

		parameters ConWidth_10 = 2 * flueRadius
		parameters ConDepth_10 = ConWidth_10
		values "ConLength_10" RANGE [0, ]

		zSmokeConMin = 2.5 * prefabUnitHeight + 2 * bShowBase * prefabUnitHeight
		if nSmokeCon2 = 1 then
			values "ConPosZ_10" range [zSmokeConMin, zSmokeConMax2] step zSmokeConMin, prefabUnitHeight
		endif
		if nSmokeCon2 > 1 then
			values "ConPosZ_10" range [zSmokeConMin, ConPosZ_11 - prefabUnitHeight] step zSmokeConMin, prefabUnitHeight
		endif

		call "MEP_m_ConnectionsACL_4" parameters SetProgram = SetProgram,
			gs_Connections = gs_Connections,
			MEP_NumConnectionData = MEP_NumConnectionData,
			MEP_StrConnectionData = MEP_StrConnectionData,
			MEP_NumberConnections = MEP_NumberConnections,
			gs_AddConnections = gs_AddConnections,
			ConName = ConName,
			ConID = ConID,
			ConPosX = ConPosX_10,
			ConPosY = ConPosY_10,
			ConPosZ = ConPosZ_10,
			ConDVecX = ConDVecX,
			ConDVecY = ConDVecY,
			ConDVecZ = ConDVecZ,
			ConWVecX = ConWVecX,
			ConWVecY = ConWVecY,
			ConWVecZ = ConWVecZ,

			ConNominalWidth = ConNominalWidth_10,
			ConNominalDepth = ConNominalDepth_10,
			ConWidth = ConWidth_10,
			ConDepth = ConDepth_10,
			ConLength = ConLength_10,
			ConWallThickness = ConWallThickness_10,
			ConConnectorWidth = ConConnectorWidth_10,
			ConConnectorDepth = ConConnectorDepth_10,
			ConConnectorWidth2 = ConConnectorWidth2_10,
			ConToolType = ConToolType_10,
			ConStatus = ConStatus_10,
			ConType_10 = ConType_10,
			ConConnectorType_10 = ConConnectorType_10,
			ConSystem_10 = ConSystem_10,
			shape_typ_to_validation = shape_typ_to_validation,
			MEP_enabled_geometry_mod = 1

		parameters MEP_ConInfo[ConID][1] = STR(ConToolType_10, 1, 0)
		parameters MEP_ConInfo[ConID][2] = ConName
		parameters MEP_ConInfo[ConID][3] = "0"

		! --- 11th CONNECTION --- !

		ConID = 11
		ConName = `Соединение Дымохода 2 (Канал 2)`

		if abs(smokeAngle_11) < eps then
			ConDVecX = 0
			ConDVecY = -1
			ConDVecZ = 0

			ConWVecX = 1
			ConWVecY = 0
			ConWVecZ = 0

			parameters ConPosX_11 = A/2 - flueRadius2 - diff
			parameters ConPosY_11 = -B/2
		endif
		if abs(smokeAngle_11 - 90) < eps then
			ConDVecX = 1
			ConDVecY = 0
			ConDVecZ = 0

			ConWVecX = 0
			ConWVecY = -1
			ConWVecZ = 0

			parameters ConPosX_11 = A/2
			parameters ConPosY_11 = 0
		endif
		if abs(smokeAngle_11 - 180) < eps then
			ConDVecX = 0
			ConDVecY = 1
			ConDVecZ = 0

			ConWVecX = 1
			ConWVecY = 0
			ConWVecZ = 0

			parameters ConPosX_11 = A/2 - flueRadius - diff
			parameters ConPosY_11 = B/2
		endif

		parameters ConWidth_11 = 2 * flueRadius
		parameters ConDepth_11 = ConWidth_11
		values "ConLength_11" RANGE [0, ]

		if nSmokeCon2 = 2 then
			values "ConPosZ_11" range [ConPosZ_10 + prefabUnitHeight, zSmokeConMax2] step ConPosZ_10 + prefabUnitHeight, prefabUnitHeight
		endif
		if nSmokeCon2 > 2 then
			values "ConPosZ_11" range [ConPosZ_10 + prefabUnitHeight, ConPosZ_12 - prefabUnitHeight] step ConPosZ_10 + prefabUnitHeight, prefabUnitHeight
		endif

		call "MEP_m_ConnectionsACL_4" parameters SetProgram = SetProgram,
			gs_Connections = gs_Connections,
			MEP_NumConnectionData = MEP_NumConnectionData,
			MEP_StrConnectionData = MEP_StrConnectionData,
			MEP_NumberConnections = MEP_NumberConnections,
			gs_AddConnections = gs_AddConnections,
			ConName = ConName,
			ConID = ConID,
			ConPosX = ConPosX_11,
			ConPosY = ConPosY_11,
			ConPosZ = ConPosZ_11,
			ConDVecX = ConDVecX,
			ConDVecY = ConDVecY,
			ConDVecZ = ConDVecZ,
			ConWVecX = ConWVecX,
			ConWVecY = ConWVecY,
			ConWVecZ = ConWVecZ,

			ConNominalWidth = ConNominalWidth_11,
			ConNominalDepth = ConNominalDepth_11,
			ConWidth = ConWidth_11,
			ConDepth = ConDepth_11,
			ConLength = ConLength_11,
			ConWallThickness = ConWallThickness_11,
			ConConnectorWidth = ConConnectorWidth_11,
			ConConnectorDepth = ConConnectorDepth_11,
			ConConnectorWidth2 = ConConnectorWidth2_11,
			ConToolType = ConToolType_11,
			ConStatus = ConStatus_11,
			ConType_11 = ConType_11,
			ConConnectorType_11 = ConConnectorType_11,
			ConSystem_11 = ConSystem_11,
			shape_typ_to_validation = shape_typ_to_validation,
			MEP_enabled_geometry_mod = 1

		parameters MEP_ConInfo[ConID][1] = STR(ConToolType_11, 1, 0)
		parameters MEP_ConInfo[ConID][2] = ConName
		parameters MEP_ConInfo[ConID][3] = "0"

		! --- 12th CONNECTION --- !

		ConID = 12
		ConName = `Соединение Дымохода 3 (Канал 2)`

		if abs(smokeAngle_12) < eps then
			ConDVecX = 0
			ConDVecY = -1
			ConDVecZ = 0

			ConWVecX = 1
			ConWVecY = 0
			ConWVecZ = 0

			parameters ConPosX_12 = A/2 - flueRadius2 - diff
			parameters ConPosY_12 = -B/2
		endif
		if abs(smokeAngle_12 - 90) < eps then
			ConDVecX = 1
			ConDVecY = 0
			ConDVecZ = 0

			ConWVecX = 0
			ConWVecY = -1
			ConWVecZ = 0

			parameters ConPosX_12 = A/2
			parameters ConPosY_12 = 0
		endif
		if abs(smokeAngle_12 - 180) < eps then
			ConDVecX = 0
			ConDVecY = 1
			ConDVecZ = 0

			ConWVecX = 1
			ConWVecY = 0
			ConWVecZ = 0

			parameters ConPosX_12 = A/2 - flueRadius - diff
			parameters ConPosY_12 = B/2
		endif

		parameters ConWidth_12 = 2 * flueRadius
		parameters ConDepth_12 = ConWidth_12
		values "ConLength_12" RANGE [0, ]

		if nSmokeCon2 = 3 then
			values "ConPosZ_12" range [ConPosZ_11 + prefabUnitHeight, zSmokeConMax2] step ConPosZ_11 + prefabUnitHeight, prefabUnitHeight
		endif
		if nSmokeCon2 > 3 then
			values "ConPosZ_12" range [ConPosZ_11 + prefabUnitHeight, ConPosZ_13 - prefabUnitHeight] step ConPosZ_11 + prefabUnitHeight, prefabUnitHeight
		endif

		call "MEP_m_ConnectionsACL_4" parameters SetProgram = SetProgram,
			gs_Connections = gs_Connections,
			MEP_NumConnectionData = MEP_NumConnectionData,
			MEP_StrConnectionData = MEP_StrConnectionData,
			MEP_NumberConnections = MEP_NumberConnections,
			gs_AddConnections = gs_AddConnections,
			ConName = ConName,
			ConID = ConID,
			ConPosX = ConPosX_12,
			ConPosY = ConPosY_12,
			ConPosZ = ConPosZ_12,
			ConDVecX = ConDVecX,
			ConDVecY = ConDVecY,
			ConDVecZ = ConDVecZ,
			ConWVecX = ConWVecX,
			ConWVecY = ConWVecY,
			ConWVecZ = ConWVecZ,

			ConNominalWidth = ConNominalWidth_12,
			ConNominalDepth = ConNominalDepth_12,
			ConWidth = ConWidth_12,
			ConDepth = ConDepth_12,
			ConLength = ConLength_12,
			ConWallThickness = ConWallThickness_12,
			ConConnectorWidth = ConConnectorWidth_12,
			ConConnectorDepth = ConConnectorDepth_12,
			ConConnectorWidth2 = ConConnectorWidth2_12,
			ConToolType = ConToolType_12,
			ConStatus = ConStatus_12,
			ConType_12 = ConType_12,
			ConConnectorType_12 = ConConnectorType_12,
			ConSystem_12 = ConSystem_12,
			shape_typ_to_validation = shape_typ_to_validation,
			MEP_enabled_geometry_mod = 1

		parameters MEP_ConInfo[ConID][1] = STR(ConToolType_12, 1, 0)
		parameters MEP_ConInfo[ConID][2] = ConName
		parameters MEP_ConInfo[ConID][3] = "0"

		! --- 13th CONNECTION --- !

		ConID = 13
		ConName = `Соединение Дымохода 4 (Канал 2)`

		if abs(smokeAngle_13) < eps then
			ConDVecX = 0
			ConDVecY = -1
			ConDVecZ = 0

			ConWVecX = 1
			ConWVecY = 0
			ConWVecZ = 0

			parameters ConPosX_13 = A/2 - flueRadius2 - diff
			parameters ConPosY_13 = -B/2
		endif
		if abs(smokeAngle_13 - 90) < eps then
			ConDVecX = 1
			ConDVecY = 0
			ConDVecZ = 0

			ConWVecX = 0
			ConWVecY = -1
			ConWVecZ = 0

			parameters ConPosX_13 = A/2
			parameters ConPosY_13 = 0
		endif
		if abs(smokeAngle_13 - 180) < eps then
			ConDVecX = 0
			ConDVecY = 1
			ConDVecZ = 0

			ConWVecX = 1
			ConWVecY = 0
			ConWVecZ = 0

			parameters ConPosX_13 = A/2 - flueRadius - diff
			parameters ConPosY_13 = B/2
		endif

		parameters ConWidth_13 = 2 * flueRadius
		parameters ConDepth_13 = ConWidth_13
		values "ConLength_13" RANGE [0, ]

		if nSmokeCon2 = 4 then
			values "ConPosZ_13" range [ConPosZ_12 + prefabUnitHeight, zSmokeConMax2] step ConPosZ_12 + prefabUnitHeight, prefabUnitHeight
		endif
		if nSmokeCon2 > 4 then
			values "ConPosZ_13" range [ConPosZ_12 + prefabUnitHeight, ConPosZ_14 - prefabUnitHeight] step ConPosZ_12 + prefabUnitHeight, prefabUnitHeight
		endif

		call "MEP_m_ConnectionsACL_4" parameters SetProgram = SetProgram,
			gs_Connections = gs_Connections,
			MEP_NumConnectionData = MEP_NumConnectionData,
			MEP_StrConnectionData = MEP_StrConnectionData,
			MEP_NumberConnections = MEP_NumberConnections,
			gs_AddConnections = gs_AddConnections,
			ConName = ConName,
			ConID = ConID,
			ConPosX = ConPosX_13,
			ConPosY = ConPosY_13,
			ConPosZ = ConPosZ_13,
			ConDVecX = ConDVecX,
			ConDVecY = ConDVecY,
			ConDVecZ = ConDVecZ,
			ConWVecX = ConWVecX,
			ConWVecY = ConWVecY,
			ConWVecZ = ConWVecZ,

			ConNominalWidth = ConNominalWidth_13,
			ConNominalDepth = ConNominalDepth_13,
			ConWidth = ConWidth_13,
			ConDepth = ConDepth_13,
			ConLength = ConLength_13,
			ConWallThickness = ConWallThickness_13,
			ConConnectorWidth = ConConnectorWidth_13,
			ConConnectorDepth = ConConnectorDepth_13,
			ConConnectorWidth2 = ConConnectorWidth2_13,
			ConToolType = ConToolType_13,
			ConStatus = ConStatus_13,
			ConType_13 = ConType_13,
			ConConnectorType_13 = ConConnectorType_13,
			ConSystem_13 = ConSystem_13,
			shape_typ_to_validation = shape_typ_to_validation,
			MEP_enabled_geometry_mod = 1

		parameters MEP_ConInfo[ConID][1] = STR(ConToolType_13, 1, 0)
		parameters MEP_ConInfo[ConID][2] = ConName
		parameters MEP_ConInfo[ConID][3] = "0"

		! --- 14th CONNECTION --- !

		ConID = 14
		ConName = `Соединение Дымохода 5 (Канал 2)`

		if abs(smokeAngle_14) < eps then
			ConDVecX = 0
			ConDVecY = -1
			ConDVecZ = 0

			ConWVecX = 1
			ConWVecY = 0
			ConWVecZ = 0

			parameters ConPosX_14 = A/2 - flueRadius2 - diff
			parameters ConPosY_14 = -B/2
		endif
		if abs(smokeAngle_14 - 90) < eps then
			ConDVecX = 1
			ConDVecY = 0
			ConDVecZ = 0

			ConWVecX = 0
			ConWVecY = -1
			ConWVecZ = 0

			parameters ConPosX_14 = A/2
			parameters ConPosY_14 = 0
		endif
		if abs(smokeAngle_14 - 180) < eps then
			ConDVecX = 0
			ConDVecY = 1
			ConDVecZ = 0

			ConWVecX = 1
			ConWVecY = 0
			ConWVecZ = 0

			parameters ConPosX_14 = A/2 - flueRadius - diff
			parameters ConPosY_14 = B/2
		endif

		parameters ConWidth_14 = 2 * flueRadius
		parameters ConDepth_14 = ConWidth_14
		values "ConLength_14" RANGE [0, ]

		if nSmokeCon2 = 5 then
			values "ConPosZ_14" range [ConPosZ_13 + prefabUnitHeight, zSmokeConMax2] step ConPosZ_13 + prefabUnitHeight, prefabUnitHeight
		endif
		if nSmokeCon2 > 5 then
			values "ConPosZ_14" range [ConPosZ_13 + prefabUnitHeight, ConPosZ_15 - prefabUnitHeight] step ConPosZ_13 + prefabUnitHeight, prefabUnitHeight
		endif

		call "MEP_m_ConnectionsACL_4" parameters SetProgram = SetProgram,
			gs_Connections = gs_Connections,
			MEP_NumConnectionData = MEP_NumConnectionData,
			MEP_StrConnectionData = MEP_StrConnectionData,
			MEP_NumberConnections = MEP_NumberConnections,
			gs_AddConnections = gs_AddConnections,
			ConName = ConName,
			ConID = ConID,
			ConPosX = ConPosX_14,
			ConPosY = ConPosY_14,
			ConPosZ = ConPosZ_14,
			ConDVecX = ConDVecX,
			ConDVecY = ConDVecY,
			ConDVecZ = ConDVecZ,
			ConWVecX = ConWVecX,
			ConWVecY = ConWVecY,
			ConWVecZ = ConWVecZ,

			ConNominalWidth = ConNominalWidth_14,
			ConNominalDepth = ConNominalDepth_14,
			ConWidth = ConWidth_14,
			ConDepth = ConDepth_14,
			ConLength = ConLength_14,
			ConWallThickness = ConWallThickness_14,
			ConConnectorWidth = ConConnectorWidth_14,
			ConConnectorDepth = ConConnectorDepth_14,
			ConConnectorWidth2 = ConConnectorWidth2_14,
			ConToolType = ConToolType_14,
			ConStatus = ConStatus_14,
			ConType_14 = ConType_14,
			ConConnectorType_14 = ConConnectorType_14,
			ConSystem_14 = ConSystem_14,
			shape_typ_to_validation = shape_typ_to_validation,
			MEP_enabled_geometry_mod = 1

		parameters MEP_ConInfo[ConID][1] = STR(ConToolType_14, 1, 0)
		parameters MEP_ConInfo[ConID][2] = ConName
		parameters MEP_ConInfo[ConID][3] = "0"

		! --- 15th CONNECTION --- !

		ConID = 15
		ConName = `Соединение Дымохода 6 (Канал 2)`

		if abs(smokeAngle_15) < eps then
			ConDVecX = 0
			ConDVecY = -1
			ConDVecZ = 0

			ConWVecX = 1
			ConWVecY = 0
			ConWVecZ = 0

			parameters ConPosX_15 = A/2 - flueRadius2 - diff
			parameters ConPosY_15 = -B/2
		endif
		if abs(smokeAngle_15 - 90) < eps then
			ConDVecX = 1
			ConDVecY = 0
			ConDVecZ = 0

			ConWVecX = 0
			ConWVecY = -1
			ConWVecZ = 0

			parameters ConPosX_15 = A/2
			parameters ConPosY_15 = 0
		endif
		if abs(smokeAngle_15 - 180) < eps then
			ConDVecX = 0
			ConDVecY = 1
			ConDVecZ = 0

			ConWVecX = 1
			ConWVecY = 0
			ConWVecZ = 0

			parameters ConPosX_15 = A/2 - flueRadius - diff
			parameters ConPosY_15 = B/2
		endif

		parameters ConWidth_15 = 2 * flueRadius
		parameters ConDepth_15 = ConWidth_15
		values "ConLength_15" RANGE [0, ]

		if nSmokeCon2 = 6 then
			values "ConPosZ_15" range [ConPosZ_14 + prefabUnitHeight, zSmokeConMax2] step ConPosZ_14 + prefabUnitHeight, prefabUnitHeight
		endif
		if nSmokeCon2 > 6 then
			values "ConPosZ_15" range [ConPosZ_14 + prefabUnitHeight, ConPosZ_16 - prefabUnitHeight] step ConPosZ_14 + prefabUnitHeight, prefabUnitHeight
		endif

		call "MEP_m_ConnectionsACL_4" parameters SetProgram = SetProgram,
			gs_Connections = gs_Connections,
			MEP_NumConnectionData = MEP_NumConnectionData,
			MEP_StrConnectionData = MEP_StrConnectionData,
			MEP_NumberConnections = MEP_NumberConnections,
			gs_AddConnections = gs_AddConnections,
			ConName = ConName,
			ConID = ConID,
			ConPosX = ConPosX_15,
			ConPosY = ConPosY_15,
			ConPosZ = ConPosZ_15,
			ConDVecX = ConDVecX,
			ConDVecY = ConDVecY,
			ConDVecZ = ConDVecZ,
			ConWVecX = ConWVecX,
			ConWVecY = ConWVecY,
			ConWVecZ = ConWVecZ,

			ConNominalWidth = ConNominalWidth_15,
			ConNominalDepth = ConNominalDepth_15,
			ConWidth = ConWidth_15,
			ConDepth = ConDepth_15,
			ConLength = ConLength_15,
			ConWallThickness = ConWallThickness_15,
			ConConnectorWidth = ConConnectorWidth_15,
			ConConnectorDepth = ConConnectorDepth_15,
			ConConnectorWidth2 = ConConnectorWidth2_15,
			ConToolType = ConToolType_15,
			ConStatus = ConStatus_15,
			ConType_15 = ConType_15,
			ConConnectorType_15 = ConConnectorType_15,
			ConSystem_15 = ConSystem_15,
			shape_typ_to_validation = shape_typ_to_validation,
			MEP_enabled_geometry_mod = 1

		parameters MEP_ConInfo[ConID][1] = STR(ConToolType_15, 1, 0)
		parameters MEP_ConInfo[ConID][2] = ConName
		parameters MEP_ConInfo[ConID][3] = "0"

		! --- 16th CONNECTION --- !

		ConID = 16
		ConName = `Соединение Дымохода 7 (Канал 2)`

		if abs(smokeAngle_16) < eps then
			ConDVecX = 0
			ConDVecY = -1
			ConDVecZ = 0

			ConWVecX = 1
			ConWVecY = 0
			ConWVecZ = 0

			parameters ConPosX_16 = A/2 - flueRadius2 - diff
			parameters ConPosY_16 = -B/2
		endif
		if abs(smokeAngle_16 - 90) < eps then
			ConDVecX = 1
			ConDVecY = 0
			ConDVecZ = 0

			ConWVecX = 0
			ConWVecY = -1
			ConWVecZ = 0

			parameters ConPosX_16 = A/2
			parameters ConPosY_16 = 0
		endif
		if abs(smokeAngle_16 - 180) < eps then
			ConDVecX = 0
			ConDVecY = 1
			ConDVecZ = 0

			ConWVecX = 1
			ConWVecY = 0
			ConWVecZ = 0

			parameters ConPosX_16 = A/2 - flueRadius - diff
			parameters ConPosY_16 = B/2
		endif

		parameters ConWidth_16 = 2 * flueRadius
		parameters ConDepth_16 = ConWidth_16
		values "ConLength_16" RANGE [0, ]

		if nSmokeCon2 = 7 then
			values "ConPosZ_16" range [ConPosZ_15 + prefabUnitHeight, zSmokeConMax2] step ConPosZ_15 + prefabUnitHeight, prefabUnitHeight
		endif
		if nSmokeCon2 > 7 then
			values "ConPosZ_16" range [ConPosZ_15 + prefabUnitHeight, ConPosZ_17 - prefabUnitHeight] step ConPosZ_15 + prefabUnitHeight, prefabUnitHeight
		endif

		call "MEP_m_ConnectionsACL_4" parameters SetProgram = SetProgram,
			gs_Connections = gs_Connections,
			MEP_NumConnectionData = MEP_NumConnectionData,
			MEP_StrConnectionData = MEP_StrConnectionData,
			MEP_NumberConnections = MEP_NumberConnections,
			gs_AddConnections = gs_AddConnections,
			ConName = ConName,
			ConID = ConID,
			ConPosX = ConPosX_16,
			ConPosY = ConPosY_16,
			ConPosZ = ConPosZ_16,
			ConDVecX = ConDVecX,
			ConDVecY = ConDVecY,
			ConDVecZ = ConDVecZ,
			ConWVecX = ConWVecX,
			ConWVecY = ConWVecY,
			ConWVecZ = ConWVecZ,

			ConNominalWidth = ConNominalWidth_16,
			ConNominalDepth = ConNominalDepth_16,
			ConWidth = ConWidth_16,
			ConDepth = ConDepth_16,
			ConLength = ConLength_16,
			ConWallThickness = ConWallThickness_16,
			ConConnectorWidth = ConConnectorWidth_16,
			ConConnectorDepth = ConConnectorDepth_16,
			ConConnectorWidth2 = ConConnectorWidth2_16,
			ConToolType = ConToolType_16,
			ConStatus = ConStatus_16,
			ConType_16 = ConType_16,
			ConConnectorType_16 = ConConnectorType_16,
			ConSystem_16 = ConSystem_16,
			shape_typ_to_validation = shape_typ_to_validation,
			MEP_enabled_geometry_mod = 1

		parameters MEP_ConInfo[ConID][1] = STR(ConToolType_16, 1, 0)
		parameters MEP_ConInfo[ConID][2] = ConName
		parameters MEP_ConInfo[ConID][3] = "0"

		! --- 17th CONNECTION --- !

		ConID = 17
		ConName = `Соединение Дымохода 8 (Канал 2)`

		if abs(smokeAngle_17) < eps then
			ConDVecX = 0
			ConDVecY = -1
			ConDVecZ = 0

			ConWVecX = 1
			ConWVecY = 0
			ConWVecZ = 0

			parameters ConPosX_17 = A/2 - flueRadius2 - diff
			parameters ConPosY_17 = -B/2
		endif
		if abs(smokeAngle_17 - 90) < eps then
			ConDVecX = 1
			ConDVecY = 0
			ConDVecZ = 0

			ConWVecX = 0
			ConWVecY = -1
			ConWVecZ = 0

			parameters ConPosX_17 = A/2
			parameters ConPosY_17 = 0
		endif
		if abs(smokeAngle_17 - 180) < eps then
			ConDVecX = 0
			ConDVecY = 1
			ConDVecZ = 0

			ConWVecX = 1
			ConWVecY = 0
			ConWVecZ = 0

			parameters ConPosX_17 = A/2 - flueRadius - diff
			parameters ConPosY_17 = B/2
		endif

		parameters ConWidth_17 = 2 * flueRadius
		parameters ConDepth_17 = ConWidth_17
		values "ConLength_17" RANGE [0, ]

		if nSmokeCon2 = 8 then
			values "ConPosZ_17" range [ConPosZ_16 + prefabUnitHeight, zSmokeConMax2] step ConPosZ_16 + prefabUnitHeight, prefabUnitHeight
		endif
		if nSmokeCon2 > 8 then
			values "ConPosZ_17" range [ConPosZ_16 + prefabUnitHeight, ConPosZ_18 - prefabUnitHeight] step ConPosZ_16 + prefabUnitHeight, prefabUnitHeight
		endif

		call "MEP_m_ConnectionsACL_4" parameters SetProgram = SetProgram,
			gs_Connections = gs_Connections,
			MEP_NumConnectionData = MEP_NumConnectionData,
			MEP_StrConnectionData = MEP_StrConnectionData,
			MEP_NumberConnections = MEP_NumberConnections,
			gs_AddConnections = gs_AddConnections,
			ConName = ConName,
			ConID = ConID,
			ConPosX = ConPosX_17,
			ConPosY = ConPosY_17,
			ConPosZ = ConPosZ_17,
			ConDVecX = ConDVecX,
			ConDVecY = ConDVecY,
			ConDVecZ = ConDVecZ,
			ConWVecX = ConWVecX,
			ConWVecY = ConWVecY,
			ConWVecZ = ConWVecZ,

			ConNominalWidth = ConNominalWidth_17,
			ConNominalDepth = ConNominalDepth_17,
			ConWidth = ConWidth_17,
			ConDepth = ConDepth_17,
			ConLength = ConLength_17,
			ConWallThickness = ConWallThickness_17,
			ConConnectorWidth = ConConnectorWidth_17,
			ConConnectorDepth = ConConnectorDepth_17,
			ConConnectorWidth2 = ConConnectorWidth2_17,
			ConToolType = ConToolType_17,
			ConStatus = ConStatus_17,
			ConType_17 = ConType_17,
			ConConnectorType_17 = ConConnectorType_17,
			ConSystem_17 = ConSystem_17,
			shape_typ_to_validation = shape_typ_to_validation,
			MEP_enabled_geometry_mod = 1

		parameters MEP_ConInfo[ConID][1] = STR(ConToolType_17, 1, 0)
		parameters MEP_ConInfo[ConID][2] = ConName
		parameters MEP_ConInfo[ConID][3] = "0"

		! --- 18th CONNECTION --- !

		ConID = 18
		ConName = `Соединение Дымохода 9 (Канал 2)`

		if abs(smokeAngle_18) < eps then
			ConDVecX = 0
			ConDVecY = -1
			ConDVecZ = 0

			ConWVecX = 1
			ConWVecY = 0
			ConWVecZ = 0

			parameters ConPosX_18 = A/2 - flueRadius2 - diff
			parameters ConPosY_18 = -B/2
		endif
		if abs(smokeAngle_18 - 90) < eps then
			ConDVecX = 1
			ConDVecY = 0
			ConDVecZ = 0

			ConWVecX = 0
			ConWVecY = -1
			ConWVecZ = 0

			parameters ConPosX_18 = A/2
			parameters ConPosY_18 = 0
		endif
		if abs(smokeAngle_18 - 180) < eps then
			ConDVecX = 0
			ConDVecY = 1
			ConDVecZ = 0

			ConWVecX = 1
			ConWVecY = 0
			ConWVecZ = 0

			parameters ConPosX_18 = A/2 - flueRadius - diff
			parameters ConPosY_18 = B/2
		endif

		parameters ConWidth_18 = 2 * flueRadius
		parameters ConDepth_18 = ConWidth_18
		values "ConLength_18" RANGE [0, ]
		if nSmokeCon2 = 9 then
			values "ConPosZ_18" range [ConPosZ_17 + prefabUnitHeight, zSmokeConMax2] step ConPosZ_17 + prefabUnitHeight, prefabUnitHeight
		endif

		call "MEP_m_ConnectionsACL_4" parameters SetProgram = SetProgram,
			gs_Connections = gs_Connections,
			MEP_NumConnectionData = MEP_NumConnectionData,
			MEP_StrConnectionData = MEP_StrConnectionData,
			MEP_NumberConnections = MEP_NumberConnections,
			gs_AddConnections = gs_AddConnections,
			ConName = ConName,
			ConID = ConID,
			ConPosX = ConPosX_18,
			ConPosY = ConPosY_18,
			ConPosZ = ConPosZ_18,
			ConDVecX = ConDVecX,
			ConDVecY = ConDVecY,
			ConDVecZ = ConDVecZ,
			ConWVecX = ConWVecX,
			ConWVecY = ConWVecY,
			ConWVecZ = ConWVecZ,

			ConNominalWidth = ConNominalWidth_18,
			ConNominalDepth = ConNominalDepth_18,
			ConWidth = ConWidth_18,
			ConDepth = ConDepth_18,
			ConLength = ConLength_18,
			ConWallThickness = ConWallThickness_18,
			ConConnectorWidth = ConConnectorWidth_18,
			ConConnectorDepth = ConConnectorDepth_18,
			ConConnectorWidth2 = ConConnectorWidth2_18,
			ConToolType = ConToolType_18,
			ConStatus = ConStatus_18,
			ConType_18 = ConType_18,
			ConConnectorType_18 = ConConnectorType_18,
			ConSystem_18 = ConSystem_18,
			shape_typ_to_validation = shape_typ_to_validation,
			MEP_enabled_geometry_mod = 1

		parameters MEP_ConInfo[ConID][1] = STR(ConToolType_18, 1, 0)
		parameters MEP_ConInfo[ConID][2] = ConName
		parameters MEP_ConInfo[ConID][3] = "0"
	else
		! --- 10th CONNECTION --- !

		ConID = 10
		ConName = `Соединение Дымохода 10`

		if abs(smokeAngle_10) < eps then
			ConDVecX = 0
			ConDVecY = -1
			ConDVecZ = 0

			ConWVecX = 1
			ConWVecY = 0
			ConWVecZ = 0

			parameters ConPosX_10 = -A/2 + flueRadius + diff
			parameters ConPosY_10 = -B/2
		endif
		if abs(smokeAngle_10 - 90) < eps then
			ConDVecX = 1
			ConDVecY = 0
			ConDVecZ = 0

			ConWVecX = 0
			ConWVecY = -1
			ConWVecZ = 0

			parameters ConPosX_10 = A/2
			parameters ConPosY_10 = 0
		endif
		if abs(smokeAngle_10 - 180) < eps then
			ConDVecX = 0
			ConDVecY = 1
			ConDVecZ = 0

			ConWVecX = 1
			ConWVecY = 0
			ConWVecZ = 0

			parameters ConPosX_10 = -A/2 + flueRadius + diff
			parameters ConPosY_10 = B/2
		endif
		if abs(smokeAngle_10 - 270) < eps then
			ConDVecX = -1
			ConDVecY = 0
			ConDVecZ = 0

			ConWVecX = 0
			ConWVecY = -1
			ConWVecZ = 0

			parameters ConPosX_10 = -A/2
			parameters ConPosY_10 = 0
		endif

		parameters ConWidth_10 = 2 * flueRadius
		parameters ConDepth_10 = ConWidth_10
		values "ConLength_10" RANGE [0, ]
		if nSmokeCon = 10 then
			values "ConPosZ_10" range [ConPosZ_9 + prefabUnitHeight, zSmokeConMax1] step ConPosZ_9 + prefabUnitHeight, prefabUnitHeight
		endif

		call "MEP_m_ConnectionsACL_4" parameters SetProgram = SetProgram,
			gs_Connections = gs_Connections,
			MEP_NumConnectionData = MEP_NumConnectionData,
			MEP_StrConnectionData = MEP_StrConnectionData,
			MEP_NumberConnections = MEP_NumberConnections,
			gs_AddConnections = gs_AddConnections,
			ConName = ConName,
			ConID = ConID,
			ConPosX = ConPosX_10,
			ConPosY = ConPosY_10,
			ConPosZ = ConPosZ_10,
			ConDVecX = ConDVecX,
			ConDVecY = ConDVecY,
			ConDVecZ = ConDVecZ,
			ConWVecX = ConWVecX,
			ConWVecY = ConWVecY,
			ConWVecZ = ConWVecZ,

			ConNominalWidth = ConNominalWidth_10,
			ConNominalDepth = ConNominalDepth_10,
			ConWidth = ConWidth_10,
			ConDepth = ConDepth_10,
			ConLength = ConLength_10,
			ConWallThickness = ConWallThickness_10,
			ConConnectorWidth = ConConnectorWidth_10,
			ConConnectorDepth = ConConnectorDepth_10,
			ConConnectorWidth2 = ConConnectorWidth2_10,
			ConToolType = ConToolType_10,
			ConStatus = ConStatus_10,
			ConType_10 = ConType_10,
			ConConnectorType_10 = ConConnectorType_10,
			ConSystem_10 = ConSystem_10,
			shape_typ_to_validation = shape_typ_to_validation,
			MEP_enabled_geometry_mod = 1

		parameters MEP_ConInfo[ConID][1] = STR(ConToolType_10, 1, 0)
		parameters MEP_ConInfo[ConID][2] = ConName
		parameters MEP_ConInfo[ConID][3] = "0"
	endif

	ac_mep_connectionpage_active = 0
	parameters ac_mep_connectionpage_active = ac_mep_connectionpage_active

	if SetProgram then
		SetProgram = 0
		parameters SetProgram = SetProgram
	endif
else
	HIDEPARAMETER "gs_connection", "useSysMat"

	ac_mep_connectionpage_active = 0
	parameters ac_mep_connectionpage_active = ac_mep_connectionpage_active
endif

