
if gs_detlevel_3D_m=1 or (GLOB_CONTEXT>20 and GLOB_CONTEXT<40) then gs_resol=6	! Simple
if gs_detlevel_3D_m=0 then END													! Off

resol gs_resol
pen gs_cont_pen
material gs_gutter_ds_mat

if gs_shadow=0 then SHADOW OFF
if gs_shadow=1 then SHADOW ON

if gs_gutter_ds_profile_num = 1 then
	addy - (dis_wall - gs_gutter_dd)
else
	addy - (dis_wall - gs_gutter_bb)
endif

! -----------------------------------------------------------------------------
! 3D HOTSPOTS
! -----------------------------------------------------------------------------
unID=gs_unID

if gs_HtpsMacro=0 then									! Hotspots not used in  Downspout Complex
	! --- ZZYZX ---
	! --- Upper Part / Length ---
	addy -gs_gutter_os_off-gs_gutter_os_u_lgth*TAN(gs_gutter_os_u_ang)
		HOTSPOT 0,	0,	0,		unID,	ZZYZX,	1+128	:unID=unID+1
		HOTSPOT 0,	0,	-1,		unID,	ZZYZX,	3		:unID=unID+1
		HOTSPOT 0,	0,	ZZYZX,	unID,	ZZYZX,	2		:unID=unID+1
	del 1
	! --- Lower Part / Length ---
	addy -gs_gutter_os_l_lgth*TAN(gs_gutter_os_l_ang)
		HOTSPOT 0,	0,	0,		unID,	ZZYZX,	1+256	:unID=unID+1
		HOTSPOT 0,	0,	-1,		unID,	ZZYZX,	3		:unID=unID+1
		HOTSPOT 0,	0,	ZZYZX,	unID,	ZZYZX,	2+128	:unID=unID+1
	del 1
endif

! --- Upper Part Vertical Length ---
add 0, -gs_gutter_os_off, ZZYZX
	HOTSPOT 0,	0,	0,						unID,	gs_gutter_os_u_lgth,	1+128	:unID=unID+1
	HOTSPOT 0,	0,	gs_gutter_os_u_lgth,	unID,	gs_gutter_os_u_lgth,	3		:unID=unID+1
	HOTSPOT 0,	0,	-gs_gutter_os_u_lgth,	unID,	gs_gutter_os_u_lgth,	2		:unID=unID+1
del 1

! --- Lower Part Vertical Length ---
	HOTSPOT 0,	0,	0,						unID,	gs_gutter_os_l_lgth,	1+128	:unID=unID+1
	HOTSPOT 0,	0,	-1,						unID,	gs_gutter_os_l_lgth,	3		:unID=unID+1
	HOTSPOT 0,	0,	gs_gutter_os_l_lgth,	unID,	gs_gutter_os_l_lgth,	2		:unID=unID+1

! --- Middle Part / Horizontal Offset ---
addz gs_gutter_os_l_lgth+gs_gutter_os_m_lgth
	HOTSPOT 0,	0,					0,	unID,	gs_gutter_os_off,	1+128	:unID=unID+1
	HOTSPOT 0,	1,					0,	unID,	gs_gutter_os_off,	3		:unID=unID+1
	HOTSPOT 0,	-gs_gutter_os_off,	0,	unID,	gs_gutter_os_off,	2		:unID=unID+1
del 1

add	 0,-gs_gutter_os_off,(gs_gutter_os_m_lgth+gs_gutter_os_l_lgth)		! Position of Origo

! -----------------------------------------------------------------------------
! 3D MOdelL
! -----------------------------------------------------------------------------
call "m_DSProfiles" PARAMETERS gs_gutter_ds_profile_num=gs_gutter_ds_profile_num, gs_gutter_aa=gs_gutter_aa, gs_gutter_bb=gs_gutter_bb, gs_gutter_dd=gs_gutter_dd, gs_mask=1

rotz 180

tube nsp/3,6,4+8+16+32,
	get(nsp),
	0,	 gs_gutter_os_u_lgth * TAN(gs_gutter_os_u_ang) - gs_gutter_os_u_lgth * TAN(gs_gutter_os_u_ang-2*gs_gutter_u_end_ang),	2*gs_gutter_os_u_lgth,	0,
	0,	 gs_gutter_os_u_lgth * TAN(gs_gutter_os_u_ang),	gs_gutter_os_u_lgth,	0,
	0,	 0,		0,		0,
	0,	-gs_gutter_os_off,	-gs_gutter_os_m_lgth,	0,
	0,	-gs_gutter_os_off+gs_gutter_os_l_lgth * TAN(gs_gutter_os_l_ang),	-gs_gutter_os_m_lgth - gs_gutter_os_l_lgth,	0,
	0,	-gs_gutter_os_off+(gs_gutter_os_l_lgth * TAN(gs_gutter_os_l_ang)) - gs_gutter_os_l_lgth * TAN(gs_gutter_os_l_ang-2*gs_gutter_l_end_ang),	-gs_gutter_os_m_lgth-2*gs_gutter_os_l_lgth,	0

! -----------------------------------------------------------------------------
! 3D HOTSPOTS
! -----------------------------------------------------------------------------
if gs_HtpsMacro=0 then 										! Hotspots not used in  Downspout Complex
	! --- Upper Part / Angle ---
	HOTSPOT  0,	0,												0,												unID,	gs_gutter_os_u_ang,	6	: unID=unID+1
	HOTSPOT  0,	0,												gs_gutter_os_u_lgth/2,							unID,	gs_gutter_os_u_ang,	4+128	: unID=unID+1
	HOTSPOT  0,	gs_gutter_os_u_lgth/2*SIN(gs_gutter_os_u_ang),	gs_gutter_os_u_lgth/2*COS(gs_gutter_os_u_ang),	unID,	gs_gutter_os_u_ang,	5	: unID=unID+1
	HOTSPOT  -1, 0,												0,												unID, 	gs_gutter_os_u_ang,	7	: unID=unID+1

	! --- Lower Part / Angle ---
	add 0, -gs_gutter_os_off, -gs_gutter_os_off / TAN(gs_gutter_os_ang)
		HOTSPOT  0,	0,												 0,												unID,	gs_gutter_os_l_ang,	6	:unID=unID+1
		HOTSPOT  0,	0,												-gs_gutter_os_l_lgth/2,							unID,	gs_gutter_os_l_ang,	4+128	:unID=unID+1
		HOTSPOT  0,-gs_gutter_os_l_lgth/2*SIN(-gs_gutter_os_l_ang),	-gs_gutter_os_l_lgth/2*COS(gs_gutter_os_l_ang),	unID,	gs_gutter_os_l_ang,	5	:unID=unID+1
		HOTSPOT  1,	0,												 0,												unID,	gs_gutter_os_l_ang,	7	:unID=unID+1
	del 1
endif

! -----------------------------------------------------------------------------
! Upper and LowerPart / END Angle
! -----------------------------------------------------------------------------
		! --- Calculation for End Angle hotspots ---
		if gs_gutter_ds_profile_num=1 then						! Round Profile
			atvitu = gs_gutter_dd / COS(gs_gutter_os_u_ang-gs_gutter_u_end_ang)
		else
			atvitu = gs_gutter_bb / COS(gs_gutter_os_u_ang-gs_gutter_u_end_ang)
		endif
		zeltu = atvitu * SIN(up_end_ang_temp)
		yeltu = atvitu * COS(up_end_ang_temp)

		! --- Lower End ---
		if gs_gutter_ds_profile_num=1 then						! Round Profile
			atvitl = gs_gutter_dd / COS(gs_gutter_os_l_ang-gs_gutter_l_end_ang)
		else
			atvitl = gs_gutter_bb / COS(gs_gutter_os_l_ang-gs_gutter_l_end_ang)
		endif
		zeltl = atvitl * SIN(low_end_ang_temp)
		yeltl = atvitl * COS(low_end_ang_temp)

		if gs_gutter_ds_profile_num=1 then						! HOTSPOTs ROUND Profile
			if GLOB_CONTEXT <> 4 then
				XX= 0			 : YY= yeltu 		: gosub "htsp_upper_end_ang"
				XX= 0			 : YY=-yeltu 		: gosub "htsp_upper_end_ang2"
				XX= gs_gutter_dd : YY= 0	 : HOTSPOT XX, gs_gutter_os_u_lgth * TAN(gs_gutter_os_u_ang), gs_gutter_os_u_lgth	:unID=unID+1
				XX=-gs_gutter_dd : YY= 0	 : HOTSPOT XX, gs_gutter_os_u_lgth * TAN(gs_gutter_os_u_ang), gs_gutter_os_u_lgth	:unID=unID+1
				XX=-gs_gutter_dd : YY= -dis_wall 	: gosub "htsp_dis_wall"
			endif

			if gs_HtpsMacro=0 then								! Hotspots not used in  Downspout Complex
				add 0, -gs_gutter_os_off, -gs_gutter_os_off / TAN(gs_gutter_os_ang)
					XX= 0			 : YY= yeltl	 : GOSUB "htsp_lower_end_ang"
					XX= 0			 : YY=-yeltl	 : GOSUB "htsp_lower_end_ang2"
					XX= gs_gutter_dd : YY= 0		 : HOTSPOT XX, gs_gutter_os_l_lgth * TAN(gs_gutter_os_l_ang), - gs_gutter_os_l_lgth	:unID=unID+1
					XX=-gs_gutter_dd : YY= 0		 : HOTSPOT XX, gs_gutter_os_l_lgth * TAN(gs_gutter_os_l_ang), - gs_gutter_os_l_lgth	:unID=unID+1
				del 1
			endif
		else													! HOTSPOTs NOT_ROUND profile

			XX= gs_gutter_aa : YY= yeltu		: gosub "htsp_upper_end_ang"
			XX= gs_gutter_aa : YY=-yeltu		: gosub "htsp_upper_end_ang2"
			XX=-gs_gutter_aa : YY= yeltu		: gosub "htsp_upper_end_ang"
			XX=-gs_gutter_aa : YY=-yeltu		: gosub "htsp_upper_end_ang2"
			XX=-gs_gutter_aa : YY= -dis_wall 	: gosub "htsp_dis_wall"

			if gs_HtpsMacro=0 then 								! (Hotspots not used in  Downspout Complex
				add 0, -gs_gutter_os_off, -gs_gutter_os_off / TAN(gs_gutter_os_ang)
					XX= gs_gutter_aa : YY= yeltl: GOSUB "htsp_lower_end_ang"
					XX= gs_gutter_aa : YY=-yeltl: GOSUB "htsp_lower_end_ang2"
					XX=-gs_gutter_aa : YY= yeltl: GOSUB "htsp_lower_end_ang"
					XX=-gs_gutter_aa : YY=-yeltl: GOSUB "htsp_lower_end_ang2"
				del 1
			endif
		endif

del 1
del 1	
end
! =============================================================================
!END	!END	!END	!END	!END	!END	!END	!END	!END	!END
! =============================================================================

! -----------------------------------------------------------------------------
"htsp_upper_end_ang":						! 3D Hotspots for Upper End Angle
! -----------------------------------------------------------------------------
Uppmxang = (90-gs_gutter_os_u_ang)/2
	add XX,gs_gutter_os_u_lgth * TAN(gs_gutter_os_u_ang), gs_gutter_os_u_lgth
	rotX (Uppmxang)

	HOTSPOT 0,	atvitu,		0,		UnID,	up_end_ang_temp,	4+128,	gs_gutter_u_end_ang	:unID=unID+1
	HOTSPOT -1,	0,			0,		UnID,	up_end_ang_temp,	7,		gs_gutter_u_end_ang	:unID=unID+1
	HOTSPOT 0,	0,			0,		UnId,	up_end_ang_temp,	6,		gs_gutter_u_end_ang	:unID=unID+1
	HOTSPOT 0,	YY, 		-zeltu,	UnID,	up_end_ang_temp, 	5,		gs_gutter_u_end_ang	:unID=unID+1

	del 2
return


! -----------------------------------------------------------------------------
"htsp_upper_end_ang2":						! 3D Hotspots for Upper End Angle2
! -----------------------------------------------------------------------------
Uppmxang = (90-gs_gutter_os_u_ang)/2
	add XX,gs_gutter_os_u_lgth * TAN(gs_gutter_os_u_ang), gs_gutter_os_u_lgth
	rotX (Uppmxang)

	HOTSPOT 0,	-atvitu,	0,		UnID,	up_end_ang_temp,	4+128,	gs_gutter_u_end_ang	:unID=unID+1
	HOTSPOT -1,	0,			0,		UnID,	up_end_ang_temp,	7,		gs_gutter_u_end_ang	:unID=unID+1
	HOTSPOT 0,	0,			0,		UnId,	up_end_ang_temp,	6,		gs_gutter_u_end_ang	:unID=unID+1
	HOTSPOT 0,	YY, 		zeltu,	UnID,	up_end_ang_temp, 	5,		gs_gutter_u_end_ang	:unID=unID+1

	del 2
return


! -----------------------------------------------------------------------------
"htsp_lower_end_ang":						! 3D Hotspots for Lower End Angle
! -----------------------------------------------------------------------------
Lowmxang = (90-gs_gutter_os_l_ang)/2
	add XX, gs_gutter_os_l_lgth * TAN(gs_gutter_os_l_ang), -gs_gutter_os_l_lgth
	rotX (-Lowmxang)

	HOTSPOT 0,	atvitl,		0,		UnID,	low_end_ang_temp,	4+128,	gs_gutter_l_end_ang	:unID=unID+1
	HOTSPOT 1,	0,			0,		UnID,	low_end_ang_temp,	7,		gs_gutter_l_end_ang	:unID=unID+1
	HOTSPOT 0,	0,			0,		UnId,	low_end_ang_temp,	6,		gs_gutter_l_end_ang	:unID=unID+1
	HOTSPOT 0,	YY, 		zeltl,	UnID,	low_end_ang_temp, 	5,		gs_gutter_l_end_ang	:unID=unID+1

	del 2
return


! -----------------------------------------------------------------------------
"htsp_lower_end_ang2":						! 3D Hotspots for Lower End Angle2
! -----------------------------------------------------------------------------
Lowmxang = (90-gs_gutter_os_l_ang)/2
	add XX, gs_gutter_os_l_lgth * TAN(gs_gutter_os_l_ang), -gs_gutter_os_l_lgth
	rotX (-Lowmxang)

	HOTSPOT 0,	-atvitl,	0,		UnID,	low_end_ang_temp,	4+128,	gs_gutter_l_end_ang	:unID=unID+1
	HOTSPOT 1,	0,			0,		UnID,	low_end_ang_temp,	7,		gs_gutter_l_end_ang	:unID=unID+1
	HOTSPOT 0,	0,			0,		UnId,	low_end_ang_temp,	6,		gs_gutter_l_end_ang	:unID=unID+1
	HOTSPOT 0,	YY, 		-zeltl,	UnID,	low_end_ang_temp, 	5,		gs_gutter_l_end_ang	:unID=unID+1

	del 2
return

! -----------------------------------------------------------------------------
"htsp_dis_wall":			!3D Hotsports for Dis. Between Downspout Axes and Wall
! -----------------------------------------------------------------------------
	addy - (gs_gutter_os_off)
	!new editable hotspots, using fix unID because of migration
	hotspot XX, YY, 		- (gs_gutter_os_m_lgth + gs_gutter_os_l_lgth), 40001, dis_wall, 1+128
	hotspot XX, 0, 			- (gs_gutter_os_m_lgth + gs_gutter_os_l_lgth), 40002, dis_wall, 2
	hotspot XX, YY-1, 		- (gs_gutter_os_m_lgth + gs_gutter_os_l_lgth), 40003, dis_wall, 3

	hotspot -XX, YY, 		- (gs_gutter_os_m_lgth + gs_gutter_os_l_lgth), 40004, dis_wall, 1+128
	hotspot -XX, 0, 		- (gs_gutter_os_m_lgth + gs_gutter_os_l_lgth), 40005, dis_wall, 2
	hotspot -XX, YY-1, 		- (gs_gutter_os_m_lgth + gs_gutter_os_l_lgth), 40006, dis_wall, 3
	del 1
return

