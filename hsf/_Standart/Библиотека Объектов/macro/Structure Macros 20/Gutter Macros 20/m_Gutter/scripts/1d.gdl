
EPS=0.0001		!!precision of zero!!
st=0.001		!!slab thickness!!
sth=0.002		!!hanger thickness!!
sthw=0.03		!!hanger width!!
sthh=0.2		!!hanger long!!

! --- Hanger ---
dim stHangerProfileValues[6]
	stHangerProfileValues[1] = `Хомут 1`
	stHangerProfileValues[2] = `Хомут 2`
	stHangerProfileValues[3] = `Гвоздь и Муфта`
	stHangerProfileValues[4] = `Планка 1`
	stHangerProfileValues[5] = `Планка 2`
	stHangerProfileValues[6] = `Планка 3`

!------------  Downspout Profile Type ------------------------------------------
PROFILE_ROUND			= 1
PROFILE_RECTANGULAR 	= 2
PROFILE_CORRUGATED		= 3

!------------  Hanger Positioning Type -----------------------------------------
HANGER_CUSTOM			= 1
HANGER_UNIFORM			= 2

dim	stHangerPositioning[2]
	stHangerPositioning[1] = `Специальный`
	stHangerPositioning[2] = `Одинаковое`


!!!*** Gutter Profile *****************************************************************

IF gs_gutter_p_num = 1 THEN
	PARAMETERS gs_gutter_p_w = 2*gs_gutter_p_r
	PARAMETERS gs_gutter_p_h = 2*gs_gutter_p_r
ENDIF


!!!************************************************************************************
!!!*** Gutter and Roof Slope **********************************************************

IF gs_slope_mode_m = 1 THEN 	!!(°)
	SLOPE_ANG = gs_gutter_slope_in_degree
	SLOPE_PERC = TAN ( SLOPE_ANG) * 100
	SLOPE = gs_gutter_lgth * TAN (SLOPE_ANG)

	PITCH_ANG = gs_gutter_roof_angle
	PITCH_PERC = TAN ( PITCH_ANG) * 100
ENDIF

IF gs_slope_mode_m = 2 THEN 	!!(%)
	SLOPE_PERC = gs_gutter_slope_in_percent
	SLOPE_ANG = ATN ( gs_gutter_slope_in_percent / 100)
	SLOPE = gs_gutter_lgth * TAN (SLOPE_ANG)

	PITCH_PERC = gs_gutter_roof_pitch_in_perc
	PITCH_ANG = ATN ( gs_gutter_roof_pitch_in_perc / 100)
ENDIF

IF gs_slope_mode = `на 12'` THEN
   SLOPE = ( gs_gutter_lgth / gs_12_foot) * gs_gutter_slope_in_12_f
   SLOPE_ANG = ATN( SLOPE / gs_gutter_lgth)
   SLOPE_PERC = ( SLOPE / gs_gutter_lgth) * 100
   SLOPE_12_INCH = SLOPE / ( gs_gutter_lgth / gs_12_inch)

   PSLOPE = ( sthh / gs_12_foot) * gs_gutter_roof_pitch_in_12_f
   PITCH_ANG = ATN( PSLOPE / sthh)
   PITCH_PERC = TAN ( PITCH_ANG) * 100
   PITCH_12_INCH =  PSLOPE / ( sthh / gs_12_inch)
ENDIF

IF gs_slope_mode = `на 12"` THEN
   SLOPE = ( gs_gutter_lgth / gs_12_inch) * gs_gutter_slope_in_12_inch
   SLOPE_ANG = ATN( SLOPE / gs_gutter_lgth)
   SLOPE_PERC = ( SLOPE / gs_gutter_lgth) * 100
   SLOPE_12_FOOT = SLOPE / ( gs_gutter_lgth / gs_12_foot)

   PSLOPE = ( sthh / gs_12_inch) * gs_gutter_roof_pitch_in_12_inc
   PITCH_ANG = ATN( PSLOPE / sthh)
   PITCH_PERC = TAN ( PITCH_ANG) * 100
   PITCH_12_COL =  PSLOPE / ( sthh / gs_12_foot)
ENDIF

gs_gutter_roof_angle = PITCH_ANG
gs_gutter_slope = SLOPE

! -----------------------------------------------------------------------------
! USA profiles
! -----------------------------------------------------------------------------
! Gutter profiles
! -----------------------------------------------------------------------------
IF gs_gutter_profile =`Полукруглый - 2.5"` THEN PARAMETERS gs_gutter_p_r = 2.5 * 0.0254
IF gs_gutter_profile =`Полукруглый - 3"` THEN PARAMETERS gs_gutter_p_r = 3 * 0.0254

IF gs_gutter_profile =`K-образный - 5"*3.5"` OR gs_gutter_profile =`U-образный - 5"*3.5"` THEN
	PARAMETERS gs_gutter_p_w = 5 * 0.0254, gs_gutter_p_h = 3.5 * 0.0254
Endif
IF gs_gutter_profile =`K-образный - 6"*4"` OR gs_gutter_profile =`U-образный - 6"*4"`	THEN
	PARAMETERS gs_gutter_p_w = 6 * 0.0254, gs_gutter_p_h = 4 * 0.0254
Endif

IF gs_gutter_profile =`Полукруглый - 2.5"` OR gs_gutter_profile =`Специальный - Полукруглый` 	OR gs_gutter_profile =`Полукруглый - 3"` THEN PARAMETERS gs_gutter_p_num=1
IF gs_gutter_profile =`K-образный - 5"*3.5"` OR gs_gutter_profile =`Специальный - K-образный` 		OR gs_gutter_profile =`K-образный - 6"*4"`	THEN PARAMETERS gs_gutter_p_num=2
IF gs_gutter_profile =`U-образный - 5"*3.5"` OR gs_gutter_profile =`Специальный - U-образный` 		OR gs_gutter_profile =`U-образный - 6"*4"` THEN PARAMETERS gs_gutter_p_num=3

IF gs_gutter_p_num = 1 THEN
	PARAMETERS gs_gutter_p_w = 2*gs_gutter_p_r
	PARAMETERS gs_gutter_p_h = 2*gs_gutter_p_r
ENDIF

! Downspout profiles
! -----------------------------------------------------------------------------
IF gs_gutter_ds_profile=`Круглый 3"` OR gs_gutter_ds_profile=`Круглый 4"` OR gs_gutter_ds_profile=`Специальный - Круглый` THEN
	PARAMETERS gs_gutter_ds_profile_num=1
ENDIF

IF gs_gutter_ds_profile=`Прямоугольный 2"*3"` OR gs_gutter_ds_profile=`Прямоугольный 3"*2"` OR gs_gutter_ds_profile=`Прямоугольный 3"*4"` OR gs_gutter_ds_profile=`Прямоугольный 4"*3"` OR gs_gutter_ds_profile=`Специальный - Прямоугольный` THEN
	PARAMETERS gs_gutter_ds_profile_num=2
ENDIF

IF gs_gutter_ds_profile=`Закругленный 2"*3"` OR gs_gutter_ds_profile=`Закругленный 3"*2"` OR gs_gutter_ds_profile=`Закругленный 3"*4"` OR gs_gutter_ds_profile=`Закругленный 4"*3"` OR gs_gutter_ds_profile=`Специальный - Закругленный` THEN
	PARAMETERS gs_gutter_ds_profile_num=3
ENDIF

IF gs_gutter_ds_profile=`Круглый 3"` THEN
	PARAMETERS gs_gutter_dd=3*0.5*0.0254
				gs_gutter_dd=3*0.5*0.0254
	PARAMETERS gs_gutter_dd2=gs_gutter_dd*2
				gs_gutter_dd2=gs_gutter_dd*2
	LOCK "gs_gutter_dd2"
ENDIF
IF gs_gutter_ds_profile=`Круглый 4"` THEN
	PARAMETERS gs_gutter_dd=4*0.5*0.0254
				gs_gutter_dd=4*0.5*0.0254
	PARAMETERS gs_gutter_dd2=gs_gutter_dd*2
				gs_gutter_dd2=gs_gutter_dd*2
	LOCK "gs_gutter_dd2"
ENDIF

IF gs_gutter_ds_profile=`Прямоугольный 2"*3"` OR gs_gutter_ds_profile=`Закругленный 2"*3"` THEN
	PARAMETERS gs_gutter_aa=0.0254
				gs_gutter_aa=0.0254
	PARAMETERS gs_gutter_aa2=gs_gutter_aa*2
				gs_gutter_aa2=gs_gutter_aa*2
	PARAMETERS gs_gutter_bb=0.0381
				gs_gutter_bb=0.0381
	PARAMETERS gs_gutter_bb2=gs_gutter_bb*2
				gs_gutter_bb2=gs_gutter_bb*2
	LOCK "gs_gutter_aa2"
	LOCK "gs_gutter_bb2"
ENDIF

IF gs_gutter_ds_profile=`Прямоугольный 3"*2"` OR gs_gutter_ds_profile=`Закругленный 3"*2"` THEN
	PARAMETERS gs_gutter_aa=0.0381
				gs_gutter_aa=0.0381
	PARAMETERS gs_gutter_aa2=gs_gutter_aa*2
				gs_gutter_aa2=gs_gutter_aa*2
	PARAMETERS gs_gutter_bb=0.0254
				gs_gutter_bb=0.0254
	PARAMETERS gs_gutter_bb2=gs_gutter_bb*2
				gs_gutter_bb2=gs_gutter_bb*2
	LOCK "gs_gutter_aa2"
	LOCK "gs_gutter_bb2"
ENDIF

IF gs_gutter_ds_profile=`Прямоугольный 3"*4"` OR gs_gutter_ds_profile=`Закругленный 3"*4"` THEN
	PARAMETERS gs_gutter_aa=0.0381
				gs_gutter_aa=0.0381
	PARAMETERS gs_gutter_aa2=gs_gutter_aa*2
				gs_gutter_aa2=gs_gutter_aa*2
	PARAMETERS gs_gutter_bb=0.0508
				gs_gutter_bb=0.0508
	PARAMETERS gs_gutter_bb2=gs_gutter_bb*2
				gs_gutter_bb2=gs_gutter_bb*2
	LOCK "gs_gutter_aa2"
	LOCK "gs_gutter_bb2"
ENDIF

IF gs_gutter_ds_profile=`Прямоугольный 4"*3"` OR gs_gutter_ds_profile=`Закругленный 4"*3"` THEN
	PARAMETERS gs_gutter_aa=0.0508
				gs_gutter_aa=0.0508
	PARAMETERS gs_gutter_aa2=gs_gutter_aa*2
				gs_gutter_aa2=gs_gutter_aa*2
	PARAMETERS gs_gutter_bb=0.0381
				gs_gutter_bb=0.0381
	PARAMETERS gs_gutter_bb2=gs_gutter_bb*2
				gs_gutter_bb2=gs_gutter_bb*2
	LOCK "gs_gutter_aa2"
	LOCK "gs_gutter_bb2"
ENDIF

!!!*** Hanger positions ***
if gs_gutter_reset_pos then
	FOR i=1 TO INT((gs_gutter_lgth - gs_gutter_hanger_off - sthw)/gs_gutter_hanger_dist)+1
		PARAMETERS gs_gutter_hanger_pos[i]=(i-1)*gs_gutter_hanger_dist+gs_gutter_hanger_off
	NEXT i
	PARAMETERS gs_gutter_reset_pos = 0
endif

IF gs_gutter_ds_h_positioning = HANGER_UNIFORM THEN
	IF GLOB_MODPAR_NAME = "gs_gutter_lgth" OR GLOB_MODPAR_NAME = "gs_gutter_lgth2" OR GLOB_MODPAR_NAME = "gs_gutter_hanger_off" OR GLOB_MODPAR_NAME = "gs_gutter_ds_h_positioning" THEN					!!Change GUTTER_LENGTH OR Change HANGER_OFFSET!!
		FOR i=1 TO INT((gs_gutter_lgth - gs_gutter_hanger_off - sthw)/gs_gutter_hanger_dist)+1
			IF not(gs_gutter_hanger_pos_mod[i]) THEN
				PARAMETERS gs_gutter_hanger_pos[i]=(i-1)*gs_gutter_hanger_dist+gs_gutter_hanger_off
			ENDIF
		NEXT i
	ENDIF
	
	IF GLOB_MODPAR_NAME = "gs_gutter_hanger_dist" THEN																!!Change DISTANCE between HANGERs!!
		FOR i=1 TO INT((gs_gutter_lgth - gs_gutter_hanger_off - sthw)/gs_gutter_hanger_dist)+1
			IF not(gs_gutter_hanger_pos_mod[i]) THEN
				PARAMETERS gs_gutter_hanger_pos[i]=(i-1)*gs_gutter_hanger_dist+gs_gutter_hanger_off
				PARAMETERS gs_gutter_hanger_pos_mod[i] = 0
			ENDIF
		NEXT i
		FOR i=INT((gs_gutter_lgth - gs_gutter_hanger_off - sthw)/gs_gutter_hanger_dist)+2 TO 99
			IF not(gs_gutter_hanger_pos_mod[i]) THEN
				PARAMETERS gs_gutter_hanger_pos[i]=0
				PARAMETERS gs_gutter_hanger_pos_mod[i] = 0
			ENDIF
		NEXT i
	
	ENDIF
	
ELSE

	hangeri = 1
	j = 0
	WHILE j <= gs_gutter_lgth AND hangeri < 99 AND gs_gutter_hanger_pos[hangeri] > EPS DO
		j = gs_gutter_hanger_pos[hangeri]
		hangeri = hangeri + 1
	ENDWHILE

	hangeri = hangeri-1

	if GLOB_MODPAR_NAME = "gs_gutter_hanger_pos_helper" THEN
		lenght = 0
		FOR i=1 to hangeri
			lenght = lenght + gs_gutter_hanger_pos_helper[i]
			PARAMETERS gs_gutter_hanger_pos[i] = lenght
		NEXT i
		FOR i=hangeri+1 to vardim1(gs_gutter_hanger_pos)
			PARAMETERS gs_gutter_hanger_pos[i] = 0
		NEXT i
	ENDIF

	if GLOB_MODPAR_NAME = "gs_gutter_hanger_pos" THEN
			PARAMETERS gs_gutter_hanger_pos_helper[1] = gs_gutter_hanger_pos[1]
		FOR i = 2 to hangeri
			PARAMETERS gs_gutter_hanger_pos_helper[i] = (gs_gutter_hanger_pos[i] - gs_gutter_hanger_pos[i-1])
		NEXT i
	ENDIF
	
	j = 0
	FOR i = 1 to vardim1(gs_gutter_hanger_pos)
		j = gs_gutter_hanger_pos[i]
		IF j >= gs_gutter_lgth OR gs_gutter_hanger_pos[i] < 0 THEN 
			PARAMETERS gs_gutter_hanger_pos[i] = 0
		ENDIF
	NEXT i

ENDIF

