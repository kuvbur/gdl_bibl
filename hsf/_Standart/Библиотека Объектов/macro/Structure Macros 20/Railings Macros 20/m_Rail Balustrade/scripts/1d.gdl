
!!Rail Balustrade

EPS=0.0001

!!PARAMETER INPUT CALCULATION!!

if gs_frameStyle_m = 2 then
	fth = gs_frameDiameter
	ftw = gs_frameDiameter
	fbw = gs_frameDiameter
	fsw = gs_frameDiameter
	bth = gs_balusterDiameter
	bw  = gs_balusterDiameter
endif

!!BALUSTER SPACING CALCULATION!!

IF ABS(lra)>EPS THEN
	IF rom_m=2 AND rmm_m=2 THEN
		!Number of balusters
		bn=int((lrah-2*fsw+bw)/(abdist+bw))
		!Calculated distance between balusters
		bdist=(lrah-2*fsw-bn*bw)/(bn+1)
	ELSE
		!Number of balusters
		bn=max(0, int((lra-2*fsw+bw)/(abdist+bw)))
		!Calculated distance between balusters
		bdist=(lra-2*fsw-bn*bw)/(bn+1)
	ENDIF
ENDIF


!!ADDITIONAL ANGLE CALCULATION FOR CURVED RAILS!!
IF ptyp_m<>1 THEN		!!ptyp=Straight
	IF rb<360 THEN
		alphafsw=(fsw*180)/(rb*pi)
		if bn > 0 then
			alphabdist = (ab - 2 * alphafsw) / bn
		else
			alphabdist = (ab - 2 * alphafsw) / (bn + 1)
		endif
	else
		!Number of balusters
		bn=int((lra+bw)/(abdist+bw))
		!Calculated distance between balusters
		bdist=(lra-bn*bw)/(bn+1)
	ENDIF

!!For curved and inclined rail
alphafsw=(fsw*180)/(rb*pi)
!alphabdist=(ab-2*alphafsw)/bn
if bn > 0 then
	alphabdist = (ab - 2 * alphafsw) / bn
else
	alphabdist = (ab - 2 * alphafsw) / (bn + 1)
endif

nalphaincl=int(ab/(360/res))+1 !number of segment points
alphaincl=ab/nalphaincl  !angle between segment points
deltaz=lra*sin(ani)
deltazincl=deltaz/nalphaincl !vertical step between segment points

m=int(alphafsw/alphaincl)+1

ENDIF

