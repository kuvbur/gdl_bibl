
if gs_detlevel_3D_m = 0 then end

if GLOB_CONTEXT = 5 THEN
	gs_detlevel_3D_m = 1
	interior = 0
	gs_path_move = 0
endif

call "VehiclePathMacro" parameters all A = A,
		wheelBase				= wheelBase,
		wheelDiam				= wheelDiam,
		hsId					= 1000,
		gs_path_move			= gs_path_move,
		gs_path_show_3D			= gs_path_show_3D,
		gs_pathNodes_Num		= gs_pathNodes_Num,
		gs_pathNodes_Num_old	= gs_pathNodes_Num_old,
		gs_pathNodes_Pos		= gs_pathNodes_Pos,
		gs_pathNodes_Angle		= gs_pathNodes_Angle,
		gs_pathNodes_Speed		= gs_pathNodes_Speed,
		gs_path_fps				= gs_path_fps,
		gs_path_start_frame		= gs_path_start_frame,
		gs_path_pen				= gs_path_pen,
		gs_path_line_pen		= gs_path_line_pen,
	returned_parameters wheelAngle, wheelRot,
		posX,posY,posZ,
		dirAngle, riseAngle

add posX,posY,posZ
rotz dirAngle
roty riseAngle

if gs_path_move then
	wheel_angle = wheelAngle
endif

! =============================================================================
! Draw the Car
! =============================================================================

rotz 180
addx -wheelBase

IF gs_shadow=0 THEN SHADOW OFF

	define material	"builtInMatBlackTyre" 0,
		0.1,	0.1,	0.1,
		0.86,	0.81,	0.09,	0,	2.2,	0,
		0.990005,	0.990005,	1,
		0,	0,	0,	0

pen gs_cont_pen

roty -gs_rot_ver
rotx gs_rot_hor


add 1.2811425, 0, 0.783662
rotz 90
call "cp_car10Body" parameters 	body_mat = gs_carbody_mat

call "cp_car10Glass" parameters glass_mat = gs_glass_mat

for ii = -1 to 1 step 2
	mulx ii
	call "cp_car10BodyAccessory" parameters gs_detlevel_3D_m = gs_detlevel_3D_m,
											body_mat = gs_carbody_mat,
											frame_mat = gs_frame_mat,
											mirror_mat = gs_mirror_mat

	call "cp_car10Lights" parameters gs_detlevel_3D_m = gs_detlevel_3D_m,
									 frontlight_mat = gs_lamp_mat,
									 rearlight_mat = gs_blamp_mat,
									 lampin_mat = gs_lampin_mat,
									 frame_mat = gs_frame_mat,
									 lampframe_mat = gs_lampframe_mat
	del 1
next ii

if gs_detlevel_3D_m = 2 and interior then
	for ii = -1 to 1 step 2
		mulx ii
		call "cp_car10Interior" parameters	interior_mat = gs_int_mat1,
											mirror_mat = gs_mirror_mat,
											bWholeParts = (ii=1)

		del 1
	next ii

	gosub 10

	mulx 1-2*not(wheel)
	gosub 20
	del 1
endif
del 2

wheelRotAngle = -wheelRot
addy -0.796
rotz -90
gosub 30
del 2

wheelRotAngle = wheelRot
addy 0.796
rotz 90
gosub 30
del 2

wheelRotAngle = -wheelRot
add wheelBase, -0.796, 0
rotz -90+wheel_angle
gosub 30
del 2

wheelRotAngle = wheelRot
add wheelBase, 0.796, 0
rotz 90+wheel_angle
gosub 30
del 2

del 2


end

10:								 ! --- seats
	material gs_int_mat2
	rotz 90
	rotx 90

	for i = -1 to 1 step 2
		mulz i
		addz -0.40
		addz -0.125
		prism_ 14, 0.25,
			0.094826, 0.232224, 79,
			0.1022988826666, 0.2236949185808, 15,
			0.10925, 0.223335, 79,
			0.183057, 0.2184946315488, 15,
			0.183057, 0.24794, 79,
			0.182748, 0.26504, 79,
			0.182265, 0.272632, 79,
			0.171098, 0.362342, 79,
			0.1569977489068, 0.4501438774375, 15,
			0.126208, 0.454742, 79,
			0.09911612702619, 0.4492935979538, 79,
			0.073974, 0.360435, 79,
			0.07558204927353, 0.2865238188014, 79,
			0.094826, 0.232224, -1
		del 1

		addz -0.28
		prism_ 20, 0.56,
			-0.1118436000216, -0.185594, 79,
			-0.1054675486347, -0.3609448619412, 15,
			-0.146816, -0.344114, 79,
			-0.244652, -0.309459, 79,
			-0.34242, -0.287338, 79,
			-0.440189, -0.283387, 79,
			-0.54587, -0.30892, 79,
			-0.59165, -0.336699, 79,
			-0.584869, -0.376862, 79,
			-0.519406, -0.439383, 15,
			-0.3900640059475, -0.4505157269889, 79,
			-0.121743, -0.455551, 79,
			-0.01756130428296, -0.4577148516267, 15,
			0.190624, 0.09458, 79,
			0.1896472913109, 0.2180624308342, 15,
			0.10925, 0.223335, 79,
			0.088643, 0.224402, 79,
			-0.047934, -0.004092, 79,
			-0.111844, -0.185583, 79,
			-0.1118436000216, -0.185594, -1
		del 3
	next i

	addz -0.72
	prism_ 23, 1.44,
		0.900248, -0.294344, 79,
		0.8986902613791, -0.3610091382289, 15,
		0.461752, -0.308924, 79,
		0.420536, -0.336697, 79,
		0.427313, -0.443523, 15,
		0.428634, -0.443549, 79,
		0.449036, -0.445466, 79,
		0.5283929999999, -0.454586, 79,
		0.624139, -0.465647, 79,
		0.720897, -0.472094, 79,
		0.81864,     -0.47727, 79,
		0.913655, -0.482232, 15,
		0.985786, -0.190228, 79,
		1.12216,     -0.00875, 79,
		1.17398,     0.096477, 79,
		1.218657,     0.255389, 79,
		1.22081030384, 0.2690118853578, 15,
		1.124097,     0.269677, 79,
		1.115838256653, 0.2646046552911, 79,
		1.001732, 0, 79,
		0.919303, -0.184645, 79,
		0.900316, -0.294095, 79,
		0.900248, -0.294344, -1
	del 3
return

20:								 ! --- wheel
	resol 16
	material gs_int_mat1
	add  0.417158, -0.6283545, 0.1190635
	rotx 25.7836563975

	addx -0.18
	elbow 0.18, 360, 0.014
	del 1

	rotx 90
	addz -0.0112
	prism_ 33, 0.025,
		-0.01549, -0.1115205439488, 79,
		0.01549, -0.1115205439488, 79,
		0.04543654553072, -0.1059680154621, 15,
		0.0790337294469, -0.161720962184, 15,
		0.1070106313356, -0.1447367430239, 79,
		0.1314496734363, -0.122967407688, 15,
		0.09851837047372, -0.07864215006653, 15,
		0.1216939407373, -0.05463825607874, 79,
		0.1328330228301, -0.01921630165701, 15,
		0.1788290188308, -0.02049834198192, 15,
		0.1794878666742, 0.01356855617805, 79,
		0.1737151344844, 0.04714925292167, 15,
		0.1289881792548, 0.03651725325411, 15,
		0.121186, 0.05188415165118, 79,
		0.113083, 0.06325740492338, 79,
		0.090884, 0.07356083369002, 79,
		0.03826, 0.08248669822616, 79,
		-0.03826, 0.08248669822616, 79,
		-0.090884, 0.07356083369002, 79,
		-0.113083, 0.06325740492338, 79,
		-0.121186, 0.05188415165118, 79,
		-0.1289881792548, 0.03651725325411, 15,
		-0.1737151344844, 0.04714925292167, 15,
		-0.1794878666742, 0.01356855617805, 79,
		-0.1788290188308, -0.02049834198192, 15,
		-0.1328330228301, -0.01921630165701, 15,
		-0.1216939407373, -0.05463825607874, 79,
		-0.09851837047372, -0.07864215006653, 15,
		-0.1314496734363, -0.122967407688, 15,
		-0.1070106313356, -0.1447367430239, 79,
		-0.0790337294469, -0.161720962184, 15,
		-0.04543654553072, -0.1059680154621, 15,
		-0.01549, -0.1115205439488, -1

	addz 0.025
	prism_ 9, 0.30,
		-0.081255, -0.0688849185638, 79,
		0, -0.08353766471818, 79,
		0.081255, -0.0688849185638, 79,
		0.098539, 0, 79,
		0.081255, 0.06888535353806, 79,
		0, 0.08353719924956, 79,
		-0.081255, 0.06888535353806, 79,
		-0.098539, 0, 79,
		-0.081255, -0.0688849185638, -1
	del 5
return

30:								 ! --- tire
	add -0.05, 0, 0.32
	rotx wheelRotAngle
	if gs_detlevel_3D_m = 2 then
		resol 24
		material "builtInMatBlackTyre"
		revolve 8, 360, 0,
			-0.11, 0.23, 1,
			-0.115, 0.235, 1,
			-0.115, 0.29, 1,
			-0.085, 0.32, 1,
			0.085, 0.32, 1,
			0.115, 0.29, 1,
			0.115, 0.235, 1,
			0.11, 0.23, 1

		material gs_wheel_mat
		for i = 1 to 6
		roty 90
		rotz 60*i
		cutpolya 8, 2, 0,
			-0.02055676896805, 0.1027212911649, 79,
			0, 0.08844792850599, 79,
			0.020192226106, 0.1020863034049, 79,
			0.05330255454972, 0.1651447813389, 79,
			0.05330255454972, 0.2515779470177, 79,
			-0.04844606370527, 0.2515779470177, 79,
			-0.04844606370527, 0.1676867310239, 79,
			-0.02055676896805, 0.1027212911649, -1
		del 2
		next i

		revolve 6, 360, 1+2+4+8+16,
			0.115, 0.035, 2,
			0.11, 0.04, 2,
			0.11, 0, 2,
			0.11, 0.175, 2,
			0.079, 0.22, 2,
			0.095, 0.172, 2

		for i = 1 to 6
		cutend
		next i

		revolve 7, 360, 1+2+4+8+16,
			-0.095, 0.22, 2,
			-0.105, 0.22, 1,
			-0.11, 0.23, 2,
			0.11, 0.23, 2,
			0.105, 0.22, 1,
			0.095, 0.22, 2,
			-0.095, 0.22, 2

		addx 0.0625
		roty -90
		cylind 0.08, 0.16
		del 2
	else
		resol 12
		material "builtInMatBlackTyre"
		revolve 6, 360, 0,
			-0.115, 0.23, 1,
			-0.115, 0.29, 1,
			-0.085, 0.32, 1,
			0.085, 0.32, 1,
			0.115, 0.29, 1,
			0.115, 0.23, 1

		material gs_wheel_mat
		revolve 4, 360, 1+2+4+8+16,
			0.11, 0, 2,
			0.11, 0.175, 2,
			0.079, 0.22, 2,
			0.095, 0.172, 2

		revolve 7, 360, 1+2+4+8+16,
			-0.095, 0.22, 2,
			-0.105, 0.22, 1,
			-0.115, 0.23, 2,
			0.115, 0.23, 2,
			0.105, 0.22, 1,
			0.095, 0.22, 2,
			-0.095, 0.22, 2
	endif
	del 2
return
