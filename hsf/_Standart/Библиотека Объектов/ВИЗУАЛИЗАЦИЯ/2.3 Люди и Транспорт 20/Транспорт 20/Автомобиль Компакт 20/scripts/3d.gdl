
if gs_detlevel_3D_m = 0 then end

if GLOB_CONTEXT = 5 THEN
	gs_detlevel_3D_m = 1
	interior = 0
	gs_path_move = 0
endif

call "VehiclePathMacro" parameters all A = A,
		wheelBase				= wheelBase,
		wheelDiam				= wheelDiam,
		hsId					= 1000,
		gs_path_move			= gs_path_move,
		gs_path_show_3D			= gs_path_show_3D,
		gs_pathNodes_Num		= gs_pathNodes_Num,
		gs_pathNodes_Num_old	= gs_pathNodes_Num_old,
		gs_pathNodes_Pos		= gs_pathNodes_Pos,
		gs_pathNodes_Angle		= gs_pathNodes_Angle,
		gs_pathNodes_Speed		= gs_pathNodes_Speed,
		gs_path_fps				= gs_path_fps,
		gs_path_start_frame		= gs_path_start_frame,
		gs_path_pen				= gs_path_pen,
		gs_path_line_pen		= gs_path_line_pen,
	returned_parameters wheelAngle, wheelRot,
		posX,posY,posZ,
		dirAngle, riseAngle

add posX,posY,posZ
rotz dirAngle
roty riseAngle

if gs_path_move then
	wheel_angle = wheelAngle
endif

! =============================================================================
! Draw the Car
! =============================================================================

if gs_list_accessories = `Колеса Грузового Автомобиля` then
	wheelRadius = 1
	wheelDepth = 0.4
else
	wheelRadius = 0.32
	wheelDepth = 0.12
endif

rotz 180
addx -wheelBase

IF gs_shadow=0 THEN SHADOW OFF

	define material	"builtInMatBlackTyre" 0,
		0.1,	0.1,	0.1,
		0.86,	0.81,	0.09,	0,	2.2,	0,
		0.990005,	0.990005,	1,
		0,	0,	0,	0

pen gs_cont_pen

roty -gs_rot_ver
rotx gs_rot_hor

addx 1.650627114224
vertPos = wheelRadius^2 - 0.32^2
if vertPos > 0 then
	vertPos = sqr(vertPos)
else
	vertPos = 0
endif

addz vertPos + wheelRadius - 0.32
mul 4.249/8.360276, 1.753/3.282416, 1.46/2.92954154331
rotz 90
muly -1
addz 2.97785
for ii = -1 to 1 step 2
	mulx ii
	call "cp_car08Body" parameters 	body_mat = gs_carbody_mat,
									bWholeParts = (ii=1)

	call "cp_car08BodyAccessory" parameters gs_detlevel_3D_m = gs_detlevel_3D_m,
											body_mat = gs_carbody_mat,
											access_mat = gs_access_mat,
											access_mat2 = gs_access_mat2,
											bWholeParts = (ii=1)

	call "cp_car08Door" parameters 	gs_detlevel_3D_m = gs_detlevel_3D_m,
									door_mat = gs_carbody_mat,
									door_mat2 = gs_doora_mat,
									frame_mat = gs_frame_mat

	call "cp_car08Lights" parameters gs_detlevel_3D_m = gs_detlevel_3D_m,
									 frontlight_mat = gs_lamp_mat,
									 rearlight_mat = gs_blamp_mat,
									 lampin_mat = gs_lampin_mat

	call "cp_car08Glass" parameters gs_detlevel_3D_m = gs_detlevel_3D_m,
									glass_mat = gs_glass_mat,
									mirror_mat = gs_mirror_mat,
									bWholeParts = (ii=1)

	del 1
next ii

if gs_detlevel_3D_m = 2 and interior then
	mulx 1-2*(wheel)
	call "cp_car08Interior" parameters interior_mat = gs_int_mat1
	del 1

	material gs_int_mat2
	add 0.71, 0.17, -2.155
	gosub 10
	addx -1.42
	gosub 10
	del 2

	add 0, -1.42, -2.155
	gosub 15
	del 1
endif

if gs_detlevel_3D_m = 2 and interior then
	mulx 1-2*(wheel)
	gosub 20
	del 1
endif

del 6

wheelRotAngle = -wheelRot
addy -0.76
rotz -90
gosub 30
del 2

wheelRotAngle = wheelRot
addy 0.76
rotz 90
gosub 30
del 2

wheelRotAngle = -wheelRot
add 2.72, -0.76, 0
rotz -90+wheel_angle
gosub 30
del 2

wheelRotAngle = wheelRot
add 2.72, 0.76, 0
rotz 90+wheel_angle
gosub 30
del 2

del 2


end

10:								 ! --- seat
	rotx 90
	roty -90
	addz -0.45
	prism_ 17, 0.90,
		1.09428, 0, 15,
		1.09428, 0.193053, 79,
		1.176959912722, 0.3932833996078, 79,
		1.400775309752, 1.243071696803, 79,
		1.398009605289, 1.398445115972, 79,
		1.361457, 1.4615585, 79,
		1.273106, 1.461941, 79,
		1.207473, 1.390336, 79,
		1.009308809884, 0.919967843759, 79,
		0.908535, 0.481357, 79,
		0.9104352188964, 0.3945400971935, 79,
		0.4422157331807, 0.4660794668527, 79,
		0.1299193344056, 0.4384076340499, 79,
		0.01264347157449, 0.3540744293174, 79,
		0, 0.2667325073622, 79,
		0.141492, 0, 15,
		1.09428, 0, -1
	del 1

	addz -0.22
	prism_ 10, 0.44,
		1.361457, 1.4615585, 79,
		1.375639920872, 1.499001075677, 79,
		1.375639920872, 1.654064, 79,
		1.347068, 1.69338, 79,
		1.283753, 1.688717, 79,
		1.235319, 1.633345, 79,
		1.216606919451, 1.533176378709, 79,
		1.237186803398, 1.470695822306, 79,
		1.273106, 1.461941, 79,
		1.361457, 1.4615585, -1
	del 3
return

15:								 ! --- back seat
	rotx 90
	roty -90
	addz -1.2
	prism_ 12, 2.5,
		1.109125889925,            0, 15,
		1.415349891217, 1.222542938057, 79,
		1.381454190644, 1.294043449158, 79,
		1.301789,  1.317164407, 79,
		1.215279054277, 1.262022990988, 79,
		0.973347, 0.6567331334476, 79,
		0.903013, 0.2494881334476, 15,
		0.4425669056815, 0.3123579345914, 79,
		0.1027798993099, 0.262536097338, 79,
		0, 0.1721391334476, 79,
		0, 0, 15,
		1.109125889925,  0, -1
	del 3
return

20:								 ! --- wheel
	material gs_int_mat1
	add -0.70, 0.426, -1.15
	rotz 180
	rotx 20
	resol 12
	addx -0.28
	elbow 0.28, 360, 0.025
	del 1

	rotx 90
	addz -0.015
	prism_ 13, 0.03,
		-0.09443650813896, -0.09443650813896, 79,
		-0.04674650284752, -0.1658096448797, 79,
		-0.03, -0.28, 15,
		0.03, -0.28, 15,
		0.04674650284752, -0.1658096448797, 79,
		0.09443650813896, -0.09443650813896, 79,
		0.1658096448797, -0.04674650284752, 79,
		0.28, -0.03, 15,
		0.28, 0.03, 15,
		-0.28, 0.03, 15,
		-0.28, -0.03, 15,
		-0.1658096448797, -0.04674650284752, 79,
		-0.09443650813896, -0.09443650813896, -1
	del 2

	resol 10
	addy 0.02
	rotz -90
	revolve 4, 360, 1+16+32,
		-0.01, 0.05, 1,
		0, 0.10, 1,
		0.013, 0.12, 1,
		0.42, 0.12, 1
	del 5
return

30:								 ! --- tire
	add -0.05, 0, wheelRadius
	rotx wheelRotAngle
	if gs_detlevel_3D_m = 2 then
		resol 24
		material "builtInMatBlackTyre"
		revolve 8, 360, 0,
			-wheelDepth * 115/120, wheelRadius * 255 / 320, 1,
			-wheelDepth, wheelRadius * 265 / 320, 1,
			-wheelDepth, wheelRadius * 300 / 320, 1,
			-wheelDepth * 100/120, wheelRadius, 1,
			wheelDepth * 100/120, wheelRadius, 1,
			wheelDepth, wheelRadius * 300 / 320, 1,
			wheelDepth, wheelRadius * 265 / 320, 1,
			wheelDepth * 115/120, wheelRadius * 255 / 320, 1

		material gs_wheel_mat
		roty -90
		addz -wheelDepth * 115/120
		prism_ 4, wheelDepth * 23/120,
			0, 0, 979,
			wheelRadius * 255 / 320, 360, 4079,
			0, 0, 979,
			wheelRadius * 240 / 320, 360, 4079
		del 2

		roty -90
		addz -wheelDepth * 105/120
		for i = 1 to 5
			rotz 72*i
			cutpolya 19, 2, 0,
				-0.1617131200115, 0.07883033343697, 79,
				-0.05772542485937, 0.04504268311618, 79,
				-0.04608913837399, 0.04412688750868, 79,
				-0.03530536869269, 0.04859367116418, 79,
				-0.02772483689529, 0.05746933353007, 79,
				-0.025, 0.06881909602356, 79,
				-0.025, 0.1781582292616, 79,
				-0.02744285428966, 0.1889366882147, 79,
				-0.03429401419221, 0.1976087307926, 79,
				-0.04421456887906, 0.2024795940824, 79,
				-0.05526576078443, 0.2025973733416, 79,
				-0.09083428050662, 0.1893386740337, 79,
				-0.1234349029814, 0.1698935688187, 79,
				-0.1520024433781, 0.1448974023476, 79,
				-0.1756034928114, 0.1151668933003, 79,
				-0.1789064841863, 0.1046201894332, 79,
				-0.1773396379064, 0.09368000171919, 79,
				-0.1712091601441, 0.08448435291718, 79,
				-0.1617131200115, 0.07883033343697, -1
			del 1
		next i

		prism_ 2, wheelDepth * 40/120,
			0, 0, 979,
			wheelRadius * 240 / 320, 360, 4079

		for i = 1 to 5
			cutend
		next i
		del 2

		addx 0.0625
		roty -90
		cylind wheelDepth * 80/120, 0.15
		del 2
	else
		resol 12
		material "builtInMatBlackTyre"
		revolve 6, 360, 0,
			-wheelDepth, wheelRadius * 255 / 320, 1,
			-wheelDepth, wheelRadius * 300 / 320, 1,
			-wheelDepth * 100/120, wheelRadius, 1,
			wheelDepth * 100/120, wheelRadius, 1,
			wheelDepth, wheelRadius * 300 / 320, 1,
			wheelDepth, wheelRadius * 255 / 320, 1

		material gs_wheel_mat
		roty -90
		addz -wheelDepth * 115/120
		prism_ 4, wheelDepth * 23/120,
			0, 0, 979,
			wheelRadius * 255 / 320, 360, 4079,
			0, 0, 979,
			wheelRadius * 240 / 320, 360, 4079
		del 1
		addz -wheelDepth * 105/120
		prism_ 2, wheelDepth * 22/120,
			0, 0, 979,
			wheelRadius * 240 / 320, 360, 4079
		del 2
	endif
	del 2
return
