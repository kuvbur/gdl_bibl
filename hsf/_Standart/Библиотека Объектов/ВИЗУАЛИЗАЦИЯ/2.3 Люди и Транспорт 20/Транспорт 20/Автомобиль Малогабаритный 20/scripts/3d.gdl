
if gs_detlevel_3D_m = 0 then end

if GLOB_CONTEXT = 5 THEN
	gs_detlevel_3D_m = 1
	interior = 0
	gs_path_move = 0
endif

call "VehiclePathMacro" parameters all A = A,
		wheelBase				= wheelBase,
		wheelDiam				= wheelDiam,
		hsId					= 1000,
		gs_path_move			= gs_path_move,
		gs_path_show_3D			= gs_path_show_3D,
		gs_pathNodes_Num		= gs_pathNodes_Num,
		gs_pathNodes_Num_old	= gs_pathNodes_Num_old,
		gs_pathNodes_Pos		= gs_pathNodes_Pos,
		gs_pathNodes_Angle		= gs_pathNodes_Angle,
		gs_pathNodes_Speed		= gs_pathNodes_Speed,
		gs_path_fps				= gs_path_fps,
		gs_path_start_frame		= gs_path_start_frame,
		gs_path_pen				= gs_path_pen,
		gs_path_line_pen		= gs_path_line_pen,
	returned_parameters wheelAngle, wheelRot,
		posX,posY,posZ,
		dirAngle, riseAngle

add posX,posY,posZ
rotz dirAngle
roty riseAngle

if gs_path_move then
	wheel_angle = wheelAngle
endif

! =============================================================================
! Draw the Car
! =============================================================================


rotz 180
addx -wheelBase

IF gs_shadow=0 THEN SHADOW OFF

	define material	"builtInMatBlackTyre" 0,
		0.1,	0.1,	0.1,
		0.86,	0.81,	0.09,	0,	2.2,	0,
		0.990005,	0.990005,	1,
		0,	0,	0,	0

pen gs_cont_pen

roty -gs_rot_ver
rotx gs_rot_hor

mulsize = 3.606/5.350

MUL mulsize ,mulsize ,mulsize
ROTz -90
ADD 0,5.4,0.251

ADD 0,-2.7,0
MATERIAL gs_carbody_mat
call "cp_car02_body" parameters
DEL 1

ADD 0,-2.412,0.062
MATERIAL gs_carbody_mat
call "cp_car02_underbody" parameters
DEL 1

ADD 0,-0.35,0.062
MATERIAL gs_lamp_mat
call "cp_car02_frontlight" parameters
DEL 1


ADD 0,-0.408,0.062
MATERIAL gs_mirror_mat
call "cp_car02_frontlight_back" parameters
DEL 1

ADD 0.01,-3.781,0.062
MATERIAL gs_glass_mat
call "cp_car02_glass" parameters
DEL 1

ADD 0,-4.922,0.062
MATERIAL gs_blamp_mat
call "cp_car02_backlight" parameters
DEL 1

ADD 0,-2.087,0.062
MATERIAL gs_access_mat
call "cp_car02_chrome" parameters
DEL 1

ADD 0,-1.777,0.062
MATERIAL gs_mirror_mat
call "cp_car02_mirror" parameters
DEL 1

ADD 0.00055,-3.2993,0.0621
MATERIAL gs_access_mat2
call "cp_car02_gaps" parameters
DEL 1

if interior and gs_detlevel_3D_m = 2 then       ! Detailed
	IF wheel<0.5 THEN MUL -1,1,1
	ADD -0.195,-2.045,0.055
	MATERIAL gs_int_mat1
	call "cp_car02_cpanel" parameters
	IF wheel<0.5 THEN DEL 1
	DEL 1

	ADD 0,-3.608,0.062
	MATERIAL gs_int_mat2
	call "cp_car02_seats" parameters
	DEL 1
ENDIF

ADD 0,-3.014,0.062
MATERIAL gs_frame_mat
call "cp_car02_plastic" parameters
DEL 1

DEL 2

add 0.880,-1.15,0
rotz -90
MUL 0.9/0.64,0.9/0.64,0.9/0.64
wheelRotAngle = -wheelRot
gosub 30
del 3


add 0.880,1.15,0
rotz 90
MUL 0.9/0.64,0.9/0.64,0.9/0.64
wheelRotAngle = wheelRot
gosub 30
del 3

add 4.50, -1.15,0
rotz -90+wheel_angle
wheelRotAngle = -wheelRot
MUL 0.9/0.64,0.9/0.64,0.9/0.64
gosub 30
del 3

add 4.50, 1.15, 0
rotz 90+wheel_angle
wheelRotAngle = wheelRot
MUL 0.9/0.64,0.9/0.64,0.9/0.64
gosub 30
del 3

DEL 1
DEL 4

END
!!!!!!!!****************************************
!!!!!!!!**************************************** END
!!!!!!!!****************************************

20:								 ! --- wheel
	material gs_int_mat1
	add -0.70, 0.426, -1.15
	rotz 180
	rotx 20
	resol 12
	addx -0.28
	elbow 0.28, 360, 0.025
	del 1

	rotx 90
	addz -0.015
	prism_ 13, 0.03,
		-0.09443650813896, -0.09443650813896, 79,
		-0.04674650284752, -0.1658096448797, 79,
		-0.03, -0.28, 15,
		0.03, -0.28, 15,
		0.04674650284752, -0.1658096448797, 79,
		0.09443650813896, -0.09443650813896, 79,
		0.1658096448797, -0.04674650284752, 79,
		0.28, -0.03, 15,
		0.28, 0.03, 15,
		-0.28, 0.03, 15,
		-0.28, -0.03, 15,
		-0.1658096448797, -0.04674650284752, 79,
		-0.09443650813896, -0.09443650813896, -1
	del 2

	resol 10
	addy 0.02
	rotz -90
	revolve 4, 360, 1+16+32,
		-0.01, 0.05, 1,
		0, 0.10, 1,
		0.013, 0.12, 1,
		0.42, 0.12, 1
	del 5
return

30:								 ! --- tire
	add -0.05, 0, 0.32
	rotx wheelRotAngle
	if gs_detlevel_3D_m = 2 then
		resol 24
		material "builtInMatBlackTyre"
		revolve 8, 360, 0,
			-0.115, 0.255, 1,
			-0.12, 0.265, 1,
			-0.12, 0.30, 1,
			-0.10, 0.32, 1,
			0.10, 0.32, 1,
			0.12, 0.30, 1,
			0.12, 0.265, 1,
			0.115, 0.255, 1

		material gs_wheel_mat
		roty -90
		addz -0.115
		prism_ 4, 0.23,
			0, 0, 979,
			0.255, 360, 4079,
			0, 0, 979,
			0.24, 360, 4079
		del 2

		roty -90
		addz -0.105
		for i = 1 to 5
			rotz 72*i
			cutpolya 19, 2, 0,
				-0.1617131200115, 0.07883033343697, 79,
				-0.05772542485937, 0.04504268311618, 79,
				-0.04608913837399, 0.04412688750868, 79,
				-0.03530536869269, 0.04859367116418, 79,
				-0.02772483689529, 0.05746933353007, 79,
				-0.025, 0.06881909602356, 79,
				-0.025, 0.1781582292616, 79,
				-0.02744285428966, 0.1889366882147, 79,
				-0.03429401419221, 0.1976087307926, 79,
				-0.04421456887906, 0.2024795940824, 79,
				-0.05526576078443, 0.2025973733416, 79,
				-0.09083428050662, 0.1893386740337, 79,
				-0.1234349029814, 0.1698935688187, 79,
				-0.1520024433781, 0.1448974023476, 79,
				-0.1756034928114, 0.1151668933003, 79,
				-0.1789064841863, 0.1046201894332, 79,
				-0.1773396379064, 0.09368000171919, 79,
				-0.1712091601441, 0.08448435291718, 79,
				-0.1617131200115, 0.07883033343697, -1
			del 1
		next i

		prism_ 2, 0.04,
			0, 0, 979,
			0.24, 360, 4079

		for i = 1 to 5
			cutend
		next i
		del 2

		addx 0.0625
		roty -90
		cylind 0.08, 0.15
		del 2
	else
		resol 12
		material "builtInMatBlackTyre"
		revolve 6, 360, 0,
			-0.12, 0.255, 1,
			-0.12, 0.30, 1,
			-0.10, 0.32, 1,
			0.10, 0.32, 1,
			0.12, 0.30, 1,
			0.12, 0.255, 1

		material gs_wheel_mat
		roty -90
		addz -0.115
		prism_ 4, 0.23,
			0, 0, 979,
			0.255, 360, 4079,
			0, 0, 979,
			0.24, 360, 4079
		del 1
		addz -0.105
		prism_ 2, 0.22,
			0, 0, 979,
			0.24, 360, 4079
		del 2
	endif
	del 2
return
