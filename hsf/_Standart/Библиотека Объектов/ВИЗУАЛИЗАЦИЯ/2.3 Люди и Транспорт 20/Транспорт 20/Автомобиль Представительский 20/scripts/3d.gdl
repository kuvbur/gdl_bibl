
IF gs_detlevel_3D_m = DLEV3D_OFF THEN END

if GLOB_CONTEXT = 5 THEN
	gs_detlevel_3D_m = DLEV3D_SIMPLE
	gs_detlevel_3D_m = 1
	interior = 0
	gs_path_move = 0
endif

call "VehiclePathMacro" parameters all A = A,
		wheelBase				= wheelBase,
		wheelDiam				= wheelDiam,
		hsId					= 1000,
		gs_path_move			= gs_path_move,
		gs_path_show_3D			= gs_path_show_3D,
		gs_pathNodes_Num		= gs_pathNodes_Num,
		gs_pathNodes_Num_old	= gs_pathNodes_Num_old,
		gs_pathNodes_Pos		= gs_pathNodes_Pos,
		gs_pathNodes_Angle		= gs_pathNodes_Angle,
		gs_pathNodes_Speed		= gs_pathNodes_Speed,
		gs_path_fps				= gs_path_fps,
		gs_path_start_frame		= gs_path_start_frame,
		gs_path_pen				= gs_path_pen,
		gs_path_line_pen		= gs_path_line_pen,
	returned_parameters wheelAngle, wheelRot,
		posX,posY,posZ,
		dirAngle, riseAngle

add posX,posY,posZ
rotz dirAngle
roty riseAngle

if gs_path_move then
	wheel_angle = wheelAngle
endif


! =============================================================================
! Draw the Car
! =============================================================================

rotz 180
addx -wheelBase

IF gs_shadow=0 THEN SHADOW OFF

	define material	"builtInMatBlackTyre" 0,
		0.1,	0.1,	0.1,
		0.86,	0.81,	0.09,	0,	2.2,	0,
		0.990005,	0.990005,	1,
		0,	0,	0,	0

pen gs_cont_pen

roty -gs_rot_ver
rotx gs_rot_hor

addx 1.084
rotz -90
ratio = 5.072/1.9718
mul ratio, ratio, ratio

for i = -1 to 1 step 2
	mulx i
	call "cp_car04_body" parameters all	body_mat = gs_carbody_mat,
								plastic_mat = gs_access_mat,
								bWholeParts = (i=1)
	call "cp_car04_door" parameters all 	glass_mat 	= gs_glass_mat,
								body_mat 	= gs_carbody_mat,
								plastic_mat = gs_frame_mat
	if interior and gs_detlevel_3D_m = DLEV3D_DETAILED then
		mulx 1-2*wheel
		call "cp_car04_interior" parameters all 	interior1_mat = gs_int_mat1,
										interior2_mat = gs_int_mat2
		del 1
	endif
	call "cp_car04_lights" parameters all rearlight_mat 		= gs_blamp_mat,
								 frontlight_mat		= gs_lamp_mat,
								 blinker_mat 		= gs_blamp_mat,
								 metal_mat			= gs_access_mat,
								 lampin_mat			= gs_lampin_mat
	del 1
next i

call "cp_car04_glass" parameters all glass_mat 	= gs_glass_mat,
									plastic_mat = gs_frame_mat


if interior and gs_detlevel_3D_m = DLEV3D_DETAILED then
	mulx 1-2*not(wheel)
	call "cp_car04_interior2" parameters all interior1_mat 	= gs_int_mat1,
									interior2_mat 	= gs_int_mat2,
									mirror_mat 		= gs_mirror_mat
	del 1
endif
del 3

wheelRotAngle = -wheelRot
addy -0.83
rotz -90
gosub 20
del 2

wheelRotAngle = wheelRot
addy 0.83
rotz 90
gosub 20
del 2

wheelRotAngle = -wheelRot
add 3.028, -0.83, 0
rotz -90+wheel_angle
gosub 20
del 2

wheelRotAngle = wheelRot
add 3.028, 0.83, 0
rotz 90+wheel_angle
gosub 20
del 2


IF gs_detlevel_3D_m = DLEV3D_SIMPLE THEN END
resol 16
for i = -1 to 1 step 2		! --- Mirror
	muly i
	add 2.12, 0.841, 1.02
	rotx 14
	gosub 10
	del 3
next i

del 2

end


10:
	rotx -90
	material gs_carbody_mat
	add -0.045, 0, 0.06
	roty -20
	addz 0.06
	rotz 90
	rotx -90
	rotz 15
	mulx 0.07/0.08
	cutplane 0
	cutplane 90
	sphere 0.08
	cutend
	cutend
	material gs_mirror_mat
	cutplane 90
	addz 0.001
	circle 0.08
	del 1
	cutend
	del 1

	material gs_carbody_mat
	mul 0.07/0.08, 1.8, 1
	cutplane 0
	cutplane -90
	sphere 0.08
	cutend
	cutend
	material gs_mirror_mat
	cutplane -90
	addz 0.001
	circle 0.08
	cutend
	del 8

	ruled 8, 4+16+32,
		0.04, 0.025, 1,
		0.03, 0.035, 1,
		-0.03, 0.035, 1,
		-0.04, 0.025, 1,
		-0.04, -0.025, 1,
		-0.03, -0.035, 1,
		0.03, -0.035, 1,
		0.04, -0.025, 1,

		0.005, 0.01, 0.10,
		-0.005, 0.02, 0.10,
		-0.015, 0.02, 0.10,
		-0.025, 0.01, 0.10,
		-0.025, -0.01, 0.10,
		-0.015, -0.02, 0.10,
		-0.005, -0.02, 0.10,
		0.005, -0.01, 0.10
	del 1
return

20:
	addz 0.361
	rotx wheelRotAngle
	addz -0.361

	if gs_detlevel_3D_m = DLEV3D_DETAILED then
		resol 32
		add -0.20, 0, 0.361

		material "builtInMatBlackTyre"
		addx 0.156
		revolve 12, 360, 0,
			0.156, 0.282, 1,
			0.156, 0.3358850508997, 1,
			0.1458167403599, 0.3491922056555, 1,
			0.1341785213368, 0.3554767917738, 1,
			0.1209522056555, 0.3592996976864, 1,
			0.1078640987147, 0.361, 1,
			-0.1078640987147, 0.361, 1,
			-0.1209522056555, 0.3592996976864, 1,
			-0.1341785213368, 0.3554767917738, 1,
			-0.1458167403599, 0.3491922056555, 1,
			-0.156, 0.3358850508997, 1,
			-0.156, 0.282, 1
		del 1

		material gs_wheel_mat

		alpha = 0
		for i = 1 to 6
			roty 90
			rotz alpha
			cutpolya 17, 2, 0,
				0.08649174221904, -0.2398836770769, 79,
				0.09223052243298, -0.2345546969298, 79,
				0.09236934892178, -0.2267244763098, 79,
				0.05882648683196, -0.1438556795462, 79,
				0.05286904198561, -0.1358127299007, 79,
				0.04376057092343, -0.1316635199749, 79,
				0, -0.1278349661097, 79,
				-0.04376057092343, -0.1316635199749, 79,
				-0.05286904198561, -0.1358127299007, 79,
				-0.05882648683196, -0.1438556795462, 79,
				-0.09236934892178, -0.2267244763098, 79,
				-0.09223052243298, -0.2345546969298, 79,
				-0.08649174221904, -0.2398836770769, 79,
				-0.0439013800774, -0.2511924935728, 79,
				0, -0.255, 79,
				0.0439013800774, -0.2511924935728, 79,
				0.08649174221904, -0.2398836770769, -1
			del 2
			alpha = alpha + 60
		next i

		revolve 17, 360, 1+2+16+32,
			0.252, 0, 1,
			0.252, 0.09957296843784, 1,
			0.2679425073604, 0.1155154757982, 1,
			0.2755831003009, 0.1388273078938, 1,
			0.2843206206423, 0.1969508810592, 1,
			0.2869865947161, 0.26, 2,
			0.01, 0.26, 2,
			0, 0.27, 1,
			0, 0.282, 2,
			0.312, 0.282, 2,
			0.312, 0.27, 1,
			0.302, 0.26, 2,
			0.2992730719373, 0.19551342736, 1,
			0.2902292318853, 0.1353521598138, 1,
			0.281081155669, 0.1074409206712, 1,
			0.267, 0.09335976500224, 2,
			0.282, 0, 1

		for i = 1 to 6
		cutend
		next i

		addx 0.26
		roty -90
		cylind 0.10, 0.20
		del 2

		del 1
	else
		resol 16
		add -0.20, 0, 0.361

		material "builtInMatBlackTyre"
		addx 0.156
		revolve 5, 360, 0,
			0.156, 0.282, 1,
			0.156, 0.351, 1,
			0.146, 0.361, 1,
			-0.156, 0.361, 1,
			-0.156, 0.282, 1
		del 1

		material gs_wheel_mat
		addx 0.312
		roty -90
		circle 0.282
		del 2
		del 1
	endif

	del 3
return
