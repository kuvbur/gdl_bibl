
if gs_detlevel_3D_m = 0 then end

if GLOB_CONTEXT = 5 THEN
	gs_detlevel_3D_m = 1
	interior = 0
	gs_path_move = 0
endif

call "VehiclePathMacro" parameters all A = A,
		wheelBase				= wheelBase,
		wheelDiam				= wheelDiam,
		hsId					= 1000,
		gs_path_move			= gs_path_move,
		gs_path_show_3D			= gs_path_show_3D,
		gs_pathNodes_Num		= gs_pathNodes_Num,
		gs_pathNodes_Num_old	= gs_pathNodes_Num_old,
		gs_pathNodes_Pos		= gs_pathNodes_Pos,
		gs_pathNodes_Angle		= gs_pathNodes_Angle,
		gs_pathNodes_Speed		= gs_pathNodes_Speed,
		gs_path_fps				= gs_path_fps,
		gs_path_start_frame		= gs_path_start_frame,
		gs_path_pen				= gs_path_pen,
		gs_path_line_pen		= gs_path_line_pen,
	returned_parameters wheelAngle, wheelRot,
		posX,posY,posZ,
		dirAngle, riseAngle

add posX,posY,posZ
rotz dirAngle
roty riseAngle

if gs_path_move then
	wheel_angle = wheelAngle
endif

! =============================================================================
! Draw the Car
! =============================================================================

rotz 180
addx -wheelBase


IF gs_shadow=0 THEN SHADOW OFF

	define material	"builtInMatBlackTyre" 0,
		0.1,	0.1,	0.1,
		0.86,	0.81,	0.09,	0,	2.2,	0,
		0.990005,	0.990005,	1,
		0,	0,	0,	0

pen gs_cont_pen

roty -gs_rot_ver
rotx gs_rot_hor

mul 5.477/5.507299, 1.996/2.052856, 2.645/2.600977

addx 1.281207
rotz 90
addz 1.411343
for ii = -1 to 1 step 2
	mulx ii

	call "cp_van02Body" parameters 	body_mat = gs_carbody_mat,
									body_mat2 = gs_carbody_mat2,
									bWholeParts = (ii=1)

	call "cp_van02BodyAccessory" parameters gs_detlevel_3D_m = gs_detlevel_3D_m,
											frame_mat = gs_frame_mat,
											access_mat = gs_access_mat,
											bWholeParts = (ii=1)

	call "cp_van02Lights" parameters gs_detlevel_3D_m = gs_detlevel_3D_m,
									 frontlight_mat = gs_lamp_mat,
									 rearlight_mat = gs_blamp_mat,
									 lampin_mat = gs_lampin_mat

	call "cp_van02Glass" parameters gs_detlevel_3D_m = gs_detlevel_3D_m,
									glass_mat = gs_glass_mat,
									mirror_mat = gs_mirror_mat,
									bWholeParts = (ii=1)

	if gs_detlevel_3D_m = 2 and interior then       !detailed
		call "cp_van02Interior" parameters interior_mat = gs_int_mat1


	endif
	del 1
next ii
del 3


if gs_detlevel_3D_m = 2 and interior then
	material gs_int_mat2
	add 1.765063, 0.48, 0.713367
	gosub 10
	del 1

	add 1.765063, -0.48, 0.713367
	gosub 10
	del 1

	muly 1-2*(wheel)
	add 2.66, -0.48, 1.43
	gosub 20
	del 2
endif


material gs_frame_mat
add 1.765, 0.97, 1.05
rotx 3
block 0.23, 0.02, 0.14
del 2

muly -1
add 1.765, 0.97, 1.05
rotx 3
block 0.23, 0.02, 0.14
del 3

add -1.36, -0.23, 1.10
rotz 90
block 0.23, 0.01, 0.14
del 2

addy -0.96
rotz -90
gosub 30
del 2

addy 0.96
rotz 90
gosub 30
del 2

add 3.01, -0.96, 0
rotz -90+wheel_angle
gosub 30
del 2

add 3.01, 0.96, 0
rotz 90+wheel_angle
gosub 30
del 2

del 3


end

10:								 ! --- seat
	rotx 90
	addz -0.31
	prism_ 14, 0.62,
		0, 0, 15,
		0.573403, 0, 15,
		0.573403, 0.1695716243728, 15,
		0.7013859802853, 0.3168132546535, 79,
		0.7013859802853, 0.4260220927399, 79,
		0.6439954620164, 0.4850869265595, 79,
		0.4095527278526, 0.4740975659723, 79,
		0.17299, 0.44214, 15,
		0.1940837108242, 0.5208628005159, 79,
		0.1638195038159, 0.8222919170276, 79,
		0.1371812610244, 0.9569227885675, 79,
		0.102307003712, 1.011026105473, 79,
		0, 1.011026105473, 15,
		0, 0, -1
	del 1

	addz -0.15
	prism_ 7, 0.30,
		0.102307003712, 1.011026105473, 79,
		0.1230989259545, 1.055569372255, 79,
		0.1119286850738, 1.226115164478, 79,
		0.05998377042548, 1.253648915501, 79,
		0, 1.253648915501, 15,
		0, 1.011026105473, 15,
		0.102307003712, 1.011026105473, -1
	del 2
return

20:								 ! --- wheel
	material gs_int_mat1
	rotz 90
	rotx 40
	resol 12
	addx -0.20
	elbow 0.20, 360, 0.02
	del 1

	rotx 90
	addz -0.0125
	mul 0.20/0.25, 0.20/0.25, 1
	prism_ 13, 0.025,
		-0.09443650813896, -0.09443650813896, 79,
		-0.04674650284752, -0.1658096448797, 79,
		-0.03, -0.25, 15,
		0.03, -0.25, 15,
		0.04674650284752, -0.1658096448797, 79,
		0.09443650813896, -0.09443650813896, 79,
		0.1658096448797, -0.04674650284752, 79,
		0.25, -0.03, 15,
		0.25, 0.03, 15,
		-0.25, 0.03, 15,
		-0.25, -0.03, 15,
		-0.1658096448797, -0.04674650284752, 79,
		-0.09443650813896, -0.09443650813896, -1
	del 3

	resol 10
	addy 0.02
	rotz -90
	muly 1.2
	revolve 4, 360, 1+16+32,
		-0.01, 0.03, 1,
		0, 0.07, 1,
		0.013, 0.08, 1,
		0.52, 0.08, 1
	del 5
return

30:								 ! --- tire
	add -0.05, 0, 0.365
	if gs_detlevel_3D_m = 2 then
		resol 24
		material "builtInMatBlackTyre"
		revolve 6, 360, 0,
			-0.115, 0.24, 1,
			-0.115, 0.34, 1,
			-0.095, 0.365, 1,
			0.095, 0.365, 1,
			0.115, 0.34, 1,
			0.115, 0.24, 1

		material gs_wheel_mat
		revolve 7, 360, 0,
			0.115, 0.24, 1,
			0.105, 0.225, 2,
			0.063, 0.213, 1,
			0.06, 0.205, 2,
			0.095, 0.12, 2,
			0.105, 0.115, 1,
			0.125, 0, 1
	else
		resol 12
		material "builtInMatBlackTyre"
		revolve 6, 360, 0,
			-0.115, 0.24, 1,
			-0.115, 0.34, 1,
			-0.095, 0.365, 1,
			0.095, 0.365, 1,
			0.115, 0.34, 1,
			0.115, 0.24, 1

		material gs_wheel_mat
		revolve 3, 360, 0,
			0.115, 0.24, 1,
			0.105, 0.225, 2,
			0.125, 0, 1
	endif
	del 1
return
