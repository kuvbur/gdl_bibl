
if gs_detlevel_3D_m = 0 then end

if GLOB_CONTEXT = 5 THEN
	gs_detlevel_3D_m = 1
	interior = 0
	gs_path_move = 0
endif

call "VehiclePathMacro" parameters all A = A,
		wheelBase				= wheelBase,
		wheelDiam				= wheelDiam,
		hsId					= 1000,
		gs_path_move			= gs_path_move,
		gs_path_show_3D			= gs_path_show_3D,
		gs_pathNodes_Num		= gs_pathNodes_Num,
		gs_pathNodes_Num_old	= gs_pathNodes_Num_old,
		gs_pathNodes_Pos		= gs_pathNodes_Pos,
		gs_pathNodes_Angle		= gs_pathNodes_Angle,
		gs_pathNodes_Speed		= gs_pathNodes_Speed,
		gs_path_fps				= gs_path_fps,
		gs_path_start_frame		= gs_path_start_frame,
		gs_path_pen				= gs_path_pen,
		gs_path_line_pen		= gs_path_line_pen,
	returned_parameters wheelAngle, wheelRot,
		posX,posY,posZ,
		dirAngle, riseAngle

add posX,posY,posZ
rotz dirAngle
roty riseAngle

if gs_path_move then
	wheel_angle = wheelAngle
endif

! =============================================================================
! Draw the Car
! =============================================================================

rotz 180
addx -wheelBase

IF gs_shadow=0 THEN SHADOW OFF

	define material	"builtInMatBlackTyre" 0,
		0.1,	0.1,	0.1,
		0.86,	0.81,	0.09,	0,	2.2,	0,
		0.990005,	0.990005,	1,
		0,	0,	0,	0

pen gs_cont_pen

roty -gs_rot_ver
rotx gs_rot_hor


addx 1.3418215
rotz 90
call "cp_car12Body" parameters 	body_mat = gs_carbody_mat,
								access_mat2 = gs_access_mat2

call "cp_car12Glass" parameters glass_mat = gs_glass_mat

for ii = -1 to 1 step 2
	mulx ii
	call "cp_car12BodyAccessory" parameters gs_detlevel_3D_m = gs_detlevel_3D_m,
											body_mat = gs_carbody_mat,
											access_mat = gs_access_mat,
											access_mat2 = gs_access_mat2,
											mirror_mat = gs_mirror_mat,
											bWholeParts = (ii=1)

	call "cp_car12Lights" parameters frontlight_mat = gs_lamp_mat,
									 rearlight_mat = gs_blamp_mat,
									 lampin_mat = gs_lampin_mat
	del 1
next ii

if gs_detlevel_3D_m = 2 and interior then
	for ii = -1 to 1 step 2
		mulx ii
		call "cp_car12Interior" parameters	interior_mat = gs_int_mat1,
											mirror_mat = gs_mirror_mat,
											bWholeParts = (ii=1)

		del 1
	next ii

	gosub 10

	mulx 1-2*not(wheel)
	gosub 20
	del 1
endif
del 2

wheelRotAngle = -wheelRot
addy -0.82
rotz -90
gosub 30
del 2

wheelRotAngle = wheelRot
addy 0.82
rotz 90
gosub 30
del 2

wheelRotAngle = -wheelRot
add wheelBase, -0.82, 0
rotz -90+wheel_angle
gosub 30
del 2

wheelRotAngle = wheelRot
add wheelBase, 0.82, 0
rotz 90+wheel_angle
gosub 30
del 2

del 2


end

10:								 ! --- seats
	material gs_int_mat2
	rotz -90
	rotx 90
	for i = -1 to 1 step 2
		mulz i
		addz -0.43
		addz -0.12
		prism_ 11, 0.24,
			0, 1.339955, 15,
			0.057621, 1.340438, 79,
			0.074621, 1.334547, 15,
			0.109897, 1.372638, 79,
			0.1202213010037, 1.408151043617, 79,
			0.09780541810592, 1.494259408367, 79,
			0.060872, 1.526526, 79,
			0.039761, 1.531456, 79,
			-0.001972967247714, 1.526002354425, 79,
			-0.012356,    1.3835095, 79,
			0, 1.339955, -1
		del 1

		addz -0.28
		wid = 0.56
		gosub 15
		del 3
	next i

	add -1.07, 0, -0.625
	wid = 1.25
	gosub 15
	del 1

	add -2.14, 0, -0.60
	wid = 1.20
	gosub 15
	del 3
return

15:
	prism_ 21, wid,
		0.291432, 0.98259, 79,
		0.141758, 1.27084, 79,
		0.074621, 1.334547, 79,
		0.057621, 1.340438, 79,
		0, 1.339955, 79,
		-0.002982, 1.339951, 79,
		-0.017306, 1.329288, 79,
		-0.022234, 1.309658, 79,
		-0.015575, 1.255374, 79,
		0.193308, 0.64445, 15,
		0.693488, 0.64445, 15,
		0.7057218891476, 0.8691579205406, 79,
		0.686035, 0.881927, 79,
		0.647652, 0.880902, 79,
		0.611414, 0.878175, 79,
		0.557807, 0.873927, 79,
		0.419723, 0.84578, 79,
		0.2936878991653, 0.7964303262332, 15,
		0.303821, 0.862725, 79,
		0.303149, 0.926959, 79,
		0.291432, 0.98259, -1
return

20:								 ! --- wheel
	resol 16
	material gs_int_mat1
	add 0.452014, -0.75021575, 1.21699975
	rotx 25.5

	addx -0.165
	elbow 0.165, 360, 0.019
	del 1

	rotx 90
	addz -0.0112
	prism_ 22, 0.025,
		0.05271386152082, 0.04542673882296, 79,
		-0.05271386152082, 0.04542673882296, 79,
		-0.08889269002422, 0.04033549074216, 79,
		-0.1151386900242, 0.03127801359682, 79,
		-0.1245226900242, 0.01885400308013, 15,
		-0.1633726279633, 0.0231167565276, 15,
		-0.1649759948301, -0.002814450177803, 79,
		-0.1621347359416, -0.03061580312753, 15,
		-0.1148219371192, -0.02643014343681, 15,
		-0.08703869002422, -0.07033783435427, 79,
		-0.04727769002422, -0.09737474929651, 79,
		0, -0.1072900784674, 79,
		0.04727769002422, -0.09737474929651, 79,
		0.08703869002422, -0.07033783435427, 79,
		0.1148219371192, -0.02643014343681, 15,
		0.1621347359416, -0.03061580312753, 15,
		0.1649759948301, -0.002814450177803, 79,
		0.1633726279633, 0.0231167565276, 15,
		0.1245226900242, 0.01885400308013, 15,
		0.1151386900242, 0.03127801359682, 79,
		0.08889269002422, 0.04033549074216, 79,
		0.05271386152082, 0.04542673882296, -1

	addz 0.025
	prism_ 9, 0.30,
		-0.075799, -0.05457307372856, 79,
		-0.0561579336959, -0.08517617745707, 79,
		0.05580468589659, -0.08517617745707, 79,
		0.075449, -0.05457307372856, 79,
		0.075449, 0.03169583405005, 79,
		0.0567679260614, 0.0676157939886, 79,
		-0.05711638159661, 0.0676157939886, 79,
		-0.075799, 0.03169583405005, 79,
		-0.075799, -0.05457307372856, -1
	del 5
return

30:								 ! --- tire
	add -0.05, 0, 0.345
	rotx wheelRotAngle
	if gs_detlevel_3D_m = 2 then
		resol 24
		material "builtInMatBlackTyre"
		revolve 8, 360, 0,
			-0.105, 0.22, 1,
			-0.115, 0.255, 1,
			-0.115, 0.33, 1,
			-0.10, 0.345, 1,
			0.10, 0.345, 1,
			0.115, 0.33, 1,
			0.115, 0.255, 1,
			0.105, 0.22, 1

		material gs_wheel_mat
		for i = 1 to 5
		roty 90
		rotz 72*i
		cutpolya 14, 2, 0,
			0, 0.07, 79,
			-0.0177811734714, 0.074268882062, 79,
			-0.03168628314149, 0.08614496766047, 79,
			-0.0464885899083, 0.1065185950756, 79,
			-0.06397469783798, 0.1408370141988, 79,
			-0.07, 0.1788792748506, 79,
			-0.07, 0.25, 79,
			0.07, 0.25, 79,
			0.07, 0.1788792748506, 79,
			0.06397469783798, 0.1408370141988, 79,
			0.0464885899083, 0.1065185950756, 79,
			0.03168628314149, 0.08614496766047, 79,
			0.0177811734714, 0.074268882062, 79,
			0, 0.07, -1
		del 2
		next i

		revolve 7, 360, 1+2+4+8+16,
			0.115, 0.035, 2,
			0.11, 0.04, 2,
			0.11, 0, 2,
			0.11, 0.17, 2,
			0.09, 0.205, 2,
			0.08, 0.205, 2,
			0.10, 0.167, 2

		for i = 1 to 5
		cutend
		next i

		revolve 7, 360, 1+2+4+8+16,
			-0.09, 0.205, 2,
			-0.10, 0.21, 1,
			-0.105, 0.22, 2,
			0.105, 0.22, 2,
			0.10, 0.21, 1,
			0.09, 0.205, 2,
			-0.09, 0.205, 2

		addx 0.0625
		roty -90
		cylind 0.08, 0.16
		del 2
	else
		resol 12
		material "builtInMatBlackTyre"
		revolve 6, 360, 0,
			-0.115, 0.22, 1,
			-0.115, 0.33, 1,
			-0.10, 0.345, 1,
			0.10, 0.345, 1,
			0.115, 0.33, 1,
			0.115, 0.22, 1

		material gs_wheel_mat
		revolve 4, 360, 1+2+4+8+16,
			0.11, 0.17, 2,
			0.09, 0.205, 2,
			0.08, 0.205, 2,
			0.10, 0.167, 2

		revolve 7, 360, 1+2+4+8+16,
			-0.09, 0.205, 2,
			-0.10, 0.21, 1,
			-0.105, 0.22, 2,
			0.105, 0.22, 2,
			0.10, 0.21, 1,
			0.09, 0.205, 2,
			-0.09, 0.205, 2
	endif
	del 2
return
