
if gs_detlevel_3D_m = 0 then end

if GLOB_CONTEXT = 5 THEN
	gs_detlevel_3D_m = 1
	interior = 0
	gs_path_move = 0
endif

call "VehiclePathMacro" parameters all A = A,
		wheelBase				= wheelBase,
		wheelDiam				= wheelDiam,
		hsId					= 1000,
		gs_path_move			= gs_path_move,
		gs_path_show_3D			= gs_path_show_3D,
		gs_pathNodes_Num		= gs_pathNodes_Num,
		gs_pathNodes_Num_old	= gs_pathNodes_Num_old,
		gs_pathNodes_Pos		= gs_pathNodes_Pos,
		gs_pathNodes_Angle		= gs_pathNodes_Angle,
		gs_pathNodes_Speed		= gs_pathNodes_Speed,
		gs_path_fps				= gs_path_fps,
		gs_path_start_frame		= gs_path_start_frame,
		gs_path_pen				= gs_path_pen,
		gs_path_line_pen		= gs_path_line_pen,
	returned_parameters wheelAngle, wheelRot,
		posX,posY,posZ,
		dirAngle, riseAngle

add posX,posY,posZ
rotz dirAngle
roty riseAngle

if gs_path_move then
	wheel_angle = wheelAngle
endif

! =============================================================================
! Draw the Car
! =============================================================================

rotz 180
addx -wheelBase

IF gs_shadow=0 THEN SHADOW OFF

	define material	"builtInMatBlackTyre" 0,
		0.1,	0.1,	0.1,
		0.86,	0.81,	0.09,	0,	2.2,	0,
		0.990005,	0.990005,	1,
		0,	0,	0,	0

pen gs_cont_pen

roty -gs_rot_ver
rotx gs_rot_hor

add 1.774376380153, 0, -0.03
mul 5.83946/2.419301, 5.83946/2.419301, 1.87198/0.760392
rotz -90
for ii = -1 to 1 step 2
	mulx ii

	call "cp_truckBody" parameters 	body_mat = gs_carbody_mat,
									bWholeParts = (ii=1)

	call "cp_truckBodyAccessory" parameters gs_detlevel_3D_m = gs_detlevel_3D_m,
											body_mat = gs_carbody_mat,
											access_mat = gs_access_mat,
											plastic_mat = gs_access_mat2,
											bWholeParts = (ii=1)

	call "cp_truckDoor" parameters 	door_mat = gs_carbody_mat,
									door_mat2 = gs_doora_mat,
									frame_mat = gs_frame_mat,
									bWholeParts = (ii=1)

	call "cp_truckLights" parameters frontlight_mat = gs_lamp_mat,
									 rearlight_mat = gs_blamp_mat,
									 lampin_mat = gs_lampin_mat

	mulx 1-2*(wheel)
	call "cp_truckGlass" parameters gs_detlevel_3D_m = gs_detlevel_3D_m,
									bInsideMirror = ((ii = -1) and interior),
									glass_mat = gs_glass_mat,
									mirror_mat = gs_mirror_mat,
									bWholeParts = (ii=1)
	del 1

	if gs_detlevel_3D_m = 2 and interior then
		mulx 1-2*(wheel)
		call "cp_truckInterior" parameters 	bBoard = (ii = -1),
											interior_mat = gs_int_mat1
		del 1
	endif

	del 1
next ii
del 2

if gs_detlevel_3D_m = 2 and interior then
	material gs_int_mat2
	add 0.95, 0.42, 0.55
	gosub 10
	addy -0.82
	gosub 10
	del 2

	add -0.23, 0, 0.55
	gosub 15
	del 1
endif

if gs_detlevel_3D_m = 2 and interior then
	muly -1+2*(wheel)
	add 0.874, 0.392, 1.241
	mulx -1
	gosub 20
	del 3
endif
del 1

wheelRotAngle = -wheelRot
addy -0.89
rotz -90
gosub 30
del 2
wheelRotAngle = wheelRot
addy 0.89
rotz 90
gosub 30
del 2

wheelRotAngle = -wheelRot
add 3.74, -0.89, 0
rotz -90+wheel_angle
gosub 30
del 2

wheelRotAngle = wheelRot
add 3.74, 0.89, 0
rotz 90+wheel_angle
gosub 30
del 2

del 2


end

10:								 ! --- seat
	rotx 90
	addz -0.27
	prism_ 21, 0.54,
		-0.5810918882448, 0.1925921708208, 15,
		-0.5949256670997, 0.1650432135004, 79,
		-0.5964270265746, 0, 15,
		0, 0, 15,
		-0.007869990993243, 0.1640784626205, 15,
		0.0299394998142, 0.1771087980673, 79,
		0.04512669931283, 0.2679423546398, 79,
		0.03097744757889, 0.2904472494997, 79,
		-0.1001830061976, 0.3285314235639, 79,
		-0.2511234682497, 0.3247663437017, 79,
		-0.4372149334691, 0.2839213490832, 15,
		-0.4268913105562, 0.3308766846311, 79,
		-0.4377384656808, 0.4297647484718, 79,
		-0.4883681777174, 0.5662454416406, 79,
		-0.7011283429966, 0.8721613097192, 79,
		-0.7136312943863, 0.8779762272354, 79,
		-0.7864666436131, 0.8816932600678, 79,
		-0.7990759172721, 0.86947235359, 79,
		-0.7985258515828, 0.8415677534219, 79,
		-0.7386468519543, 0.635367134741, 79,
		-0.5810918882448, 0.1925921708208, -1
	del 1

	addz -0.12
	prism_ 10, 0.24,
		-0.7789393300534, 1.045451437377, 15,
		-0.8011498401946, 0.8895010340322, 15,
		-0.7864666436131, 0.8816932600678, 15,
		-0.7136312943863, 0.8779762272354, 15,
		-0.6830348920783, 0.9059155180874, 79,
		-0.6817483914816, 0.9983978175855, 79,
		-0.6939544581182, 1.024340916987, 79,
		-0.7183665913914, 1.043553286291, 79,
		-0.7190086348412, 1.043710845445, 79,
		-0.7789393300534, 1.045451437377, -1
	del 2
return

15:								 ! --- back seat
	rotx 90
	addz -0.75
	prism_ 18, 1.50,
		-0.5055133731318, 0.9044308285254, 79,
		-0.5728800547316, 0.9055922958106, 15,
		-0.6006970394856, 0.7755613030141, 79,
		-0.5874935537264, 0.3502515368126, 79,
		-0.5821347893064, 0, 15,
		0, 0, 15,
		0, 0.1762468729765, 15,
		0.03079911576777, 0.1888371075708, 79,
		0.06190201762248, 0.3473563873634, 79,
		0.0557859559595, 0.3723233856705, 79,
		-0.06576380728202, 0.3897197732326, 79,
		-0.2327628720125, 0.3782383867263, 79,
		-0.3681433186533, 0.3393908542413, 15,
		-0.353507335451, 0.4499520150396, 79,
		-0.3691867123289, 0.5834784740765, 79,
		-0.4857083436653, 0.8896225826976, 79,
		-0.5017332889429, 0.9043656561878, 79,
		-0.5055133731318, 0.9044308285254, -1
	del 2
return

20:								 ! --- wheel
	material gs_int_mat1
	rotz -90
	rotx 18
	resol 12
	addx -0.20
	elbow 0.20, 360, 0.0175
	del 1

	mul 0.20/0.25, 1, 0.20/0.25
	rotx 90
	addz -0.015
	prism_ 13, 0.03,
		-0.09443650813896, -0.09443650813896, 79,
		-0.04674650284752, -0.1658096448797, 79,
		-0.03, -0.25, 15,
		0.03, -0.25, 15,
		0.04674650284752, -0.1658096448797, 79,
		0.09443650813896, -0.09443650813896, 79,
		0.1658096448797, -0.04674650284752, 79,
		0.25, -0.03, 15,
		0.25, 0.03, 15,
		-0.25, 0.03, 15,
		-0.25, -0.03, 15,
		-0.1658096448797, -0.04674650284752, 79,
		-0.09443650813896, -0.09443650813896, -1
	del 3

	resol 10
	addy 0.02
	rotz -90
	addz -0.003
	mul 1, 0.9, 0.20/0.25
	revolve 4, 360, 1+16+32,
		-0.01, 0.05, 1,
		0, 0.10, 1,
		0.013, 0.12, 1,
		0.42, 0.12, 1
	del 6
return

30:								 ! --- tire
	add -0.10, 0, 0.41
	rotx wheelRotAngle
	if gs_detlevel_3D_m = 2 then
		resol 24
		material "builtInMatBlackTyre"
		revolve 8, 360, 0,
			-0.123, 0.26, 1,
			-0.13, 0.325, 1,
			-0.13, 0.40, 1,
			-0.12, 0.41, 1,
			0.12, 0.41, 1,
			0.13, 0.40, 1,
			0.13, 0.325, 1,
			0.123, 0.26, 1

		material gs_wheel_mat
		roty -90
		addz -0.123
		prism_ 4, 0.246,
			0, 0, 979,
			0.26, 360, 4079,
			0, 0, 979,
			0.245, 360, 4079
		del 2


		roty -90
		addz -0.113
		for i = 1 to 5
			rotz 72*i
			cutpolya 11, 2, 0,
				-0.1963891171949, -0.07437280852172, 15,
				-0.111342713171, -0.03654829631123, 79,
				-0.09405513831496, -0.02179224261898, 79,
				-0.0875976212528, 0, 79,
				-0.09405513831496, 0.02179224261897, 79,
				-0.111342713171, 0.03654829631123, 79,
				-0.1963891171949, 0.07437280852176, 15,
				-0.2065692554701, 0.03780400368399, 79,
				-0.21, 0, 79,
				-0.2065692554701, -0.03780400368394, 79,
				-0.1963891171949, -0.07437280852172, -1
			del 1
		next i

		prism_ 2, 0.06,
			0, 0, 979,
			0.245, 360, 4079

		for i = 1 to 5
			cutend
		next i
		del 2

		addx 0.0425
		roty -90
		cylind 0.08, 0.15
		del 2
	else
		resol 12
		material "builtInMatBlackTyre"
		revolve 6, 360, 0,
			-0.123, 0.26, 1,
			-0.13, 0.325, 1,
			-0.13, 0.41, 1,
			0.13, 0.41, 1,
			0.13, 0.325, 1,
			0.123, 0.26, 1

		material gs_wheel_mat
		roty -90
		addz -0.123
		prism_ 4, 0.246,
			0, 0, 979,
			0.26, 360, 4079,
			0, 0, 979,
			0.245, 360, 4079
		del 1
		addz -0.113
		prism_ 2, 0.22,
			0, 0, 979,
			0.245, 360, 4079
		del 2
	endif
	del 2
return
