
!! Stairs Spiral.gsm


if gs_detlevel_3D_m = DLEV3D_OFF then END

IF gs_shadow=0 THEN SHADOW OFF

pen gs_cont_pen

resol gs_resol

MATERIAL bmat
SECT_FILL typeFillStringer, penBackFillStringer, penFillStringer, penLineStringer

IF topTreadLevel_m = TOPTREAD_ATFLOOR AND firstTreadLevel_m = FIRSTTREAD_ATFLOOR THEN

	zz2=zzyzx+ust-treadThickness
	nRisers2ndRun=nRisers+1
	tth2=treadThickness
	fth2=ust-treadThickness
addz -ust
ENDIF


IF topTreadLevel_m = TOPTREAD_BELOWFLOOR AND firstTreadLevel_m = FIRSTTREAD_ABOVEFLOOR THEN

	zz2=zzyzx+ust-rth-treadThickness
	nRisers2ndRun=nRisers-1
	tth2=treadThickness-rth
	fth2=ust+rth-treadThickness
addz -ust
ENDIF

IF topTreadLevel_m = TOPTREAD_BELOWFLOOR AND firstTreadLevel_m = FIRSTTREAD_ATFLOOR THEN

	zz2=zzyzx+ust-rth-treadThickness
	nRisers2ndRun=nRisers
	tth2=treadThickness
	fth2=ust-treadThickness
addz -ust

ENDIF
IF topTreadLevel_m = TOPTREAD_ATFLOOR AND firstTreadLevel_m = FIRSTTREAD_ABOVEFLOOR THEN

	zz2=zzyzx+ust-treadThickness
	nRisers2ndRun=nRisers
	tth2=treadThickness-rth
fth2=ust+rth-treadThickness
addz -ust
ENDIF


IF stairBaseType_m = 1 THEN		! Concrete
	ADDZ 0!-tth2

	CALL "Spiral_Stair" PARAMETERS zz=zz2,rnu=nRisers2ndRun,fth=fth2,
	angle=angle,r1=swelldia/2,r2=a/2,sbw=stairSlabThk

	DEL 2
ENDIF
IF topTreadLevel_m = TOPTREAD_ATFLOOR AND firstTreadLevel_m = FIRSTTREAD_ATFLOOR THEN
	MATERIAL trmat
	SECT_FILL typeFillTread, penBackFillTread, penFillTread, penLineTread

	dalf=angle/(nRisers+1)
	X1=swelldia/2
	Y1=0

	X2=X1*COS(dalf)
	Y2=X1*SIN(dalf)

	X11=Len/2
	Y11=0

	X12=X11*COS(dalf)
	Y12=X11*SIN(dalf)

	FOR K=0 TO nRisers
		ADDZ -treadThickness
		IF ABS(treadThickness)>EPS THEN   			!!!treadThickness#0
			base
			PRISM 6,treadThickness,
				X1-nosing*SIN(dalf/2),Y1-nosing*COS(dalf),
				X1,Y1,
				X2,Y2,
				X12,Y12,
				X11,Y11,
				X11-nosing*SIN(dalf/2),Y11-nosing*COS(dalf)
			vert 0, 0, 0 !#1
			vert 1*COS(dalf), 0, 0 !#2
			vert 0, 1*SIN(dalf), 0 !#3
			vert 0, 0, 1 !#4
			coor 2, -1, -2,-3, -4
			body -1

	   ENDIF
		ADDZ (Hei)/(nRisers)+treadThickness
		ROTZ dalf
	NEXT K
	DEL (nRisers)*3+3

!!!!!!!!!!!!!!!!!!!!! *** Rail Bar *** !!!!!!!!!!!!!!!!!!!!!!

	IF rightRailType_m = RAIL_BALUSTRADE THEN
		SECT_FILL SYMB_FILL, SYMB_FBGD_PEN, SYMB_FILL_PEN, SYMB_SECT_PEN

		if iShowRailingOn = 1 or iShowRailingOn = 2 then ! both or right
		MATERIAL matPost

			atlo=SIN(dalf/2)*Len
			bet=ATN(rth/atlo)
			kmagp=rth/2+nosing*TAN(bet)

				FOR k=1 TO nRisers+1
					kr=COS(dalf/2)*Len/2-rightRailBalustDiam/2
					xr=COS(dalf/2)*kr!(Len/2-rightRailBalustDiam)*COS(dalf/2)
					yr=SIN(dalf/2)*kr!(Len/2-rightRailBalustDiam)*SIN(dalf/2)

					PRISM_ 2,rightRailHeight+kmagp,
						xr,yr,979,
						rightRailBalustDiam/2*0.8,360,4079

					ADDZ rth
					ROTZ dalf
				NEXT K

			DEL (nRisers+1)*2

!!!!!!!!!!!!!!!!!!!!! *** Rail Frame *** !!!!!!!!!!!!!!!!!!!!!!

				ADD -Len/2,-Len/2,0
				FOR I=-3 TO (nRisers)*4+3
					ialfa=angle/4/(nRisers+1)*(i+2)
					X=Len/2 + kr*COS(ialfa)!(Len/2-rightRailBalustDiam)*COS(ialfa*i)
					Y=Len/2 + kr*SIN(ialfa)!(Len/2-rightRailBalustDiam)*SIN(ialfa*i)
					Z=rth*i/4+rightRailHeight+kmagp
					put X,Y,Z,0
				NEXT I

				MATERIAL matHandrail

				TUBE 2,nsp/4+0,51,
					0.0,0,901,
					rightRailBalustDiam/2,360,4001,
					get(nsp)

			DEL 1
		ENDIF

		if iShowRailingOn = 1 or iShowRailingOn = 3 then ! both or left
			MATERIAL matPost

			atlo=SIN(dalf/2)*Len
			bet=ATN(rth/atlo)
			kmagp=rth/2+nosing*TAN(bet)

				FOR k=1 TO nRisers+1
					kr=COS(dalf/2)*swelldia/2+leftRailBalustDiam/2
					xr=COS(dalf/2)*kr!(swelldia/2+leftRailBalustDiam)*COS(dalf/2)
					yr=SIN(dalf/2)*kr!(swelldia/2+leftRailBalustDiam)*SIN(dalf/2)

					PRISM_ 2,leftRailHeight+kmagp,
						xr,yr,979,
						leftRailBalustDiam/2*0.8,360,4079

					ADDZ rth
					ROTZ dalf
				NEXT K

			DEL (nRisers+1)*2

!!!!!!!!!!!!!!!!!!!!! *** Rail Frame *** !!!!!!!!!!!!!!!!!!!!!!

				ADD -swelldia/2,-swelldia/2,0
				FOR I=-3 TO (nRisers)*4+3
					ialfa=angle/4/(nRisers+1)*(i+2)
					X=swelldia/2 + kr*COS(ialfa)!(Len/2-leftRailBalustDiam)*COS(ialfa*i)
					Y=swelldia/2 + kr*SIN(ialfa)!(Len/2-leftRailBalustDiam)*SIN(ialfa*i)
					Z=rth*i/4+leftRailHeight+kmagp

					put X,Y,Z,0

				NEXT I

				MATERIAL matHandrail

				TUBE 2,nsp/4+0,51,
					0.0,0,901,
					leftRailBalustDiam/2,360,4001,
					get(nsp)

			DEL 1

		ENDIF
	ENDIF
ENDIF
del top

!!!!!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%5
IF topTreadLevel_m = TOPTREAD_BELOWFLOOR AND firstTreadLevel_m = FIRSTTREAD_ABOVEFLOOR THEN

	MATERIAL trmat
	SECT_FILL typeFillTread, penBackFillTread, penFillTread, penLineTread

	dalf=angle/(nRisers-1)

	X1=swelldia/2
	Y1=0

	X2=X1*COS(dalf)
	Y2=X1*SIN(dalf)

	X11=Len/2
	Y11=0

	X12=X11*COS(dalf)
	Y12=X11*SIN(dalf)
	ADDZ rth-treadThickness
	FOR K=1 TO nRisers-1

	IF ABS(treadThickness)>EPS THEN   		!!treadThickness<>0
		PRISM 6,treadThickness,
			X1-nosing*SIN(dalf/2),Y1-nosing*COS(dalf),
			X1,Y1,
			X2,Y2,
			X12,Y12,
			X11,Y11,
			X11-nosing*SIN(dalf/2),Y11-nosing*COS(dalf)
	ENDIF

		ADDZ rth
		ROTZ dalf
	NEXT K
	DEL (nRisers-1)*2+1

!!!!!!!!!!!!!!!!!!!!! *** Rail Bar *** !!!!!!!!!!!!!!!!!!!!!!

	IF rightRailType_m = RAIL_BALUSTRADE THEN
		SECT_FILL SYMB_FILL, SYMB_FBGD_PEN, SYMB_FILL_PEN, SYMB_SECT_PEN

		if iShowRailingOn = 1 or iShowRailingOn = 2 then ! both or right
			MATERIAL matPost
			addz 0!rth
			atlo=SIN(dalf/2)*Len
			bet=ATN(rth/atlo)
			kmagp=rth/2+nosing*TAN(bet)
			rotz -dalf
				FOR k=0 TO nRisers
					kr=COS(dalf/2)*Len/2-rightRailBalustDiam/2
					xr=COS(dalf/2)*kr!(Len/2-rightRailBalustDiam)*COS(dalf/2)
					yr=SIN(dalf/2)*kr!(Len/2-rightRailBalustDiam)*SIN(dalf/2)

					PRISM_ 2,rightRailHeight+kmagp,
						xr,yr,979,
						rightRailBalustDiam/2*0.8,360,4079

					ADDZ rth
					ROTZ dalf
				NEXT K

			DEL (nRisers)*2

!!!!!!!!!!!!!!!!!!!!! *** Rail Frame *** !!!!!!!!!!!!!!!!!!!!!!
			rotz dalf/2

				ADD -Len/2,-Len/2,0
				FOR I=-2 TO (nRisers+1)*4
					ialfa=angle/4/(nRisers-1)*(i-5)

					X=Len/2 + kr*COS(ialfa)!(Len/2-rightRailBalustDiam)*COS(ialfa*i)
					Y=Len/2 + kr*SIN(ialfa)!(Len/2-rightRailBalustDiam)*SIN(ialfa*i)
					Z=rth*(i-5)/4+rightRailHeight+kmagp
					put X,Y,Z,0
				NEXT I

				MATERIAL matHandrail

				TUBE 2,nsp/4+0,51,
					0.0,0,901,
					rightRailBalustDiam/2,360,4001,
					get(nsp)
			DEL 5
		ENDIF

		if iShowRailingOn = 1 or iShowRailingOn = 3 then ! both or left
			MATERIAL matPost
			atlo=SIN(dalf/2)*swelldia
			bet=ATN(rth/atlo)
			kmagp=rth/2+nosing*TAN(bet)
			rotz -dalf
				FOR k=0 TO nRisers
					kr=COS(dalf/2)*swelldia/2+leftRailBalustDiam/2
					xr=COS(dalf/2)*kr!(swelldia/2+leftRailBalustDiam)*COS(dalf/2)
					yr=SIN(dalf/2)*kr!(swelldia/2+leftRailBalustDiam)*SIN(dalf/2)

					PRISM_ 2,leftRailHeight+kmagp,
						xr,yr,979,
						leftRailBalustDiam/2*0.8,360,4079

					ADDZ rth
					ROTZ dalf
				NEXT K

			DEL (nRisers)*2

!!!!!!!!!!!!!!!!!!!!! *** Rail Frame *** !!!!!!!!!!!!!!!!!!!!!!
			rotz dalf/2

				ADD -swelldia/2,-swelldia/2,0
				FOR I=-2 TO (nRisers+1)*4
					ialfa=angle/4/(nRisers-1)*(i-5)

					X=swelldia/2 + kr*COS(ialfa)!(Len/2-leftRailBalustDiam)*COS(ialfa*i)
					Y=swelldia/2 + kr*SIN(ialfa)!(Len/2-leftRailBalustDiam)*SIN(ialfa*i)
					Z=rth*(i-5)/4+leftRailHeight+kmagp
					put X,Y,Z,0
				NEXT I

				MATERIAL matHandrail

				TUBE 2,nsp/4+0,51,
					0.0,0,901,
					leftRailBalustDiam/2,360,4001,
					get(nsp)
					!Len/2+(kr)*COS(angle),Len/2 +(kr)*SIN(angle),Hei+leftRailHeight+kmagp+rth/2,0,
					!Len/2+(kr)*COS(angle+dalf),Len/2 +(kr)*SIN(angle+dalf),Hei+leftRailHeight+kmagp+rth/2,0

			DEL 1

		ENDIF
	ENDIF
ENDIF

del top

!!!!!!!!!!!!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
IF topTreadLevel_m = TOPTREAD_BELOWFLOOR AND firstTreadLevel_m = FIRSTTREAD_ATFLOOR THEN

	MATERIAL trmat
	SECT_FILL typeFillTread, penBackFillTread, penFillTread, penLineTread

	dalf=angle/(nRisers)
	X1=swelldia/2
	Y1=0

	X2=X1*COS(dalf)
	Y2=X1*SIN(dalf)

	X11=Len/2
	Y11=0

	X12=X11*COS(dalf)
	Y12=X11*SIN(dalf)

	FOR K=1 TO nRisers
	ADDZ -treadThickness
	IF ABS(treadThickness)>EPS THEN   		!!treadThickness<>0
		PRISM 6,treadThickness,
			X1-nosing*SIN(dalf/2),Y1-nosing*COS(dalf),
			X1,Y1,
			X2,Y2,
			X12,Y12,
			X11,Y11,
			X11-nosing*SIN(dalf/2),Y11-nosing*COS(dalf)
	ENDIF

		ADDZ (Hei)/(nRisers)+treadThickness
		ROTZ dalf
	NEXT K
	DEL (nRisers)*3

!!!!!!!!!!!!!!!!!!!!! *** Rail Bar *** !!!!!!!!!!!!!!!!!!!!!!

	IF rightRailType_m = RAIL_BALUSTRADE THEN
	MATERIAL matPost

		if iShowRailingOn = 1 or iShowRailingOn = 2 then ! both or right
			MATERIAL matPost
			atlo=SIN(dalf/2)*Len
			bet=ATN(rth/atlo)
			kmagp=rth/2+nosing*TAN(bet)

				FOR k=0 TO nRisers
					kr=COS(dalf/2)*Len/2-rightRailBalustDiam/2
					xr=COS(dalf/2)*kr!(Len/2-rightRailBalustDiam)*COS(dalf/2)
					yr=SIN(dalf/2)*kr!(Len/2-rightRailBalustDiam)*SIN(dalf/2)

					PRISM_ 2,rightRailHeight+kmagp,
						xr,yr,979,
						rightRailBalustDiam/2*0.8,360,4079

					ADDZ rth
					ROTZ dalf
				NEXT K

			DEL (nRisers)*2

!!!!!!!!!!!!!!!!!!!!! *** Rail Frame *** !!!!!!!!!!!!!!!!!!!!!!
			rotz dalf/2

				ADD -Len/2,-Len/2,0
				FOR I=-2 TO (nRisers+1)*4
					ialfa=angle/4/(nRisers)*(i-5)

					X=Len/2 + kr*COS(ialfa)!(Len/2-rightRailBalustDiam)*COS(ialfa*i)
					Y=Len/2 + kr*SIN(ialfa)!(Len/2-rightRailBalustDiam)*SIN(ialfa*i)
					Z=rth*(i-5)/4+rightRailHeight+kmagp
					put X,Y,Z,0
				NEXT I
				MATERIAL matHandrail

				TUBE 2,nsp/4+0,51,
					0.0,0,901,
					rightRailBalustDiam/2,360,4001,
					get(nsp)

			DEL 4

		ENDIF
		if iShowRailingOn = 1 or iShowRailingOn = 3 then ! both or left
			MATERIAL matPost

			atlo=SIN(dalf/2)*swelldia
			bet=ATN(rth/atlo)
			kmagp=rth/2+nosing*TAN(bet)

				FOR k=0 TO nRisers
					kr=COS(dalf/2)*swelldia/2+leftRailBalustDiam/2
					xr=COS(dalf/2)*kr!(swelldia/2+leftRailBalustDiam)*COS(dalf/2)
					yr=SIN(dalf/2)*kr!(swelldia/2+leftRailBalustDiam)*SIN(dalf/2)

					PRISM_ 2,leftRailHeight+kmagp,
						xr,yr,979,
						leftRailBalustDiam/2*0.8,360,4079

					ADDZ rth
					ROTZ dalf
				NEXT K

				DEL (nRisers)*2

!!!!!!!!!!!!!!!!!!!!! *** Rail Frame *** !!!!!!!!!!!!!!!!!!!!!!

				rotz dalf/2

				ADD -swelldia/2,-swelldia/2,0
				FOR I=-2 TO (nRisers+1)*4
					ialfa=angle/4/(nRisers)*(i-5)
					X=swelldia/2 + kr*COS(ialfa)!(Len/2-leftRailBalustDiam)*COS(ialfa*i)
					Y=swelldia/2 + kr*SIN(ialfa)!(Len/2-leftRailBalustDiam)*SIN(ialfa*i)
					Z=rth*(i-5)/4+leftRailHeight+kmagp
					put X,Y,Z,0
				NEXT I

				MATERIAL matHandrail

				TUBE 2,nsp/4+0,51,
					0.0,0,901,
					leftRailBalustDiam/2,360,4001,
					get(nsp)

			DEL 1
		ENDIF
	ENDIF
ENDIF


!!!!!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%5
IF topTreadLevel_m = TOPTREAD_ATFLOOR AND firstTreadLevel_m = FIRSTTREAD_ABOVEFLOOR THEN

	MATERIAL trmat
	SECT_FILL typeFillTread, penBackFillTread, penFillTread, penLineTread

	dalf=angle/(nRisers)

	X1=swelldia/2
	Y1=0

	X2=X1*COS(dalf)
	Y2=X1*SIN(dalf)

	X11=Len/2
	Y11=0

	X12=X11*COS(dalf)
	Y12=X11*SIN(dalf)
	ADDZ rth-treadThickness
	FOR K=1 TO nRisers

	IF ABS(treadThickness)>EPS THEN   		!!!treadThickness<>0
		PRISM 6,treadThickness,
			X1-nosing*SIN(dalf/2),Y1-nosing*COS(dalf),
			X1,Y1,
			X2,Y2,
			X12,Y12,
			X11,Y11,
			X11-nosing*SIN(dalf/2),Y11-nosing*COS(dalf)
	ENDIF

		ADDZ rth
		ROTZ dalf
	NEXT K
	DEL nRisers*2+1

!!!!!!!!!!!!!!!!!!!!! *** Rail Bar *** !!!!!!!!!!!!!!!!!!!!!!

	IF rightRailType_m = RAIL_BALUSTRADE THEN
		MATERIAL matPost

		if iShowRailingOn = 1 or iShowRailingOn = 2 then ! both or right
			MATERIAL matPost
			addz 0!rth
			atlo=SIN(dalf/2)*Len
			bet=ATN(rth/atlo)
			kmagp=rth/2+nosing*TAN(bet)
			rotz -dalf
				FOR k=0 TO nRisers
					kr=COS(dalf/2)*Len/2-rightRailBalustDiam/2
					xr=COS(dalf/2)*kr!(Len/2-rightRailBalustDiam)*COS(dalf/2)
					yr=SIN(dalf/2)*kr!(Len/2-rightRailBalustDiam)*SIN(dalf/2)

					PRISM_ 2,rightRailHeight+kmagp,
						xr,yr,979,
						rightRailBalustDiam/2*0.8,360,4079

					ADDZ rth
					ROTZ dalf
				NEXT K

			DEL (nRisers)*2

!!!!!!!!!!!!!!!!!!!!! *** Rail Frame *** !!!!!!!!!!!!!!!!!!!!!!
			rotz dalf/2

				ADD -Len/2,-Len/2,0
				FOR I=-2 TO (nRisers+1)*4
					ialfa=angle/4/(nRisers)*(i-5)

					X=Len/2 + kr*COS(ialfa)!(Len/2-rightRailBalustDiam)*COS(ialfa*i)
					Y=Len/2 + kr*SIN(ialfa)!(Len/2-rightRailBalustDiam)*SIN(ialfa*i)
					Z=rth*(i-5)/4+rightRailHeight+kmagp
					put X,Y,Z,0
				NEXT I

				MATERIAL matHandrail

				TUBE 2,nsp/4+0,51,
					0.0,0,901,
					rightRailBalustDiam/2,360,4001,
					get(nsp)

			DEL 5
		ENDIF
		if iShowRailingOn = 1 or iShowRailingOn = 3 then ! both or left

			MATERIAL matPost
			atlo=SIN(dalf/2)*swelldia
			bet=ATN(rth/atlo)
			kmagp=rth/2+nosing*TAN(bet)
			rotz -dalf
				FOR k=0 TO nRisers
					kr=COS(dalf/2)*swelldia/2+leftRailBalustDiam/2
					xr=COS(dalf/2)*kr!(swelldia/2+leftRailBalustDiam)*COS(dalf/2)
					yr=SIN(dalf/2)*kr!(swelldia/2+leftRailBalustDiam)*SIN(dalf/2)

					PRISM_ 2,leftRailHeight+kmagp,
						xr,yr,979,
						leftRailBalustDiam/2*0.8,360,4079

					ADDZ rth
					ROTZ dalf
				NEXT K

			DEL (nRisers)*2

!!!!!!!!!!!!!!!!!!!!! *** Rail Frame *** !!!!!!!!!!!!!!!!!!!!!!
			rotz dalf/2

				ADD -swelldia/2,-swelldia/2,0
				FOR I=-2 TO (nRisers+1)*4
					ialfa=angle/4/(nRisers)*(i-5)

					X=swelldia/2 + kr*COS(ialfa)!(Len/2-leftRailBalustDiam)*COS(ialfa*i)
					Y=swelldia/2 + kr*SIN(ialfa)!(Len/2-leftRailBalustDiam)*SIN(ialfa*i)
					Z=rth*(i-5)/4+leftRailHeight+kmagp
					put X,Y,Z,0
				NEXT I

				MATERIAL matHandrail

				TUBE 2,nsp/4+0,51,
					0.0,0,901,
					leftRailBalustDiam/2,360,4001,
					get(nsp)

			DEL 1

		ENDIF
	ENDIF
ENDIF


