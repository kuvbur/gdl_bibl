
IF gs_detlevel_3D_m = DLEV3D_OFF THEN end
IF gs_detlevel_3D_m = DLEV3D_SIMPLE THEN gs_resol = 4

IF (GLOB_CONTEXT > 20 and GLOB_CONTEXT < 40) THEN gs_detlevel_3D_m = DLEV3D_SIMPLE	!!Simple

IF gs_shadow=0 THEN SHADOW OFF

PEN gs_cont_pen
MATERIAL mat_ladder

! ------------------------------------------------------------------------------
! HOTSPOTS
! ------------------------------------------------------------------------------
unID=1
HOTSPOT 0,0,0,unID    		:unID=unID+1


! ------------------------------------------------------------------------------
! EDITABLE HOTSPOTS
! ------------------------------------------------------------------------------

HOTSPOT 0,0,0,unID,b_temp,1+128,b    :unID=unID+1
HOTSPOT 0,-0.1,0,unID,b_temp,3,b     :unID=unID+1
HOTSPOT 0,b_temp,0,unID,b_temp,2,b   :unID=unID+1

HOTSPOT 0,0,0,unID,b_temp,1+128,b    :unID=unID+1
HOTSPOT 0,0.1,0,unID,b_temp,3,b     :unID=unID+1
HOTSPOT 0,-b_temp,0,unID,b_temp,2,b :unID=unID+1

HOTSPOT 0,0,zzyzx,unID,a,1+128      :unID=unID+1
HOTSPOT -0.1,0,zzyzx,unID,a,3       :unID=unID+1
HOTSPOT a,0,zzyzx,unID,a,2          :unID=unID+1

HOTSPOT a-st_w/2,0,0,unID,zzyzx,1+128      :unID=unID+1
HOTSPOT a-st_w/2,0,-0.1,unID,zzyzx,3       :unID=unID+1
HOTSPOT a-st_w/2,0,zzyzx,unID,zzyzx,2          :unID=unID+1

HOTSPOT a,0,zzyzx,unID,b_temp,1+128,b    :unID=unID+1
HOTSPOT a,-0.1,zzyzx,unID,b_temp,3,b     :unID=unID+1
HOTSPOT a,b_temp,zzyzx,unID,b_temp,2,b   :unID=unID+1

HOTSPOT a,0,zzyzx,unID,b_temp,1+128,b    :unID=unID+1
HOTSPOT a,0.1,zzyzx,unID,b_temp,3,b     :unID=unID+1
HOTSPOT a,-b_temp,zzyzx,unID,b_temp,2,b   :unID=unID+1

HOTSPOT 2",b/2+hr_d/2,0,unID,hr_h,1+128    :unID=unID+1
HOTSPOT 2",b/2+hr_d/2,-0.1,unID,hr_h,3     :unID=unID+1
HOTSPOT 2",b/2+hr_d/2,hr_h,unID,hr_h,2   :unID=unID+1

HOTSPOT 2",-b/2-hr_d/2,0,unID,hr_h,1+128    :unID=unID+1
HOTSPOT 2",-b/2-hr_d/2,-0.1,unID,hr_h,3     :unID=unID+1
HOTSPOT 2",-b/2-hr_d/2,hr_h,unID,hr_h,2   :unID=unID+1

! ------------------------------------------------------------------------------
! SIDE RAILs
! ------------------------------------------------------------------------------
ADDy -b/2
ROTz 90
FOR i=1 to 2

	! --- ACCESSORIES ---
	IF gs_detlevel_3D_m = DLEV3D_DETAILED THEN
	 MULx -1
	 ROTx 90
	 ADDz 1"
	 PRISM_ 6,4",
		0,0,15,
		f_w,0,15,
		f_w,f_t,15,
		f_t,f_t,15,
		f_t,f_d,15,
		0,f_d,15
	 DEL 3
	ENDIF

	 CUTPLANE 180
	ROTx 90
	 CUTPLANE 180
	DEL 1

	ADD 0,-a+st_w+1",zzyzx
	ROTx 90-alfa/2
	 CUTPLANE
	DEL 2

	ADDy -6"
	ROTx 90-alfa
	ADDz -6"*sin(90-alfa)
	 PRISM_ 8,zzyzx/sin(alfa),
		0,0,15,
		sr_d,0,15,
		sr_d,sr_t,15,
		sr_t,sr_t,15,
		sr_t,sr_w-sr_t,15,
		sr_d,sr_w-sr_t,15,
		sr_d,sr_w,15,
		0,sr_w,15
	DEL 3
	 CUTEND
	 CUTEND
	 CUTEND

	ADD 0,-a+st_w+1",zzyzx
	ROTx 90-alfa/2
	 CUTPLANE 180
	DEL 2

	ADD 0,-a+st_w+1",zzyzx-sr_w
	ROTx 90
	 PRISM_ 8,st_w+1",
		0,0,15,
		sr_d,0,15,
		sr_d,sr_t,15,
		sr_t,sr_t,15,
		sr_t,sr_w-sr_t,15,
		sr_d,sr_w-sr_t,15,
		sr_d,sr_w,15,
		0,sr_w,15
	DEL 2
	 CUTEND
	ADDx b
	MULx -1
NEXT i
DEL 4
DEL 2

! ------------------------------------------------------------------------------
! STEPS
! ------------------------------------------------------------------------------

ROTz -90
ADDy a-st_w-(n_st-1)*dX
FOR s=1 TO n_st
  ADD 0,dX*(s-1),dY*s-st_h
  ! --- SIMPLE STEPS ---
  IF gs_detlevel_3D_m = DLEV3D_SIMPLE THEN
	  PRISM_ 5,st_h,
		-b/2+sr_t,0,15,
		-b/2+sr_t,st_w,15,
		b/2-sr_t,st_w,15,
		b/2-sr_t,0,15,
		-b/2+sr_t,0,-1
  ENDIF

  ! --- DETAILED STEPS ---
  IF gs_detlevel_3D_m = DLEV3D_DETAILED THEN
	  PRISM_ 10,st_h,
		-b/2+sr_t,0,15,
		-b/2+sr_t,st_w,15,
		b/2-sr_t,st_w,15,
		b/2-sr_t,0,15,
		-b/2+sr_t,0,-1,

		-b/2+sr_t+st_t,st_t,15,
		-b/2+sr_t+st_t,st_w-st_t,15,
		b/2-sr_t-st_t,st_w-st_t,15,
		b/2-sr_t-st_t,st_t,15,
		-b/2+sr_t+st_t,st_t,-1

	  ROTx 90
	  FOR p=1 to npY-1
		ADDz -st_t-p*dpY
		 POLY 4,
			-b/2+sr_t+st_t,0,
			-b/2+sr_t+st_t,st_h,
			b/2-sr_t-st_t,st_h,
			b/2-sr_t-st_t,0
		DEL 1
	  NEXT p
	  DEL 1

	  ROTz 90
	  ROTx 90
	  ADDz -b/2+sr_t
	  FOR p=1 to npX-1
		ADDz st_t+p*dpX
		 POLY 4,
			st_t,0,
			st_t,st_h,
			st_w-st_t,st_h,
			st_w-st_t,0
		DEL 1
	  NEXT p
	  DEL 3
  ENDIF

  DEL 1
NEXT s
DEL 2

! ------------------------------------------------------------------------------
! HANDRAIL
! ------------------------------------------------------------------------------

RESOL gs_resol

! --- Accessories (only in detailed mode) ---
IF gs_detlevel_3D_m = DLEV3D_DETAILED THEN
	IF iHandrailPos = HANDRAILPOS_LEFT or iHandrailPos = HANDRAILPOS_BOTH THEN
		ADD 2",b/2,2"
		PRISM_ 12,2",
			-2",0,15,
			-2",f_t,15,
			-hr_d/2-f_t,f_t,15,
			-hr_d/2-f_t,hr_d/2,79,
			hr_d/2+f_t,hr_d/2,1079,
			hr_d/2+f_t,f_t,15,
			2",f_t,15,
			2",0,15,
			hr_d/2,0,15,
			hr_d/2,hr_d/2,79,
			-hr_d/2,hr_d/2,1079,
			-hr_d/2,0,15
		DEL 1
	ENDIF

	IF iHandrailPos = HANDRAILPOS_RIGHT or iHandrailPos = HANDRAILPOS_BOTH THEN
		ADD 2",-b/2,2"
		MULy -1
		PRISM_ 12,2",
			-2",0,15,
			-2",f_t,15,
			-hr_d/2-f_t,f_t,15,
			-hr_d/2-f_t,hr_d/2,79,
			hr_d/2+f_t,hr_d/2,1079,
			hr_d/2+f_t,f_t,15,
			2",f_t,15,
			2",0,15,
			hr_d/2,0,15,
			hr_d/2,hr_d/2,79,
			-hr_d/2,hr_d/2,1079,
			-hr_d/2,0,15
		DEL 2
	ENDIF
ENDIF

! --- To Wall ---
IF iTopConnType = TOPCONNTYPE_WALL THEN
   IF iHandrailPos = HANDRAILPOS_LEFT or iHandrailPos = HANDRAILPOS_BOTH THEN
	ADD 2",b/2+hr_d/2,0
	TUBE 2,8,1+2+16+32,
		0,0,901,
		hr_d/2,360,4001,

		0,0,0,0,
		0,0,2",0,
		0,0,min(hr_h, zzyzx - 2"),0,
		(zzyzx-hr_h-2")/tan(alfa),0,zzyzx-2",0,
		(zzyzx-hr_h-2")/tan(alfa),max(-b/2+door_w/2+6",0),zzyzx-2",0,
		a-sr_w+2",max(-b/2+door_w/2+6",0),zzyzx+hr_h,0,
		a-2",max(-b/2+door_w/2+6",0),zzyzx+hr_h,0,
		a+0.1,max(-b/2+door_w/2+6",0),zzyzx+hr_h,0
	DEL 1
   ENDIF

   IF iHandrailPos = HANDRAILPOS_RIGHT or iHandrailPos = HANDRAILPOS_BOTH THEN
	ADD 2",-b/2-hr_d/2,0
	TUBE 2,8,1+2+16+32,
		0,0,901,
		hr_d/2,360,4001,

		0,0,0,0,
		0,0,2",0,
		0,0,min(hr_h, zzyzx - 2"),0,
		(zzyzx-hr_h-2")/tan(alfa),0,zzyzx-2",0,
		(zzyzx-hr_h-2")/tan(alfa),-max(-b/2+door_w/2+6",0),zzyzx-2",0,
		a-sr_w+2",-max(-b/2+door_w/2+6",0),zzyzx+hr_h,0,
		a-2",-max(-b/2+door_w/2+6",0),zzyzx+hr_h,0,
		a+0.1,-max(-b/2+door_w/2+6",0),zzyzx+hr_h,0
	DEL 1
   ENDIF
ENDIF


! --- Back to stringer ---
IF iTopConnType = TOPCONNTYPE_STRINGER THEN
   IF iHandrailPos = HANDRAILPOS_LEFT or iHandrailPos = HANDRAILPOS_BOTH THEN
	ADD 2",b/2+hr_d/2,0
	muly -1
	TUBE 2,9,1+2+16+32,
		0,0,901,
		hr_d/2,360,4001,

		0,0,0,0,
		0,0,2",0,
		0,0,min(hr_h, zzyzx - 2"),0,
		(zzyzx-hr_h-2")/tan(alfa),0,zzyzx-2",0,
		(zzyzx-hr_h-2")/tan(alfa),-max(-b/2+door_w/2+6",0),zzyzx-2",0,
		a-sr_w+2",-max(-b/2+door_w/2+6",0),zzyzx+hr_h,0,
		a-4",-max(-b/2+door_w/2+6",0),zzyzx+hr_h,0,
!		a-4",-max(-b/2+door_w/2+6",0),zzyzx-2",0,
		a-4",hr_d/2,zzyzx-2",0,
		a-4",0.1,zzyzx-2",0
	del 1

	DEL 1
   ENDIF

   IF iHandrailPos = HANDRAILPOS_RIGHT or iHandrailPos = HANDRAILPOS_BOTH THEN
	ADD 2",-b/2-hr_d/2,0

	TUBE 2,9,1+2+16+32,
		0,0,901,
		hr_d/2,360,4001,

		0,0,0,0,
		0,0,2",0,
		0,0,min(hr_h, zzyzx - 2"),0,
		(zzyzx-hr_h-2")/tan(alfa),0,zzyzx-2",0,
		(zzyzx-hr_h-2")/tan(alfa),-max(-b/2+door_w/2+6",0),zzyzx-2",0,
		a-sr_w+2",-max(-b/2+door_w/2+6",0),zzyzx+hr_h,0,
		a-4",-max(-b/2+door_w/2+6",0),zzyzx+hr_h,0,
!		a-4",-max(-b/2+door_w/2+6",0),zzyzx-2",0,
		a-4",hr_d/2,zzyzx-2",0,
		a-4",0.1,zzyzx-2",0

	DEL 1
   ENDIF
ENDIF

! --- Accessories ---

IF gs_detlevel_3D_m = DLEV3D_DETAILED THEN


ENDIF
