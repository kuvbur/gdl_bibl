
if gs_detlevel_3d_m = 0 then end
if not (gs_shadow) then shadow off

addx (leftSide_X + rightSide_X) / 2
addy (downSide_Y + upperSide_Y) / 2

unID = 1
r = min (doorWidth, doorHeight) / 4
hotspot 0, 							0, 							0, unID, gs_updirection, 6 : unID = unID +1 !center of angle
hotspot 0, 							r,							0, unID, gs_updirection, 4+128 : unID = unID +1 !base hotspot
hotspot r * sin (gs_updirection), 	r * cos (gs_updirection), 	0, unID, gs_updirection, 5 : unID = unID +1 !moving
hotspot 0, 							0, 							-1, unID, gs_updirection, 7 : unID = unID +1 !center of angle

del 2

! --- Frame ----------------------------------------------------------------------------------
addx (leftSide_X + rightSide_X) / 2
addy (downSide_Y + upperSide_Y) / 2

rotz - gs_updirection

material matFrame
sect_fill fillFrame, fillPenBgFrame, fillPenFrame,  penFrame

addz AC_clampWidth / 2 + offsetGlass + offsetPanel - frameThk

material matFrame

if gs_SashText_typ_m = 1 then
	prism_ 4, frameThk,
	 doorWidth / 2, 				-doorHeight / 2, 				15,
	 doorWidth / 2, 				 doorHeight / 2, 				15,
	 doorWidth / 2 - frameWidth, 	 doorHeight / 2 - frameWidth, 	15,
	 doorWidth / 2 - frameWidth, 	-doorHeight / 2,				15

	gosub "verticalTextureDir"

	prism_ 4, frameThk,
	  doorWidth / 2, 				doorHeight / 2, 				15,
	  doorWidth / 2 - frameWidth, 	doorHeight / 2 - frameWidth, 	15,
	 -doorWidth / 2 + frameWidth, 	doorHeight / 2 - frameWidth, 	15,
	 -doorWidth / 2, 				doorHeight / 2, 				15

	gosub "horizontalTextureDir"

	prism_ 4, frameThk,
	-doorWidth / 2, 				 doorHeight / 2, 				15,
	-doorWidth / 2 + frameWidth, 	 doorHeight / 2 - frameWidth, 	15,
	-doorWidth / 2 + frameWidth, 	-doorHeight / 2,			 	15,
	-doorWidth / 2, 				-doorHeight / 2, 				15

	gosub "verticalTextureDir"
else
	prism_ 4, frameThk,
		 doorWidth / 2, 				-doorHeight / 2, 				15,
		 doorWidth / 2, 				 doorHeight / 2 - frameWidth,	15,
		 doorWidth / 2 - frameWidth, 	 doorHeight / 2 - frameWidth, 	15,
		 doorWidth / 2 - frameWidth, 	-doorHeight / 2,				15

	gosub "verticalTextureDir"

	prism_ 4, frameThk,
		  doorWidth / 2, 				doorHeight / 2, 				15,
		  doorWidth / 2,				doorHeight / 2 - frameWidth, 	15,
		 -doorWidth / 2,				doorHeight / 2 - frameWidth, 	15,
		 -doorWidth / 2, 				doorHeight / 2, 				15

	gosub "horizontalTextureDir"

	prism_ 4, frameThk,
		-doorWidth / 2, 				 doorHeight / 2 - frameWidth,	15,
		-doorWidth / 2 + frameWidth, 	 doorHeight / 2 - frameWidth, 	15,
		-doorWidth / 2 + frameWidth, 	-doorHeight / 2,			 	15,
		-doorWidth / 2, 				-doorHeight / 2, 				15

	gosub "verticalTextureDir"

endif

del 4

! --- clamp ---

addz -AC_clampWidth / 2
material matClamp

if abs (downSide_Y - downClamp_Y) > eps then
	prism_ 4, AC_clampWidth,
			leftClamp_X, 	downClamp_Y, 	15,
			rightClamp_X, 	downClamp_Y, 	15,
			rightSide_X, 	downSide_Y, 	15,
			leftSide_X, 	downSide_Y, 	15
endif

if abs (rightSide_X - rightClamp_X) > eps then
	prism_ 4, AC_clampWidth,
			rightClamp_X, 	downClamp_Y, 	15,
			rightClamp_X, 	upperClamp_Y, 	15,
			rightSide_X, 	upperSide_Y, 	15,
			rightSide_X, 	downSide_Y, 	15
endif

if abs (upperSide_Y - upperClamp_Y) > eps then
	prism_ 4, AC_clampWidth,
			rightClamp_X, 	upperClamp_Y, 	15,
			leftClamp_X, 	upperClamp_Y, 	15,
			leftSide_X, 	upperSide_Y, 	15,
			rightSide_X, 	upperSide_Y, 	15
endif

if abs (leftSide_X - leftClamp_X) > eps then
	prism_ 4, AC_clampWidth,
			leftClamp_X, 	upperClamp_Y, 	15,
			leftClamp_X, 	downClamp_Y, 	15,
			leftSide_X, 	downSide_Y, 	15,
			leftSide_X, 	upperSide_Y, 	15
endif

del 1

! --- Sash ----------------------------------------------------------------------

addz offsetPanel

if abs (gs_updirection) < eps then
	addx (leftSide_X + rightSide_X) / 2 - sash_X / 2
	addy downSide_Y
endif
if abs (gs_updirection - 90) < eps then
	addx leftSide_X
	addy (downSide_Y + upperSide_Y) / 2 + sash_X / 2
endif
if abs (gs_updirection - 180) < eps then
	addx (leftSide_X + rightSide_X) / 2 + sash_X / 2
	addy upperSide_Y
endif
if abs (gs_updirection - 270) < eps then
	addx rightSide_X
	addy (downSide_Y + upperSide_Y) / 2 - sash_X / 2
endif

rotz -gs_updirection

if nPanels = 2 and iFixPanelPosition = 1 then mulX -1


if gs_opening_dir_m = OPDIR_OUT then
	addz AC_ClampWidth / 2 + offsetGlass
	mulz -1
else
	addz AC_ClampWidth / 2 + offsetGlass - 2 * sashThk
endif

sh_unID = 500

if nPanels = 4 then addx doorWidth / 2 - sash_X	- frameWidth
if nPanels = 2 and iFixPanelPosition = 1 then addx -sash_X

call "sashgeometry_1" parameters 	a 					= sash_X,
								b 						= sash_Y,

						! --- Options ------------------------------------------
								gs_opening_dir_m		= gs_opening_dir_m,
								gs_optype_m				= OPTYPE_SLIDINGRIGHT,
								gs_SashText_typ_num		= gs_SashText_typ_m,

						! --- Frame --------------------------------------------
								gs_frame_width			= frameWidth,
								gs_frame_thk			= frameThk,
								gs_rebate_width 		= 0,
								gs_rebate_depth 		= 0,

						! --- Sash ---------------------------------------------
								grill_m					= grill_m,
								gs_sash_thk				= sashThk,
								gs_sash_width			= sashWidth,
								gs_glass_thk			= glassThk,
								nHorPanel_1				= nHorPanel_1,
								nVertPanel_1			= nVertPanel_1,
								grillPosition_m			= grillPosition_m,
								gth						= grillThk,
								grillWidth_hor_1		= grillWidth_hor_1,
								grillWidth_vert_1		= grillWidth_vert_1,
								horgrid_1				= horgrid_1,
								vergrid_1				= vergrid_1,
								glassFromLeft			= glassFromLeft,
								glassFromRight			= glassFromRight,
								glassFromTop			= glassFromTop,
								glassFromBottom			= glassFromBottom,
								gs_cust_panel			= gs_cust_panel,
								gs_handle_typ_m			= gs_handle_typ_m,
								gs_han_pos				= gs_han_pos,
								gs_han_height			= gs_han_height,
								gs_cust_handle			= gs_cust_handle,
								fliphandle				= 1,

						! --- Opening ------------------------------------------
								opWidth3d				= opWidth3d,
								owlen_a					= doorWidth - 2 * frameThk - sashThk,

						! --- 2D Rep -------------------------------------------
								gs_frame_pen_cont		= penFrame,
								gs_fillSash				= fillSash,
								gs_penSash_fg			= fillPenSash,
								gs_penSash_bg			= fillPenBgSash,

						! --- 3D Rep -------------------------------------------
								gs_detlevel_3d_m		= gs_detlevel_3d_m,
								gs_shadow				= gs_shadow,
								gs_resol				= gs_resol,
								gs_frame_pen			= penFrame,
								gs_glass_pen			= penGlass,

						! --- Materials ----------------------------------------
								gs_frame_mat			= matSash,
								gs_frame_mat2			= matSash,
								gs_glass_mat			= matGlass,
								gs_grill_mat			= matGrill,
								gs_grill_mat2			= matGrill,
								matHandle				= matHandle,
								matHandleAcc			= matHandleAcc,

						! --- Others -------------------------------------------
								sh_unID					= sh_unID,
								isWindow				= 0,
								gs_full_edit			= 1,

						! --- MVO Override -------------------------------------------
								or_bOplines3d			= or_bOplines3d,
								or_iOpLineType3dIn		= or_iOpLineType3dIn,
								or_iOpLineType3dOut		= or_iOpLineType3dOut,
								or_iOplineStyle		= or_iOplineStyle,
								or_opLinePen			= or_opLinePen,
								bOverride_MVO_3D			= bOverride_MVO_3D

if nPanels = 4 then
	mulx -1
	addx sash_X
	sh_unID = 1000
	call "sashgeometry_3" parameters 	a 				= sash_X,
								b 						= sash_Y,

						! --- Options ------------------------------------------
								gs_opening_dir_m		= gs_opening_dir_m,
								gs_optype_m				= OPTYPE_SLIDINGRIGHT,
								gs_SashText_typ_num		= gs_SashText_typ_m,

						! --- Frame --------------------------------------------
								gs_frame_width			= frameWidth,
								gs_frame_thk			= frameThk,
								gs_rebate_width 		= 0,
								gs_rebate_depth 		= 0,

						! --- Sash ---------------------------------------------
								grill_m					= grill_m,
								gs_sash_thk				= sashThk,
								gs_sash_width			= sashWidth,
								gs_glass_thk			= glassThk,
								nHorPanel_3				= nHorPanel_3,
								nVertPanel_3			= nVertPanel_3,
								grillPosition_m			= grillPosition_m,
								gth						= grillThk,
								grillWidth_hor_3		= grillWidth_hor_3,
								grillWidth_vert_3		= grillWidth_vert_3,
								horgrid_3				= horgrid_3,
								vergrid_3				= vergrid_3,
								glassFromLeft			= glassFromLeft,
								glassFromRight			= glassFromRight,
								glassFromTop			= glassFromTop,
								glassFromBottom			= glassFromBottom,
								gs_cust_panel			= gs_cust_panel,
								gs_handle_typ_m			= gs_handle_typ_m*b2Handles,
								gs_han_pos				= gs_han_pos,
								gs_han_height			= gs_han_height,
								gs_cust_handle			= gs_cust_handle,
								flipHandle				= 1,

						! --- Opening ------------------------------------------
								opWidth3d				= opWidth3d,
								owlen_a					= doorWidth - 2 * frameThk - sashThk,

						! --- 2D Rep -------------------------------------------
								gs_frame_pen_cont		= penFrame,
								gs_fillSash				= fillSash,
								gs_penSash_fg			= fillPenSash,
								gs_penSash_bg			= fillPenBgSash,

						! --- 3D Rep -------------------------------------------
								gs_detlevel_3d_m		= gs_detlevel_3d_m,
								gs_shadow				= gs_shadow,
								gs_resol				= gs_resol,
								gs_frame_pen			= penFrame,
								gs_glass_pen			= penGlass,

						! --- Materials ----------------------------------------
								gs_frame_mat			= matSash,
								gs_frame_mat2			= matSash,
								gs_glass_mat			= matGlass,
								gs_grill_mat			= matGrill,
								gs_grill_mat2			= matGrill,
								matHandle				= matHandle,
								matHandleAcc			= matHandleAcc,

						! --- Others -------------------------------------------
								sh_unID					= sh_unID,
								isWindow				= 0,
								gs_full_edit			= 1,

						! --- MVO Override -------------------------------------------
								or_bOplines3d			= or_bOplines3d,
								or_iOpLineType3dIn		= or_iOpLineType3dIn,
								or_iOpLineType3dOut		= or_iOpLineType3dOut,
								or_iOplineStyle		= or_iOplineStyle,
								or_opLinePen			= or_opLinePen,
								bOverride_MVO_3D			= bOverride_MVO_3D

	del 2
endif

addx sash_X
addz sashThk

sh_unID = 1500

call "sashgeometry_2" parameters 	a 					= sash_X,
								b 						= sash_Y,

						! --- Options ------------------------------------------
								gs_opening_dir_m		= gs_opening_dir_m,
								gs_optype_m				= 15,
								gs_SashText_typ_num		= gs_SashText_typ_m,

						! --- Frame --------------------------------------------
								gs_frame_width			= frameWidth,
								gs_frame_thk			= frameThk,
								gs_rebate_width 		= 0,
								gs_rebate_depth 		= 0,

						! --- Sash ---------------------------------------------
								grill_m					= grill_m,
								gs_sash_thk				= sashThk,
								gs_sash_width			= sashWidth,
								gs_glass_thk			= glassThk,
								nHorPanel_2				= nHorPanel_2,
								nVertPanel_2			= nVertPanel_2,
								grillPosition_m			= grillPosition_m,
								gth						= grillThk,
								grillWidth_hor_2		= grillWidth_hor_2,
								grillWidth_vert_2		= grillWidth_vert_2,
								horgrid_2				= horgrid_2,
								vergrid_2				= vergrid_2,
								glassFromLeft			= glassFromLeft,
								glassFromRight			= glassFromRight,
								glassFromTop			= glassFromTop,
								glassFromBottom			= glassFromBottom,
								gs_cust_panel			= gs_cust_panel,
								gs_handle_typ_m			= 0,
								flipHandle				= 1,

						! --- Opening ------------------------------------------
								opAngle_horizontal		= 0,
								opAngle_vertical		= 0,

						! --- 2D Rep -------------------------------------------
								gs_frame_pen_cont		= penFrame,
								gs_fillSash				= fillSash,
								gs_penSash_fg			= fillPenSash,
								gs_penSash_bg			= fillPenBgSash,

						! --- 3D Rep -------------------------------------------
								gs_detlevel_3d_m		= gs_detlevel_3d_m,
								gs_shadow				= gs_shadow,
								gs_resol				= gs_resol,
								gs_frame_pen			= penFrame,
								gs_glass_pen			= penGlass,

						! --- Materials ----------------------------------------
								gs_frame_mat			= matSash,
								gs_frame_mat2			= matSash,
								gs_glass_mat			= matGlass,
								gs_grill_mat			= matGrill,
								gs_grill_mat2			= matGrill,

						! --- Others -------------------------------------------
								sh_unID					= sh_unID,
								isWindow				= 0,
								gs_full_edit			= 1,

						! --- MVO Override -------------------------------------------
								or_bOplines3d			= or_bOplines3d,
								or_iOpLineType3dIn		= or_iOpLineType3dIn,
								or_iOpLineType3dOut		= or_iOpLineType3dOut,
								or_iOplineStyle		= or_iOplineStyle,
								or_opLinePen			= or_opLinePen,
								bOverride_MVO_3D			= bOverride_MVO_3D

if nPanels = 4 then
	addx -doorWidth + sash_X + frameWidth *2
	sh_unID = 2000
	call "sashgeometry_4" parameters 	a 				= sash_X,
								b 						= sash_Y,

						! --- Options ------------------------------------------
								gs_opening_dir_m		= gs_opening_dir_m,
								gs_optype_m				= 15,
								gs_SashText_typ_num		= gs_SashText_typ_m,

						! --- Frame --------------------------------------------
								gs_frame_width			= frameWidth,
								gs_frame_thk			= frameThk,
								gs_rebate_width 		= 0,
								gs_rebate_depth 		= 0,

						! --- Sash ---------------------------------------------
								grill_m					= grill_m,
								gs_sash_thk				= sashThk,
								gs_sash_width			= sashWidth,
								gs_glass_thk			= glassThk,
								nHorPanel_4				= nHorPanel_4,
								nVertPanel_4			= nVertPanel_4,
								grillPosition_m			= grillPosition_m,
								gth						= grillThk,
								grillWidth_hor_4		= grillWidth_hor_4,
								grillWidth_vert_4		= grillWidth_vert_4,
								horgrid_4				= horgrid_4,
								vergrid_4				= vergrid_4,
								glassFromLeft			= glassFromLeft,
								glassFromRight			= glassFromRight,
								glassFromTop			= glassFromTop,
								glassFromBottom			= glassFromBottom,
								gs_cust_panel			= gs_cust_panel,
								gs_handle_typ_m			= 0,
								flipHandle				= 1,

						! --- Opening ------------------------------------------
								opAngle_horizontal		= 0,
								opAngle_vertical		= 0,

						! --- 2D Rep -------------------------------------------
								gs_frame_pen_cont		= penFrame,
								gs_fillSash				= fillSash,
								gs_penSash_fg			= fillPenSash,
								gs_penSash_bg			= fillPenBgSash,

						! --- 3D Rep -------------------------------------------
								gs_detlevel_3d_m		= gs_detlevel_3d_m,
								gs_shadow				= gs_shadow,
								gs_resol				= gs_resol,
								gs_frame_pen			= penFrame,
								gs_glass_pen			= penGlass,

						! --- Materials ----------------------------------------
								gs_frame_mat			= matSash,
								gs_frame_mat2			= matSash,
								gs_glass_mat			= matGlass,
								gs_grill_mat			= matGrill,
								gs_grill_mat2			= matGrill,

						! --- Others -------------------------------------------
								sh_unID					= sh_unID,
								isWindow				= 0,
								gs_full_edit			= 1,

						! --- MVO Override -------------------------------------------
								or_bOplines3d			= or_bOplines3d,
								or_iOpLineType3dIn		= or_iOpLineType3dIn,
								or_iOpLineType3dOut		= or_iOpLineType3dOut,
								or_iOplineStyle		= or_iOplineStyle,
								or_opLinePen			= or_opLinePen,
								bOverride_MVO_3D			= bOverride_MVO_3D
	del 1
endif

del 1
if gs_opening_dir_m = OPDIR_IN then
	del 5
else
	del 4
endif

end

!=============================================================================================================================
! end ! end ! end ! end ! end ! end ! end ! end ! end ! end ! end ! end ! end ! end ! end ! end ! end ! end ! end ! end ! end
!=============================================================================================================================


! ---- horizontal texture -------------------------------------------------------------------------------------------------------
"horizontalTextureDir":
	base
	vert 0, 0, 0
	vert 1, 0, 0
	vert 0, 0, 1
	vert 0, 1, 0
	coor 2, -1, -2, -3, -4
	body 1
	base

return

! ---- vertical texture -------------------------------------------------------------------------------------------------------
"verticalTextureDir":
	rotz 90

	gosub "horizontalTextureDir"

	del 1

	return
