
nCorners_in = vardim1 (lModPanelCoords)

leftCF_X  = lModCFRegCoords[1][1]
rightCF_X = lModCFRegCoords[1][1]

leftSide_X  = lModPanelCoords[1][1]
rightSide_X = lModPanelCoords[1][1]

for i = 1 to nCorners_in
	if lModCFRegCoords[i][1] < leftCF_X  then leftCF_X  = lModCFRegCoords[i][1]
	if lModCFRegCoords[i][1] > rightCF_X then rightCF_X = lModCFRegCoords[i][1]

	if lModPanelCoords[i][1] < leftSide_X  then leftSide_X  = lModPanelCoords[i][1]
	if lModPanelCoords[i][1] > rightSide_X then rightSide_X = lModPanelCoords[i][1]
next i

! --- moving and transforming to the correct position ---
if abs (a) < eps then end

if abs (rightSide_X - leftSide_X) > eps & GLOB_CONTEXT <> 5 then
	ddd = a / (rightSide_X - leftSide_X)
	mul2 ddd, 1
else
	ddd = 1
endif
add2 -leftSide_X, 0

! --- setting detail level ---

if gs_detlevel_2d_m = 0 then end

if gs_detlevel_2d_m < 0 then
	if GLOB_SCALE > 150 then gs_detlevel_2d_m = 200
	if GLOB_SCALE <= 150 and GLOB_SCALE > 75 then gs_detlevel_2d_m = 100
	if GLOB_SCALE <= 75 then gs_detlevel_2d_m = 50
endif

pen gs_cont_pen


if gs_detlevel_2d_m = 200 then
	if ABS(leftSide_X - leftCF_X) < EPS OR ABS(rightSide_X - rightCF_X) < EPS then
		if ABS(leftSide_X - leftCF_X) < EPS then
			line2 leftSide_X, 0, rightSide_X-(rightSide_X - rightCF_X)/ddd, 0
		endif

		if ABS(rightSide_X - rightCF_X) < EPS then
			line2 leftSide_X - (leftSide_X -  leftCF_X)/ddd, 0, rightSide_X, 0
		endif
	else
		line2 leftCF_X, 0, rightCF_X, 0
	endif
endif

if gs_detlevel_2d_m = 100 then
	fill internalFill_1

	if sSpecEdgeSetting_m > 0 and NOT(abs(aSpecialEdge1 - 90) < eps OR abs(aSpecialEdge1 - 270) < eps)  then
		if aSpecialEdge1 > 90 AND aSpecialEdge1 < 270 then
			if sSpecEdgeSetting_m > 2 then
				poly2_b 	5, 1+2+64,
							internalFillPen_1, internalFillPenBg_1,

							leftSide_X - lOffset1/ddd,						AC_clampWidth / 2, 1,
							rightSide_X - (rightSide_X - rightCF_X)/ddd,	AC_clampWidth / 2, 1,
							rightSide_X - (rightSide_X - rightCF_X)/ddd,	-panelThk + AC_clampWidth / 2, 1,
							leftSide_X - lOffset1/ddd,						-panelThk + AC_clampWidth / 2, 1, !0
							leftSide_X - lOffset1/ddd,						AC_clampWidth / 2, -1
			else
			poly2_b 	5, 1+2+64,
						internalFillPen_1, internalFillPenBg_1,

						leftSide_X - ((AC_clampWidth / 2)/1*(tan(aMitterAngle1/2)))/ddd,			AC_clampWidth / 2, 1,
						rightSide_X - (rightSide_X - rightCF_X)/ddd,								AC_clampWidth / 2, 1,
						rightSide_X - (rightSide_X - rightCF_X)/ddd,								-panelThk + AC_clampWidth / 2, 1,
							leftSide_X + ((panelThk - AC_clampWidth/2)/1*(tan(aMitterAngle1/2)))/ddd,	-panelThk + AC_clampWidth / 2, 1, !0
						leftSide_X - ((AC_clampWidth / 2)/1*(tan(aMitterAngle1/2)))/ddd,			AC_clampWidth / 2, -1
		endif
		endif

		if aSpecialEdge1 < 90 OR aSpecialEdge1 > 270 then
			if sSpecEdgeSetting_m > 2 then
				poly2_b 	5, 1+2+64,
							internalFillPen_1, internalFillPenBg_1,

							leftSide_X - (leftSide_X -  leftCF_X)/ddd,	AC_clampWidth / 2, 1,
							rightSide_X + lOffset1/ddd,					AC_clampWidth / 2, 1, !0
							rightSide_X + lOffset1/ddd,					-panelThk + AC_clampWidth / 2, 1,
							leftSide_X - (leftSide_X -  leftCF_X)/ddd,	-panelThk + AC_clampWidth / 2, 1,
							leftSide_X - (leftSide_X -  leftCF_X)/ddd,	AC_clampWidth / 2, -1
			else
			poly2_b 	5, 1+2+64,
						internalFillPen_1, internalFillPenBg_1,

						leftSide_X - (leftSide_X -  leftCF_X)/ddd,									AC_clampWidth / 2, 1,
							rightSide_X + ((AC_clampWidth / 2)/tan(90-aMitterAngle1/2))/ddd,			AC_clampWidth / 2, 1, !0
						rightSide_X - ((panelThk - AC_clampWidth/2)/tan(90-aMitterAngle1/2))/ddd,	-panelThk + AC_clampWidth / 2, 1,
						leftSide_X - (leftSide_X -  leftCF_X)/ddd,									-panelThk + AC_clampWidth / 2, 1,
						leftSide_X - (leftSide_X -  leftCF_X)/ddd,									AC_clampWidth / 2, -1
		endif
		endif

	else
			poly2_b 	5, 1+2+64,
						internalFillPen_1, internalFillPenBg_1,

						leftCF_X,	AC_clampWidth / 2, 1,
						rightCF_X,	AC_clampWidth / 2, 1,
						rightCF_X,	-panelThk + AC_clampWidth / 2, 1,
						leftCF_X,	-panelThk + AC_clampWidth / 2, 1,
						leftCF_X,	AC_clampWidth / 2, -1
	endif
endif

if gs_detlevel_2d_m = 50 then
	fill internalFill_1

	if sSpecEdgeSetting_m > 0 and NOT(abs(aSpecialEdge1 - 90) < eps OR abs(aSpecialEdge1 - 270) < eps)  then
		if aSpecialEdge1 > 90 AND aSpecialEdge1 < 270 then
			if sSpecEdgeSetting_m > 2 then
					fill coatingFill
					poly2_b 	5, 1+2+64,
								internalFillPen_1, internalFillPenBg_1,

								leftSide_X - lOffset1/ddd,						AC_clampWidth / 2,				1,
								rightSide_X - (rightSide_X - rightCF_X)/ddd,	AC_clampWidth / 2,				1,
								rightSide_X - (rightSide_X - rightCF_X)/ddd,	AC_clampWidth / 2-coatingThk,	1,
								leftSide_X - lOffset1/ddd,						AC_clampWidth / 2-coatingThk,	1, !0
								leftSide_X - lOffset1/ddd,						AC_clampWidth / 2,				-1

					fill internalFill_1
					poly2_b 	5, 1+2+64,
								internalFillPen_1, internalFillPenBg_1,

								leftSide_X - lOffset1/ddd,						AC_clampWidth / 2 - coatingThk,	1,
								rightSide_X - (rightSide_X - rightCF_X)/ddd,	AC_clampWidth / 2 - coatingThk,	1,
								rightSide_X - (rightSide_X - rightCF_X)/ddd,	-AC_clampWidth / 2,				1,
								leftSide_X - lOffset1/ddd,						-AC_clampWidth / 2,				1, !0
								leftSide_X - lOffset1/ddd,						AC_clampWidth / 2 - coatingThk,	-1
			else
			if coatingThk < AC_clampWidth / 2 Then
				fill coatingFill
				poly2_b 	5, 1+2+64,
							internalFillPen_1, internalFillPenBg_1,

							leftSide_X - ((AC_clampWidth / 2)/1*(tan(aMitterAngle1/2)))/ddd,				AC_clampWidth / 2, 1,
							rightSide_X - (rightSide_X - rightCF_X)/ddd,									AC_clampWidth / 2, 1,
							rightSide_X - (rightSide_X - rightCF_X)/ddd,									AC_clampWidth / 2-coatingThk, 1,
								leftSide_X - (((AC_clampWidth / 2)-coatingThk)/1*(tan(aMitterAngle1/2)))/ddd,	AC_clampWidth / 2-coatingThk, 1, !0
							leftSide_X - ((AC_clampWidth / 2)/1*(tan(aMitterAngle1/2)))/ddd,				AC_clampWidth / 2, -1

				fill internalFill_1
				poly2_b 	5, 1+2+64,
							internalFillPen_1, internalFillPenBg_1,

							leftSide_X - (((AC_clampWidth / 2) - coatingThk)/1*(tan(aMitterAngle1/2)))/ddd,	AC_clampWidth / 2 - coatingThk, 1,
							rightSide_X - (rightSide_X - rightCF_X)/ddd,									AC_clampWidth / 2 - coatingThk, 1,
							rightSide_X - (rightSide_X - rightCF_X)/ddd,									-AC_clampWidth / 2, 1,
								leftSide_X + ((AC_clampWidth / 2)/1*(tan(aMitterAngle1/2)))/ddd,				-AC_clampWidth / 2, 1, !0
							leftSide_X - (((AC_clampWidth / 2) - coatingThk)/1*(tan(aMitterAngle1/2)))/ddd,	AC_clampWidth / 2 - coatingThk, -1
			else
				fill coatingFill
				poly2_b 	5, 1+2+64,
							internalFillPen_1, internalFillPenBg_1,

							leftSide_X - ((AC_clampWidth / 2)/1*(tan(aMitterAngle1/2)))/ddd,			AC_clampWidth / 2, 1,
							rightSide_X - (rightSide_X - rightCF_X)/ddd,								AC_clampWidth / 2, 1,
							rightSide_X - (rightSide_X - rightCF_X)/ddd,								AC_clampWidth / 2-coatingThk, 1,
								leftSide_X - ((AC_clampWidth / 2-coatingThk)/1*(tan(aMitterAngle1/2)))/ddd,	AC_clampWidth / 2-coatingThk, 1, !0
							leftSide_X - ((AC_clampWidth / 2)/1*(tan(aMitterAngle1/2)))/ddd,			AC_clampWidth / 2, -1

				if abs (coatingThk - AC_clampWidth) > eps then
					fill internalFill_1
					poly2_b 	5, 1+2+64,
							internalFillPen_1, internalFillPenBg_1,

							leftSide_X - (((AC_clampWidth / 2) - coatingThk)/1*(tan(aMitterAngle1/2)))/ddd,	AC_clampWidth / 2 - coatingThk, 1,
							rightSide_X - (rightSide_X - rightCF_X)/ddd,									AC_clampWidth / 2 - coatingThk, 1,
							rightSide_X - (rightSide_X - rightCF_X)/ddd,									-AC_clampWidth / 2, 1,
								leftSide_X + ((AC_clampWidth / 2)/1*(tan(aMitterAngle1/2)))/ddd,				-AC_clampWidth / 2, 1, !0
							leftSide_X - (((AC_clampWidth / 2) - coatingThk)/1*(tan(aMitterAngle1/2)))/ddd,	AC_clampWidth / 2 - coatingThk, -1
				endif
			endif
			endif

			if abs(AC_clampWidth - panelThk) > eps then
				thk = panelThk - AC_clampWidth
				angleDiff = 0
				if abs (panelBackAngle - 90) > eps then
					angleDiff = thk / tan (panelBackAngle)
				endif

				if sSpecEdgeSetting_m > 2 then
					poly2_b 	5, 1+2+64,
								internalFillPen_1, internalFillPenBg_1,

								leftSide_X - lOffset1/ddd,										-AC_clampWidth / 2,				1,
								rightSide_X - (rightSide_X - rightCF_X)/ddd,					-AC_clampWidth / 2,				1,
								rightSide_X - angleDiff/ddd - (rightSide_X - rightCF_X)/ddd,	-panelThk + AC_clampWidth / 2,	1,
								leftSide_X - lOffset1/ddd,										-panelThk + AC_clampWidth / 2,	1, !0
								leftSide_X - lOffset1/ddd,										-AC_clampWidth / 2,				-1
				else
				poly2_b 	5, 1+2+64,
							internalFillPen_1, internalFillPenBg_1,

							leftSide_X + ((AC_clampWidth / 2)/1*(tan(aMitterAngle1/2)))/ddd,			-AC_clampWidth / 2, 1,
							rightSide_X - (rightSide_X - rightCF_X)/ddd,								-AC_clampWidth / 2, 1,
							rightSide_X - angleDiff/ddd - (rightSide_X - rightCF_X)/ddd,								-panelThk + AC_clampWidth / 2, 1,
								leftSide_X + ((panelThk - AC_clampWidth/2)/1*(tan(aMitterAngle1/2)))/ddd,	-panelThk + AC_clampWidth / 2, 1, !0
							leftSide_X + ((AC_clampWidth / 2)/1*(tan(aMitterAngle1/2)))/ddd,			-AC_clampWidth / 2, -1
			endif
		endif
		endif

		if aSpecialEdge1 < 90 OR aSpecialEdge1 > 270 then
			if sSpecEdgeSetting_m > 2 then
					fill coatingFill
					poly2_b 	5, 1+2+64,
								internalFillPen_1, internalFillPenBg_1,

								leftSide_X - (leftSide_X -  leftCF_X)/ddd,	AC_clampWidth / 2,				1,
								rightSide_X + lOffset1/ddd,					AC_clampWidth / 2,				1, !0
								rightSide_X + lOffset1/ddd,					AC_clampWidth / 2-coatingThk,	1,
								leftSide_X - (leftSide_X -  leftCF_X)/ddd,	AC_clampWidth / 2-coatingThk,	1,
								leftSide_X - (leftSide_X -  leftCF_X)/ddd,	AC_clampWidth / 2,				-1

					fill internalFill_1
					poly2_b 	5, 1+2+64,
								internalFillPen_1, internalFillPenBg_1,

								leftSide_X - (leftSide_X -  leftCF_X)/ddd,	AC_clampWidth / 2 - coatingThk,	1,
								rightSide_X + lOffset1/ddd,					AC_clampWidth / 2 - coatingThk,	1, !0
								rightSide_X + lOffset1/ddd,					-AC_clampWidth / 2,				1,
								leftSide_X - (leftSide_X -  leftCF_X)/ddd,	-AC_clampWidth / 2,				1,
								leftSide_X - (leftSide_X -  leftCF_X)/ddd,	AC_clampWidth / 2 - coatingThk,	-1
			else
			if coatingThk < AC_clampWidth / 2 Then
				fill coatingFill
				poly2_b 	5, 1+2+64,
							internalFillPen_1, internalFillPenBg_1,

							leftSide_X - (leftSide_X -  leftCF_X)/ddd,									AC_clampWidth / 2, 1,
								rightSide_X + ((AC_clampWidth / 2)/tan(90-aMitterAngle1/2))/ddd,			AC_clampWidth / 2, 1, !0
							rightSide_X + ((AC_clampWidth / 2-coatingThk)/tan(90-aMitterAngle1/2))/ddd,	AC_clampWidth / 2-coatingThk, 1,
							leftSide_X - (leftSide_X -  leftCF_X)/ddd,									AC_clampWidth / 2-coatingThk, 1,
							leftSide_X - (leftSide_X -  leftCF_X)/ddd,									AC_clampWidth / 2, -1

				fill internalFill_1
				poly2_b 	5, 1+2+64,
							internalFillPen_1, internalFillPenBg_1,

							leftSide_X - (leftSide_X -  leftCF_X)/ddd,										AC_clampWidth / 2 - coatingThk, 1,
								rightSide_X + (((AC_clampWidth / 2) - coatingThk)/tan(90-aMitterAngle1/2))/ddd,	AC_clampWidth / 2 - coatingThk, 1, !0
							rightSide_X - (AC_clampWidth / 2/tan(90-aMitterAngle1/2))/ddd,					-AC_clampWidth / 2, 1,
							leftSide_X - (leftSide_X -  leftCF_X)/ddd,										-AC_clampWidth / 2, 1,
							leftSide_X - (leftSide_X -  leftCF_X)/ddd,										AC_clampWidth / 2 - coatingThk, -1
			else
				fill coatingFill
				poly2_b 	5, 1+2+64,
							internalFillPen_1, internalFillPenBg_1,

							leftSide_X - (leftSide_X -  leftCF_X)/ddd,									AC_clampWidth / 2, 1,
								rightSide_X + ((AC_clampWidth / 2)/tan(90-aMitterAngle1/2))/ddd,			AC_clampWidth / 2, 1, !0
							rightSide_X + ((AC_clampWidth / 2-coatingThk)/tan(90-aMitterAngle1/2))/ddd,	AC_clampWidth / 2-coatingThk, 1,
							leftSide_X - (leftSide_X -  leftCF_X)/ddd,									AC_clampWidth / 2-coatingThk, 1,
							leftSide_X - (leftSide_X -  leftCF_X)/ddd,									AC_clampWidth / 2, -1

				if abs (coatingThk - AC_clampWidth) > eps then
					fill internalFill_1
					poly2_b 	5, 1+2+64,
								internalFillPen_1, internalFillPenBg_1,

								leftSide_X - (leftSide_X -  leftCF_X)/ddd,										AC_clampWidth / 2 - coatingThk, 1,
									rightSide_X + (((AC_clampWidth / 2) - coatingThk)/tan(90-aMitterAngle1/2))/ddd,	AC_clampWidth / 2 - coatingThk, 1, !0
								rightSide_X - (AC_clampWidth / 2/tan(90-aMitterAngle1/2))/ddd,					-AC_clampWidth / 2, 1,
								leftSide_X - (leftSide_X -  leftCF_X)/ddd,										-AC_clampWidth / 2, 1,
								leftSide_X - (leftSide_X -  leftCF_X)/ddd,										AC_clampWidth / 2 - coatingThk, -1
				endif
			endif
			endif

			if abs(AC_clampWidth - panelThk) > eps then
				thk = panelThk - AC_clampWidth
				angleDiff = 0
				if abs (panelBackAngle - 90) > eps then
					angleDiff = thk / tan (panelBackAngle)
				endif

				if sSpecEdgeSetting_m > 2 then
					poly2_b 	5, 1+2+64,
							internalFillPen_1, internalFillPenBg_1,

							leftSide_X - (leftSide_X -  leftCF_X)/ddd,					-AC_clampWidth / 2,				1,
							rightSide_X + lOffset1/ddd,									-AC_clampWidth / 2,				1, !0
							rightSide_X + lOffset1/ddd,									-panelThk + AC_clampWidth / 2,	1,
							leftSide_X + angleDiff/ddd - (leftSide_X -  leftCF_X)/ddd,	-panelThk + AC_clampWidth / 2,	1,
							leftSide_X - (leftSide_X -  leftCF_X)/ddd,					-AC_clampWidth / 2,				-1
				else
			poly2_b 	5, 1+2+64,
						internalFillPen_1, internalFillPenBg_1,

						leftSide_X - (leftSide_X -  leftCF_X)/ddd,									-AC_clampWidth / 2, 1,
							rightSide_X - ((AC_clampWidth / 2)/tan(90-aMitterAngle1/2))/ddd,			-AC_clampWidth / 2, 1, !0
						rightSide_X - ((panelThk - AC_clampWidth/2)/tan(90-aMitterAngle1/2))/ddd,	-panelThk + AC_clampWidth / 2, 1,
						leftSide_X + angleDiff/ddd - (leftSide_X -  leftCF_X)/ddd,									-panelThk + AC_clampWidth / 2, 1,
						leftSide_X - (leftSide_X -  leftCF_X)/ddd,									-AC_clampWidth / 2, -1
			endif
		endif
		endif
	else

		fill coatingFill
		poly2_b 	5, 1+2+64,
					coatingFillPen, coatingFillPenBg,

					leftCF_X,	AC_clampWidth / 2, 1,
					rightCF_X,	AC_clampWidth / 2, 1,
					rightCF_X,	AC_clampWidth / 2-coatingThk, 1,
					leftCF_X,	AC_clampWidth / 2-coatingThk, 1,
					leftCF_X,	AC_clampWidth / 2, -1

		if abs (coatingThk - AC_clampWidth) > eps then
			fill internalFill_1
			poly2_b 	5, 1+2+64,
						internalFillPen_1, internalFillPenBg_1,

						leftCF_X,	AC_clampWidth / 2 - coatingThk, 1,
						rightCF_X,	AC_clampWidth / 2 - coatingThk, 1,
						rightCF_X,	-AC_clampWidth / 2, 1,
						leftCF_X,	-AC_clampWidth /2 , 1,
						leftCF_X,	AC_clampWidth / 2-coatingThk, -1
		endif

		if abs(AC_clampWidth - panelThk) > eps then
			thk = panelThk - AC_clampWidth
			angleDiff = 0
			if abs (panelBackAngle - 90) > eps then
				angleDiff = thk / tan (panelBackAngle)
			endif

			poly2_b 	5, 1+2+64,
						internalFillPen_1, internalFillPenBg_1,

						leftCF_X,	-AC_clampWidth / 2, 1,
						rightCF_X,	-AC_clampWidth / 2, 1,
						rightCF_X - angleDiff,	-panelThk + AC_clampWidth / 2, 1,
						leftCF_X + angleDiff,	-panelThk + AC_clampWidth / 2, 1,
						leftCF_X,	-AC_clampWidth / 2, -1
		endif
	endif
endif

end
