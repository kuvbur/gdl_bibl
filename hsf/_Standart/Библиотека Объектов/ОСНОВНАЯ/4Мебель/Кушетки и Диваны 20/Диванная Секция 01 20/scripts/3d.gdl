
!! Sofa Set 01.gsm

IF gs_detlevel_3D_m=0 THEN END

IF GLOB_CONTEXT>20 and GLOB_CONTEXT<40 THEN gs_detlevel_3D_m=1

IF not(gs_shadow) THEN SHADOW OFF
	unID=1

	!!! *** X Dimension
	HOTSPOT 0,0,0,unID, A,1+256 : unID=unID+1
	HOTSPOT -1,0,0,unID, A,3 : unID=unID+1
	HOTSPOT A,0,0,unID, A,2 : unID=unID+1

	HOTSPOT 0,B,0,unID, A,1+256 : unID=unID+1
	HOTSPOT -1,B,0,unID, A,3 : unID=unID+1
	HOTSPOT A,B,0,unID, A,2 : unID=unID+1

	!!! *** X Dimension
	HOTSPOT 0,0,0,unID, B,1+256 : unID=unID+1
	HOTSPOT 0,-1,0,unID, B,3 : unID=unID+1
	HOTSPOT 0,B,0,unID, B,2 : unID=unID+1

	HOTSPOT A,0,0,unID, B,1+256 : unID=unID+1
	HOTSPOT A,-1,0,unID, B,3 : unID=unID+1
	HOTSPOT A,B,0,unID, B,2 : unID=unID+1

ADD a/2,b/2,0

IF iSofaUnitType = SOFAUNIT_STANDARD THEN

	hotspot a/2, -b/2+b-yback2+COS(75)*(yyy/SIN(75)), 0, unID, zzyzx, 1+128: unID=unID+1
	hotspot a/2, -b/2+b-yback2+COS(75)*(yyy/SIN(75)), -1, unID, zzyzx, 3: unID=unID+1
	hotspot a/2, -b/2+b-yback2+COS(75)*(yyy/SIN(75)), zzyzx, unID, zzyzx, 2: unID=unID+1

	hotspot -a/2, -b/2+b-yback2+COS(75)*(yyy/SIN(75)), 0, unID, zzyzx, 1+128: unID=unID+1
	hotspot -a/2, -b/2+b-yback2+COS(75)*(yyy/SIN(75)), -1, unID, zzyzx, 3: unID=unID+1
	hotspot -a/2, -b/2+b-yback2+COS(75)*(yyy/SIN(75)), zzyzx, unID, zzyzx, 2: unID=unID+1
ENDIF
IF iSofaUnitType = SOFAUNIT_END THEN

	hotspot a/2, -b/2+b-yback2+COS(75)*(yyy/SIN(75)), 0, unID, zzyzx, 1+128: unID=unID+1
	hotspot a/2, -b/2+b-yback2+COS(75)*(yyy/SIN(75)), -1, unID, zzyzx, 3: unID=unID+1
	hotspot a/2, -b/2+b-yback2+COS(75)*(yyy/SIN(75)), zzyzx, unID, zzyzx, 2: unID=unID+1

	hotspot -a/2+0.15, -b/2+b-yback2+COS(75)*(yyy/SIN(75)), 0, unID, zzyzx, 1+128: unID=unID+1
	hotspot -a/2+0.15, -b/2+b-yback2+COS(75)*(yyy/SIN(75)), -1, unID, zzyzx, 3: unID=unID+1
	hotspot -a/2+0.15, -b/2+b-yback2+COS(75)*(yyy/SIN(75)), zzyzx, unID, zzyzx, 2: unID=unID+1
ENDIF
IF iSofaUnitType = SOFAUNIT_CORNER THEN

	hotspot -a/2, -b/2+b-yback2+COS(75)*(yyy/SIN(75)), 0, unID, zzyzx, 1+128: unID=unID+1
	hotspot -a/2, -b/2+b-yback2+COS(75)*(yyy/SIN(75)), -1, unID, zzyzx, 3: unID=unID+1
	hotspot -a/2, -b/2+b-yback2+COS(75)*(yyy/SIN(75)), zzyzx, unID, zzyzx, 2: unID=unID+1

	hotspot -a/2+b-yback2+COS(75)*(yyy/SIN(75)), -b/2, 0, unID, zzyzx, 1+128: unID=unID+1
	hotspot -a/2+b-yback2+COS(75)*(yyy/SIN(75)), -b/2, -1, unID, zzyzx, 3: unID=unID+1
	hotspot -a/2+b-yback2+COS(75)*(yyy/SIN(75)), -b/2, zzyzx, unID, zzyzx, 2: unID=unID+1
ENDIF

! Hotspot editing !
IF gs_full_edit=1 THEN

IF iSofaUnitType = SOFAUNIT_STANDARD THEN

	hotspot -a/2, -b/2, 0, unID, gs_seat_height, 1+128: unID=unID+1
	hotspot -a/2, -b/2, -1, unID, gs_seat_height, 3: unID=unID+1
	hotspot -a/2, -b/2, gs_seat_height, unID, gs_seat_height, 2: unID=unID+1

	hotspot a/2, -b/2, 0, unID, gs_seat_height, 1+128: unID=unID+1
	hotspot a/2, -b/2, -1, unID, gs_seat_height, 3: unID=unID+1
	hotspot a/2, -b/2, gs_seat_height, unID, gs_seat_height, 2: unID=unID+1

	hotspot -a/2, b/2, 0, unID, arm_h, 1+128: unID=unID+1
	hotspot -a/2, b/2, -1, unID, arm_h, 3: unID=unID+1
	hotspot -a/2, b/2, arm_h, unID, arm_h, 2: unID=unID+1

	hotspot a/2, b/2, 0, unID, arm_h, 1+128: unID=unID+1
	hotspot a/2, b/2, -1, unID, arm_h, 3: unID=unID+1
	hotspot a/2, b/2, arm_h, unID, arm_h, 2: unID=unID+1
ENDIF
IF iSofaUnitType = SOFAUNIT_END THEN

	hotspot -a/2+0.15, -b/2, 0, unID, gs_seat_height, 1+128: unID=unID+1
	hotspot -a/2+0.15, -b/2, -1, unID, gs_seat_height, 3: unID=unID+1
	hotspot -a/2+0.15, -b/2, gs_seat_height, unID, gs_seat_height, 2: unID=unID+1

	hotspot a/2, -b/2, 0, unID, gs_seat_height, 1+128: unID=unID+1
	hotspot a/2, -b/2, -1, unID, gs_seat_height, 3: unID=unID+1
	hotspot a/2, -b/2, gs_seat_height, unID, gs_seat_height, 2: unID=unID+1

	hotspot -a/2, -b/2, 0, unID, arm_h, 1+128: unID=unID+1
	hotspot -a/2, -b/2, -1, unID, arm_h, 3: unID=unID+1
	hotspot -a/2, -b/2, arm_h, unID, arm_h, 2: unID=unID+1

	hotspot -a/2, b/2, 0, unID, arm_h, 1+128: unID=unID+1
	hotspot -a/2, b/2, -1, unID, arm_h, 3: unID=unID+1
	hotspot -a/2, b/2, arm_h, unID, arm_h, 2: unID=unID+1
ENDIF
IF iSofaUnitType = SOFAUNIT_CORNER THEN

	hotspot -a/2, -b/2, 0, unID, gs_seat_height, 1+128: unID=unID+1
	hotspot -a/2, -b/2, -1, unID, gs_seat_height, 3: unID=unID+1
	hotspot -a/2, -b/2, gs_seat_height, unID, gs_seat_height, 2: unID=unID+1

	hotspot a/2, -b/2, 0, unID, arm_h, 1+128: unID=unID+1
	hotspot a/2, -b/2, -1, unID, arm_h, 3: unID=unID+1
	hotspot a/2, -b/2, arm_h, unID, arm_h, 2: unID=unID+1

	hotspot -a/2, b/2, 0, unID, arm_h, 1+128: unID=unID+1
	hotspot -a/2, b/2, -1, unID, arm_h, 3: unID=unID+1
	hotspot -a/2, b/2, arm_h, unID, arm_h, 2: unID=unID+1
ENDIF
IF iSofaUnitType = SOFAUNIT_POUFFE THEN

	hotspot -a/2, -b/2, 0, unID, gs_seat_height, 1+128: unID=unID+1
	hotspot -a/2, -b/2, -1, unID, gs_seat_height, 3: unID=unID+1
	hotspot -a/2, -b/2, gs_seat_height, unID, gs_seat_height, 2: unID=unID+1

	hotspot -a/2, b/2, 0, unID, gs_seat_height, 1+128: unID=unID+1
	hotspot -a/2, b/2, -1, unID, gs_seat_height, 3: unID=unID+1
	hotspot -a/2, b/2, gs_seat_height, unID, gs_seat_height, 2: unID=unID+1

	hotspot a/2, -b/2, 0, unID, gs_seat_height, 1+128: unID=unID+1
	hotspot a/2, -b/2, -1, unID, gs_seat_height, 3: unID=unID+1
	hotspot a/2, -b/2, gs_seat_height, unID, gs_seat_height, 2: unID=unID+1

	hotspot a/2, b/2, 0, unID, gs_seat_height, 1+128: unID=unID+1
	hotspot a/2, b/2, -1, unID, gs_seat_height, 3: unID=unID+1
	hotspot a/2, b/2, gs_seat_height, unID, gs_seat_height, 2: unID=unID+1
ENDIF

ENDIF

ADD -a/2,-b/2,0

IF iLegType = LEGTYPE_1 THEN k = 1
IF iLegType = LEGTYPE_2 THEN k = 2
IF iLegType = LEGTYPE_3 THEN k = 3
IF iLegType = LEGTYPE_4 THEN k = 4
IF iLegType = LEGTYPE_5 THEN k = 5
IF not(bLeg) THEN k = 0

PEN gs_cont_pen

aaa=a
IF iSofaUnitType = SOFAUNIT_CORNER THEN aaa = b


MATERIAL gs_sofa_mat
RESOL gs_resol

IF iSofaUnitType = SOFAUNIT_STANDARD THEN aa = a
IF iSofaUnitType = SOFAUNIT_END THEN aa = a-0.15

IF iSofaUnitType = SOFAUNIT_END THEN
	ADD 0.15, 0, leg_h
	ROTY -90
	CALL "fa_cushion" parameters gs_detlevel_3D_m=gs_detlevel_3D_m,cush_a=arm_h-leg_h,
	cush_b=b,cush_h=0.15,r1=0.02,r2=0.01,gs_resol=gs_resol,cush_mat=gs_sofa_mat
	DEL 2
	ADDX 0.15
ENDIF

IF iSofaUnitType = SOFAUNIT_STANDARD OR iSofaUnitType = SOFAUNIT_END THEN
	bb=b-yback2
	GOSUB 100
	bb=yyy/SIN(75)
	GOSUB 110
	GOSUB 120
DEL TOP
ENDIF


IF iSofaUnitType = SOFAUNIT_CORNER THEN
	aa=b-yback2
	bb=b-yback2
	GOSUB 100
	aa=b
	bb=yyy/SIN(75)

	ROTZ 45
	CUTPLANE 90
	DEL 1
	GOSUB 110
	GOSUB 120
	CUTEND


	ROTZ 45
	CUTPLANE -90
	DEL 1
	ROTZ -90
	ADDX -b
	GOSUB 110
	GOSUB 120
	CUTEND
	DEL 2
		DEL 1 !!!!!
ENDIF


IF iSofaUnitType = SOFAUNIT_POUFFE THEN
ADDZ leg_h
	CALL "fa_cushion" parameters gs_detlevel_3D_m=gs_detlevel_3D_m,cush_a=a,cush_b=b,
	cush_h=gs_seat_height-leg_h,r1=0.02,r2=0.01,gs_resol=gs_resol,cush_mat=gs_cush_mat
DEL 1
		DEL 1 !!!!!
ENDIF

DEL TOP
MATERIAL gs_leg_mat
GOSUB 10+k


END


10:
leg_h=0
RETURN

11:
ADD 0.0525, 0.02, 0
CALL "fa_sofalegtyp" PARAMETERS sofaleg_typ_m=1,a=aaa-0.105, b=b-0.04, gs_detlevel_3D_m=gs_detlevel_3D_m,
gs_resol=gs_resol,gs_cont_pen=gs_cont_pen, gs_leg_mat=gs_leg_mat
DEL 1
RETURN

12:
ADD 0.06, 0.04, 0
CALL "fa_sofalegtyp" PARAMETERS sofaleg_typ_m=2,a=aaa-0.12, b=b-0.08, leg_h=leg_h, gs_detlevel_3D_m=gs_detlevel_3D_m,
gs_resol=gs_resol,gs_cont_pen=gs_cont_pen, gs_leg_mat=gs_leg_mat
DEL 1
RETURN

13:
ADD 0.075, 0.075, 0
CALL "fa_sofalegtyp" PARAMETERS sofaleg_typ_m=3,a=aaa-0.15, b=b-0.15, leg_h=leg_h, gs_detlevel_3D_m=gs_detlevel_3D_m,
gs_resol=gs_resol,gs_cont_pen=gs_cont_pen, gs_leg_mat=gs_leg_mat
DEL 1
RETURN

14:
ADD 0.02, 0.075, 0
CALL "fa_sofalegtyp" PARAMETERS sofaleg_typ_m=4,a=aaa-0.04, b=b-0.15, leg_h=leg_h, gs_detlevel_3D_m=gs_detlevel_3D_m,
gs_resol=gs_resol,gs_cont_pen=gs_cont_pen, gs_leg_mat=gs_leg_mat
DEL 1
RETURN

15:
ADD 0.075, 0.085, 0
CALL "fa_sofalegtyp" PARAMETERS sofaleg_typ_m=5,a=aaa-0.15, b=b-0.17, leg_h=leg_h,ur=0.055, lr=0.045,
gs_cont_pen=gs_cont_pen, gs_leg_mat=gs_leg_mat
DEL 1
RETURN


100:
ADDZ gs_seat_height-0.15
	CALL "fa_cushion" parameters gs_detlevel_3D_m=gs_detlevel_3D_m,cush_a=aa,
	cush_b=bb,
	cush_h=0.15,r1=0.02,r2=0.01,gs_resol=gs_resol,cush_mat=gs_cush_mat
DEL 1
RETURN

110:
ADD 0, b-yyy/TAN(75)-0.03, gs_seat_height-(gs_seat_height-leg_h)*0.5+(gs_seat_height-leg_h)*0.5-0.0875
ROTX 75
	CALL "fa_cushion" parameters gs_detlevel_3D_m=gs_detlevel_3D_m,cush_a=aa,
	cush_b=bb,cush_h=0.15,
	r1=0.02,r2=0.01,gs_resol=gs_resol,cush_mat=gs_cush_mat
DEL 2
RETURN

120:
ADDZ leg_h
ROTY 90
IF gs_detlevel_3D_m=2 THEN
	EXTRUDE 11, 0, 0, aa, 1+2+4+16+32,
		-gs_seat_height+0.15+leg_h, 0.02, 0,
		-gs_seat_height+0.15+leg_h,  b-yback2, 0,
		-(gs_seat_height-leg_h)+0.0875,  b-yback2, 0,
		-(gs_seat_height-leg_h)+0.0875,  b-yyy/TAN(75)-0.03, 0,
		-arm_h+leg_h+0.02, b-yyy/TAN(75)-0.03+(arm_h-gs_seat_height+0.0675)/TAN(75), 0,
		-arm_h+leg_h+0.02, b-0.02, 1,
		-arm_h+leg_h+0.04, b, 1001,
		-0.02, b, 1,
		0, b-0.02, 1001,
		0, 0.04, 1,
		-0.02, 0.02, 1001
ELSE
	PRISM_ 8, aa,
		0, 0.02, 15,
		-gs_seat_height+0.15+leg_h, 0.02, 15,
		-gs_seat_height+0.15+leg_h,  b-yback2, 15,
		-(gs_seat_height-leg_h)+0.0875,  b-yback2, 15,
		-(gs_seat_height-leg_h)+0.0875,  b-yyy/TAN(75)-0.03, 15,
		-arm_h+leg_h+0.02, b-yyy/TAN(75)-0.03+(arm_h-gs_seat_height+0.0675)/TAN(75), 15,
		-arm_h+leg_h+0.02, b, 15,
		0, b, 15

ENDIF

DEL 2
RETURN
