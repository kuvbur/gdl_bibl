
!! Sofa Set 02.gsm

if GLOB_CONTEXT = 3 then
	TubeMask = 1+2
else
	TubeMask = 1+2+16+32
endif

RESOL gs_resol
rr=radius_i+b
alpha=(ASN(a/2/rr))*2
rrr=0.04/SIN(alpha)
rrrr=0.04*TAN(90-alpha)
bac=b/0.9
see=gs_seat_height-0.44-leg_h
zee=zzyzx-0.9-leg_h

IF gs_detlevel_3D_m=0 THEN END

IF GLOB_CONTEXT>20 and GLOB_CONTEXT<40 THEN gs_detlevel_3D_m=1

IF gs_shadow=0 THEN SHADOW OFF


IF iSofaUnitType2 = SOFAUNIT_STANDARD THEN
ADD a/2,b/2,0

	unID=1

	HOTSPOT a/2,b/2,0: unID=unID+1
	HOTSPOT a/2,-b/2,0: unID=unID+1
	HOTSPOT -a/2,-b/2,0: unID=unID+1
	HOTSPOT -a/2,b/2,0: unID=unID+1

	hotspot a/2, b/2, 0, unID, zzyzx, 1+128: unID=unID+1
	hotspot a/2, b/2, -1, unID, zzyzx, 3: unID=unID+1
	hotspot a/2, b/2, zzyzx, unID, zzyzx, 2: unID=unID+1

	hotspot -a/2, b/2, 0, unID, zzyzx, 1+128: unID=unID+1
	hotspot -a/2, b/2, -1, unID, zzyzx, 3: unID=unID+1
	hotspot -a/2, b/2, zzyzx, unID, zzyzx, 2: unID=unID+1
del 1
ENDIF

IF iSofaUnitType2 = SOFAUNIT_CURVA THEN
	HOTSPOT 0, 0,0: unID=unID+1
	HOTSPOT 0, -radius_i,0: unID=unID+1
	HOTSPOT 0, b,0: unID=unID+1
	HOTSPOT rr*SIN(alpha), -radius_i+rr*COS(alpha),0: unID=unID+1
	HOTSPOT radius_i*SIN(alpha), -radius_i+radius_i*COS(alpha),0: unID=unID+1

	HOTSPOT rr*SIN(alpha), -radius_i+rr*COS(alpha), 0, unID, zzyzx, 1+128: unID=unID+1
	HOTSPOT rr*SIN(alpha), -radius_i+rr*COS(alpha), -1, unID, zzyzx, 3: unID=unID+1
	HOTSPOT rr*SIN(alpha), -radius_i+rr*COS(alpha), zzyzx, unID, zzyzx, 2: unID=unID+1

	HOTSPOT 0, b, 0, unID, zzyzx, 1+128: unID=unID+1
	HOTSPOT 0, b, -1, unID, zzyzx, 3: unID=unID+1
	HOTSPOT 0, b, zzyzx, unID, zzyzx, 2: unID=unID+1
ENDIF

IF iSofaUnitType2 = SOFAUNIT_CURVB THEN
	HOTSPOT 0, 0,0: unID=unID+1
	HOTSPOT 0, rr,0: unID=unID+1
	HOTSPOT 0, b,0: unID=unID+1
	HOTSPOT radius_i*SIN(alpha), rr-radius_i*COS(alpha),0: unID=unID+1
	HOTSPOT rr*SIN(alpha), rr-rr*COS(alpha),0: unID=unID+1

	HOTSPOT 0, b, 0, unID, zzyzx, 1+128: unID=unID+1
	HOTSPOT 0, b, -1, unID, zzyzx, 3: unID=unID+1
	HOTSPOT 0, b, zzyzx, unID, zzyzx, 2: unID=unID+1

	HOTSPOT radius_i*SIN(alpha), rr-radius_i*COS(alpha), 0, unID, zzyzx, 1+128: unID=unID+1
	HOTSPOT radius_i*SIN(alpha), rr-radius_i*COS(alpha), -1, unID, zzyzx, 3: unID=unID+1
	HOTSPOT radius_i*SIN(alpha), rr-radius_i*COS(alpha), zzyzx, unID, zzyzx, 2: unID=unID+1
ENDIF

! Hotspot editing !
IF gs_full_edit=1 THEN

IF iSofaUnitType2 = SOFAUNIT_STANDARD THEN
ADD a/2,b/2,0

	hotspot -a/2, -b/2, 0, unID, gs_seat_height, 1+128: unID=unID+1
	hotspot -a/2, -b/2, -1, unID, gs_seat_height, 3: unID=unID+1
	hotspot -a/2, -b/2, gs_seat_height, unID, gs_seat_height, 2: unID=unID+1

	hotspot a/2, -b/2, 0, unID, gs_seat_height, 1+128: unID=unID+1
	hotspot a/2, -b/2, -1, unID, gs_seat_height, 3: unID=unID+1
	hotspot a/2, -b/2, gs_seat_height, unID, gs_seat_height, 2: unID=unID+1
del 1
ENDIF

IF iSofaUnitType2 = SOFAUNIT_CURVA THEN

	hotspot 0, 0, 0, unID, gs_seat_height, 1+128: unID=unID+1
	hotspot 0, 0, -1, unID, gs_seat_height, 3: unID=unID+1
	hotspot 0, 0, gs_seat_height, unID, gs_seat_height, 2: unID=unID+1

	HOTSPOT radius_i*SIN(alpha), -radius_i+radius_i*COS(alpha), 0, unID, gs_seat_height, 1+128: unID=unID+1
	HOTSPOT radius_i*SIN(alpha), -radius_i+radius_i*COS(alpha), -1, unID, gs_seat_height, 3: unID=unID+1
	HOTSPOT radius_i*SIN(alpha), -radius_i+radius_i*COS(alpha), gs_seat_height, unID, gs_seat_height, 2: unID=unID+1
ENDIF

IF iSofaUnitType2 = SOFAUNIT_CURVB THEN

	hotspot 0, 0, 0, unID, gs_seat_height, 1+128: unID=unID+1
	hotspot 0, 0, -1, unID, gs_seat_height, 3: unID=unID+1
	hotspot 0, 0, gs_seat_height, unID, gs_seat_height, 2: unID=unID+1


	HOTSPOT rr*SIN(alpha), rr-rr*COS(alpha), 0, unID, gs_seat_height, 1+128: unID=unID+1
	HOTSPOT rr*SIN(alpha), rr-rr*COS(alpha), -1, unID, gs_seat_height, 3: unID=unID+1
	HOTSPOT rr*SIN(alpha), rr-rr*COS(alpha), gs_seat_height, unID, gs_seat_height, 2: unID=unID+1
ENDIF

ENDIF

IF iLegType = LEGTYPE_1 THEN k = 1
IF iLegType = LEGTYPE_2 THEN k = 2
IF iLegType = LEGTYPE_3 THEN k = 3
IF iLegType = LEGTYPE_4 THEN k = 4
IF iLegType = LEGTYPE_5 THEN k = 5
IF not(bLeg) THEN k = 0

PEN gs_cont_pen
MATERIAL gs_leg_mat
RESOL gs_resol
rr=radius_i+b
alpha=(ASN(a/2/rr))*2
rrr=0.04/SIN(alpha)
rrrr=0.04*TAN(90-alpha)
bac=b/0.9
see=gs_seat_height-0.44-leg_h
zee=zzyzx-0.9-leg_h
GOSUB 10+k

 MATERIAL gs_sofa_mat
zz=zzyzx-leg_h-0.08
zz=zz/(0.573-leg_h)
bb=(b-0.08)/0.764
xx=(b-0.08)/0.764
!bb=1
!--------------------------------> Standard <-----
IF iSofaUnitType2 = SOFAUNIT_STANDARD THEN
 IF gs_detlevel_3D_m=2 THEN
	ADD 0, 0,leg_h
	mm=1
	ADDX 0.04
	   GOSUB 100: DEL 1

	mm=-1
	ADDX a-0.04
	MULX -1
	   GOSUB 100
	DEL 1
	DEL 1

	DEL 1

	rrr=0.04/SIN(alpha): rrrr=0.04*TAN(90-alpha): rr=rr-rrr-rrrr-b

	sn=INT(gs_resol/2)
	ss=alpha/sn

	FOR i=1 TO sn
		PUT rr*SIN((alpha/sn)*i), -rr+rr*COS((alpha/sn)*i), 0, 0
	NEXT i
	ADD 0.04, 0, leg_h
	zzz=(zzyzx-0.08)/(0.653-leg_h): bbb=b/0.844 : bb=(b-0.08)/0.764:! bb=1

	bx1=0.554926-0.511257: bz1=0.265652-0.18582
	bx2=0.606386-0.603886: bz2=0.29804-0.24412
	bx3=0.689001-0.6865: bz3=0.520594-0.466673
	bac=b/0.9

	zz=1
	she=gs_seat_height-0.316763-leg_h
	zhe=zzyzx-0.573-leg_h

	RESOL gs_resol*3

	TUBE 56, 4, TubeMask,
		bac*0.5909559448409, 0.399013109646+see,     1,
		bac*0.6027912842486, 0.3987096772842+see,     1,
		bac*0.6125917285096, 0.4002599606719+see,     1,
		bac*0.6222255642665, 0.4034625323809+see,     1,
		bac*0.6309592779127, 0.4080908284277+see,     1,
		bac*0.6385172561444, 0.4139242711665+see,     1,
		bac*0.6447063957045, 0.4207077841968+see,     1,
		bac*0.6494021640446, 0.4281747149031+see,     1,
		bac*0.6497342754433, 0.4290083706836+see,     1,
		bac*0.7384039662842, 0.8453253773279+zee,     1,
		bac*0.7423199072537, 0.8551535908857+zee,     1,
		bac*0.7499646191822, 0.8673111903691+zee,     1,
		bac*0.7595901886368, 0.8778621461493+zee,     1,
		bac*0.7708351765685, 0.8865395664053+zee,     1,
		bac*0.7833209345768, 0.8931564379244+zee,     1,
		bac*0.7966808473712, 0.8975976677554+zee,     1,
		bac*0.8105602959487, 0.8997938445718+zee,     1,
		bac*0.8246003077138, 0.8997097392458+zee,     1,
		bac*0.8384525204504, 0.8973496933741+zee,     1,
		bac*0.8517630471273, 0.8927451985133+zee,     1,
		bac*0.8641706214157, 0.8859725398306+zee,     1,
		bac*0.8753088744419, 0.8771516840593+zee,     1,
		bac*0.8848024671265, 0.8664720107092+zee,     1,
		bac*0.8922878882509, 0.8542106840637+zee,     1,
		bac*0.8974503856626, 0.8407297732849+zee,     1,
		bac*0.9000499396195, 0.8264683536786+zee,     1,
				 bac*0.9, 0.8196074250759+zee,     1,
				 bac*0.9, 0.07274901301811,     1,
		bac*0.8973070762871, 0.05851679632127,     1,
		bac*0.8920534803358, 0.04506934841447,     1,
		bac*0.8844858869628, 0.03285739378564,     1,
		bac*0.8749276256134, 0.02224561418475,     1,
		bac*0.8637396028866, 0.01349772985178,     1,
		bac*0.8512898980467, 0.006800569866368,     1,
		bac*0.8379522056853, 0.002277258264593,     1,
		bac*0.8240877835979, 2.398177668019E-017,     1,
		bac*0.07591221640209, 1.845931736176E-017,     1,
		bac*0.06204779431468, 0.002277258264593,     1,
		bac*0.04871010195333, 0.006800569866368,     1,
		bac*0.03626039711344, 0.01349772985178,     1,
		bac*0.02507237438662, 0.02224561418475,     1,
		bac*0.0155141130372, 0.03285739378564,     1,
		bac*0.007946519664197, 0.04506934841447,     1,
		bac*0.002692923712876, 0.05851679632127,     1,
		0, 0.07274901301811,     1,
		0, 0.3392786757382+see,     1,
		bac*0.003671953580813, 0.3586814810741+see,     1,
		bac*0.01085136179389, 0.3770593598888+see,     1,
		bac*0.02123429417948, 0.3938164212934+see,     1,
		bac*0.03441521437722, 0.4084525662378+see,     1,
		bac*0.04992245551074, 0.4205756353607+see,     1,
		bac*0.067250402201, 0.4298959007823+see,     1,
		bac*0.08588014347145, 0.4362136022463+see,     1,
		bac*0.1057298753639, 0.4394745685672+see,     1,
		bac*0.1241766736962, 0.4390703777182+see,     1,
		bac*0.1259808779418, 0.4389151055221+see,     1,

		-a,0,0,0,
		0,0,0,0,
		a-0.08,0,0,0,
		a,0,0,0
	DEL 1

 ELSE
!	zz=(zzyzx-leg_h)/(0.653-leg_h)
	zz=1
	she=gs_seat_height-0.316763-leg_h
	zhe=zzyzx-0.573-leg_h
	bb=b/0.844
	ADDZ leg_h
	TUBE 6, 4, 1+2+16+32,
		bb*0.593059,     she+0.262139,     0,
		0.0,     she+0.316763,     0,
		0.0,    0.0,     0,
		bb*0.844,     0.0,     0,
		bb*0.844,     zhe+0.573,     0,
		bb*0.708455,     zhe+0.573,     0,

		-1, 0, 0, 0,
		0, 0, 0, 0,
		a, 0, 0, 0,
		2*a, 0, 0, 0
	DEl 1
 ENDIF
ENDIF

!--------------------------------> Curved A <-----
IF iSofaUnitType2 = SOFAUNIT_CURVA THEN
 IF gs_detlevel_3D_m=2 THEN
	rr=radius_i+b: alpha=(ASN(a/2/rr))*2
	ADD 0, 0, leg_h+0.04
	mm=1
	ADD 0.04,0,-0.04
	   GOSUB 100: DEL 1
	DEL 1

	ADDY -radius_i
	ROTZ -alpha
	ADD 0, 0+radius_i, leg_h+0.04
	mm=-1
	MULX -1
	ADD 0.04,0,-0.04
	   GOSUB 100
		DEL 2
	DEL 1+2

	rrr=0.04/SIN(alpha): rrrr=0.04*TAN(90-alpha): rr=rr-rrr-rrrr-b

	sn=INT(gs_resol/2)
	ss=alpha/sn

	FOR i=1 TO sn
		PUT rr*SIN((alpha/sn)*i), -rr+rr*COS((alpha/sn)*i), 0, 0
	NEXT i
	ADD 0.04, 0, leg_h
	zzz=(zzyzx-0.08)/(0.653-leg_h): bbb=b/0.844 : bb=(b-0.08)/0.764:! bb=1

	bx1=0.554926-0.511257: bz1=0.265652-0.18582
	bx2=0.606386-0.603886: bz2=0.29804-0.24412
	bx3=0.689001-0.6865: bz3=0.520594-0.466673
	bac=b/0.9

	zz=1
	she=gs_seat_height-0.316763-leg_h
	zhe=zzyzx-0.573-leg_h

	RESOL gs_resol*3
	TUBE 56, 3+sn, TubeMask,
		bac*0.5909559448409, 0.399013109646+see,     1,
		bac*0.6027912842486, 0.3987096772842+see,     1,
		bac*0.6125917285096, 0.4002599606719+see,     1,
		bac*0.6222255642665, 0.4034625323809+see,     1,
		bac*0.6309592779127, 0.4080908284277+see,     1,
		bac*0.6385172561444, 0.4139242711665+see,     1,
		bac*0.6447063957045, 0.4207077841968+see,     1,
		bac*0.6494021640446, 0.4281747149031+see,     1,
		bac*0.6497342754433, 0.4290083706836+see,     1,
		bac*0.7384039662842, 0.8453253773279+zee,     1,
		bac*0.7423199072537, 0.8551535908857+zee,     1,
		bac*0.7499646191822, 0.8673111903691+zee,     1,
		bac*0.7595901886368, 0.8778621461493+zee,     1,
		bac*0.7708351765685, 0.8865395664053+zee,     1,
		bac*0.7833209345768, 0.8931564379244+zee,     1,
		bac*0.7966808473712, 0.8975976677554+zee,     1,
		bac*0.8105602959487, 0.8997938445718+zee,     1,
		bac*0.8246003077138, 0.8997097392458+zee,     1,
		bac*0.8384525204504, 0.8973496933741+zee,     1,
		bac*0.8517630471273, 0.8927451985133+zee,     1,
		bac*0.8641706214157, 0.8859725398306+zee,     1,
		bac*0.8753088744419, 0.8771516840593+zee,     1,
		bac*0.8848024671265, 0.8664720107092+zee,     1,
		bac*0.8922878882509, 0.8542106840637+zee,     1,
		bac*0.8974503856626, 0.8407297732849+zee,     1,
		bac*0.9000499396195, 0.8264683536786+zee,     1,
				 bac*0.9, 0.8196074250759+zee,     1,
				 bac*0.9, 0.07274901301811,     1,
		bac*0.8973070762871, 0.05851679632127,     1,
		bac*0.8920534803358, 0.04506934841447,     1,
		bac*0.8844858869628, 0.03285739378564,     1,
		bac*0.8749276256134, 0.02224561418475,     1,
		bac*0.8637396028866, 0.01349772985178,     1,
		bac*0.8512898980467, 0.006800569866368,     1,
		bac*0.8379522056853, 0.002277258264593,     1,
		bac*0.8240877835979, 2.398177668019E-017,     1,
		bac*0.07591221640209, 1.845931736176E-017,     1,
		bac*0.06204779431468, 0.002277258264593,     1,
		bac*0.04871010195333, 0.006800569866368,     1,
		bac*0.03626039711344, 0.01349772985178,     1,
		bac*0.02507237438662, 0.02224561418475,     1,
		bac*0.0155141130372, 0.03285739378564,     1,
		bac*0.007946519664197, 0.04506934841447,     1,
		bac*0.002692923712876, 0.05851679632127,     1,
		0, 0.07274901301811,     1,
		0, 0.3392786757382+see,     1,
		bac*0.003671953580813, 0.3586814810741+see,     1,
		bac*0.01085136179389, 0.3770593598888+see,     1,
		bac*0.02123429417948, 0.3938164212934+see,     1,
		bac*0.03441521437722, 0.4084525662378+see,     1,
		bac*0.04992245551074, 0.4205756353607+see,     1,
		bac*0.067250402201, 0.4298959007823+see,     1,
		bac*0.08588014347145, 0.4362136022463+see,     1,
		bac*0.1057298753639, 0.4394745685672+see,     1,
		bac*0.1241766736962, 0.4390703777182+see,     1,
		bac*0.1259808779418, 0.4389151055221+see,     1,

		-rr*SIN(ss), -rr+rr*COS(ss), 0, 0,
		0, 0, 0, 0,
		GET(NSP),
		rr*SIN(alpha+ss), -rr+rr*COS(alpha+ss), 0, 0
	DEL 1

 ELSE
	rr=radius_i+b: alpha=(ASN(a/2/rr))*2
	rr=rr-b
	sn=INT(gs_resol/2)

	IF alpha<=45 THEN sn=1
	IF alpha>45 THEN sn=3
	ss=alpha/sn

	FOR i=1 TO sn
		PUT rr*SIN((alpha/sn)*i), -rr+rr*COS((alpha/sn)*i), 0, 0
	NEXT i
	she=gs_seat_height-0.316763-leg_h
	zhe=zzyzx-0.573-leg_h
	!zz=(zzyzx-leg_h)/(0.653-leg_h):
	bb=b/0.844: bbb=b/(b/COS(alpha/2))
	zz=1
	ADDZ leg_h
	TUBE 6, 4, 1+2+16+32,
		bbb*bb*0.593059,     she+0.262139,     0,
		0.0,     she+0.316763,     0,
		0.0,    0.0,     0,
		bbb*bb*0.844,     0.0,     0,
		bbb*bb*0.844,     zhe+0.573,     0,
		bbb*bb*0.708455,     zhe+0.573,     0,

		-rr*SIN(ss), -rr+rr*COS(ss), 0, 0,
		0, 0, 0, 0,
		GET(NSP),
		rr*SIN(alpha+ss), -rr+rr*COS(alpha+ss), 0, 0
	DEl 1
 ENDIF
ENDIF


!--------------------------------> Curved B <-----
IF iSofaUnitType2 = SOFAUNIT_CURVB THEN
 IF gs_detlevel_3D_m=2 THEN
	rr=radius_i+b: alpha=(ASN(a/2/rr))*2
	ADD 0, 0.04, leg_h+0.04
	mm=1
	ADD 0.04,-0.04,-0.04
	   GOSUB 100: DEL 1
	DEL 1

	ADDY rr
	ROTZ alpha
	ADD 0, 0.04-rr, leg_h+0.04
	mm=-1
	MULX -1
	ADD 0.04,-0.04,-0.04
	   GOSUB 100
		DEL 1
		DEL 1
	DEL 1+2

	rrr=0.04/SIN(alpha): rrrr=0.04*TAN(90-alpha): rr=rr-rrr-rrrr

	sn=INT(gs_resol/2)
	ss=alpha/sn

	FOR i=1 TO sn
		PUT rr*SIN((alpha/sn)*i), rr-rr*COS((alpha/sn)*i), 0, 0
	NEXT i
	ADD 0.04, 0, leg_h
	zzz=(zzyzx-0.08)/(0.653-leg_h): bbb=b/0.844

	bx1=0.554926-0.511257: bz1=0.265652-0.18582
	bx2=0.606386-0.603886: bz2=0.29804-0.24412
	bx3=0.689001-0.6865: bz3=0.520594-0.466673
	zz=1
	she=gs_seat_height-0.316763-leg_h
	zhe=zzyzx-0.573-leg_h

	RESOL gs_resol*3
	TUBE 56, 3+sn, TubeMask,
		bac*0.5909559448409, 0.399013109646+see,     1,
		bac*0.6027912842486, 0.3987096772842+see,     1,
		bac*0.6125917285096, 0.4002599606719+see,     1,
		bac*0.6222255642665, 0.4034625323809+see,     1,
		bac*0.6309592779127, 0.4080908284277+see,     1,
		bac*0.6385172561444, 0.4139242711665+see,     1,
		bac*0.6447063957045, 0.4207077841968+see,     1,
		bac*0.6494021640446, 0.4281747149031+see,     1,
		bac*0.6497342754433, 0.4290083706836+see,     1,
		bac*0.7384039662842, 0.8453253773279+zee,     1,
		bac*0.7423199072537, 0.8551535908857+zee,     1,
		bac*0.7499646191822, 0.8673111903691+zee,     1,
		bac*0.7595901886368, 0.8778621461493+zee,     1,
		bac*0.7708351765685, 0.8865395664053+zee,     1,
		bac*0.7833209345768, 0.8931564379244+zee,     1,
		bac*0.7966808473712, 0.8975976677554+zee,     1,
		bac*0.8105602959487, 0.8997938445718+zee,     1,
		bac*0.8246003077138, 0.8997097392458+zee,     1,
		bac*0.8384525204504, 0.8973496933741+zee,     1,
		bac*0.8517630471273, 0.8927451985133+zee,     1,
		bac*0.8641706214157, 0.8859725398306+zee,     1,
		bac*0.8753088744419, 0.8771516840593+zee,     1,
		bac*0.8848024671265, 0.8664720107092+zee,     1,
		bac*0.8922878882509, 0.8542106840637+zee,     1,
		bac*0.8974503856626, 0.8407297732849+zee,     1,
		bac*0.9000499396195, 0.8264683536786+zee,     1,
				 bac*0.9, 0.8196074250759+zee,     1,
				 bac*0.9, 0.07274901301811,     1,
		bac*0.8973070762871, 0.05851679632127,     1,
		bac*0.8920534803358, 0.04506934841447,     1,
		bac*0.8844858869628, 0.03285739378564,     1,
		bac*0.8749276256134, 0.02224561418475,     1,
		bac*0.8637396028866, 0.01349772985178,     1,
		bac*0.8512898980467, 0.006800569866368,     1,
		bac*0.8379522056853, 0.002277258264593,     1,
		bac*0.8240877835979, 2.398177668019E-017,     1,
		bac*0.07591221640209, 1.845931736176E-017,     1,
		bac*0.06204779431468, 0.002277258264593,     1,
		bac*0.04871010195333, 0.006800569866368,     1,
		bac*0.03626039711344, 0.01349772985178,     1,
		bac*0.02507237438662, 0.02224561418475,     1,
		bac*0.0155141130372, 0.03285739378564,     1,
		bac*0.007946519664197, 0.04506934841447,     1,
		bac*0.002692923712876, 0.05851679632127,     1,
		0, 0.07274901301811,     1,
		0, 0.3392786757382+see,     1,
		bac*0.003671953580813, 0.3586814810741+see,     1,
		bac*0.01085136179389, 0.3770593598888+see,     1,
		bac*0.02123429417948, 0.3938164212934+see,     1,
		bac*0.03441521437722, 0.4084525662378+see,     1,
		bac*0.04992245551074, 0.4205756353607+see,     1,
		bac*0.067250402201, 0.4298959007823+see,     1,
		bac*0.08588014347145, 0.4362136022463+see,     1,
		bac*0.1057298753639, 0.4394745685672+see,     1,
		bac*0.1241766736962, 0.4390703777182+see,     1,
		bac*0.1259808779418, 0.4389151055221+see,     1,

		-rr*SIN(ss), rr-rr*COS(ss), 0, 0,
		0, 0, 0, 0,
		GET(NSP),
		rr*SIN(alpha+ss), rr-rr*COS(alpha+ss), 0, 0
	DEL 1

 ELSE
	rr=radius_i+b: alpha=(ASN(a/2/rr))*2

	sn=INT(gs_resol/2)

	IF alpha<=45 THEN sn=1
	IF alpha>45 THEN sn=3
	ss=alpha/sn

	FOR i=1 TO sn
		PUT rr*SIN((alpha/sn)*i), rr-rr*COS((alpha/sn)*i), 0, 0
	NEXT i
	she=gs_seat_height-0.316763-leg_h
	zhe=zzyzx-0.573-leg_h
	zz=(zzyzx-leg_h)/(0.653-leg_h): bb=b/0.844: bbb=b/(b/COS(alpha/2))
	ADDZ leg_h
	TUBE 6, 4, 1+2+16+32,
		bbb*bb*0.593059,     she+0.262139,     0,
		0.0,     she+0.316763,     0,
		0.0,    0.0,     0,
		bbb*bb*0.844,     0.0,     0,
		bbb*bb*0.844,     zhe+0.573,     0,
		bbb*bb*0.708455,     zhe+0.573,     0,

		-rr*SIN(ss), rr-rr*COS(ss), 0, 0,
		0, 0, 0, 0,
		GET(NSP),
		rr*SIN(alpha+ss), rr-rr*COS(alpha+ss), 0, 0
	DEl 1
 ENDIF
ENDIF

END

!----------------> !!! RETURN !!! <----------------
10:
leg_h=0
RETURN

11:
ADD 0.0525, 0.045, 0
IF iSofaUnitType2 = SOFAUNIT_STANDARD THEN CALL "fa_sofalegtyp" PARAMETERS sofaleg_typ_m = 1,a = a-0.105,
b=b-0.10, gs_detlevel_3D_m=gs_detlevel_3D_m, leg_pos_m=_legPositionType,
gs_resol=gs_resol,gs_cont_pen=gs_cont_pen, gs_leg_mat=gs_leg_mat
DEL 1
IF iSofaUnitType2 = SOFAUNIT_CURVA THEN
	ADDY b
	ROTZ 180
	CALL "fa_sofalegtyp" PARAMETERS sofaleg_typ_m=1,b=b-0.105, gs_detlevel_3D_m=gs_detlevel_3D_m, leg_pos_m=_legPositionType,
	r=radius_i+0.105, angle=-6.5, dist=0.045,
	gs_resol=gs_resol,gs_cont_pen=gs_cont_pen, gs_leg_mat=gs_leg_mat
	CALL "fa_sofalegtyp" PARAMETERS sofaleg_typ_m=1,b=b-0.105, gs_detlevel_3D_m=gs_detlevel_3D_m, leg_pos_m=_legPositionType,
	r=radius_i+0.105, angle=-alpha+6.5, dist=0.045,
	gs_resol=gs_resol,gs_cont_pen=gs_cont_pen, gs_leg_mat=gs_leg_mat
	DEL 2
ENDIF

IF iSofaUnitType2 = SOFAUNIT_CURVB THEN
	CALL "fa_sofalegtyp" PARAMETERS sofaleg_typ_m=1,b=b-0.105, gs_detlevel_3D_m=gs_detlevel_3D_m, leg_pos_m=_legPositionType,
	r=radius_i+0.105, angle=6.5, dist=0.045,
	gs_resol=gs_resol,gs_cont_pen=gs_cont_pen, gs_leg_mat=gs_leg_mat
	CALL "fa_sofalegtyp" PARAMETERS sofaleg_typ_m=1,b=b-0.105, gs_detlevel_3D_m=gs_detlevel_3D_m, leg_pos_m=_legPositionType,
	r=radius_i+0.105, angle=alpha-6.5, dist=0.045,
	gs_resol=gs_resol,gs_cont_pen=gs_cont_pen, gs_leg_mat=gs_leg_mat
ENDIF
RETURN

12:
ADD 0.06, 0.05, 0
IF iSofaUnitType2 = SOFAUNIT_STANDARD THEN CALL "fa_sofalegtyp" PARAMETERS sofaleg_typ_m = 2,a = a-0.12,
b=b-0.10, leg_h=leg_h, gs_detlevel_3D_m=gs_detlevel_3D_m, leg_pos_m=_legPositionType,
gs_resol=gs_resol,gs_cont_pen=gs_cont_pen, gs_leg_mat=gs_leg_mat
DEL 1
IF iSofaUnitType2 = SOFAUNIT_CURVA THEN
	ADDY b
	ROTZ 180
	CALL "fa_sofalegtyp" PARAMETERS sofaleg_typ_m=2,b=b-0.10, gs_detlevel_3D_m=gs_detlevel_3D_m, leg_h=leg_h,
	leg_pos_m=_legPositionType, r=radius_i+0.10, angle=-5.5, dist=0.05,
	gs_resol=gs_resol,gs_cont_pen=gs_cont_pen, gs_leg_mat=gs_leg_mat
	CALL "fa_sofalegtyp" PARAMETERS sofaleg_typ_m=2,b=b-0.10, gs_detlevel_3D_m=gs_detlevel_3D_m, leg_h=leg_h,
	leg_pos_m=_legPositionType, r=radius_i+0.10, angle=-alpha+5.5, dist=0.05,
	gs_resol=gs_resol,gs_cont_pen=gs_cont_pen, gs_leg_mat=gs_leg_mat
	DEL 2
ENDIF

IF iSofaUnitType2 = SOFAUNIT_CURVB THEN
	CALL "fa_sofalegtyp" PARAMETERS sofaleg_typ_m=2,b=b-0.10, gs_detlevel_3D_m=gs_detlevel_3D_m, leg_h=leg_h,
	leg_pos_m=_legPositionType, r=radius_i+0.10, angle=5.5, dist=0.05,
	gs_resol=gs_resol,gs_cont_pen=gs_cont_pen, gs_leg_mat=gs_leg_mat
	CALL "fa_sofalegtyp" PARAMETERS sofaleg_typ_m=2,b=b-0.10, gs_detlevel_3D_m=gs_detlevel_3D_m, leg_h=leg_h,
	leg_pos_m=_legPositionType, r=radius_i+0.10, angle=alpha-5.5, dist=0.05,
	gs_resol=gs_resol,gs_cont_pen=gs_cont_pen, gs_leg_mat=gs_leg_mat
ENDIF
RETURN

13:
ADD 0.075, 0.085, 0
IF iSofaUnitType2 = SOFAUNIT_STANDARD THEN CALL "fa_sofalegtyp" PARAMETERS sofaleg_typ_m = 3,a = a-0.15,
b=b-0.18, leg_h=leg_h, gs_detlevel_3D_m=gs_detlevel_3D_m, leg_pos_m=_legPositionType,
gs_resol=gs_resol,gs_cont_pen=gs_cont_pen, gs_leg_mat=gs_leg_mat
DEL 1
IF iSofaUnitType2 = SOFAUNIT_CURVA THEN
	ADDY b
	ROTZ 180
	CALL "fa_sofalegtyp" PARAMETERS sofaleg_typ_m=3,b=b-0.18, gs_detlevel_3D_m=gs_detlevel_3D_m, leg_h=leg_h,
	leg_pos_m=_legPositionType, r=radius_i+0.18, angle=-5.5, dist=0.085,
	gs_resol=gs_resol,gs_cont_pen=gs_cont_pen, gs_leg_mat=gs_leg_mat
	CALL "fa_sofalegtyp" PARAMETERS sofaleg_typ_m=3,b=b-0.18, gs_detlevel_3D_m=gs_detlevel_3D_m, leg_h=leg_h,
	leg_pos_m=_legPositionType, r=radius_i+0.18, angle=-alpha+5.5, dist=0.085,
	gs_resol=gs_resol,gs_cont_pen=gs_cont_pen, gs_leg_mat=gs_leg_mat
	DEL 2
ENDIF

IF iSofaUnitType2 = SOFAUNIT_CURVB THEN
	CALL "fa_sofalegtyp" PARAMETERS sofaleg_typ_m=3,b=b-0.18, gs_detlevel_3D_m=gs_detlevel_3D_m, leg_h=leg_h,
	leg_pos_m=_legPositionType, r=radius_i+0.18, angle=5.5, dist=0.085,
	gs_resol=gs_resol,gs_cont_pen=gs_cont_pen, gs_leg_mat=gs_leg_mat
	CALL "fa_sofalegtyp" PARAMETERS sofaleg_typ_m=3,b=b-0.18, gs_detlevel_3D_m=gs_detlevel_3D_m, leg_h=leg_h,
	leg_pos_m=_legPositionType, r=radius_i+0.18, angle=alpha-5.5, dist=0.085,
	gs_resol=gs_resol,gs_cont_pen=gs_cont_pen, gs_leg_mat=gs_leg_mat
ENDIF
RETURN

14:
ADD 0.02, 0.085, 0
IF iSofaUnitType2 = SOFAUNIT_STANDARD THEN CALL "fa_sofalegtyp" PARAMETERS sofaleg_typ_m = 4,a = a-0.04,
b=b-0.185, leg_h=leg_h, gs_detlevel_3D_m=gs_detlevel_3D_m, leg_pos_m=_legPositionType,
gs_resol=gs_resol,gs_cont_pen=gs_cont_pen, gs_leg_mat=gs_leg_mat
DEL 1
IF iSofaUnitType2 = SOFAUNIT_CURVA THEN
	ADDY b
	ROTZ 180
	CALL "fa_sofalegtyp" PARAMETERS sofaleg_typ_m=4,b=b-0.185, gs_detlevel_3D_m=gs_detlevel_3D_m, leg_h=leg_h,
	leg_pos_m=_legPositionType, r=radius_i+0.185, angle=-5.5, dist=0.085,
	gs_resol=gs_resol,gs_cont_pen=gs_cont_pen, gs_leg_mat=gs_leg_mat
	CALL "fa_sofalegtyp" PARAMETERS sofaleg_typ_m=4,b=b-0.185, gs_detlevel_3D_m=gs_detlevel_3D_m, leg_h=leg_h,
	leg_pos_m=_legPositionType, r=radius_i+0.185, angle=-alpha+5.5, dist=0.085,
	gs_resol=gs_resol,gs_cont_pen=gs_cont_pen, gs_leg_mat=gs_leg_mat
	DEL 2
ENDIF

IF iSofaUnitType2 = SOFAUNIT_CURVB THEN
	CALL "fa_sofalegtyp" PARAMETERS sofaleg_typ_m=4,b=b-0.185, gs_detlevel_3D_m=gs_detlevel_3D_m, leg_h=leg_h,
	leg_pos_m=_legPositionType, r=radius_i+0.185, angle=5.5, dist=0.085,
	gs_resol=gs_resol,gs_cont_pen=gs_cont_pen, gs_leg_mat=gs_leg_mat
	CALL "fa_sofalegtyp" PARAMETERS sofaleg_typ_m=4,b=b-0.185, gs_detlevel_3D_m=gs_detlevel_3D_m, leg_h=leg_h,
	leg_pos_m=_legPositionType, r=radius_i+0.185, angle=alpha-5.5, dist=0.085,
	gs_resol=gs_resol,gs_cont_pen=gs_cont_pen, gs_leg_mat=gs_leg_mat
ENDIF
RETURN

15:
ADD 0.075, 0.105, 0
IF iSofaUnitType2 = SOFAUNIT_STANDARD THEN CALL "fa_sofalegtyp" PARAMETERS sofaleg_typ_m = 5,a = a-0.15,
 b=b-0.22, leg_h=leg_h, ur=0.025, lr=0.015,leg_pos_m=_legPositionType,
gs_cont_pen=gs_cont_pen, gs_leg_mat=gs_leg_mat
DEL 1
IF iSofaUnitType2 = SOFAUNIT_CURVA THEN
	ADDY b
	ROTZ 180
	CALL "fa_sofalegtyp" PARAMETERS sofaleg_typ_m=5,b=b-0.22, leg_h=leg_h,
	ur=0.025, lr=0.015,leg_pos_m=_legPositionType, r=radius_i+0.22, angle=-6.5, dist=0.105,
	gs_cont_pen=gs_cont_pen, gs_leg_mat=gs_leg_mat
	CALL "fa_sofalegtyp" PARAMETERS sofaleg_typ_m=5,b=b-0.22, leg_h=leg_h,
	ur=0.025, lr=0.015,leg_pos_m=_legPositionType, r=radius_i+0.22, angle=-alpha+6.5, dist=0.105,
	gs_cont_pen=gs_cont_pen, gs_leg_mat=gs_leg_mat
	DEL 2
ENDIF

IF iSofaUnitType2 = SOFAUNIT_CURVB THEN
	CALL "fa_sofalegtyp" PARAMETERS sofaleg_typ_m=5,b=b-0.22, leg_h=leg_h,
	ur=0.025, lr=0.015,leg_pos_m=_legPositionType, r=radius_i+0.22, angle=6.5, dist=0.105,
	gs_cont_pen=gs_cont_pen, gs_leg_mat=gs_leg_mat
	CALL "fa_sofalegtyp" PARAMETERS sofaleg_typ_m=5,b=b-0.22, leg_h=leg_h,
	ur=0.025, lr=0.015,leg_pos_m=_legPositionType, r=radius_i+0.22, angle=alpha-6.5, dist=0.105,
	gs_cont_pen=gs_cont_pen, gs_leg_mat=gs_leg_mat
ENDIF
RETURN

100:
	sh=gs_seat_height-0.316763-leg_h
	zh=zzyzx-0.573-leg_h
	zz=1
	if GLOB_CONTEXT = 3 then
  		contourStatus = 14+64
	else
  		contourStatus = 15+64
	endif

MULX -1
ROTZ 90
ROTX 90
HPRISM_ gs_sofa_mat,gs_sofa_mat,gs_sofa_mat,gs_sofa_mat,
	56,0.04,0,0.04,1,

    bac*0.5909559448409, 0.399013109646+see,  contourStatus,
    bac*0.6027912842486, 0.3987096772842+see, contourStatus,
    bac*0.6125917285096, 0.4002599606719+see, contourStatus,
    bac*0.6222255642665, 0.4034625323809+see, contourStatus,
    bac*0.6309592779127, 0.4080908284277+see, contourStatus,
    bac*0.6385172561444, 0.4139242711665+see, contourStatus,
    bac*0.6447063957045, 0.4207077841968+see, contourStatus,
    bac*0.6494021640446, 0.4281747149031+see, contourStatus,
    bac*0.6497342754433, 0.4290083706836+see, contourStatus,
    bac*0.7384039662842, 0.8453253773279+zee, contourStatus,
    bac*0.7423199072537, 0.8551535908857+zee,contourStatus,
    bac*0.7499646191822, 0.8673111903691+zee, contourStatus,
    bac*0.7595901886368, 0.8778621461493+zee, contourStatus,
    bac*0.7708351765685, 0.8865395664053+zee, contourStatus,
    bac*0.7833209345768, 0.8931564379244+zee, contourStatus,
    bac*0.796680847370, 0.8975976677554+zee, contourStatus,
    bac*0.8105602959487, 0.8997938445718+zee, contourStatus,
    bac*0.8246003077138, 0.8997097392458+zee, contourStatus,
    bac*0.8384525204504, 0.8973496933741+zee, contourStatus,
    bac*0.8517630471273, 0.8927451985133+zee, contourStatus,
    bac*0.8641706214157, 0.8859725398306+zee, contourStatus,
    bac*0.8753088744419, 0.8771516840593+zee, contourStatus,
    bac*0.8848024671265, 0.8664720107092+zee, contourStatus,
    bac*0.8922878882509, 0.8542106840637+zee,contourStatus,
    bac*0.8974503856626, 0.8407297732849+zee, contourStatus,
    bac*0.9000499396195, 0.8264683536786+zee, contourStatus,
    bac*0.9, 		0.8196074250759+zee, contourStatus,
    bac*0.9, 			0.07274901301811, contourStatus,
    bac*0.8973070762871, 0.05851679632127, contourStatus,
    bac*0.8920534803358, 0.04506934841447, contourStatus,
    bac*0.8844858869628, 0.03285739378564, contourStatus,
    bac*0.8749276256134, 0.02224561418475, contourStatus,
    bac*0.8637396028866, 0.01349772985178, contourStatus,
    bac*0.8512898980467, 0.006800569866368, contourStatus,
    bac*0.8379522056853, 0.002277258264593, contourStatus,
    bac*0.8240877835979, 2.398177668019E-017, contourStatus,
    bac*0.07591221640209, 1.845931736176E-017, contourStatus,
    bac*0.06204779431468, 0.002277258264593,contourStatus,
    bac*0.04871010195333, 0.006800569866368, contourStatus,
    bac*0.03626039711344, 0.01349772985178, contourStatus,
    bac*0.02507237438662, 0.02224561418475, contourStatus,
    bac*0.0155141130372, 0.03285739378564, contourStatus,
    bac*0.007946519664197, 0.04506934841447, contourStatus,
    bac*0.002692923712876, 0.05851679632127, contourStatus,
    0, 					0.07274901301811, contourStatus,
    0, 					0.3392786757382+see, contourStatus,
    bac*0.003671953580813, 0.3586814810741+see, contourStatus,
    bac*0.01085136179389, 0.3770593598888+see, contourStatus,
    bac*0.02123429417948, 0.3938164212934+see, contourStatus,
    bac*0.03441521437722, 0.4084525662378+see, contourStatus,
    bac*0.04992245551074, 0.4205756353607+see,contourStatus,
    bac*0.067250402201, 0.4298959007823+see, contourStatus,
    bac*0.08588014347145, 0.4362136022463+see, contourStatus,
    bac*0.1057298753639, 0.4394745685672+see, contourStatus,
    bac*0.1241766736962, 0.4390703777182+see,  contourStatus,
    bac*0.1259808779418, 0.4389151055221+see,    contourStatus
DEL 1
DEL 1
DEL 1

RETURN

130:

RETURN
