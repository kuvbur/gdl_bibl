

IF gs_detlevel_3D_m=0 then END

IF gs_shadow=0 THEN SHADOW OFF

addz placementHeight

unID = 1

! --- X Dimension --------------------------------------------------------------
HOTSPOT 0,0,0,unID, A,1+256 : unID=unID+1
HOTSPOT -1,0,0,unID, A,3 : unID=unID+1
HOTSPOT A,0,0,unID, A,2 : unID=unID+1

HOTSPOT 0,B,0,unID, A,1+256 : unID=unID+1
HOTSPOT -1,B,0,unID, A,3 : unID=unID+1
HOTSPOT A,B,0,unID, A,2 : unID=unID+1

! --- X Dimension --------------------------------------------------------------
HOTSPOT 0,0,0,unID, B,1+256 : unID=unID+1
HOTSPOT 0,-1,0,unID, B,3 : unID=unID+1
HOTSPOT 0,B,0,unID, B,2 : unID=unID+1

HOTSPOT A,0,0,unID, B,1+256 : unID=unID+1
HOTSPOT A,-1,0,unID, B,3 : unID=unID+1
HOTSPOT A,B,0,unID, B,2 : unID=unID+1

! --- ZZyZx --------------------------------------------------------------------
HOTSPOT 0,0,0,unID, zzyzx,1+128 : unID=unID+1
HOTSPOT 0,0,-1,unID, zzyzx,3 : unID=unID+1
HOTSPOT 0,0,zzyzx,unID, zzyzx,2 : unID=unID+1

HOTSPOT A,0,0,unID, zzyzx,1+128 : unID=unID+1
HOTSPOT A,0,-1,unID, zzyzx,3 : unID=unID+1
HOTSPOT A,0,zzyzx,unID, zzyzx,2 : unID=unID+1

HOTSPOT A,B,0,unID, zzyzx,1+128 : unID=unID+1
HOTSPOT A,B,-1,unID, zzyzx,3 : unID=unID+1
HOTSPOT A,B,zzyzx,unID, zzyzx,2 : unID=unID+1

HOTSPOT 0,B,0,unID, zzyzx,1+128 : unID=unID+1
HOTSPOT 0,B,-1,unID, zzyzx,3 : unID=unID+1
HOTSPOT 0,B,zzyzx,unID, zzyzx,2 : unID=unID+1


PEN gs_cont_pen


if same_thk then
	valt1=p_th
	valt2=p_th
	valt3=p_th
	valt4=p_th
else
	valt1=p_th_low
	valt2=p_th_left
	valt3=p_th_right
	valt4=p_th_up
endif


MATERIAL gs_p_mat

if side_vis_m=1 then
	if same_thk then
		mask_tp2=13:mask_temp7=12:mask_temp52=10:mask_temp8=10
		mask_temp51=10:mask_temp5=10:mask_temp=11:mask_tp=13
		mask_temp6=11:mask_temp7=14:mask_temp2=11
		mask_temp3=14:mask_temp4=14:mask_tp5=12:mask_tp4=9
		mask3=13:mask4=15:mask=15:mask2=13:mask_tp61=8:mask_temp81=8

		if ABS(bpt) < EPS then
			mask_tp6=10:mask_temp11=13:mask_tp31=11:mask_tp3=14
			mask_temp12=13:mask_temp9=11:mask_temp10=14:mask_tp61=10
		else
			mask_tp6=8:mask_temp11=9:mask_tp31=9:mask_tp3=12
			mask_temp12=12:mask_t21=8:mask_temp81=10:mask_temp9=11
			mask_temp10=14
		endif

	else

		mask_tp6=10:mask_temp3=14:mask_tp5=8:mask_temp10=14
		mask_tp2=13:mask_temp7=14:mask_tp=13:mask_temp=11:mask_temp9=11
		mask_temp51=10:mask_temp5=10:mask_temp2=11:mask_temp4=14:mask4=15
		mask_temp52=10:mask_tp61=10:mask_tp4=8:mask_temp6=11:mask_temp81=8
		mask3=15:mask2=15:mask=15
		if ABS(bpt) < EPS then
			mask_temp11=13:mask_temp12=13:mask_temp8=10
			mask_tp3=14:mask_tp31=11:mask4=15:mask2=15

				if ABS(p_th_up) < EPS then
					mask_temp8=14:mask_tp6=8:mask_temp51=14:mask_temp52=14
					mask_tp6=14:mask_temp5=14:mask_t21=8:mask_tp61=14
				endif
				if ABS(p_th_low) < EPS then
					mask_t21=9:mask_tp6=11:mask_temp5=11:mask_tp61=11
					mask_temp51=11:mask_temp52=11:mask_temp8=11
				endif
				if ABS(p_th_up) < EPS and ABS(p_th_low) < EPS then
					mask_temp51=15:mask_temp52=15:mask_t21=13
					mask_tp6=15:mask_temp8=15:mask_temp5=15:mask_tp61=15
				endif
				if ABS(p_th_right) < EPS then
					mask_tp31=15:mask_tp=15:mask_tp3=15:mask_tp2=15
					mask_t21=8
				endif
				if ABS(p_th_right) < EPS then
					mask_temp=15:mask_temp11=15
					mask_temp3=15:mask_temp12=15
				endif
		else
			mask_temp11=9:mask_temp12=12:mask_temp81=10
			mask_tp6=8:mask_tp3=12:mask_tp61=8:mask_tp5=12
			mask_tp31=9:mask_t21=8:mask_tp4=9:mask_temp8=10
			mask_temp81=10

			if ABS(p_th_up) < EPS then
				mask_tp6=8:mask_t21=12:mask_temp5=14:maskk_1=12
				mask_tp6=12:mask_temp51=14:mask_temp52=14
			endif
			if ABS(p_th_low) < EPS then
				mask_t21=9:mask_temp8=11:mask_tp6=9:mask_temp8=11
				mask_temp51=11:mask_temp52=11:mask_temp5=11
				mask_tp61=9:mask_temp81=11
			endif
			if ABS(p_th_up) < EPS and ABS(p_th_low) < EPS then
				mask_temp51=15:mask_temp52=15:mask_t21=13
				mask_tp6=13:mask_temp8=15:mask_temp5=15
				mask_tp61=13:mask_temp81=15
			endif
			if ABS(p_th_right) < EPS then
				mask_tp=15:mask_tp31=13:mask_tp3=13:mask_t21=10
				mask_tp61=8:mask_temp81=10:mask_temp8=10
			endif
			if ABS(p_th_left) < EPS then
				mask_tp4=9:mask_tp5=12:mask_temp=15
				mask_temp11=11:mask_temp12=14:mask_temp3=15
			endif
		endif
	endif
endif

if side_vis_m=2 then
	if same_thk then
		mask_tp2=13:mask_temp7=12:mask_temp52=10:mask_temp8=8:mask_temp81=8
		mask_tp61=8:mask_temp51=10:mask_temp5=10:mask_temp=8:mask_tp=13
		mask_temp9=9:mask_temp6=11:mask_temp7=14:mask_temp2=11
		mask_temp3=8:mask_temp10=12:mask_temp4=14:mask_tp5=8:mask_tp4=8
		mask4=15:mask=15:mask2=13:mask3=15

		if ABS(bpt) < EPS then
			mask_tp6=10:mask_temp11=13:mask_tp31=11:mask_tp3=14
			mask_temp12=13
		else
			mask_tp6=8:mask_temp11=9:mask_tp31=9:mask_tp3=12
			mask_temp12=12:mask_t21=8
		endif

	else

		mask_temp8=8:mask_tp6=10:mask_temp3=8:mask_tp5=8:mask_temp10=12
		mask_tp2=13:mask_temp7=14:mask_tp=13:mask_temp=8:mask_temp9=9
		mask_temp51=10:mask_temp5=10:mask_temp2=11:mask_temp4=14
		mask_temp52=10:mask_tp61=8:mask_tp4=8:mask_temp6=11:mask_temp81=8
		mask4=15:mask2=15:mask=15:mask2=13:mask3=15
		if ABS(bpt) < EPS then
			mask_temp11=13:mask_temp12=13
			mask_tp3=14:mask_tp31=11

			if ABS(p_th_up) < EPS then
				mask_temp8=12:mask_tp6=8:mask_temp51=14:mask_temp52=14
				mask_tp6=14:mask_temp5=14:mask_t21=8
			endif
			if ABS(p_th_low) < EPS then
				mask_t21=9:mask_tp6=11:mask_temp5=11
				mask_temp51=11:mask_temp52=11:mask_temp8=9
				endif
			if ABS(p_th_up) < EPS and ABS(p_th_low) < EPS then
				mask_temp51=15:mask_temp52=15:mask_t21=13
				mask_tp6=15:mask_temp8=13:mask_temp5=15
			endif
			if ABS(p_th_right) < EPS then
				mask_tp31=15:mask_tp=15:mask_tp3=15:mask_tp2=15
				mask_t21=8
			endif

		else

			mask_temp11=9:mask_temp12=12
			mask_tp6=8:mask_tp3=12
			mask_tp31=9:mask_t21=8
			if ABS(p_th_up) < EPS then
				mask_temp8=14:mask_tp6=8:mask_t21=12:mask_temp5=14
				mask_tp6=12:mask_temp51=14:mask_temp52=14:mask_temp8=12
				mask_temp81=8
			endif
			if ABS(p_th_low) < EPS then
				mask_t21=9:mask_temp8=11:mask_tp6=9:mask_temp8=9
				mask_temp51=11:mask_temp52=11:mask_temp5=11
			endif
			if ABS(p_th_up) < EPS and ABS(p_th_low) < EPS then
				mask_temp51=15:mask_temp52=15:mask_t21=13
				mask_tp6=13:mask_temp8=13:mask_temp5=15
			endif
			if ABS(p_th_right) < EPS then
				mask_tp=15:mask_tp31=13:mask_tp3=13:mask_t21=10
			endif

		endif
	endif
endif

if side_vis_m=3 then
	mask_temp81=8:mask3=13:mask4=15:mask=15:mask2=13

	if same_thk then
		mask_tp2=13:mask_temp7=12:mask_tp=13:mask_temp52=10:mask_temp8=10
		mask_temp51=8:mask_t21=8:mask_temp81=10
		if ABS(bpt) < EPS then
			mask_tp6=10:mask_tp61=10:mask_temp11=13:mask_temp9=11
			mask_tp4=9:mask_temp=11:mask_tp3=8:mask_temp12=13
			mask_temp10=14:mask_tp5=12:mask_temp3=14:mask_temp2=8
			mask_temp4=8:mask_temp5=8:mask_temp6=9:mask_tp31=8
		else
			mask_tp6=8:mask_temp11=9:mask_temp9=11:mask_tp4=9
			mask_temp=11:mask_tp3=8:mask_temp12=12:mask_temp10=14
			mask_tp5=12:mask_temp3=14:mask_temp2=8:mask_temp4=8
			mask_temp5=8:mask_temp6=9:mask_tp31=8:mask_tp61=8
		endif

	else

		mask_temp8=10:mask_tp6=10:mask_tp3=8:mask_temp6=9:mask_temp3=14
		mask_tp2=13:mask_temp7=12:mask_tp=13:mask_temp=11:mask_temp9=11
		mask_temp52=10:mask_tp31=8:mask_temp5=8:mask_temp51=8
		mask_temp2=8:mask_temp4=8:mask_t21=8:mask_temp81=10
		if ABS(bpt) < EPS then
			mask_temp11=13:mask_temp12=13:mask_tp61=10:mask_temp10=14

			if ABS(p_th_up) < EPS then
				mask_temp8=14:mask_tp6=8:mask_temp51=12:mask_temp52=14
				mask_tp61=14:mask_tp6=14
			endif
			if ABS(p_th_low) < EPS then
				mask_t21=9:mask_tp6=11:mask_tp61=11
				mask_temp51=9:mask_temp52=11:mask_temp8=11
			endif
			if ABS(p_th_up) < EPS and ABS(p_th_low) < EPS then
				mask_temp51=13:mask_temp52=15:mask_t21=13
				mask_tp6=15:mask_temp8=15:mask_tp61=15
			endif
			if ABS(p_th_left) < EPS then
				mask_temp=15:mask_temp11=15:mask_temp3=15
				mask_temp12=15
			endif
		else

			mask_temp11=9:mask_temp12=12:mask_tp61=8:mask_tp4=9
			mask_tp5=12:mask_tp6=8:mask_temp10=14

			if ABS(p_th_up) < EPS then
				mask_temp8=14:mask_tp6=8:mask_t21=12:mask_tp61=12
				mask_tp6=12:mask_temp51=12:mask_temp52=14
				:mask_temp81=14
			endif
			if ABS(p_th_low) < EPS then
				mask_t21=9:mask_tp61=9:mask_temp8=11:mask_tp6=9
				mask_temp51=9:mask_temp52=11:mask_temp81=11
			endif
			if ABS(p_th_up) < EPS and ABS(p_th_low) < EPS then
				mask_temp51=13:mask_temp52=15:mask_t21=13
				mask_tp6=13:mask_temp8=15:mask_tp61=13
				mask_temp81=15
			endif
			if ABS(p_th_left) < EPS then
				mask_temp=15:mask_temp11=11:mask_temp3=15
				mask_temp12=14
			endif
		endif
	endif
endif

if side_vis_m=4 then
	mask_temp81=8:mask3=13:mask4=15:mask=15:mask2=13:mask_temp8=8
	if same_thk then
		mask_tp2=13:mask_temp7=12:mask_tp=13:mask_temp52=10:mask_tp5=8
		mask_temp51=8:mask_t21=8:mask_temp9=9:mask_temp=8:mask_tp4=8
		mask_temp10=12:mask_temp3=8:mask_tp61=8
		if ABS(bpt) < EPS then
			mask_tp6=10:mask_temp11=13
			mask_tp3=8:mask_temp12=13:mask_temp2=8
			mask_temp4=8:mask_temp5=8:mask_temp6=9:mask_tp31=8
		else
			mask_tp6=8:mask_temp11=9:mask_temp2=8:mask_temp4=8
			mask_tp3=8:mask_temp12=12
			mask_temp5=8:mask_temp6=9:mask_tp31=8
		endif

	else

		mask_temp8=8:mask_tp6=10:mask_tp3=8:mask_temp6=9:mask_temp3=8
		mask_tp2=13:mask_temp7=12:mask_tp=13:mask_temp=8:mask_temp9=9
		mask_temp52=10:mask_tp31=8:mask_temp5=8:mask_temp51=8
		mask_temp2=8:mask_temp4=8:mask_t21=8:mask_temp81=8:mask_tp5=8
		mask_temp11=13:mask_tp4=8:mask_temp10=12:mask_tp61=8
		if ABS(bpt) < EPS then
			mask_temp12=13
			if ABS(p_th_up) < EPS then
				mask_temp8=12:mask_tp6=8:mask_temp51=12:mask_temp52=14
				mask_tp6=14
			endif
			if ABS(p_th_low) < EPS then
				mask_t21=9:mask_tp6=11
				mask_temp51=9:mask_temp52=11:mask_temp8=9
			endif
			if ABS(p_th_up) < EPS and ABS(p_th_low) < EPS then
				mask_temp51=13:mask_temp52=15:mask_t21=13
				mask_tp6=15:mask_temp8=13
			endif
			if ABS(p_th_left) < EPS then
				mask_temp=15:mask_temp11=15:mask_temp3=15
				mask_temp12=15
			endif
		else

			mask_temp11=9:mask_temp12=12:mask_tp61=8
			mask_tp6=8:mask_temp10=12:mask_temp9=9:mask_temp81=8

			if ABS(p_th_up) < EPS then
				mask_temp8=12:mask_tp6=8:mask_t21=12
				mask_tp6=12:mask_temp51=12:mask_temp52=14
			endif
			if ABS(p_th_low) < EPS then
				mask_t21=9:mask_tp61=8:mask_temp8=9:mask_tp6=9
				mask_temp51=9:mask_temp52=11:mask_temp81=8
			endif
			if ABS(p_th_up) < EPS and ABS(p_th_low) < EPS then
				mask_temp51=13:mask_temp52=15:mask_t21=13
				mask_tp6=13:mask_temp8=13:mask_tp61=8
				mask_temp81=8
			endif
			if ABS(p_th_left) < EPS then
				mask_temp=15:mask_temp11=11:mask_temp3=15
				mask_temp12=14
			endif
		endif
	endif
endif


if valt1>0 then
	PRISM_ 11,valt1,
			0,0,mask_temp,
			0,b-bpt,mask_tp4,
			0,b,mask_temp9,
			valt2,b,mask_temp11,
			a-valt3,b,9,
			a,b,mask_temp2,
			a,b-bpt,mask_tp31,
			a,0,mask_temp6,
			a-valt3,0,mask_tp,
			valt2,0,9,
			0,0,-1
endif

if valt4>0 then
	addz zzyzx-valt4

	PRISM_ 11,valt4,
			0,0,mask_temp3,
			0,b-bpt,mask_tp5,
			0,b,mask_temp10,
			valt2,b,mask_temp12,
			a-valt3,b,12,
			a,b,mask_temp4,
			a,b-bpt,mask_tp3,
			a,0,mask_temp7,
			a-valt3,0,mask_tp2,
			valt2,0,12,
			0,0,-1

	del 1
endif

if side_vis_m=1 or side_vis_m=2 then
	mask_t=13

	if ABS(p_th_right) < EPS then
		mask_t2=10
	else
		mask_t2=8
	endif
else
	mask_t=15:mask_t2=8

endif

if side_vis_m=1 or side_vis_m=3 then
	if ABS(p_th_left) < EPS then
		mask_t=15:mask_t3=10
		if ABS(p_th_up) < EPS and ABS(p_th_low) < EPS and ABS(p_th_left) < EPS then
			mask_t3=15
		endif
		if ABS(p_th_low) < EPS and ABS(p_th_left) < EPS then
			mask_t3=11
		endif
		if ABS(p_th_up) < EPS and ABS(p_th_left) < EPS then
			mask_t3=14
		endif

	else
		mask_t3=8
	endif
endif


addz valt1
if bpt>0 then
	material bpmat
	PRISM_ 5,zzyzx-valt1-valt4,
			valt2,b-bpt,mask_t,
			a-valt3,b-bpt,mask_t2,
			a-valt3,b,mask_t21,
			valt2,b,mask_t3,
			valt2,b-bpt,-1
endif

MATERIAL gs_p_mat

if valt2>0 then
	PRISM_ 7,zzyzx-valt1-valt4,			!!! Left
			0,0,mask_temp8,
			valt2,0,15,
			valt2,b-bpt,10,
			valt2,b,mask_tp6,
			0,b,mask_temp81,
			0,b-bpt,mask_tp61,
			0,0,-1
endif

if side_vis_m=2 then

	if bpt>0 and ABS(p_th_up)< EPS then
		maskk_1=12
	else
		maskk_1=8
	endif
	if bpt>0 and ABS(p_th_low)< EPS then
		maskk_1=9
	else
		maskk_1=8
	endif
	if bpt>0 and ABS(p_th_up) < EPS and ABS(p_th_low) < EPS then
		maskk_1=13
	else
		maskk_1=8
	endif
else
	maskk_1=8
endif

if side_vis_m=1 then
	if bpt>0 and ABS(p_th_up)< EPS then
		maskk_1=12
	else
		maskk_1=8
	endif
	if bpt>0 and ABS(p_th_low)< EPS then
		maskk_1=9
	else
		maskk_1=8
	endif
	if bpt>0 and ABS(p_th_up) < EPS and ABS(p_th_low) < EPS then
		maskk_1=13
	else
		maskk_1=8
	endif

endif
if valt3>0 then

	PRISM_ 7,zzyzx-valt1-valt4,			!!! Rihgt
			a,0,mask_temp5,
			a,b-bpt,maskk_1,
			a,b,mask_temp51,
			a-valt3,b,8,
			a-valt3,b-bpt,15,
			a-valt3,0,mask_temp52,
			a,0,-1
endif

del 1


if bpt>0 then
	bb=b-bpt
else
	bb=b
endif

frontShelfOffset=0
if gs_detlevel_3D_m=2 then
	frontShelfOffset=0.01
endif

nCuts = 0
if gs_detlevel_3D_m=2 and vpn>0 then
	add valt2,0,valt1
	for ii=1 to vpn
		addx (((a-valt2-valt3)-(vpn*vpth))/(vpn+1))

		cutpolya 5,1,0,
				0,0,15,
				vpth,0,15,
				vpth,bb,15,
				0,bb,15,
				0,0,-1
		addx vpth
	next ii
	nCuts = vpn
	del 2*vpn

	del 1
endif


material gs_sh_mat
if shelf_num>0 then
	addz valt1
	addx valt2
	for i=1 to shelf_num
		addz (((zzyzx - valt1 - valt4) - (shelf_thk * shelf_num)) / (shelf_num + 1))!-shelf_thk/2
		for k = 1 to (vpn+1)
		PRISM_ 5,shelf_thk,
			0,									frontShelfOffset,	mask4,
			((a-valt2-valt3)-vpn*vpth)/(vpn+1),	frontShelfOffset,	mask,
			((a-valt2-valt3)-vpn*vpth)/(vpn+1),	bb,					mask2,
			0,									bb,					mask3,
			0,									frontShelfOffset,	-1
			addx (((a-valt2-valt3)- vpn*vpth)/(vpn+1)) + vpth
		next k
		del (vpn + 1)
		addz shelf_thk
	Next i
	del 2 * shelf_num

	del 2
endif

for iCut=1 to nCuts
	cutend
next iCut


material gs_vp_mat
if vpn>0 then
	add valt2,0,valt1
	for ii=1 to vpn
		addx (((a-valt2-valt3)-(vpn*vpth))/(vpn+1))

		PRISM_ 5,zzyzx-valt1-valt4,
				0,0,15,
				vpth,0,15,
				vpth,bb,15,
				0,bb,15,
				0,0,-1
		addx vpth
	Next ii
	del vpn
	del vpn

	del 1
endif

del 1

gosub 1000

end

1000:
roty 90
gosub 5000
del 1
return

2000:
gosub 5000
return

5000:

vert 0, 0, 0
vert 1, 0, 0
vert 0, 1, 0
vert 0, 0, 1

coor 2, -1, -2, -3, -4


base

body -1

return

