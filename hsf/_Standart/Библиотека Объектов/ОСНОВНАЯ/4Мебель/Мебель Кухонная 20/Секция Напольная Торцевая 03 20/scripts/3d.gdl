
IF gs_detlevel_3D_m=0 then END
IF GLOB_CONTEXT>20 and GLOB_CONTEXT<40 THEN gs_detlevel_3D_m=1

IF gs_detlevel_3D_m=1 THEN RESOL 4
IF gs_detlevel_3D_m=2 THEN RESOL gs_resol

if gs_detlevel_3D_m = 1 then 
	if gs_count_type_m # 0 then gs_count_type_m = 1
endif

IF not(gs_shadow) THEN SHADOW OFF

basecab_unID=1
CALL "fa_gen_endcabinet" PARAMETERS a=a, b=b, zzyzx=zzyzx,
		gs_detlevel_3D_m=gs_detlevel_3D_m, dob_face=0, count_th=count_th,
		front_cab=front_cab, rear_cab=0, left_cab=0,
		right_cab=right_cab, toe_h=toe_h, side_vis_m=0,
		sink=0, shelf_num=shelf_num, gs_cont_pen=gs_cont_pen, gs_shadow=gs_shadow,
		drawer=0,fr_th1=0,depth_cab=depth_cab,cab_size=cab_size,
		toe_d=toe_d,gs_toe_type_m=gs_toe_type_m,ToeHtps3D=1,
		gs_ShelfMat=gs_ShelfMat,toe_mat=toe_mat, gs_cabinet_mat=gs_cabinet_mat,
		basecab_unID=basecab_unID,
		returned_parameters basecab_unID



unID = basecab_unID

! --- Counter -----------------------------------------------------------------

dd = side_vis_m

ADDZ ZZYZX-count_th
IF gs_count_type_m = 1 THEN
	CPRISM_ count_mat, count_mat, count_mat, 5, count_th,                  !! COUNTER
		0, 0, 13+2*((dd=1) OR (dd=3)),
		a, b-depth_cab-FrontY*cab_size, 8+7*((dd=2) OR (dd=3)),
		a, b, 13+2*((dd=2) OR (dd=3)),
		0, b, 8+7*((dd=1) OR (dd=3)),
		0, 0, -1
ENDIF
IF gs_count_type_m = 2 Then

	CPRISM_ count_mat, count_mat, count_mat, 5, count_th,                  !! COUNTER
		0, rr4, 13,
		a, b-depth_cab+rr4-FrontY*cab_size, 8+7*((dd=2) OR (dd=3)),
		a, b, 13+2*((dd=2) OR (dd=3)),
		0, b, 8+7*((dd=1) OR (dd=3)),
		0, rr4, -1

	RESOL gs_resol
	addz count_th
	MATERIAL count_mat
	TUBE 6,4, 3+16*((dd=1) OR (dd=3))+32*((dd=2) OR (dd=3)),
			0,0,1,
			0,-count_th,1,
			-rr4,-count_th,1,
			-rr4,-rr4,1,
			0,-rr4,901,
			rr4,-90,4001,

			-a, b-depth_cab+rr4-FrontY*cab_size,0,0,
			0, +rr4,0,0,
			a, b-depth_cab+rr4-FrontY*cab_size,0,0,
			2*a, 0,0,0


	del 1
ENDIF
del 1

! --- BackSpalsh --------------------------------------------------------------

IF bs_h > 0 & gs_count_type_m # 0 THEN
	add 0,b-0.02,ZZYZX
	CPRISM_ bs_mat, bs_mat, bs_mat, 5, bs_h,
			0, 0, 13+2*((dd=1) OR (dd=3)),
			a, 0, 8+7*((dd=2) OR (dd=3)),
			a, 0.02, 13+2*((dd=2) OR (dd=3)),
			0, 0.02, 8+7*((dd=1) OR (dd=3)),
			0, 0, -1
	DEL 1
ENDIF


! --- Hotspots ----------------------------------------------------------------

unID=1

IF gs_count_type_m=0 THEN
	a=a-right_cab
	b=b-front_cab
	TEMP=1
	ADDy front_cab
ELSE
	a=a
	b=b
	TEMP=0
	ADDy 0
ENDIF

unID=unID+1
hotspot a, b, 0, unID, zzyzx, 1+128
unID=unID+1
hotspot a, b, -1, unID, zzyzx, 3
unID=unID+1
hotspot a, b, zzyzx, unID, zzyzx, 2

unID=unID+1
hotspot 0, b, 0, unID, zzyzx, 1+128
unID=unID+1
hotspot 0, b, -1, unID, zzyzx, 3
unID=unID+1
hotspot 0, b, zzyzx, unID, zzyzx, 2

unID=unID+1
hotspot 0, 0, 0, unID, zzyzx, 1+128
unID=unID+1
hotspot 0, 0, -1, unID, zzyzx, 3
unID=unID+1
hotspot 0, 0, zzyzx, unID, zzyzx, 2

unID=unID+1
hotspot a, b-depth_cab-FrontY*cab_size+FrontY*TEMP, 0, unID, zzyzx, 1+128
unID=unID+1
hotspot a,  b-depth_cab-FrontY*cab_size+FrontY*TEMP, -1, unID, zzyzx, 3
unID=unID+1
hotspot a,  b-depth_cab-FrontY*cab_size+FrontY*TEMP, zzyzx, unID, zzyzx, 2

DEL 1
