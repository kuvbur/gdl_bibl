

if not(gs_shadow) then shadow off
if iDetlevel3D = 2 then	! Detailed
	resol gs_resol
else
	if iDetlevel3D = 1 then ! Simple
		resol 3
		gs_resol = 6
	else
		END	! Off
	endif
endif

pen gs_cont_pen


!-----Definitions-----
unID = 1
panelWidth = 0.02												! Side panel
wheelPoz = 0.05
reducedA = a-0.77+0.13											! Scaler A
reducedB = b-0.57												! Scaler B
drawerBottomOffset = 0.01										! Drawer bottom offset
barHeight = 0.05												! Upper bar height


!-----Hotspot-----
call "Resize_A_B_ZZYZX" Parameters ALL

hotspot a/2, b, ZZYZX, unID : unID = unID + 1
hotspot a/2, b, 0, unID : unID = unID + 1


!-----Base-----
addz wheelHeight
bPillar = 0
gosub 10
bPillar = 1
addz baseHeight+ 2*boardHeight-boardHeight
gosub 10
del 2

!-----Wheel-----
wheelAlfa = 200
add wheelPoz, wheelPoz, 0
gosub 40
addy b-2*wheelPoz
gosub 40
del 2
wheelAlfa = 20
add a-wheelPoz, wheelPoz, 0
gosub 40
addy b-2*wheelPoz
gosub 40
del 2

!-----Side Panels-----
material gs_side_mat
if iStyle = 3 then		! With Lower Tray
	panelHeigth = baseHeight - lowerHeight
	addz lowerHeight + wheelHeight + boardHeight
else
	panelHeigth = baseHeight
	addz wheelHeight + boardHeight
endif
drawerX1 = 0.07181980515339
drawerX2 = b-drawerX1
addx 0.03
gosub 20
del 1
addx a-0.03-panelWidth
gosub 20
del 1

rotz -90
addx -b+0.03
drawerX1 = 0.0714662517628
drawerX2 = a-drawerX1
gosub 20
del 3

!-----Front-----
drawerHeight = 0.05
add 0.0713, 0.03, ZZYZX-boardHeight-drawerHeight
gosub 90
del 1

drawerDepth = b-2*0.03-panelWidth-drawerEps
add 0.073, 0.03, 0

if iStyle = 1 then	! Basket
	drawerHeight = drawerH[1]
	addz lowerHeight + wheelHeight + boardHeight
	knobNumber = 1
	gosub 100
	addz drawerUnitHeigth
	knobNumber = 2
	gosub 100
	del 2
endif

if iStyle = 2 then	! Drawers only
	addz wheelHeight + boardHeight + drawerEps
	drawerHeight = drawerH[1]
	knobNumber = 1
	gosub 100
	addz (lowerHeight-drawerUnitHeigth) - drawerEps
	drawerHeight = drawerH[2]
	knobNumber = 2
	gosub 100
	addz drawerUnitHeigth
	knobNumber = 3
	gosub 100
	addz drawerUnitHeigth
	drawerHeight = drawerH[4]
	knobNumber = 4
	gosub 100
	addz drawerUnitHeigth/2
	knobNumber = 5
	gosub 100
	del 5
endif

if iStyle = 3 then	! With Lower Tray
	drawerHeight = drawerH[1]
	addz lowerHeight + wheelHeight + boardHeight
	knobNumber = 1
	gosub 100
	addz drawerUnitHeigth
	drawerHeight = drawerH[2]
	knobNumber = 2
	gosub 100
	addz drawerUnitHeigth/2
	knobNumber = 3
	gosub 100
	del 3
endif

del 1

if iStyle = 3 then	! With Lower Tray Bottom Bars
	material gs_bar_mat
	addz boardHeight + wheelHeight
	frameRadius = 0.01
	frameHeigth = barHeight
	profilRadius = 0.004
	gosub 110
	del 1
endif


!-----Uppers Bars-----
if bUpper then
	material gs_bar_mat
	addz baseHeight + 2*boardHeight + wheelHeight
	frameRadius = 0.01
	frameHeigth = barHeight
	profilRadius = 0.004
	gosub 110
	del 1
endif

!-----Side Bar-----
if bSide then
	material gs_bar_mat
	frameRadius = 0.05
	profilRadius = 0.01
	sidebarAlfa = 130
	addz baseHeight + 2*boardHeight + wheelHeight - profilRadius - boardHeight - 0.02
	gosub 120
	del 1
endif



END
! ======================================================================
! SubRoutines
! ======================================================================
!-----Motherboard-----
10:
	curveUnitLength = (reducedA)/4

	if iDetlevel3D = 2 then	! Detailed
		if bPillar then
			cutalfa = 11
		else
			cutalfa = 15
		endif
		addz boardHeight/2
		rotz -45
		cutplane{2} cutalfa
		del 1

		addx a
		rotz 45
		cutplane{2} cutalfa
		del 1

		addy b
		rotz 135
		cutplane{2} cutalfa
		del 3

		addy b
		rotz -135
		cutplane{2} cutalfa
		del 2

		del 1
	endif

	if bPillar then
		addz -baseHeight-2*boardHeight+boardHeight
		material gs_cabinet_mat

		prism_ 10, baseHeight+2*boardHeight,
			0.07134062043357, reducedB+0.5410857864376,     15,
			0.05414213562373, reducedB+0.5582842712475,     79,
			0.0612132034356, reducedB+0.5087867965644,   979,
			0, 73.73979529169,  4079,
			0.01171572875254, reducedB+0.5158578643763,    79,
			0.0293933982822, reducedB+0.4981801948466,     15,
			0.05343502884254, reducedB+0.4981801948466,    15,
			0.0714662517628, reducedB+0.5162114177669,     15,
			0.0714662517628, reducedB+0.5412114177669,     15,
			0.07134062043357, reducedB+0.5410857864376,    -1

		prism_ 10, baseHeight+2*boardHeight,
			reducedA+0.5685337482372, reducedB+0.5412114177669,     15,
			reducedA+0.5685337482372, reducedB+0.5162114177669,     15,
			reducedA+0.5865649711575, reducedB+0.4981801948466,     15,
			reducedA+0.6106066017178, reducedB+0.4981801948466,     15,
			reducedA+0.6282842712475, reducedB+0.5158578643763,     79,
			reducedA+0.5787867965644, reducedB+0.5087867965644,   979,
			0, 73.73979529169,  4079,
			reducedA+0.5858578643763, reducedB+0.5582842712475,     79,
			reducedA+0.5686593795664, reducedB+0.5410857864376,     15,
			reducedA+0.5685337482372, reducedB+0.5412114177669,     -1

		prism_ 10, baseHeight+2*boardHeight,
			reducedA+0.5686593795664, 0.02891421356237,     15,
			reducedA+0.5858578643763, 0.01171572875254,     79,
			reducedA+0.5787867965644, 0.0612132034356,   979,
			0, 73.73979529169,  4079,
			reducedA+0.6282842712475, 0.05414213562373,     79,
			reducedA+0.6106066017178, 0.07181980515339,     15,
			reducedA+0.5865649711575, 0.07181980515339,     15,
			reducedA+0.5685337482372, 0.05378858223314,     15,
			reducedA+0.5685337482372, 0.02878858223314,     15,
			0.5686593795664, 0.02891421356237,     -1

		prism_ 10, baseHeight+2*boardHeight,
			0.0714662517628, 0.02878858223314,     15,
			0.0714662517628, 0.05378858223314,     15,
			0.05343502884254, 0.07181980515339,     15,
			0.0293933982822, 0.07181980515339,     15,
			0.01171572875254, 0.05414213562373,     79,
			0.0612132034356, 0.0612132034356,   979,
			0, 73.73979529169,  4079,
			0.05414213562373, 0.01171572875254,     79,
			0.07134062043357, 0.02891421356237,     15,
			0.0714662517628, 0.02878858223314,     -1
		del 1
	endif

	material gs_cabinet_mat
	prism_ 110, boardHeight,
		0.02,        0.095,     79,
		-0.007434027689205,        0.095,   979,
		0, -45.7308886913,  4079,
		0.01171572875254, 0.07535533905933,     79,
		0.04, 0.04707106781187,   979,
		0,           90,  4079,
		0.01171572875254, 0.0187867965644,     79,
		0.0187867965644, 0.01171572875254,     79,
		0.04707106781187,         0.04,   979,
		0,           90,  4079,
		0.07535533905933, 0.01171572875254,     79,
		0.095, -0.007434027689205,   979,
		0, -45.7308886913,  4079, 					!Corner 1 end
		curveUnitLength+0.2075,       0.0125,     1079,
		curveUnitLength*2+0.32,        0.005,     1079,
		curveUnitLength*3+0.4325,       0.0125,     1079,
		reducedA+0.545,         0.02,     1079, 			!Corner 2 start
		reducedA+0.545, -0.007434027689205,   979,
		0, -45.7308886913,  4079,
		reducedA+0.5646446609407, 0.01171572875254,     79,
		reducedA+0.5929289321881,         0.04,   979,
		0,           90,  4079,
		reducedA+0.6212132034356, 0.01171572875254,     79,
		reducedA+0.6282842712475, 0.0187867965644,     79,
		reducedA+0.6, 0.04707106781187,   979,
		0,           90,  4079,
		reducedA+0.6282842712475, 0.07535533905933,     79,
		reducedA+0.6474340276892,        0.095,   979,
		0, -45.7308886913,  4079,
		reducedA+0.62,        0.095,     79,
		reducedA+0.62,        reducedB+0.475,     79,
		reducedA+0.6474340276892,        reducedB+0.475,   979,
		0, -45.7308886913,  4079,
		reducedA+0.6282842712475, reducedB+0.4946446609407,     79,
		reducedA+0.6, reducedB+0.5229289321881,   979,
		0,           90,  4079,
		reducedA+0.6282842712475, reducedB+0.5512132034356,     79,
		reducedA+0.6212132034356, reducedB+0.5582842712475,     79,
		reducedA+0.5929289321881,         reducedB+0.53,   979,
		0,           90,  4079,
		reducedA+0.5646446609407, reducedB+0.5582842712475,     79,
		reducedA+0.545, reducedB+0.5774340276892,   979,
		0, -45.7308886913,  4079, 				!Corner 3 end
		curveUnitLength*3+0.4325,       reducedB+0.5575,     1079,
		curveUnitLength*2+0.32,        reducedB+0.565,     1079,
		curveUnitLength+0.2075,       reducedB+0.5575,     1079,
		0.095,         reducedB+0.55,     1079, 			!Cornewr 4 start
		0.095, reducedB+0.5774340276892,   979,
		0, -45.7308886913,  4079,
		0.07535533905933, reducedB+0.5582842712475,     79,
		0.04707106781187,        reducedB+0.53,   979,
		0,           90,  4079,
		0.0187867965644, reducedB+0.5582842712475,     79,
		0.01171572875254, reducedB+0.5512132034356,     79,
		0.04, reducedB+0.5229289321881,   979,
		0,           90,  4079,
		0.01171572875254, reducedB+0.4946446609407,     79,
		-0.007434027689205,        reducedB+0.475,   979,
		0, -45.7308886913,  4079,
		0.02,        reducedB+0.475,     79,
		0.02,        0.095,     -1,
		0.06,         reducedB+0.49,     15, 	! Tray
		0.06,         0.08,     15,
		0.08,         0.06,     15,
		reducedA+0.56,         0.06,     15,
		reducedA+0.58,         0.08,     15,
		reducedA+0.58,         reducedB+0.49,     15,
		reducedA+0.56,         reducedB+0.51,     15,
		0.08,         reducedB+0.51,     15,
		 0.06,         reducedB+0.49,     -1,
		0.07134062043357, reducedB+0.5410857864376,     15,
		0.05414213562373, reducedB+0.5582842712475,     79,
		0.0612132034356, reducedB+0.5087867965644,   979,
		0, 73.73979529169,  4079,
		0.01171572875254, reducedB+0.5158578643763,    15,
		0.0293933982822, reducedB+0.4981801948466,     15,
		0.05343502884254, reducedB+0.4981801948466,    15,
		0.0714662517628, reducedB+0.5162114177669,     15,
		0.0714662517628, reducedB+0.5412114177669,     15,
		0.07134062043357, reducedB+0.5410857864376,     -1,
		reducedA+0.5685337482372, reducedB+0.5412114177669,     15,
		reducedA+0.5685337482372, reducedB+0.5162114177669,     15,
		reducedA+0.5865649711575, reducedB+0.4981801948466,     15,
		reducedA+0.6106066017178, reducedB+0.4981801948466,     15,
		reducedA+0.6282842712475, reducedB+0.5158578643763,     79,
		reducedA+0.5787867965644, reducedB+0.5087867965644,   979,
		0, 73.73979529169,  4079,
		reducedA+0.5858578643763, reducedB+0.5582842712475,     15,
		reducedA+0.5686593795664, reducedB+0.5410857864376,     15,
		reducedA+0.5685337482372, reducedB+0.5412114177669,     -1,
		reducedA+0.5686593795664, 0.02891421356237,     15,
		reducedA+0.5858578643763, 0.01171572875254,     79,
		reducedA+0.5787867965644, 0.0612132034356,   979,
		0, 73.73979529169,  4079,
		reducedA+0.6282842712475, 0.05414213562373,     15,
		reducedA+0.6106066017178, 0.07181980515339,     15,
		reducedA+0.5865649711575, 0.07181980515339,     15,
		reducedA+0.5685337482372, 0.05378858223314,     15,
		reducedA+0.5685337482372, 0.02878858223314,     15,
		0.5686593795664, 0.02891421356237,     -1,
		0.0714662517628, 0.02878858223314,     15,
		0.0714662517628, 0.05378858223314,     15,
		0.05343502884254, 0.07181980515339,     15,
		0.0293933982822, 0.07181980515339,     15,
		0.01171572875254, 0.05414213562373,     79,
		0.0612132034356, 0.0612132034356,   979,
		0, 73.73979529169,  4079,
		0.05414213562373, 0.01171572875254,     15,
		0.07134062043357, 0.02891421356237,     15,
		0.0714662517628, 0.02878858223314,     -1

	if iDetlevel3D = 2 then	! Detailed
		cutend
		cutend
		cutend
		cutend
	endif

	material gs_top_mat
	prism_ 9, boardHeight-0.01,
		0.06,         b-0.08,     15, 	! Tray
		0.06,         0.08,     15,
		0.08,         0.06,     15,
		a-0.08,       0.06,     15,
		a-0.06,       0.08,     15,
		a-0.06,       b-0.08,     15,
		a-0.08,       b-0.06,     15,
		0.08,         b-0.06,     15,
		0.06,         b-0.08,     -1

	return


!-----Panel-----
20:
	prism 4, panelHeigth,
		0, drawerX1,
		panelWidth, drawerX1,
		panelWidth, drawerX2,
		0, drawerX2
	return


!-----Wheel-----
40:
	material gs_cabinet_mat
	mul wheelHeight/0.0815, wheelHeight/0.0815, wheelHeight/0.0815
	rotz wheelAlfa
	if iDetlevel3D = 1 then resol 5
	addz 0.0795
	cylind 0.002, 0.0225
	del 1

	add -0.02, 0.011, 0.0375
	rotx 90
	material gs_wheel_mat
	cylind 0.022, 0.0375
	if iDetlevel3D = 1 then resol 3

	addz -0.006
	material gs_cabinet_mat
	prism_ 6, 0.005,
		-0.01, -0.01, 15,
		0.01, -0.01, 15,
		0.032, 0.042, 15,
		0.008, 0.042, 15,
		-0.01, 0, 15,
		-0.01, -0.01, -1
	addz 0.029
	prism_ 6, 0.005,
		-0.01, -0.01, 15,
		0.01, -0.01, 15,
		0.032, 0.042, 15,
		0.008, 0.042, 15,
		-0.01, 0, 15,
		-0.01, -0.01, -1
	del 6
	return


! ----- U bar -----
50:
	rotx 90
	iRes = int(gs_resol/2)
	iAlpha = 90/iRes

	put  0, -1, 0, 0
	put  0, 0, 0, 0
	put  0, frameHeigth-frameRadius ,   0,0
	for i=1 to iRes-1
		put frameRadius-cos(i*iAlpha)*frameRadius, frameHeigth-frameRadius+sin(i*iAlpha)*frameRadius, 0, 0
	next i
	put frameRadius , frameHeigth,0,0
	put frameLenght-frameRadius , frameHeigth,0,0
	for i=1 to iRes-1
		put frameLenght-frameRadius+sin(i*iAlpha)*frameRadius, frameHeigth-frameRadius+cos(i*iAlpha)*frameRadius, 0,0
	next i
	put frameLenght, frameHeigth-frameRadius, 0, 0
	put frameLenght, 0, 0, 0
	put frameLenght, -1, 0, 0

	tube 2, NSP/4, 1+2+16+32+128,
		0, 0, 901,
		profilRadius , 360, 4001,
		GET (NSP)

	del 1
	return


! ----- Top front-----
90:
	material gs_drawer_mat
	prism 4, drawerHeight,
		0, 0,
		a-2*0.0713, 0,
		a-2*0.0713, panelWidth,
		0, panelWidth
	return


! ----- Drawer-----
100:
	! --- Front ---
	material gs_drawer_mat
	prism 4, drawerHeight,
		0, 0,
		drawerWidth, 0,
		drawerWidth, panelWidth,
		0, panelWidth

	! --- Drawer ---
	if iDetlevel3D = 2 then	! Detailed
		material gs_side_mat
		addz drawerBottomOffset
		prism 4, panelWidth,
			drawerBottomOffset, panelWidth,
			drawerWidth-drawerBottomOffset,  panelWidth,
			drawerWidth-drawerBottomOffset, drawerDepth,
			drawerBottomOffset, drawerDepth
		addz panelWidth

		prism 4, drawerHeight-panelWidth*2.5,
			drawerBottomOffset, panelWidth,
			drawerBottomOffset+panelWidth,  panelWidth,
			drawerBottomOffset+panelWidth, drawerDepth,
			drawerBottomOffset, drawerDepth

		prism 4, drawerHeight-panelWidth*2.5,
			drawerWidth-drawerBottomOffset-panelWidth, panelWidth,
			drawerWidth-drawerBottomOffset,  panelWidth,
			drawerWidth-drawerBottomOffset, drawerDepth,
			drawerWidth-drawerBottomOffset-panelWidth, drawerDepth

		prism 4, drawerHeight-panelWidth*2.5,
			drawerWidth-drawerBottomOffset-panelWidth, drawerDepth,
			drawerWidth-drawerBottomOffset-panelWidth,  drawerDepth-panelWidth,
			drawerBottomOffset+panelWidth, drawerDepth-panelWidth,
			drawerBottomOffset+panelWidth, drawerDepth
		del 2
	endif

	! --- Knob ---
	if bKnob then
		add drawerWidth/2, 0, drawerHeight/2+0.005

		hotspot  knob_pl[knobNumber][1], 0,  0, unID, knob_pl[knobNumber][2], 1+128					: unID=unID+1
		hotspot  knob_pl[knobNumber][1], 0, -1, unID, knob_pl[knobNumber][2], 3 					: unID=unID+1
		hotspot  knob_pl[knobNumber][1], 0, knob_pl[knobNumber][2], unID, knob_pl[knobNumber][2],2 	: unID=unID+1

		hotspot  0, 0, knob_pl[knobNumber][2], unID, knob_pl[knobNumber][1], 1+128					: unID=unID+1
		hotspot -1, 0, knob_pl[knobNumber][2], unID, knob_pl[knobNumber][1], 3 						: unID=unID+1
		hotspot  knob_pl[knobNumber][1], 0, knob_pl[knobNumber][2], unID, knob_pl[knobNumber][1],2 	: unID=unID+1

		add	knob_pl[knobNumber][1], 0, knob_pl[knobNumber][2]

		if iKnobStyle= 4  or iKnobStyle = 5 or iKnobStyle = 6 or iKnobStyle = 7 or iKnobStyle = 8 then
			roty 90
			addz 0.1	! knob_size = 0.2
			nTrans = 2
		endif


		if iKnobStyle = 8 then
			roty 180
			addz 0.2
			nTrans = nTrans + 2
		endif


		CALL "fa_knobtyp" PARAMETERS 	gs_detlevel_3D_m	= iDetlevel3D,
										gs_knob_type_m		= iKnobStyle,
										gs_resol			= gs_resol,
										gs_shadow			= gs_shadow,
										gs_cont_pen			= gs_cont_pen,
										gs_knob_mat			= gs_knob_mat,
										knob_size			= 0.2

		del nTrans

		del 2
	endif
	return


! ----- Bars -----
110:
	rotz 90
	drawerX1 = 0.1
	drawerX2 = b-0.1
	add drawerX1, -0.04, 0
	frameLenght = drawerX2 - drawerX1
	gosub 50
	del 1
	add drawerX1, -a+0.04, 0
	frameLenght = drawerX2 - drawerX1
	gosub 50
	del 2

	drawerX1 = 0.1
	drawerX2 = a-0.1
	add drawerX1, b-0.04, 0
	frameLenght = drawerX2 - drawerX1
	gosub 50
	del 1
	return


! ----- Side Bar -----
120:

	iRes = int(gs_resol/2)
	iAlpha = sidebarAlfa/iRes

	alfa = sidebarAlfa+2*iAlpha
	for i=-2 to iRes-1
		put a+0.06-frameRadius-profilRadius+cos(alfa)*frameRadius, b-frameRadius-profilRadius+sin(alfa)*frameRadius, 0, 0
		alfa = alfa - iAlpha
	next i

	put a+0.06-profilRadius , b-frameRadius-profilRadius, 0, 0
	alfa = 0
	for i=0 to iRes+2
		put a+0.06-frameRadius-profilRadius+cos(alfa)*frameRadius, frameRadius+profilRadius-sin(alfa)*frameRadius, 0, 0
		alfa = alfa + iAlpha
	next i

	tube 2, NSP/4, 1+2+16+32+128,
		0, 0, 901,
		profilRadius , 360, 4001,
		GET (NSP)

	return
