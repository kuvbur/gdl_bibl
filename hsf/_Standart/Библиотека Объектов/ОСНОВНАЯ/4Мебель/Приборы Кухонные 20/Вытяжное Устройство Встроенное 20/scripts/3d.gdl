
if gs_detlevel_3D_m = 0 then end

if not(gs_shadow) then shadow off

pen gs_cont_pen

! --- start of modifying to Shaft

				! --- CONNECTIONS --- !

if bShowMEP then
	IF gs_detlevel_3D_m=1 THEN RESOL 8
	IF gs_detlevel_3D_m=2 THEN RESOL 24

	IF useSysMat THEN
		matAppliance	= sMat
		matKnob			= sMat
		matGreaseFilter	= sMat
		matFilterTrim	= sMat
		matLamp			= sMat
		gs_con_mat		= sMat
	ENDIF


	CALL "MEP_m_ConnectionsACL_4" PARAMETERS SetProgram = SetProgram,
		ui_current_con = ui_current_con,
		MEP_NumberConnections = MEP_NumberConnections,
		MEP_NumConnectionData = gs_Connections,
		gs_AddConnections = gs_AddConnections,
		cShow3D = 1,
		gs_ConMat = gs_con_mat,
		MEP_InsShow = 0,
		MEP_cline_show_3D = 0,
		gs_cont_pen = gs_cont_pen,
		ConPosX_1=ConPosX_1, ConPosY_1=ConPosY_1, ConPosZ_1=ConPosZ_1, ConLength_1=ConLength_1, ConEdit_1 = 1
ENDIF

! --- end of modifying to Shaft



if gs_detlevel_3D_m = 1 then gs_resol=8

resol gs_resol

addx a

! --- Under Cabinet 1 ----------------------------------------------------------

if type_m = 1 then
	hotspot -a,	b-depthCabinet,	zzyzx
	hotspot  0,	b-depthCabinet,	zzyzx

	if gs_detlevel_3D_m = 1 then
		roty -90
		material matAppliance
		prism_      7,      a,
				0,      0,				15,
				0,      B,				15,
				zzyzx,  B,				15,
				zzyzx,  b-depthCabinet, 15,
				5",		b-depthCabinet, 15,
				3",		0,				15,
				0,      0,				-1
		del 1
	else  ! Detailed
		roty -90
		rotx 90
		addy 0
		cutpolya 4, 1, 0,
				5",		a-8",	15,
				6.8",	a-8",	15,
				6.8",	8",		15,
				5",		8",		15
		del 3

		roty -90
		material matAppliance
		prism_      7,      a,
				0,      0,				15,
				0,      b,				15,
				zzyzx,  b,				15,
				zzyzx,  b-depthCabinet, 15,
				5",		b-depthCabinet, 15,
				3",		0,				15,
				0,      0,				-1
		del 1

		material matKnob
		add -aa/2, -0.001,0.032
		rotx 90
		resol gs_resol/2
		gz = 0.006 : gr1 = 0.02 : gr2 = 0.01 : gv = 0.003 : beta = 90
		gosub 9996

		add 0.032, -0.01, 0
		gx = 0.01 : gy = 0.02 : gz = 0.004 : gr = 0.0015
		add gx/2 ,gy/2, 0
		gosub 9997

		add 0.018, 0,0
		gosub 9997

		add 0.018, 0,0
		gosub 9997
		del 3

		material matAppliance
		gx = 0.12 : gy = 0.05 : gz = 0.006 : gr = 0.003
		add -0.065+gx/2, -0.014+gy/2,-0.0001
		poly_ 10,
				-gx/2,		-gy/2+gr,	0*64+1,
				-gx/2,		 gy/2-gr,   0*64+1,
				-gx/2+gr,    gy/2,      1000+0*64+1,
				 gx/2-gr,    gy/2,      0*64+1,
				 gx/2,		 gy/2-gr,   1000+0*64+1,
				 gx/2,		-gy/2+gr,   0*64+1,
				 gx/2-gr,	-gy/2,		1000+0*64+1,
				-gx/2+gr,   -gy/2,		0*64+1,
				-gx/2,		-gy/2+gr,	1000+0*64+1,
				-gx/2,		-gy/2+gr,	-1

		del 4

		resol gs_resol
		material matGreaseFilter
		prism_      5,      -0.001,
			-0.025,		0.08,		11,
			-0.025,		b-0.025,	11,
			-a+0.025,	b-0.025,	11,
			-a+0.025,	0.08,		11,
			-0.025,		0.08,		-1

		add -a+.2,0.04,0
		mulx 1.6
		cutpolya 2, 1, 0,
			0,		0,		901,
			0.03,	360,	4015
		del 2
		add -0.2,0.04,0
		mulx 1.6
		cutpolya 2, 1, 0,
			0, 0, 901,
			0.03, 360, 4015
		del 2
		rotx -87
		cutpolya 4, 1, 0,
			-0.03,		0.02, 15,
			-0.03,		0.01, 15,
			-a+0.03,	0.01, 15,
			-a+0.03,	0.02, 15
		del 1

		material matFilterTrim
		prism_      10,      -0.01,
			0,			0,			11,
			0,			b,			11,
			-a,			b,			11,
			-a,			0,			11,
			0,			0,			-1,
			-0.025,		0.08,		11,
			-0.025,		b-0.025,	11,
			-a+0.025,	b-0.025,	11,
			-a+0.025,	0.08,		11,
			-0.025,		0.08,		-1

		cutend
		cutend
		cutend
		cutend

		material matFilterTrim
		for i = 0 to 5
			add -a+8", b-depthCabinet, 5"+0.3"*i
			rotx 45
			rect a-16", 1/2"
			del 2
		next i

		material matLamp
		add -a+3", 0.01, -0.002
		rect a-6", 0.06
		del 1
	endif
endif


! --- Under Cabinet 2 ----------------------------------------------------------

if type_m = 2 then
	r = zzyzx/3
	p = r/5

	add 0, b, 0
	rotz -90
	rotx 90

	if gs_detlevel_3D_m = 1 then
		material matAppliance
		prism_	7, a,
				0,					0,			15,
				0,					zzyzx,		115,
				depthCabinet,		0,			115,
				b-depthCabinet,		-r,			115,
				0,					-r*0.99,	115,
				depthCabinet,		0,			15,
				0,					0,			-1

		material matKnob
		add b, r+p, 0.5*a
		roty 90
		prism_	4, p/10,
				0,		0,		15,
				0.3*a,	0,		115,
				0,		r-2*p,	115,
				-0.3*a, 0,		115
		add 0.15*a, -p+r/2, p/10
		cylind	r/4, (r-2*p)/2*0.8
		addx 0.15*a*0.5
		cylind	r/4, (r-2*p)/2*0.8
		del 2
		del 2
	else							! Detailed
		rr=1*p
		beta=(atn(0.4*b/r))/2
		k=rr*tan(beta)
		x=k*sin(2*beta)
		y=k*cos(2*beta)
		material matAppliance

		addz a/2
		hprism_	matAppliance, matAppliance, matAppliance, matAppliance,
				7, a/2,  0,			rr*0.95, 1,
				0,					0,			15,
				0,					zzyzx,		115,
				depthCabinet,		0,			115,
				b-depthCabinet,		-r,			115,
				0,					-r*0.99,	115,
				depthCabinet,		0,			15,
				0,					0,			-1

		mulz -1
		hprism_	matAppliance, matAppliance, matAppliance, matAppliance,
				7, a/2, 0,	rr*0.95, 1,
				0,				0,			15,
				0,				zzyzx,		115,
				depthCabinet,	0,			115,
				b-depthCabinet, -r,			115,
				0,				-r*0.99,	115,
				depthCabinet,	0,			15,
				0,				0,			-1

		del 2

		material matGreaseFilter
		rotx 90
		prism_	4, zzyzx/100,
				r,			r,		8,
				0.6*b-2*r,	0,		108,
				0,			a-2*r,	108,
				-0.6*b+2*r, 0,		108
		del 1

		material matKnob
		add b, r+p, 0.5*a
		roty 90
		prism_	4, p/10,
				0,		0,		15,
				0.3*a,	0,		115,
				0,		r-2*p,	115,
				-0.3*a, 0,		115
		add 0.15*a, -p+r/2, p/10
		fprism_	matKnob, matKnob, matKnob, matKnob,
				2, r/4, 45, r/4/3,
				0,				0,		979,
				(r-2*p)/2*0.8,	360,	4079
		addx 0.15*a*.5
		fprism_	matKnob, matKnob, matKnob, matKnob,
				2, r/4, 45, r/4/3,
				0,				0,		979,
				(r-2*p)/2*0.8,	360,	4079
		del 4
	endif

	del 3
endif


! --- Inside Cabinet 1 ----------------------------------------------------------

if type_m = 3 then
	add -a/2, b, 0
	IF gs_detlevel_3D_m = 1 THEN
		material matAppliance
		muly B/0.31
		addx -a/2
		rotz 90
		rotx 90
		prism_ 8, a,
			  -0.115, 0,    79,
			   -0.29, -0.2401403508772,    900,
				   0, 36.08233919367,   4013,
			   -0.31,        0.057,    15,
			   -0.31,        0.073,   15,
				0,        0.073,    15,
				   0,            0,    15,
			  -0.115, 0,      15
		del 4

		addz hh1
		prism_ 5, hh2,
			-aa2/2, 0, 15,
			-aa2/2, -bb2, 15,
			 aa2/2, -bb2, 15,
			 aa2/2,  0, 15,
			-aa2/2, 0, -1
		add 0, -0.02-aa3/2, hh2
		if bShowMEP then
			cylind  hh3, ConWidth_1/2+ConWallThickness_1
		else
			cylind  hh3, aa3/2
		endif
		del 2
	endif

	IF gs_detlevel_3D_m = 2 THEN
		muly B/0.31
		material matLamp
		add a/4, -0.04, -0.001
		MULx 1.4
		PRISM_ 2, 0.001,
			0, 0, 900+64+15,
			0.03, 360, 4000+64+15
		DEL 2
		add -a/4, -0.04, -0.001
		MULx 1.4
		PRISM_ 2, 0.001,
			0, 0, 900+64+15,
			0.03, 360, 4000+64+15
		DEL 2

		material matKnob
		add -0.01, -0.04, -0.001
		MULx 1.6
		PRISM_ 2, 0.001,
			0, 0, 900+64+15,
			0.03, 360, 4000+64+15
		del 2

		add -0.04, -0.04, -0.001
		MULZ -1
		RESOL gs_resol/2
		gz=.004 : gr1=.012 : gr2=.008 : gv=.002 : beta=-90
		GOSUB 9996

		add 0.025, -0.008, 0
		gx=.01 : gy=.016 : gz=.004 : gr=.0015
		ADD gx/2 ,gy/2, 0
		GOSUB 9997
		DEL 1

		add .018, 0,0
		gx=.01 : gy=.016 : gz=.004 : gr=.0015
		ADD gx/2 ,gy/2, 0
		GOSUB 9997
		DEL 1

		add .018, 0,0
		gx=.01 : gy=.016 : gz=.004 : gr=.0015
		ADD gx/2 ,gy/2, 0
		GOSUB 9997
		DEL 1
		del 5

		resol gs_resol*3
		material matAppliance
		addx -a/2
		rotz 90
		rotx 90
		prism_ 8, a,
			-0.115, 0,    79,
			-0.29, -0.2401403508772,    900,
			0, 36.08233919367,   4000,
			-0.29,        0.057,    15,
			-0.29,        0.073,   15,
			0,        0.073,    15,
			0,            0,    15,
			-0.115, 0,      15

		material matFilterTrim
		addz 0.02
		prism_ 9, a-0.04,
			-0.3060886165053, 0.05191684629306,      15,
			-0.3062261260481, 0.05441306165349,      79,
			-0.29, -0.2401403508772,    900,
			0, -39.2354170337,   4001,
			-0.1162605538171, -0.001729770491056,      15,
			-0.1177329220051, -0.003750199138396,      79,
			-0.29, -0.2401403508772,    900,
			0, 39.2354170337,   4001,
			-0.3060886165053, 0.05191684629306,      15

		addz 0.01
		material matGreaseFilter
		prism_ 9, a-0.06,
			-0.1199252220215, -0.003005621084262,      15,
			-0.119819715001, -0.002858512976265,      79,
			-0.29, -0.2401403508772,    900,
			0, 38.14556432237,   4001,
			-0.3027225759252, 0.05158235317895,      15,
			-0.3027146882837, 0.05140149325544,      79,
			-0.29, -0.2401403508772,    900,
			0, -38.14556432237,   4001,
			-0.1199252220215, -0.003005621084262,      1
		del 2
		del 3

		material matKnob
		add a/3-0.06, -0.29-0.002, 0.06
		brick 0.04, 0.002, 0.01
		add 0.06, 0, 0
		brick 0.04, 0.002, 0.01
		del 2
		del 1

		addz hh1
		material matAppliance
		prism_ 5, hh2,
			-aa2/2, 0, 15,
			-aa2/2, -bb2, 15,
			 aa2/2, -bb2, 15,
			 aa2/2,  0, 15,
			-aa2/2, 0, -1

		add 0, -0.02-aa3/2, hh2
		if bShowMEP then
			cylind  hh3, ConWidth_1/2+ConWallThickness_1
		else
			cylind  hh3, aa3/2
		endif
		del 2
	endif
	del 1
endif


! --- Inside Cabinet 2 ----------------------------------------------------------

if type_m = 4 then
	add -a/2, b, 0
	if gs_detlevel_3D_m = 1 then
		material matAppliance
		prism_ 5, hh1,
			-A/2, 0, 15,
			-A/2, -B, 15,
			 A/2, -B, 15,
			 A/2,  0, 15,
			-A/2, 0, -1

		addz hh1
		prism_ 5, hh2,
			-aa2/2, 0, 15,
			-aa2/2, -bb2, 15,
			 aa2/2, -bb2, 15,
			 aa2/2,  0, 15,
			-aa2/2, 0, -1

		add 0, -0.02-aa3/2, hh2
		if bShowMEP then
			cylind  hh3, ConWidth_1/2+ConWallThickness_1
		else
			cylind  hh3, aa3/2
		endif
		del 2
	endif

	if gs_detlevel_3D_m = 2 then
		material matGreaseFilter
		prism_ 5, 0.005,
			-aa1/2+0.02, -0.08, 15,
			-aa1/2+0.02, -bb1+0.01, 15,
			 aa1/2-0.02, -bb1+0.01, 15,
			 aa1/2-0.02,  -0.08, 15,
			-aa1/2+0.02, -0.08, -1

		material matLamp
		add a/4, -0.04, 0.004
		MULx 1.4
		PRISM_ 2, 0.001,
			0, 0, 900+64+15,
			0.03, 360, 4000+64+15
		DEL 2
		add -a/4, -0.04, 0.004
		MULx 1.4
		PRISM_ 2, 0.001,
			0, 0, 900+64+15,
			0.03, 360, 4000+64+15
		DEL 2

		material matKnob
		add -0.01, -0.04, 0.004
		MULx 1.6
		PRISM_ 2, 0.001,
			0, 0, 900+64+15,
			0.03, 360, 4000+64+15
		del 2

		add -0.04, -0.04, 0.004
		MULZ -1
		RESOL gs_resol/2
		gz=.004 : gr1=.012 : gr2=.008 : gv=.002 : beta=-90
		GOSUB 9996

		add .025, -.008,0
		gx=.01 : gy=.016 : gz=.004 : gr=.0015
		ADD gx/2 ,gy/2, 0
		GOSUB 9997
		DEL 1

		add .018, 0,0
		gx=.01 : gy=.016 : gz=.004 : gr=.0015
		ADD gx/2 ,gy/2, 0
		GOSUB 9997
		DEL 1

		add .018, 0,0
		gx=.01 : gy=.016 : gz=.004 : gr=.0015
		ADD gx/2 ,gy/2, 0
		GOSUB 9997
		DEL 1
		del 5

		addz 0.005
		material matAppliance
		prism_ 5, hh1-0.01,
			-aa1/2, 0, 15,
			-aa1/2, -bb1, 15,
			 aa1/2, -bb1, 15,
			 aa1/2,  0, 15,
			-aa1/2, 0, -1
		del 1

		material matFilterTrim
		prism_ 5, hh1,
			-aa1/2, -bb1, 15,
			-aa1/2, -bb1-0.02, 15,
			 aa1/2, -bb1-0.02, 15,
			 aa1/2, -bb1, 15,
			-aa1/2, -bb1, -1

		material matKnob
		add a/3-0.06, -b-0.002, 0.03
		brick 0.04, 0.002, 0.016
		add 0.06, 0, 0
		brick 0.04, 0.002, 0.016
		del 2

		addz hh1-0.005
		material matAppliance
		prism_ 5, hh2+0.005,
			-aa2/2, 0, 15,
			-aa2/2, -bb2, 15,
			 aa2/2, -bb2, 15,
			 aa2/2,  0, 15,
			-aa2/2, 0, -1

		add 0, -0.02-aa3/2, hh2+0.005
		resol gs_resol
		if bShowMEP then
			cylind  hh3, ConWidth_1/2+ConWallThickness_1
		else
			cylind  hh3, aa3/2
		endif
		del 2
	endif
	del 1
endif


! --- Inside Cabinet 3 ----------------------------------------------------------

if type_m = 5 then

	hotspot -a/2,b-0.08,zzyzx
	material matAppliance
	ruled 4 , 1*0+2*1+4*1+16*1+32*1+64*0,
		-0.02,			0.08,		0,
		-a+0.02,		0.08,		0,
		-a+0.02,		b-0.02,		0,
		-0.02,			b-0.02,		0,
		-(a-0.2)/2,		b-0.15,		0.18,
		-a+(a-0.2)/2,	b-0.15,		0.18,
		-a+(a-0.2)/2,	b-0.02,		0.18,
		-(a-0.2)/2,		b-0.02,		0.18


	if gs_detlevel_3D_m = 1 then
		material matAppliance
		prism_      5,      -.01,
			0,      0,      15,
			0,      b,      15,
			-a,		b,      15,
			-a,		0,		15,
			0,      0,      -1

		add -a/2, b-0.08, 0.18
		if bShowMEP then
			cylind  zzyzx-0.18, ConWidth_1/2+ConWallThickness_1
		else
			cylind  zzyzx-0.18, 0.06
		endif
		del 1
	else  ! Detailed
		material matAppliance
		add -a/2, b-0.08, 0.18
		if bShowMEP then
			cylind  zzyzx-0.18, ConWidth_1/2+ConWallThickness_1
		else
			cylind  zzyzx-0.18, 0.06
		endif
		del 1

		material matKnob
		rotx 4
		add -aa/2-.05, 0.03, -0.014
		mulz -1
		resol gs_resol/2
		gz = 0.004 : gr1 = 0.012 : gr2 = 0.008 : gv = 0.002 : beta = -90
		gosub 9996

		add 0.025, -0.008, 0
		gx = 0.01 : gy = 0.016 : gz = 0.004 : gr = 0.0015
		add gx/2 ,gy/2, 0
		gosub 9997
		del 1

		add 0.018, 0,0
		gx = 0.01 : gy = 0.016 : gz = 0.004 : gr = 0.0015
		add gx/2 ,gy/2, 0
		gosub 9997
		del 1

		add 0.018, 0, 0
		gx = 0.01 : gy = 0.016 : gz = 0.004 : gr = 0.0015
		add gx/2 ,gy/2, 0
		gosub 9997
		del 1

		del 6

		resol gs_resol
		material matGreaseFilter
		prism_      5,      -0.001,
			-0.025,		0.08,		15,
			-0.025,		b-0.025,	15,
			-a+0.025,	b-0.025,	15,
			-a+0.025,	0.08,		15,
			-0.025,		0.08,		-1

		material matAppliance
		rotx 4
		add -a/2, 0.03, -0.01
		mul 2.6, 1, -1
		cone 0.004, 0.025, 0.023, 90 , 90
		del 3

		rotx -86
		cutpolya 4, 1, 0,
			-0.03,		0.02,	15,
			-0.03,		0.01,	15,
			-a+0.03,	0.01,	15,
			-a+0.03,	0.02,	15
		del 1

		material matFilterTrim
		prism_      10,      -0.01,
			0,			0,			15,
			0,			b,			15,
			-a,			b,			15,
			-a,			0,			15,
			0,			0,			-1,
			-0.025,		0.08,		15,
			-0.025,		b-0.025,	15,
			-a+0.025,	b-0.025,	15,
			-a+0.025,	0.08,		15,
			-0.025,		0.08,		-1

		cutend
		material matLamp
		rotx 4
		add -a+0.15, 0.04, -0.0101
		mulx 1.6
		prism_ 2, .0001,
			0,		0,		900+64+15,
			0.03,	360,	4000+64+15
		del 2
		add -0.15, 0.04, -0.0101
		mulx 1.6
		prism_ 2, 0.0001,
			0,		0,		900+64+15,
			0.03,	360,	4000+64+15
		del 3
	endif
endif
del 1

end



9997:
	mm=15
	prism_ 10, gz-gr,
				-gx/2,		-gy/2+gr,	64+mm,
				-gx/2,		 gy/2-gr,   64+mm,
				-gx/2+gr,    gy/2,      1000+64+mm,
				 gx/2-gr,    gy/2,      64+mm,
				 gx/2,		 gy/2-gr,   1000+64+mm,
				 gx/2,		-gy/2+gr,   64+mm,
				 gx/2-gr,	-gy/2,		1000+64+mm,
				-gx/2+gr,   -gy/2,      64+mm,
				-gx/2,		-gy/2+gr,	1000+64+mm,
				-gx/2,		-gy/2+gr,	-1
	m=64
	mm=15
	rotz -90
	rotx 90
	add 0,gz-gr, -(gx-2*gr)/2
	mul 5*(gy-2*gr), 5*(gy-2*gr), 1
	prism_      20,      gx-2*gr,
			   -0.095396,   0.029993,		m+mm,
				0.0,		0.0,			900+m+mm,
				0.0,		17.4536,		4000+m+mm,
			   -0.1,		0.0,			m+mm,
				0.1,		0.0,			m+mm,
				0.0,		0.0,			900+m+mm,
				0.0,		11.3325,		4000+m+mm,
				0.09805,    0.01965,		m+mm,
				0.088245,   0.017685,		900+m+mm,
				0.0,		105.1596,		4000+m+mm,
				0.083785,   0.026635,		m+mm,
				0.035992,   0.114475,		900+m+mm,
				0.0,		-91.6331,		4000+m+mm,
			   -0.053174,   0.069205,		m+mm,
			   -0.062248,   0.065002,		900+m+mm,
				0.0,		108.9013,		4000+m+mm,
			   -0.069164,   0.072224,		m+mm,
			   -0.0,		0.0,			900+m+mm,
				0.0,		28.7861,		4000+m+mm,
			   -0.095396,   0.029993,		-1
	del 4
return


9996:
	rotz beta
	roty -90
	cutpolya 6, 1, 0,
		0,		2*gv,	15,
		gz,		gv,		15,
		gz+gv,	0,		15,
		gz,		-gv,	15,
		0,		-2*gv,	15,
		0,		2*gv,	-1
	del 1
	cone  gz, gr1, gr2, 90, 90
	cutend

	roty -90
	addz -gr1-gv/4
	prism_ 6, 1.9*gr1,
		0,		2*gv,	64+15,
		gz,		gv,		64+15,
		gz+gv,	0,		15,
		gz,		-gv,	64+15,
		0,		-2*gv,	64+15,
		0,		2*gv,	-1
	del 3
return
