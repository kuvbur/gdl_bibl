
! -----------------------------------------------------------------------------
! Oriented View
! -----------------------------------------------------------------------------

angleViewRot = 0
if dt then
	rrr = REQUEST ("View_Rotangle", "", angleViewRot)
endif
totalRotate = (SYMB_ROTANGLE + angleViewRot) MOD 360

! -----------------------------------------------------------------------------
! 2D Drawing
! -----------------------------------------------------------------------------

DrawingNum = 1
DRAWINDEX 20

unID = 1
hotspot2  0,  0,  unID : unID=unID+1
hotspot2  0,  0,  unID, a2, 	1+128, a : unID=unID+1
hotspot2 -1,  0,  unID, a2, 	3 		 : unID=unID+1
hotspot2  a2, 0,  unID, a2, 	2, a 	 : unID=unID+1

hotspot2  0,  0,  unID, a2, 	1+128, a : unID=unID+1
hotspot2  1,  0,  unID, a2, 	3		 : unID=unID+1
hotspot2 -a2, 0,  unID, a2, 	2, a 	 : unID=unID+1

hotspot2  0,  -b,  unID, a2, 	1+128, a : unID=unID+1
hotspot2 -1,  -b,  unID, a2, 	3 		 : unID=unID+1
hotspot2  a2, -b,  unID, a2, 	2, a 	 : unID=unID+1

hotspot2  0,  -b,  unID, a2, 	1+128, a : unID=unID+1
hotspot2  1,  -b,  unID, a2, 	3		 : unID=unID+1
hotspot2 -a2, -b,  unID, a2, 	2, a 	 : unID=unID+1

hotspot2 -a/2,   0,  unID, b, 	1+256 : unID=unID+1
hotspot2 -a/2,   1,  unID, b, 	3 		 : unID=unID+1
hotspot2 -a/2,  -b,  unID, b, 	2 	 : unID=unID+1

hotspot2 a/2,   0,  unID, b, 	1+256 : unID=unID+1
hotspot2 a/2,   1,  unID, b, 	3 		 : unID=unID+1
hotspot2 a/2,  -b,  unID, b, 	2 	 : unID=unID+1

if DrawingNum = 1 then	! Top
	pen gs_cont_pen
	fill gs_fill_type
	line_type gs_line_type

	if iSymbolType = 2 then
		poly2_b 5, 1+2+4+64, gs_fill_pen, gs_back_pen,
			-a/2,  0,  1,
			-a/2, -b,  1,
			 a/2, -b,  1,
			 a/2,  0,  1,
			-a/2,  0, -1
	else
		DRAWINDEX 20
		mul2 a / 0.7, b / 0.6

		poly2_b 11, 1+2+4+64, gs_fill_pen, gs_back_pen,
			0.2992753623188,         -0.6,      1,
			-0.2992753623188,         -0.6,      1,
			-0.2992753623188, -0.5492753623188,    900,
			0,          -90,   4001,
			-0.35, -0.5492753623188,      1,
			-0.35,            0,      1,
			0.35,            0,      1,
			0.35, -0.5492753623188,      1,
			0.2992753623188, -0.5492753623188,    900,
			0,          -90,   4001,
			0.2992753623188,         -0.6,      1

		line2    0.3117234360025, -0.1467625273085, 0.3117234360025, -0.5037534043857
		arc2     0.2711437258575, -0.5037534043857, 0.04057971014493,          270,            0
		line2    0.2711437258575, -0.5443331145307, -0.2711437258575, -0.5443331145307
		arc2     -0.2711437258575, -0.5037534043857, 0.04057971014493,          180,          270
		line2    -0.3117234360025, -0.5037534043857, -0.3117234360025, -0.1467625273085
		line2    0.284948725608, -0.1113947739301, 0.3136851712445, -0.1113947739301
		line2    0.3136851712445, -0.1113947739301, 0.3136851712445, -0.08124158201811
		line2    0.3136851712445, -0.08124158201811, 0.284948725608, -0.08124158201811
		line2    0.284948725608, -0.08124158201811, 0.284948725608, -0.1113947739301
		line2    0.3280534293331, -0.07262633939449, 0.1541977039753, -0.07262633939449
		line2    0.1541977039753, -0.07262633939449, 0.1541977039753, -0.1214458528789
		line2    0.1541977039753, -0.1214458528789, 0.3280534293331, -0.1214458528789
		line2    0.3280534293331, -0.1214458528789, 0.3280534293331, -0.07262633939449
		line2    0.165396082573, -0.08702074009827, 0.1792403656553, -0.08702074009827
		line2    0.1792403656553, -0.08702074009827, 0.1792403656553, -0.09993342637433
		line2    0.1792403656553, -0.09993342637433, 0.165396082573, -0.09993342637433
		line2    0.165396082573, -0.09993342637433, 0.165396082573, -0.08702074009827
		line2    0.191238673786, -0.08702074009827, 0.2050829568683, -0.08702074009827
		line2    0.2050829568683, -0.08702074009827, 0.2050829568683, -0.09993342637433
		line2    0.2050829568683, -0.09993342637433, 0.191238673786, -0.09993342637433
		line2    0.191238673786, -0.09993342637433, 0.191238673786, -0.08702074009827
		line2    0.2161583833341, -0.08702074009827, 0.2300026664163, -0.08702074009827
		line2    0.2300026664163, -0.08702074009827, 0.2300026664163, -0.09993342637433
		line2    0.2300026664163, -0.09993342637433, 0.2161583833341, -0.09993342637433
		line2    0.2161583833341, -0.09993342637433, 0.2161583833341, -0.08702074009827
		line2    0.2429239267525, -0.08702074009827, 0.2567682098348, -0.08702074009827
		line2    0.2567682098348, -0.08702074009827, 0.2567682098348, -0.09993342637433
		line2    0.2567682098348, -0.09993342637433, 0.2429239267525, -0.09993342637433
		line2    0.2429239267525, -0.09993342637433, 0.2429239267525, -0.08702074009827
		line2    -0.07206934795414, -0.5443331145307, -0.07206934795414, -0.5163544368355
		line2    -0.07206934795414, -0.5163544368355, -1.110223024625E-016, -0.5163544368355
		line2    -1.110223024625E-016, -0.5163544368355, 0.07206934795414, -0.5163544368355
		line2    0.07206934795414, -0.5163544368355, 0.07206934795414, -0.5443331145307
		line2    -0.3460067691721, -0.1467625273085, 0.3468382656558, -0.1467625273085

		del 1
	endif

	! -----------------------------------------------------------------------------
	! Symbols
	! -----------------------------------------------------------------------------

	if b2DSymbol then
		pen gs_symbol_pen
		aorb = a
		if a > b then aorb = b
		add2 0, -b/2

		if iWasherSymbolType = 1 then
			rot2 10
			circle2  0, 0, aorb/6
			line2 0,	-aorb/6,	aorb/3,		-aorb/6
			line2 0,	aorb/6,		-aorb/3,	aorb/6
			line2 aorb/6,	0,		aorb/6,		aorb/3
			line2 -aorb/6,	0,		-aorb/6,	-aorb/3
			del 1
		endif

		if iWasherSymbolType = 2 then
			circle2 0, 0, aorb/2.7
			circle2 0, 0, aorb/20
			fill gs_symbol_fill_type
			poly2_b  7, 1+2+4+64, gs_symbol_pen,   gs_fill_back_pen,
					aorb/20,  0, 	1,
					0,		  0,    900,
					0,		  180,  4001,
					-aorb/20, 0,  	1,
					0, 		  0,  	900,
					0, 		  180,	4001,
					aorb/20,  0, 	1
		endif

		if iWasherSymbolType = 3 then
			circle2 0, 0, aorb/3.5
			circle2 0, 0, aorb/4.5
		endif

		if iWasherSymbolType = 4 then
			circle2 0, 0, aorb/3
			for i = 1 to 3
				line2 0, 0, 0, aorb/4.5
				rot2 120
			next i
			del i-1

			add2 0, -b/2
			poly2_B 5, 1+2+4+64, gs_fill_pen, gs_back_pen,
					-a/3, 0, 1,
					-a/3, -0.05, 1,
					 a/3, -0.05, 1,
					 a/3, 0, 1,
					-a/3, 0, -1
			del 1
		endif
		del 1
	endif


	! -----------------------------------------------------------------------------
	! 2D TEXT
	! -----------------------------------------------------------------------------

	unID = 200
	if dt then
		DRAWINDEX 30
		nTrans = 0

		hotspot2 0,		-b/2+txty,	unID,  txtx,  1+128	:unID = unID + 1
		hotspot2 txtx,	-b/2+txty,	unID,  txtx,  2		:unID = unID + 1
		hotspot2 -1,	-b/2+txty,	unID,  txtx,  3		:unID = unID + 1

		hotspot2 txtx,	-b/2,		unID,  txty,  1+128	:unID = unID + 1
		hotspot2 txtx,	-b/2+txty,	unID,  txty,  2		:unID = unID + 1
		hotspot2 txtx,	-1,			unID,  txty,  3		:unID = unID + 1

		pen penText
		define style textstyle	fontType, fontSize * 1000 / GLOB_SCALE, 5,
								gs_text_style_bold + 2 * gs_text_style_italic + 4 * gs_text_style_underline
		style textstyle
		add2 txtx, -b/2+txty
		nTrans = nTrans + 1

		! ---------------------------------------------------------------------
		! Text Rotation - Readable / Always Horizontal / Align with Symbol
		! ---------------------------------------------------------------------
		if typeTextRotation_m = 2 then								! Readable
			rot2 180 * (totalRotate > (gs_readable_angle + eps) & totalRotate < (gs_readable_angle + 180 + eps))	! 1/0
			nTrans = nTrans + 1
		else
			if typeTextRotation_m = 1 then							! Horizontal
				rot2 totalRotate * (SYMB_MIRRORED - not(SYMB_MIRRORED))	! 1/-1
				nTrans = nTrans + 1
			endif
		endif
		! ----------------------------------------------------------------------

		text2 0, 0, stDisplayText

		del nTrans
	else
		hotspot2 0, -b/2, unID 	: unID = unID + 1
		unID = unID + 5
	endif

	drawindex 10
	add2 -a/2, -b
	call "fa_minimalspace" parameters all MSType = 20, unID = 3000
	del 1

ENDIF

! -----------------------------------------------------------------------------
! Modifying to Shaft
! -----------------------------------------------------------------------------

IF bShowMEP THEN

	PEN gs_cont_pen

	! --- OTHER VIEWS ---
	add2 -a/2, -b
	rot2 -SYMB_ROTANGLE * (DrawingNum > 1 AND NOT(SYMB_MIRRORED))+SYMB_ROTANGLE * (DrawingNum > 1 AND SYMB_MIRRORED)

	if DrawingNum = 2 then PROJECT2 -3, 90, 2	! Bottom
	if DrawingNum = 3 then PROJECT2 4, 270, 2	! Front
	if DrawingNum = 4 then PROJECT2 4,  90, 2	! Back
	if DrawingNum = 5 then PROJECT2 4, 180*(SYMB_MIRRORED), 2		! Right
	if DrawingNum = 6 then PROJECT2 4, 180*NOT(SYMB_MIRRORED), 2	! Left

	! --- CONNECTIONS ---

	CALL "MEP_m_ConnectionsACL_4" PARAMETERS SetProgram = SetProgram,
		ui_current_con = ui_current_con,
		MEP_NumberConnections = MEP_NumberConnections,
		MEP_NumConnectionData = gs_Connections,
		gs_AddConnections = gs_AddConnections,
		DrawingNum = DrawingNum,
		MEP_InsShow = 0,
		MEP_cline_show = 0,
		gs_cont_pen = gs_cont_pen,
		gs_fill_type=gs_fill_type,
		gs_fill_pen=gs_fill_pen,
		gs_back_pen=gs_back_pen,
		ConPosX_1=ConPosX_1, ConPosY_1=ConPosY_1, ConLength_1=ConLength_1, ConEdit_1 = 12,
		ConPosX_2=ConPosX_2, ConPosY_2=ConPosY_2, ConLength_2=ConLength_2, ConEdit_2 = 12

	DEL 2
ENDIF

