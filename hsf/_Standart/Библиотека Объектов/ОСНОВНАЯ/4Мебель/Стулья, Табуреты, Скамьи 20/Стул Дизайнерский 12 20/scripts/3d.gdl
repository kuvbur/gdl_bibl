

IF gs_detlevel_3D_m=0 THEN END
IF gs_shadow=0 THEN SHADOW OFF

IF GLOB_CONTEXT>20 and GLOB_CONTEXT<40 THEN gs_detlevel_3D_m=1
IF gs_detlevel_3D_m=1 THEN gs_resol = 16

pen gs_cont_pen


add a/2,b/2,0
	unID=1

	hotspot -a/2, -b/2, 0, unID: unID=unID+1
	hotspot -a/2,  b/2, 0, unID: unID=unID+1
	hotspot a/2, -b/2, 0, unID: unID=unID+1
	hotspot a/2,  b/2, 0, unID: unID=unID+1
	hotspot -a/2,  0.3047*b/0.770865529547, zzyzx, unID: unID=unID+1
	hotspot a/2,  0.3047*b/0.770865529547, zzyzx, unID: unID=unID+1

	hotspot 0, b/2, 0, unID, zzyzx, 1+128: unID=unID+1
	hotspot 0, b/2, -1, unID, zzyzx, 3: unID=unID+1
	hotspot 0, b/2, zzyzx, unID, zzyzx, 2: unID=unID+1

	hotspot 0, -b/2, 0, unID, gs_seat_height, 1+128: unID=unID+1
	hotspot 0, -b/2, -1, unID, gs_seat_height, 3: unID=unID+1
	hotspot 0, -b/2, gs_seat_height, unID, gs_seat_height, 2: unID=unID+1

del 1

mul A/0.622037793561, B/0.6091803338807, 1
addx 0.3110188967805

! --- Leg Types

if gs_leg_type_m = 1 then
	mulz gs_seat_height/0.45
	material gs_leg_mat
	resol max(3, gs_resol/3)
	cutplane 180

	for ii = -1 to 1 step 2
		mulx ii
		add -0.28, 0.02, 0
		roty 7
		rotx -5

		mm = 16
		dist_1 = 0.457
		dist_2 = 0.20
		ang = 90
		gosub 30

		add 0, dist_2*COS(90-ang), dist_1+dist_2*SIN(90-ang)
		rotx -ang

		mm = 32
		dist_1 = 0.16
		dist_2 = 0.46
		ang = 70
		gosub 30
		del 2

		del 4
	next ii
	cutend
	del 1
endif

if gs_leg_type_m = 2 then
	material gs_leg_mat
	resol gs_resol
	addy 0.29
	cylind 0.01, 0.20
	addz 0.01
	resol max(3, gs_resol/2)
	addz gs_seat_height-0.06
	cutplane -5
	del 1
	cylind gs_seat_height, 0.02
	cutend
	addz gs_seat_height-0.06
	rotx -5
	resol gs_resol
	cylind 0.02, 0.09
	del 4
endif

if gs_leg_type_m = 3 then
	dist_1 = 0.055
	dist_2 = 0.25
	dist_3 = 0.06
	dist_4 = 0.26
	ang = atn(dist_2/dist_4)
	rr = 0.04

	material gs_leg_mat
	resol max(3, gs_resol/2)
	addy 0.29
	addz gs_seat_height-0.05
	cutplane -5
	del 1
	addz dist_1+dist_2
	cylind gs_seat_height-dist_1-dist_2, 0.02
	del 1
	cutend
	addz gs_seat_height-0.05
	rotx -5
	resol gs_resol
	cylind 0.02, 0.09
	del 2

	for ii = 1 to 5
		rotz 72*ii
		resol max(3, gs_resol/3)

		addy -dist_4-0.02
		cylind 0.005, 0.0125
		put 0, 0, -0.10, 0
		put 0, 0, 0.005, 0
		if gs_detlevel_3D_m = 2 then
			num = int(ang/12)
			alpha_i = ang/num
			alpha = 0
			for i = 1 to num+1
				put 0, rr-rr*cos(alpha), dist_1-(rr*tan(ang/2))+rr*sin(alpha), 0
				alpha = alpha + alpha_i
			next i
		else
			put 0, 0, dist_1, 0
		endif
		zz = dist_1+dist_2
		put 0, dist_4, zz, 0
		zz = zz+dist_3
		put 0, dist_4, zz, 0
		put 0, dist_4, zz+0.01, 0

		tube 2, NSP/4, 1+2+16+32,
			0, 0, 901,
			0.008, 360, 4001,

			get(NSP)

		del 2
	next ii
	del 1
endif

if gs_leg_type_m = 4 then
	dist_1 = 0.04
	dist_2 = 0.21
	dist_3 = 0.055
	dist_4 = 0.26
	ang = atn(dist_4/dist_2)
	rr = 0.04

	material gs_leg_mat
	resol max(3, gs_resol/2)
	addy 0.29
	addz gs_seat_height-0.05
	cutplane -5
	del 1
	addz dist_1+dist_2+0.06
	cylind gs_seat_height-dist_1-dist_2-0.06, 0.02
	del 1
	cutend
	addz gs_seat_height-0.05
	rotx -5
	resol gs_resol
	cylind 0.02, 0.09
	del 2

	for ii = 1 to 5
		rotz 72*ii
		addy -dist_4-0.02

		rotz rnd(90)
		resol gs_resol
		material gs_roller_mat
		addy 0.015
		roty -90
		add 0.025, 0, -0.015
		cylind 0.03, 0.025
		del 3
		addz 0.03
		resol max(3, gs_resol/3)
		cylind 0.03, 0.008
		del 2

		addz 0.06
		resol max(3, gs_resol/3)
		material gs_leg_mat
		put 0, 0, -0.10, 0
		put 0, 0, 0, 0
		if gs_detlevel_3D_m = 2 then
			num = int(ang/12)
			alpha_i = ang/num
			alpha = 0
			for i = 1 to num+1
				put 0, rr-rr*cos(alpha), dist_1-(rr*tan(ang/2))+rr*sin(alpha), 0
				alpha = alpha + alpha_i
			next i
		else
			put 0, 0, dist_1, 0
		endif
		zz = dist_1+dist_2
		put 0, dist_4, zz, 0
		zz = zz+dist_3
		put 0, dist_4, zz, 0
		put 0, dist_4, zz+0.01, 0

		tube 2, NSP/4, 1+2+16+32,
			0, 0, 901,
			0.008, 360, 4001,

			get(NSP)

		del 3
	next ii
	del 1
endif

if gs_leg_type_m = 5 then
	material gs_leg_mat
	resol gs_resol
	add 0, 0.29, 0.01
	resol max(3, gs_resol/2)
	addz gs_seat_height-0.06
	cutplane -5
	del 1
	cylind gs_seat_height, 0.02
	cutend
	addz gs_seat_height-0.06
	rotx -5
	resol gs_resol
	cylind 0.02, 0.09
	del 3

	resol max(3, gs_resol/2)
	addy 0.29
	cutpolya 2, 2, 0,
		0, 0, 979,
		0.02, 360, 4079

	for i = 1 to 4
		rotz 45+90*i
		rotx 90
		add -0.32, 0, -0.005
		prism_ 7, 0.01,
			0, 0, 15,
			0, 0.04, 15,
			0.32, 0.04, 15,
			0.32, 0.01, 15,
			0.04, 0.01, 15,
			0.04, 0, 15,
			0, 0, -1
		del 3
	next i
	cutend
	del 1
endif



! --- Seat

addz gs_seat_height-0.012
mulz (zzyzx-(gs_seat_height-0.012))/0.3645212105232
rotx -5
for i = -1 to 1 step 2
	mulx i
	add 0, 0.397734505135, 0.056
	rotx 75
	muly -1
	cutplane -46
	add 0, -0.39, -0.07948423715807
	gosub 10
	del 1
	cutend
	del 3
	gosub 20


	if gs_detlevel_3D_m = 2 then
		num = 8
		depth = 0.01
	else
		num = 4
		depth = 0.015
	endif
	dist = 0.25
	ang = 180-2*(atn((dist/2)/depth))
	rr = (dist/2)/SIN(ang)
	rr2 = rr-0.006
	alpha_i = (ang*2)/num

	alpha = -ang
	for j = 1 to num+1
		put rr*sin(alpha), rr*cos(alpha), (j>1 and j<num+1)
		alpha = alpha + alpha_i
	next j
	alpha = ang
	for j = 1 to num+1
		put rr2*sin(alpha), rr2*cos(alpha),  (j>1 and j<num+1)
		alpha = alpha - alpha_i
	next j

	alpha = -ang
	for j = 1 to num+1
		put rr*sin(alpha), rr*cos(alpha), 0.014
		alpha = alpha + alpha_i
	next j
	alpha = ang
	for j = 1 to num+1
		put rr2*sin(alpha), rr2*cos(alpha), 0.014
		alpha = alpha - alpha_i
	next j

	material gs_leg_mat
	add -0.257, 0.392, 0.058
	rotx 31
	roty -101.5
	rotx 90
	add dist/2, -rr*cos(ang), -0.007
	ruled NSP/6, 4+16+32,
		get(NSP)
	del 5

	if bUpholstered then
		add 0, 0.001045868912972, 0.0119543363771
		call "DesignerChair12_m" parameters all mat = gs_upholstery_mat
		del 1
	endif
	del 1
next i
del 5

end

10:
	if gs_detlevel_3D_m = 2 then
		resol 90
		mulz -1

			put 0, 0, 13
			put 0.05401974495885, 0.001886466643988, 79
			put 0.1077762956601, 0.007536675359143, 79
			put 0.1610077401775, 0.01692309727636, 79
			put 0.213454725, 0.03, 8
			put 0.213454725, 0.39, 13
			put 0, 0.39, 8
			put 0, 0, -1

		bprism_ gs_seat_mat, gs_seat_mat, gs_seat_mat,
				NSP/3, -0.012, 0.5666445370438,
				get(NSP)
		del 1

		resol 24
		add 0.2084421282484, 0, 0.03973096677551
		roty -21.5832926215
		mulz -1

			put 0, 0.39, 8
			put 0, 0.03, 13
			put 0.04371910696048, 0.04490095926057, 79
			put 0.0857618819, 0.06402696186676, 8
			put 0.0857618819, 0.3729573471713, 13
			put 0.0557618819, 0.39, 15
			put 0, 0.39, -1

		bprism_ gs_seat_mat, gs_seat_mat, gs_seat_mat,
				NSP/3, -0.012, 0.1119251771243,
				get(NSP)
		del 3

		resol 80
		add 0.269104107223, 0, 0.09736406350039
		roty -21.5832926215-43.9024891632
		mulz -1

			put 0, 0.06402696186676, 13
			put 0.04126421433853, 0.08804079296521, 79
			put 0.07987536879875, 0.1161224278936, 79
			put 0.1154339400717, 0.1479812960158, 79
			put 0.1475719910091, 0.1832877423244, 79
			put 0.1750944098605, 0.2203810754299, 79
			put 0.19883761344, 0.26, 15
			put 0, 0.3729573471713, 8
			put 0, 0.06402696186676, -1

		bprism_ gs_seat_mat, gs_seat_mat, gs_seat_mat,
				NSP/3, -0.012, 0.4646854034123,
				get(NSP)
		del 3
	else
		resol 30
		mulz -1

			put 0, 0, 13
			put 0.1077762956601, 0.007536675359143, 79
			put 0.213454725, 0.03, 8
			put 0.213454725, 0.39, 13
			put 0, 0.39, 8
			put 0, 0, -1

		bprism_ gs_seat_mat, gs_seat_mat, gs_seat_mat,
				NSP/3, -0.012, 0.5666445370438,
				get(NSP)
		del 1

		resol 16
		add 0.2084421282484, 0, 0.03973096677551
		roty -21.5832926215
		mulz -1

			put 0, 0.39, 8
			put 0, 0.03, 13
			put 0.0857618819, 0.06402696186676, 8
			put 0.0857618819, 0.3729573471713, 13
			put 0.0557618819, 0.39, 15
			put 0, 0.39, -1

		bprism_ gs_seat_mat, gs_seat_mat, gs_seat_mat,
				NSP/3, -0.012, 0.1119251771243,
				get(NSP)
		del 3

		resol 20
		add 0.269104107223, 0, 0.09736406350039
		roty -21.5832926215-43.9024891632
		mulz -1

			put 0, 0.06402696186676, 13
			put 0.07987536879875, 0.1161224278936, 79
			put 0.1475719910091, 0.1832877423244, 79
			put 0.19883761344, 0.26, 15
			put 0, 0.3729573471713, 8
			put 0, 0.06402696186676, -1

		bprism_ gs_seat_mat, gs_seat_mat, gs_seat_mat,
				NSP/3, -0.012, 0.4646854034123,
				get(NSP)
		del 3
	endif
return


20:
	if gs_detlevel_3D_m = 2 then
		resol 200
		mulz -1

			put 0.1804937643, 0.39, 13
			put 0.1358532572976, 0.3987299889266, 79
			put 0.09079922762775, 0.4049847457237, 79
			put 0.04546881489893, 0.408745231586, 79
			put 0, 0.41, 8
			put 0, 0, 13
			put 0.04546881489893, 0.001254768414026, 79
			put 0.09079922762775, 0.00501525427634, 79
			put 0.1358532572976, 0.01127001107343, 79
			put 0.1804937643, 0.02, 8
			put 0.1804937643, 0.39, -1

		bprism_ gs_seat_mat, gs_seat_mat, gs_seat_mat,
				NSP/3, -0.012, 1.5714693483,
				get(NSP)
		del 1

		resol 24
		add 0.180097178572, 0, 0.01035406783003
		roty -6.5808034582
		mulz -1

			put 0, 0.39, 8
			put 0, 0.02, 13
			put 0.05890511489055, 0.03731033126184, 79
			put 0.11506382475, 0.06212281673963, 8
			put 0.11506382475, 0.3729573471713, 13
			put 0.08506382475, 0.39, 15
			put 0.06392802435792, 0.3864689644844, 79
			put 0.042531912375, 0.3852871599149, 79
			put 0.02113580039208, 0.3864689644844, 79
			put 0, 0.39, -1

		bprism_ gs_seat_mat, gs_seat_mat, gs_seat_mat,
				NSP/3, -0.012, 0.1119251771243,
				get(NSP)
		del 3

		resol 90
		add 0.269104107223, 0, 0.07509748315182
		roty -6.5808034582-58.9024891632
		mulz -1

			put 0, 0.06212281673963, 13
			put 0.0682206712622, 0.1055574564696, 79
			put 0.12802161103, 0.160004453805, 79
			put 0.1666894639308, 0.2076936274265, 79
			put 0.19883761344, 0.26, 15
			put 0, 0.3729573471713, 8
			put 0, 0.06212281673963, -1

		bprism_ gs_seat_mat, gs_seat_mat, gs_seat_mat,
				NSP/3, -0.012, 0.4646854034123,
				get(NSP)
		del 3
	else
		resol 50
		mulz -1

			put 0.1804937643, 0.39, 13
			put 0, 0.41, 8
			put 0, 0, 13
			put 0.1804937643, 0.02, 8
			put 0.1804937643, 0.39, -1

		bprism_ gs_seat_mat, gs_seat_mat, gs_seat_mat,
				NSP/3, -0.012, 1.5714693483,
				get(NSP)
		del 1

		resol 20
		add 0.180097178572, 0, 0.01035406783003
		roty -6.5808034582
		mulz -1

			put 0, 0.39, 8
			put 0, 0.02, 13
			put 0.05890511489055, 0.03731033126184, 79
			put 0.11506382475, 0.06212281673963, 8
			put 0.11506382475, 0.3729573471713, 13
			put 0.08506382475, 0.39, 15
			put 0.06392802435792, 0.3864689644844, 79
			put 0.042531912375, 0.3852871599149, 79
			put 0.02113580039208, 0.3864689644844, 79
			put 0, 0.39, -1

		bprism_ gs_seat_mat, gs_seat_mat, gs_seat_mat,
				NSP/3, -0.012, 0.1119251771243,
				get(NSP)
		del 3

		resol 24
		add 0.269104107223, 0, 0.07509748315182
		roty -6.5808034582-58.9024891632
		mulz -1

			put 0, 0.06212281673963, 13
			put 0.12802161103, 0.160004453805, 79
			put 0.19883761344, 0.26, 15
			put 0, 0.3729573471713, 8
			put 0, 0.06212281673963, -1

		bprism_ gs_seat_mat, gs_seat_mat, gs_seat_mat,
				NSP/3, -0.012, 0.4646854034123,
				get(NSP)
		del 3
	endif
return

30:
	rr = 0.05
	put 0, 0, -0.10, 0
	put 0, 0, -0.01, 0
	if gs_detlevel_3D_m = 2 then
		num = int(ang/12)
		alpha_i = ang/num
		alpha = 0
		for i = 1 to num+1
			put 0, rr-rr*cos(alpha), dist_1-(rr*tan(ang/2))+rr*sin(alpha), 0
			alpha = alpha + alpha_i
		next i
	else
		put 0, 0, dist_1, 0
	endif
	put 0, (dist_2-0.01)*COS(90-ang), dist_1+(dist_2-0.01)*sin(90-ang), 0
	put 0, (dist_2+0.01)*COS(90-ang), dist_1+(dist_2+0.01)*SIN(90-ang), 0

	tube 2, NSP/4, 1+2+mm,
		0, 0, 901,
		0.007, 360, 4001,

		get(NSP)
return
