
call "FM_types" parameters all

VALUES "gs_sink_type"	st_sinktypes
VALUES "gs_sink_type_m" SINK_TYPE_1,
					SINK_TYPE_2,
					SINK_TYPE_3,
					SINK_TYPE_4,
					SINK_TYPE_5,
					SINK_TYPE_6,
					SINK_TYPE_7,
					SINK_TYPE_8,
					SINK_TYPE_9,
					SINK_TYPE_10,
					SINK_TYPE_11,
					SINK_TYPE_12,
					SINK_TYPE_13,
					SINK_TYPE_14

if GLOB_MODPAR_NAME = "gs_sink_type" then
	gs_sink_type_m = SINK_TYPE_3
	if gs_sink_type = st_sinktypes[1]  then gs_sink_type_m = SINK_TYPE_1
	if gs_sink_type = st_sinktypes[2]  then gs_sink_type_m = SINK_TYPE_2

	if gs_sink_type = st_sinktypes[4]  then gs_sink_type_m = SINK_TYPE_4
	if gs_sink_type = st_sinktypes[5]  then gs_sink_type_m = SINK_TYPE_5
	if gs_sink_type = st_sinktypes[6]  then gs_sink_type_m = SINK_TYPE_6
	if gs_sink_type = st_sinktypes[7]  then gs_sink_type_m = SINK_TYPE_7
	if gs_sink_type = st_sinktypes[8]  then gs_sink_type_m = SINK_TYPE_8
	if gs_sink_type = st_sinktypes[9]  then gs_sink_type_m = SINK_TYPE_9
	if gs_sink_type = st_sinktypes[10] then gs_sink_type_m = SINK_TYPE_10
	if gs_sink_type = st_sinktypes[11] then gs_sink_type_m = SINK_TYPE_11
	if gs_sink_type = st_sinktypes[12] then gs_sink_type_m = SINK_TYPE_12
	if gs_sink_type = st_sinktypes[13] then gs_sink_type_m = SINK_TYPE_13
	if gs_sink_type = st_sinktypes[14] then gs_sink_type_m = SINK_TYPE_14
	parameters gs_sink_type_m = gs_sink_type_m
else
	gs_sink_type = st_sinktypes[3]
	if gs_sink_type_m = SINK_TYPE_1		then gs_sink_type = st_sinktypes[1]
	if gs_sink_type_m = SINK_TYPE_2		then gs_sink_type = st_sinktypes[2]

	if gs_sink_type_m = SINK_TYPE_4		then gs_sink_type = st_sinktypes[4]
	if gs_sink_type_m = SINK_TYPE_5		then gs_sink_type = st_sinktypes[5]
	if gs_sink_type_m = SINK_TYPE_6		then gs_sink_type = st_sinktypes[6]
	if gs_sink_type_m = SINK_TYPE_7		then gs_sink_type = st_sinktypes[7]
	if gs_sink_type_m = SINK_TYPE_8		then gs_sink_type = st_sinktypes[8]
	if gs_sink_type_m = SINK_TYPE_9		then gs_sink_type = st_sinktypes[9]
	if gs_sink_type_m = SINK_TYPE_10	then gs_sink_type = st_sinktypes[10]
	if gs_sink_type_m = SINK_TYPE_11	then gs_sink_type = st_sinktypes[11]
	if gs_sink_type_m = SINK_TYPE_12	then gs_sink_type = st_sinktypes[12]
	if gs_sink_type_m = SINK_TYPE_13	then gs_sink_type = st_sinktypes[13]
	if gs_sink_type_m = SINK_TYPE_14	then gs_sink_type = st_sinktypes[14]
	parameters gs_sink_type = gs_sink_type
endif

VALUES "SinkSymbol" st_SinkSymbol
VALUES "SinkSymbol_m" DETAILED_DRAIN_SYMBOL, DETAILED_SYMBOL, SIMPLE_SYMBOL

if GLOB_MODPAR_NAME = "SinkSymbol" then
	SinkSymbol_m = SIMPLE_SYMBOL
	if SinkSymbol = st_SinkSymbol[2] then SinkSymbol_m = DETAILED_SYMBOL
	if SinkSymbol = st_SinkSymbol[3]	then SinkSymbol_m = DETAILED_DRAIN_SYMBOL
	parameters SinkSymbol_m  = SinkSymbol_m
else
	SinkSymbol = st_SinkSymbol[1]
	if SinkSymbol_m = DETAILED_SYMBOL then SinkSymbol = st_SinkSymbol[2]
	if SinkSymbol_m = DETAILED_DRAIN_SYMBOL then SinkSymbol = st_SinkSymbol[3]
	parameters SinkSymbol = SinkSymbol
endif

VALUES "gs_resol" RANGE [4,)

! --- Limitation

parameters ac_bottomlevel = hCountertop - zzyzx
parameters ac_toplevel = hCountertop

if not(sunder) then
	hideparameter "count_th"
	lock          "count_th"
endif

if gs_cont_pen=0 THEN PARAMETERS gs_cont_pen=8
if gs_fill_pen=0 THEN PARAMETERS gs_fill_pen=91

values "gs_detlevel_3D" st_detail3D
values "gs_detlevel_3D_m" DETAILED_3D, SIMPLE_3D, OFF_3D

if GLOB_MODPAR_NAME = "gs_detlevel_3D" OR gs_detlevel_3D_m = -1 then
	gs_detlevel_3D_m = DETAILED_3D
	if gs_detlevel_3D = st_detail3D[3] then gs_detlevel_3D_m = OFF_3D
	if gs_detlevel_3D = st_detail3D[2] then gs_detlevel_3D_m = SIMPLE_3D
	parameters gs_detlevel_3D_m = gs_detlevel_3D_m
else
	gs_detlevel_3D = st_detail3D[1]
	if gs_detlevel_3D_m = OFF_3D then gs_detlevel_3D = st_detail3D[3]
	if gs_detlevel_3D_m = SIMPLE_3D then gs_detlevel_3D = st_detail3D[2]
	parameters gs_detlevel_3D = gs_detlevel_3D
endif

if gs_detlevel_3D_m = 1 then HIDEPARAMETER "gs_resol"
if gs_detlevel_3D_m = 0 then HIDEPARAMETER "gs_resol", "gs_shadow"


call "tapType_m" parameters	all	enableTapGroups			= 0,
								enableSingleLevelTaps	= 0,
								enableTwoHandleTaps		= 0,
								enableTraditionalTaps	= 0,
								enableSensorFaucets		= 0,
								enableWallMountedTaps	= 0,
								enableCustomTaps		= 2 + 2**2 + 2**3 + 2**4 + 2**5 + 2**6 + 2**7 + 2**8 + 2**9,
								bEnableTapEdit			= 0,
								enableTapSymbols		= 2 + 4 + 8 + 32

if gs_tap_type_m <> 0 then
	if SinkSymbol_m < 2 then
		HIDEPARAMETER "TapSymbol", "TapSymbol_m"
		LOCK "TapSymbol", "TapSymbol_m"
	endif
endif

bowlNumber = 1
if GLOB_MODPAR_NAME = "gs_sink_type" or GLOB_MODPAR_NAME = "gs_sink_type_m" then

	if LibraryLangCode = "USA" then
		if	gs_sink_type_m = SINK_TYPE_1 then
			A	= 0.4064	! 1'-4"
		endif

		if gs_sink_type_m = SINK_TYPE_2 then
			A	= 0.5588	! 1'-10"
		endif

		if	gs_sink_type_m = SINK_TYPE_3 | \
			gs_sink_type_m = SINK_TYPE_4 | \
			gs_sink_type_m = SINK_TYPE_5 | \
			gs_sink_type_m = SINK_TYPE_6 | \
			gs_sink_type_m = SINK_TYPE_7 | \
			gs_sink_type_m = SINK_TYPE_8 | \
			gs_sink_type_m = SINK_TYPE_9 then

			A	= 0.8128	! 2'-8"
		endif

		if gs_sink_type_m = SINK_TYPE_10 then
			A	= 1.2192	! 4'
		endif

		if	gs_sink_type_m = SINK_TYPE_11 | \
			gs_sink_type_m = SINK_TYPE_12 | \
			gs_sink_type_m = SINK_TYPE_13 | \
			gs_sink_type_m = SINK_TYPE_14 then

			A	= 1.4986	! 4'-11"
		endif


		if	gs_sink_type_m = SINK_TYPE_1 then
			B	= 0.4064	! 1'-4"
		else
			B	= 0.5588	! 1'-10"
		endif
	else
		if	gs_sink_type_m = SINK_TYPE_1 then
			A	= 0.4
		endif

		if gs_sink_type_m = SINK_TYPE_2 then
			A	= 0.55
		endif

		if	gs_sink_type_m = SINK_TYPE_3 | \
			gs_sink_type_m = SINK_TYPE_4 | \
			gs_sink_type_m = SINK_TYPE_5 | \
			gs_sink_type_m = SINK_TYPE_6 | \
			gs_sink_type_m = SINK_TYPE_7 | \
			gs_sink_type_m = SINK_TYPE_8 | \
			gs_sink_type_m = SINK_TYPE_9 then

			A	= 0.8
		endif

		if gs_sink_type_m = SINK_TYPE_10 then
			A	= 1.2
		endif

		if	gs_sink_type_m = SINK_TYPE_11 | \
			gs_sink_type_m = SINK_TYPE_12 | \
			gs_sink_type_m = SINK_TYPE_13 | \
			gs_sink_type_m = SINK_TYPE_14 then

			A	= 1.5
		endif


		if	gs_sink_type_m = SINK_TYPE_1 then
			B	= 0.4
		else
			B	= 0.55
		endif
	endif

	parameters	A	= A,
				B	= B

	if gs_sink_type_m = SINK_TYPE_1 then				!!(Sink Round)
		parameters ConPosX_3=0.2, ConPosY_3=0.3
		ConStatus_3 = 1
		parameters ConStatus_3 = ConStatus_3
	endif

	if gs_sink_type_m = SINK_TYPE_2 then				!!(Sink 1 Bowl)
		parameters ConPosX_3=a/2, ConPosY_3=0.35
		ConStatus_3 = 1
		parameters ConStatus_3 = ConStatus_3
	endif

	if gs_sink_type_m = SINK_TYPE_3 then				!!(Sink 2 Bowl)
		parameters ConPosX_3=0.30, ConPosY_3=0.35, ConPosX_4=0.50, ConPosY_4=0.35
		ConStatus_3 = 1
		ConStatus_4 = 1
		parameters ConStatus_3 = ConStatus_3, ConStatus_4 = ConStatus_4
	endif

	if gs_sink_type_m = SINK_TYPE_4 then				!!(Bar Sink)
		parameters ConPosX_3=0.30, ConPosY_3=0.35
		ConStatus_3 = 1
		parameters ConStatus_3 = ConStatus_3
	endif

	if gs_sink_type_m = SINK_TYPE_5 then				!!(Bar sink Centre)
		parameters ConPosX_3=0.40, ConPosY_3=0.35
		ConStatus_3 = 1
		parameters ConStatus_3 = ConStatus_3
	endif

	if gs_sink_type_m = SINK_TYPE_6 then				!!(Sink 2 Bowl Assymetric_1)
		parameters ConPosX_3=0.40, ConPosY_3=0.35, ConPosX_4=0.56, ConPosY_4=0.35
		ConStatus_3 = 1
		ConStatus_4 = 1
		parameters ConStatus_3 = ConStatus_3, ConStatus_4 = ConStatus_4
	endif

	if gs_sink_type_m = SINK_TYPE_7 then				!!(Sink 2 bowl Asymetric_2)
		parameters ConPosX_3=0.40, ConPosY_3=0.35
		ConStatus_3 = 1
		parameters ConStatus_3 = ConStatus_3
	endif

	if gs_sink_type_m = SINK_TYPE_8 then				!!(Sink 3 Bowl_1)
		parameters ConPosX_3=0.20, ConPosY_3=0.35, ConPosX_4=0.40, ConPosY_4=0.35, ConPosX_5=0.60, ConPosY_5=0.35
		ConStatus_3 = 1
		ConStatus_4 = 1
		ConStatus_5 = 1
		parameters ConStatus_3 = ConStatus_3, ConStatus_4 = ConStatus_4, ConStatus_5 = ConStatus_5
	endif

	if gs_sink_type_m = SINK_TYPE_9 then				!!(Sink 3 Bowl_2)
		parameters ConPosX_3=0.20, ConPosY_3=0.35, ConPosX_4=0.40, ConPosY_4=0.35
		ConStatus_3 = 1
		ConStatus_4 = 1
		parameters ConStatus_3 = ConStatus_3, ConStatus_4 = ConStatus_4
	endif

	if gs_sink_type_m = SINK_TYPE_10 then				!!(Single with Tray)
		parameters ConPosX_3=0.35, ConPosY_3=0.35
		ConStatus_3 = 1
		parameters ConStatus_3 = ConStatus_3
	endif

	if gs_sink_type_m = SINK_TYPE_11 then				!!(Single Centered)
		parameters ConPosX_3=0.75, ConPosY_3=0.35
		ConStatus_3 = 1
		parameters ConStatus_3 = ConStatus_3
	endif

	if gs_sink_type_m = SINK_TYPE_12 then				!!(Double Centered Asymmetric)
		parameters ConPosX_3=0.65, ConPosY_3=0.35, ConPosX_4=0.92, ConPosY_4=0.30
		ConStatus_3 = 1
		ConStatus_4 = 1
		parameters ConStatus_3 = ConStatus_3, ConStatus_4 = ConStatus_4
	endif

	if gs_sink_type_m = SINK_TYPE_13 then				!!(Double Centered)
		parameters ConPosX_3=0.65, ConPosY_3=0.35, ConPosX_4=0.85, ConPosY_4=0.35
		ConStatus_3 = 1
		ConStatus_4 = 1
		parameters ConStatus_3 = ConStatus_3, ConStatus_4 = ConStatus_4
	endif

	if gs_sink_type_m = SINK_TYPE_14 then				!!(Double with tray)
		parameters ConPosX_3=0.30, ConPosY_3=0.35, ConPosX_4=0.56, ConPosY_4=0.35
		ConStatus_3 = 1
		ConStatus_4 = 1
		parameters ConStatus_3 = ConStatus_3, ConStatus_4 = ConStatus_4
	endif
endif

if GLOB_MODPAR_NAME = "A" then
	if gs_sink_type_m = SINK_TYPE_1 then				!!(Sink Round)
		parameters ConPosX_3=a/2
	endif
	if gs_sink_type_m = SINK_TYPE_2 then				!!(Sink 1 Bowl)
		parameters ConPosX_3=a/2
	endif
	if gs_sink_type_m = SINK_TYPE_3 then				!!(Sink 2 Bowl)
		parameters ConPosX_3=a*3/8, ConPosX_4=a*5/8
	endif
	if gs_sink_type_m = SINK_TYPE_4 then				!!(Bar Sink)
		parameters ConPosX_3=a*3/8
	endif
	if gs_sink_type_m = SINK_TYPE_5 then				!!(Bar sink Centre)
		parameters ConPosX_3=a/2
	endif
	if gs_sink_type_m = SINK_TYPE_6 then				!!(Sink 2 Bowl Assymetric_1)
		parameters ConPosX_3=a/2, ConPosX_4=a*0.56/0.8
	endif
	if gs_sink_type_m = SINK_TYPE_7 then				!!(Sink 2 bowl Asymetric_2)
		parameters ConPosX_3=a/2
	endif
	if gs_sink_type_m = SINK_TYPE_8 then				!!(Sink 3 Bowl_1)
		parameters ConPosX_3=a/4, ConPosX_4=a/2, ConPosX_5=a*3/4
	endif
	if gs_sink_type_m = SINK_TYPE_9 then				!!(Sink 3 Bowl_2)
		parameters ConPosX_3=a/4, ConPosX_4=a/2
	endif
	if gs_sink_type_m = SINK_TYPE_10 then				!!(Single with Tray)
		parameters ConPosX_3= a*0.35/1.2
	endif
	if gs_sink_type_m = SINK_TYPE_11 then				!!(Single Centered)
		parameters ConPosX_3=a/2
	endif
	if gs_sink_type_m = SINK_TYPE_12 then				!!(Double Centered Asymmetric)
		parameters ConPosX_3=a*0.65/1.5, ConPosX_4=a*0.92/1.5
	endif
	if gs_sink_type_m = SINK_TYPE_13 then				!!(Double Centered)
		parameters ConPosX_3=a*0.65/1.5, ConPosX_4=a*0.85/1.5
	endif
	if gs_sink_type_m = SINK_TYPE_14 then				!!(Double with tray)
		parameters ConPosX_3=a*0.30/1.5, ConPosX_4=a*0.56/1.5
	endif
endif

if GLOB_MODPAR_NAME = "B" then
	if gs_sink_type_m = SINK_TYPE_1 then				!!(Sink Round)
		parameters ConPosY_3 = b - 0.1
	else
		if gs_sink_type_m = SINK_TYPE_12 then
			parameters ConPosY_4 = b - 0.25
		else
			parameters ConPosY_4 = b - 0.2
		endif
		parameters ConPosY_3 = b - 0.2
		parameters ConPosY_5 = b - 0.2
	endif
endif

! --- start of modify to Shaft

! --- minimal width by type

if gs_sink_type_m = SINK_TYPE_1 or gs_sink_type_m = SINK_TYPE_2 then
	values "A" range [0.2, )
else
	if gs_sink_type_m > SINK_TYPE_2 then
		if gs_sink_type_m = SINK_TYPE_5 or gs_sink_type_m = SINK_TYPE_8 or gs_sink_type_m = SINK_TYPE_9 or gs_sink_type_m = SINK_TYPE_11 or gs_sink_type_m = SINK_TYPE_14 then
			values "A" range [0.7, )
		else
			values "A" range [0.5, )
		endif
	endif
endif

VALUES "B" RANGE[0.15, ]
VALUES "ZZYZX" RANGE(0, ]

PUT 1, 2

if isMEPEnabled then

	if 	gs_sink_type_m = SINK_TYPE_1|\				!!(Sink Round)
		gs_sink_type_m = SINK_TYPE_2|\ 				!!(Sink 1 Bowl)
		gs_sink_type_m = SINK_TYPE_4|\				!!(Bar Sink)
		gs_sink_type_m = SINK_TYPE_5|\				!!(Bar sink Centre)
		gs_sink_type_m = SINK_TYPE_7|\				!!(Sink 2 bowl Asymetric_2)
		gs_sink_type_m = SINK_TYPE_10|\				!!(Single with Tray)
		gs_sink_type_m = SINK_TYPE_11 then			!!(Single Centered)

		hideparameter "ConStatus_4", "ConStatus_5"
	endif

	if 	gs_sink_type_m = SINK_TYPE_3|\				!!(Sink 2 Bowl)
		gs_sink_type_m = SINK_TYPE_6|\				!!(Sink 2 Bowl Assymetric_1)
		gs_sink_type_m = SINK_TYPE_9|\				!!(Sink 3 Bowl_2)
		gs_sink_type_m = SINK_TYPE_12|\				!!(Double Centered Asymmetric)
		gs_sink_type_m = SINK_TYPE_13|\				!!(Double Centered)
		gs_sink_type_m = SINK_TYPE_14 then			!!(Double with tray)

		hideparameter "ConStatus_5"
	endif

	nTabs = 3

	IF NOT(ConStatus_1) AND NOT(ConStatus_2) AND NOT(ConStatus_3) AND NOT(ConStatus_4) AND NOT(ConStatus_5) THEN
		LOCK "gs_con_mat"
		HIDEPARAMETER "gs_con_mat"
	ENDIF

	DIM shape_typ_to_validation[3]
		shape_typ_to_validation[1] = 0		! Rectangle
		shape_typ_to_validation[2] = 1		! Circle
		shape_typ_to_validation[3] = 0		! Oval

					! --- CONNECTIONS --- !

	bowlNumber = 1
	if	gs_sink_type_m = SINK_TYPE_3 or gs_sink_type_m = SINK_TYPE_6 \
		or gs_sink_type_m = SINK_TYPE_9 or gs_sink_type_m = SINK_TYPE_12 \
		or gs_sink_type_m = SINK_TYPE_13 or gs_sink_type_m = SINK_TYPE_14 then
			bowlNumber = 2
	endif
	if gs_sink_type_m = SINK_TYPE_8 then bowlNumber = 3

	PARAMETERS MEP_NumberConnections = bowlNumber + 2
	if bowlNumber < 2 then
		parameters ConStatus_4 = 0
		hideparameter "ConStatus_4"
	endif
	if bowlNumber < 3 then
		parameters ConStatus_5 = 0
		hideparameter "ConStatus_5"
	endif
	if GLOB_MODPAR_NAME = "gs_sink_type" then
		if bowlNumber > 1 then
			ConStatus_4 = 1
			parameters ConStatus_4 = ConStatus_4
		endif
		if bowlNumber > 2 then
			ConStatus_5 = 1
			parameters ConStatus_5 = ConStatus_5
		endif
	endif


					! --- 1st CONNECTION --- !

	ConID = 1
	ConName = `Подключение Горячей Воды`

	ConDVecX = 0
	ConDVecY = 0
	ConDVecZ = -1

	ConWVecX = 1
	ConWVecY = 0
	ConWVecZ = 0

	if ConWidth_1 < 0.001 then
		ConWidth_1 = 0.001
		PARAMETERS ConWidth_1 = ConWidth_1
	endif
	if ConWidth_1 > A/2 then
		ConWidth_1 = A/2
		PARAMETERS ConWidth_1 = ConWidth_1
	endif
	values "ConWidth_1" RANGE (0, A/2]
	parameters ConDepth_1 = ConWidth_1
	values "ConLength_1" RANGE [0, ]

	if GLOB_MODPAR_NAME = "gs_sink_type" or GLOB_MODPAR_NAME = "gs_tap_type" then
		tapPositionX = 0
		tapPositionY = 0
		halfDistFromTapMiddle = 0

		call "fa_sinktyp" parameters ALL returned_parameters tapPositionX, tapPositionY, halfDistFromTapMiddle

		if ABS(halfDistFromTapMiddle) < EPS then halfDistFromTapMiddle = ConWidth_1*0.75

		ConPosX_1 = tapPositionX-halfDistFromTapMiddle
		PARAMETERS ConPosX_1 = ConPosX_1
		ConPosX_2 = tapPositionX+halfDistFromTapMiddle
		PARAMETERS ConPosX_2 = ConPosX_2
		ConPosY_1 = tapPositionY
		PARAMETERS ConPosY_1 = ConPosY_1
		ConPosY_2 = ConPosY_1
		PARAMETERS ConPosY_2 = ConPosY_2
	endif
	parameters ConPosZ_1 = 0


	CALL "MEP_m_ConnectionsACL_4" PARAMETERS SetProgram = SetProgram,
		gs_Connections = gs_Connections,
		MEP_NumConnectionData = MEP_NumConnectionData,
		MEP_StrConnectionData = MEP_StrConnectionData,
		MEP_NumberConnections = MEP_NumberConnections,
		gs_AddConnections = gs_AddConnections,
		ConName = ConName,
		ConID = ConID,
		ConPosX = ConPosX_1,
		ConPosY = ConPosY_1,
		ConPosZ = ConPosZ_1+hCountertop,
		ConDVecX = ConDVecX,
		ConDVecY = ConDVecY,
		ConDVecZ = ConDVecZ,
		ConWVecX = ConWVecX,
		ConWVecY = ConWVecY,
		ConWVecZ = ConWVecZ,

		ConNominalWidth = ConNominalWidth_1,
		ConNominalDepth = ConNominalDepth_1,
		ConWidth = ConWidth_1,
		ConDepth = ConDepth_1,
		ConLength = ConLength_1,
		ConWallThickness = ConWallThickness_1,
		ConConnectorWidth = ConConnectorWidth_1,
		ConConnectorDepth = ConConnectorDepth_1,
		ConConnectorWidth2 = ConConnectorWidth2_1,
		ConToolType = ConToolType_1,
		ConStatus = ConStatus_1,
		ConType_1 = ConType_1,
		ConConnectorType_1 = ConConnectorType_1,
		ConSystem_1 = ConSystem_1,
		ui_current_con = ui_current_con,
		shape_typ_to_validation = shape_typ_to_validation,
		MEP_enabled_geometry_mod = 1

	parameters MEP_ConInfo[ConID][1] = STR(ConToolType_1, 1, 0)
	parameters MEP_ConInfo[ConID][2] = ConName
	parameters MEP_ConInfo[ConID][3] = "0"


					! --- 2nd CONNECTION --- !

	ConID = 2
	ConName = `Подключение Холодной Воды`

	ConDVecX = 0
	ConDVecY = 0
	ConDVecZ = -1

	ConWVecX = 1
	ConWVecY = 0
	ConWVecZ = 0

	if ConWidth_2 < 0.001 then
		ConWidth_2 = 0.001
		PARAMETERS ConWidth_2 = ConWidth_2
	endif
	if ConWidth_2 > A/2 then
		ConWidth_2 = A/2
		PARAMETERS ConWidth_2 = ConWidth_2
	endif
	values "ConWidth_2" RANGE (0, A/2]
	parameters ConDepth_2 = ConWidth_2
	values "ConLength_2" RANGE [0, ]

	parameters ConPosZ_2 = 0


	CALL "MEP_m_ConnectionsACL_4" PARAMETERS SetProgram = SetProgram,
		gs_Connections = gs_Connections,
		MEP_NumConnectionData = MEP_NumConnectionData,
		MEP_StrConnectionData = MEP_StrConnectionData,
		MEP_NumberConnections = MEP_NumberConnections,
		gs_AddConnections = gs_AddConnections,
		ConName = ConName,
		ConID = ConID,
		ConPosX = ConPosX_2,
		ConPosY = ConPosY_2,
		ConPosZ = ConPosZ_2+hCountertop,
		ConDVecX = ConDVecX,
		ConDVecY = ConDVecY,
		ConDVecZ = ConDVecZ,
		ConWVecX = ConWVecX,
		ConWVecY = ConWVecY,
		ConWVecZ = ConWVecZ,

		ConNominalWidth = ConNominalWidth_2,
		ConNominalDepth = ConNominalDepth_2,
		ConWidth = ConWidth_2,
		ConDepth = ConDepth_2,
		ConLength = ConLength_2,
		ConWallThickness = ConWallThickness_2,
		ConConnectorWidth = ConConnectorWidth_2,
		ConConnectorDepth = ConConnectorDepth_2,
		ConConnectorWidth2 = ConConnectorWidth2_2,
		ConToolType = ConToolType_2,
		ConStatus = ConStatus_2,
		ConType_2 = ConType_2,
		ConConnectorType_2 = ConConnectorType_2,
		ConSystem_2 = ConSystem_2,
		shape_typ_to_validation = shape_typ_to_validation,
		MEP_enabled_geometry_mod = 1

	parameters MEP_ConInfo[ConID][1] = STR(ConToolType_2, 1, 0)
	parameters MEP_ConInfo[ConID][2] = ConName
	parameters MEP_ConInfo[ConID][3] = "0"


					! --- 3rd CONNECTION --- !

	ConID = 3
	ConName = `Подключение Канализации #1`

	ConDVecX = 0
	ConDVecY = 0
	ConDVecZ = -1

	ConWVecX = -1
	ConWVecY = 0
	ConWVecZ = 0

	if ConWidth_3 < 0.001 then
		ConWidth_3 = 0.001
		PARAMETERS ConWidth_3 = ConWidth_3
	endif
	if ConWidth_3 > MIN(A/2, B/2) then
		ConWidth_3 = MIN(A/2, B/2)
		PARAMETERS ConWidth_3 = ConWidth_3
	endif
	values "ConWidth_3" RANGE (0, MIN(A/2, B/2)]
	parameters ConDepth_3 = ConWidth_3
	values "ConLength_3" RANGE [0, ]

	if gs_sink_type_m = SINK_TYPE_1 then
		values "ConPosY_3" RANGE [sBot+drainR, B-drainR-sBot]
	else
		values "ConPosY_3" RANGE [sSide+drainR, B-drainR-sTop]
	endif

	if gs_sink_type_m = SINK_TYPE_2 then
		values "ConPosX_3" RANGE [sSide+drainR, A-sSide-drainR]
	endif
	if gs_sink_type_m = SINK_TYPE_3 | gs_sink_type_m = SINK_TYPE_4 then
		values "ConPosX_3" RANGE [sSide+drainR, A/2-sBot]
	endif
	if gs_sink_type_m = SINK_TYPE_5 then
		values "ConPosX_3" RANGE [a*sRate4+drainR, a*sRate3-drainR]
	endif
	if gs_sink_type_m = SINK_TYPE_6 | gs_sink_type_m = SINK_TYPE_7 then
		values "ConPosX_3" RANGE [sSide+drainR, a*sRate-sMid-drainR]
	endif
	if gs_sink_type_m = SINK_TYPE_8 | gs_sink_type_m = SINK_TYPE_9 then
		values "ConPosX_3" RANGE [sSide+drainR, a*sRate2-sMid-drainR]
	endif
	if gs_sink_type_m = SINK_TYPE_10 then
		values "ConPosX_3" RANGE [sSide+drainR, a*sRate5-sMid-drainR]
	endif
	if gs_sink_type_m = SINK_TYPE_11 then
		values "ConPosX_3" RANGE [a*sRate7+sMid+drainR, a*sRate8-sMid-drainR]
	endif
	if gs_sink_type_m = SINK_TYPE_12 then
		values "ConPosX_3" RANGE [a*sRate9+sMid+drainR, a*sRate10-sMid-drainR]
	endif
	if gs_sink_type_m = SINK_TYPE_13 then
		values "ConPosX_3" RANGE [a/4+sMid+drainR, a/2-sMid-drainR]
	endif
	if gs_sink_type_m = SINK_TYPE_14 then
		values "ConPosX_3" RANGE [sSide+drainR, a*sRate13-sMid-drainR]
	endif
	parameters ConPosZ_3 = -zzyzx

	CALL "MEP_m_ConnectionsACL_4" PARAMETERS SetProgram = SetProgram,
		gs_Connections = gs_Connections,
		MEP_NumConnectionData = MEP_NumConnectionData,
		MEP_StrConnectionData = MEP_StrConnectionData,
		MEP_NumberConnections = MEP_NumberConnections,
		gs_AddConnections = gs_AddConnections,
		ConName = ConName,
		ConID = ConID,
		ConPosX = ConPosX_3,
		ConPosY = ConPosY_3,
		ConPosZ = ConPosZ_3+hCountertop,
		ConDVecX = ConDVecX,
		ConDVecY = ConDVecY,
		ConDVecZ = ConDVecZ,
		ConWVecX = ConWVecX,
		ConWVecY = ConWVecY,
		ConWVecZ = ConWVecZ,

		ConNominalWidth = ConNominalWidth_3,
		ConNominalDepth = ConNominalDepth_3,
		ConWidth = ConWidth_3,
		ConDepth = ConDepth_3,
		ConLength = ConLength_3,
		ConWallThickness = ConWallThickness_3,
		ConConnectorWidth = ConConnectorWidth_3,
		ConConnectorDepth = ConConnectorDepth_3,
		ConConnectorWidth2 = ConConnectorWidth2_3,
		ConToolType = ConToolType_3,
		ConStatus = ConStatus_3,
		ConType_3 = ConType_3,
		ConConnectorType_3 = ConConnectorType_3,
		ConSystem_3 = ConSystem_3,
		shape_typ_to_validation = shape_typ_to_validation,
		MEP_enabled_geometry_mod = 1

	parameters MEP_ConInfo[ConID][1] = STR(ConToolType_3, 1, 0)
	parameters MEP_ConInfo[ConID][2] = ConName
	parameters MEP_ConInfo[ConID][3] = "0"


					! --- 4th CONNECTION --- !

	ConID = 4
	ConName = `Подключение Канализации #2`

	ConDVecX = 0
	ConDVecY = 0
	ConDVecZ = -1

	ConWVecX = -1
	ConWVecY = 0
	ConWVecZ = 0

	if ConWidth_4 < 0.001 then
		ConWidth_4 = 0.001
		PARAMETERS ConWidth_4 = ConWidth_4
	endif
	if ConWidth_4 > MIN(A/2, B/2) then
		ConWidth_4 = MIN(A/2, B/2)
		PARAMETERS ConWidth_4 = ConWidth_4
	endif
	values "ConWidth_4" RANGE (0, MIN(A/2, B/2)]
	parameters ConDepth_4 = ConWidth_4
	values "ConLength_4" RANGE [0, ]

	if gs_sink_type_m = SINK_TYPE_2 then
		values "ConPosX_4" RANGE [sSide+drainR, A-sSide-drainR]
		values "ConPosY_4" RANGE [sSide+drainR, B-drainR-sTop]
	endif
	if gs_sink_type_m = SINK_TYPE_3 then
		values "ConPosX_4" RANGE [a/2+sMid+drainR, a-sSide-drainR]
	endif
	if gs_sink_type_m = SINK_TYPE_6 then
		values "ConPosX_4" RANGE [a*sRate+sMid+drainR, a-sSide-drainR]
		values "ConPosY_4" RANGE [sBot+drainR, b-sTop-sRed-drainR]
	endif
	if gs_sink_type_m = SINK_TYPE_8 then
		values "ConPosX_4" RANGE [a*sRate2+sMid+drainR, a*sRate1-sMid-drainR]
		values "ConPosY_4" RANGE [sBot+drainR, b-sTop-sRed-drainR]
	endif
	if gs_sink_type_m = SINK_TYPE_9 then
		values "ConPosX_4" RANGE [a*sRate2+sMid+drainR, a*sRate1-sMid-drainR]
		values "ConPosY_4" RANGE [sBot+drainR, b-sTop-sRed-drainR]
	endif
	if gs_sink_type_m = SINK_TYPE_12 then
		values "ConPosX_4" RANGE [a*sRate11+sMid+drainR, a*sRate12-sMid-drainR]
		values "ConPosY_4" RANGE [sBot+drainR, b-sTop-sRed-drainR]
	endif
	if gs_sink_type_m = SINK_TYPE_13 then
		values "ConPosX_4" RANGE [a/2+sMid+drainR, a*0.75-sMid-drainR]
	values "ConPosY_4" RANGE [sSide+drainR, B-drainR-sTop]
	endif
	if gs_sink_type_m = SINK_TYPE_14 then
		values "ConPosX_4" RANGE [a*sRate14+sMid+drainR, a*sRate15-sMid-drainR]
		values "ConPosY_4" RANGE [sSide+drainR, B-drainR-sTop]
	endif
	parameters ConPosZ_4 = -zzyzx


	CALL "MEP_m_ConnectionsACL_4" PARAMETERS SetProgram = SetProgram,
		gs_Connections = gs_Connections,
		MEP_NumConnectionData = MEP_NumConnectionData,
		MEP_StrConnectionData = MEP_StrConnectionData,
		MEP_NumberConnections = MEP_NumberConnections,
		gs_AddConnections = gs_AddConnections,
		ConName = ConName,
		ConID = ConID,
		ConPosX = ConPosX_4,
		ConPosY = ConPosY_4,
		ConPosZ = ConPosZ_4+hCountertop,
		ConDVecX = ConDVecX,
		ConDVecY = ConDVecY,
		ConDVecZ = ConDVecZ,
		ConWVecX = ConWVecX,
		ConWVecY = ConWVecY,
		ConWVecZ = ConWVecZ,

		ConNominalWidth = ConNominalWidth_4,
		ConNominalDepth = ConNominalDepth_4,
		ConWidth = ConWidth_4,
		ConDepth = ConDepth_4,
		ConLength = ConLength_4,
		ConWallThickness = ConWallThickness_4,
		ConConnectorWidth = ConConnectorWidth_4,
		ConConnectorDepth = ConConnectorDepth_4,
		ConConnectorWidth2 = ConConnectorWidth2_4,
		ConToolType = ConToolType_4,
		ConStatus = ConStatus_4,
		ConType_4 = ConType_4,
		ConConnectorType_4 = ConConnectorType_4,
		ConSystem_4 = ConSystem_4,
		shape_typ_to_validation = shape_typ_to_validation,
		MEP_enabled_geometry_mod = 1

	parameters MEP_ConInfo[ConID][1] = STR(ConToolType_4, 1, 0)
	parameters MEP_ConInfo[ConID][2] = ConName
	parameters MEP_ConInfo[ConID][3] = "0"


					! --- 5th CONNECTION --- !

	ConID = 5
	ConName = `Подключение Канализации #3`

	ConDVecX = 0
	ConDVecY = 0
	ConDVecZ = -1

	ConWVecX = -1
	ConWVecY = 0
	ConWVecZ = 0

	if ConWidth_5 < 0.001 then
		ConWidth_5 = 0.001
		PARAMETERS ConWidth_5 = ConWidth_5
	endif
	if ConWidth_5 > MIN(A/2, B/2) then
		ConWidth_5 = MIN(A/2, B/2)
		PARAMETERS ConWidth_5 = ConWidth_5
	endif
	values "ConWidth_5" RANGE (0, MIN(A/2, B/2)]
	parameters ConDepth_5 = ConWidth_5
	values "ConLength_5" RANGE [0, ]

	if gs_sink_type_m = SINK_TYPE_8 then
		values "ConPosX_5" RANGE [a*sRate1+sMid+drainR, a-sSide-drainR]
		values "ConPosY_5" RANGE [sSide+drainR, B-drainR-sTop]
	endif
	parameters ConPosZ_5 = -zzyzx


	CALL "MEP_m_ConnectionsACL_4" PARAMETERS SetProgram = SetProgram,
		gs_Connections = gs_Connections,
		MEP_NumConnectionData = MEP_NumConnectionData,
		MEP_StrConnectionData = MEP_StrConnectionData,
		MEP_NumberConnections = MEP_NumberConnections,
		gs_AddConnections = gs_AddConnections,
		ConName = ConName,
		ConID = ConID,
		ConPosX = ConPosX_5,
		ConPosY = ConPosY_5,
		ConPosZ = ConPosZ_5+hCountertop-zzyzx,
		ConDVecX = ConDVecX,
		ConDVecY = ConDVecY,
		ConDVecZ = ConDVecZ,
		ConWVecX = ConWVecX,
		ConWVecY = ConWVecY,
		ConWVecZ = ConWVecZ,

		ConNominalWidth = ConNominalWidth_5,
		ConNominalDepth = ConNominalDepth_5,
		ConWidth = ConWidth_5,
		ConDepth = ConDepth_5,
		ConLength = ConLength_5,
		ConWallThickness = ConWallThickness_5,
		ConConnectorWidth = ConConnectorWidth_5,
		ConConnectorDepth = ConConnectorDepth_5,
		ConConnectorWidth2 = ConConnectorWidth2_5,
		ConToolType = ConToolType_5,
		ConStatus = ConStatus_5,
		ConType_5 = ConType_5,
		ConConnectorType_5 = ConConnectorType_5,
		ConSystem_5 = ConSystem_5,
		shape_typ_to_validation = shape_typ_to_validation,
		MEP_enabled_geometry_mod = 1

	parameters MEP_ConInfo[ConID][1] = STR(ConToolType_5, 1, 0)
	parameters MEP_ConInfo[ConID][2] = ConName
	parameters MEP_ConInfo[ConID][3] = "0"

	if gs_ui_current_page = 3 then
		ac_mep_connectionpage_active = 1
	else
		ac_mep_connectionpage_active = 0
	endif
	PARAMETERS ac_mep_connectionpage_active = ac_mep_connectionpage_active

	if SetProgram then
		SetProgram = 0
		parameters SetProgram = SetProgram
	endif
	put 3
else
	nTabs = 2

	hideparameter "gs_connection", "gs_con_mat", "useSysMat"

	ac_mep_connectionpage_active = 0
	parameters ac_mep_connectionpage_active = ac_mep_connectionpage_active
endif

values "gs_ui_current_page" get(nsp)

if not(isMEPEnabled) and gs_ui_current_page > 2 then
	gs_ui_current_page = 1
	parameters gs_ui_current_page = gs_ui_current_page
endif

! =============================================================================
! Onorm list Settings
! =============================================================================
if LibraryLangCode = "AUT" or LibraryLangCode = "CHE" or LibraryLangCode = "GER" then
	call "Onorm_Plumbing" parameters all
else
	hideparameter "gs_onorm_Title"
endif
END
