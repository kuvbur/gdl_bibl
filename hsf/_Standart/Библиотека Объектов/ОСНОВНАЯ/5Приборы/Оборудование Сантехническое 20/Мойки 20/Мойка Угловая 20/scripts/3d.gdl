
IF gs_detlevel_3D_m = 0 THEN END

IF not(gs_shadow) THEN SHADOW OFF

unID = 1

! --- start of modifying to Shaft

				! --- CONNECTIONS --- !

IF gs_detlevel_3D_m=1 THEN RESOL 8
IF gs_detlevel_3D_m=2 THEN RESOL 24

if bShowMEP then

	IF useSysMat THEN
		gs_sink_mat	= sMat
		gs_tap_mat	= sMat
		gs_con_mat	= sMat
	ENDIF

	CALL "MEP_m_ConnectionsACL_4" PARAMETERS SetProgram = SetProgram,
		ui_current_con = ui_current_con,
		MEP_NumberConnections = MEP_NumberConnections,
		MEP_NumConnectionData = gs_Connections,
		gs_AddConnections = gs_AddConnections,
		cShow3D = 1,
		gs_ConMat = gs_con_mat,
		MEP_InsShow = 0,
		MEP_cline_show_3D = 0,
		gs_cont_pen = gs_cont_pen,
		ConPosX_1=ConPosX_1, ConPosY_1=ConPosY_1, ConPosZ_1=ConPosZ_1, ConLength_1=ConLength_1, ConEdit_1 = 17,
		ConPosX_2=ConPosX_2, ConPosY_2=ConPosY_2, ConPosZ_2=ConPosZ_2, ConLength_2=ConLength_2, ConEdit_2 = 17,
		ConPosX_3=ConPosX_3, ConPosY_3=ConPosY_3, ConPosZ_3=ConPosZ_3, ConLength_3=ConLength_3, ConEdit_3 = 15,
		ConPosX_4=ConPosX_4, ConPosY_4=ConPosY_4, ConPosZ_4=ConPosZ_4, ConLength_4=ConLength_4, ConEdit_4 = 15
ENDIF

! --- end of modifying to Shaft


addStatus = 0
IF GLOB_CONTEXT > 40 AND GLOB_CONTEXT < 50 THEN
	addStatus = 2
ENDIF

pen gs_cont_pen

HOTSPOT 0,0,0
HOTSPOT a,b,0

hotspot	0,0,0,unID,ZZYZX,1+128 : unID=unID+1
hotspot	0,0,1,unID,ZZYZX,3 : unID=unID+1
hotspot	0,0,-ZZYZX,unID,ZZYZX,2 : unID=unID+1

hotspot	a,b,0,unID,ZZYZX,1+128 : unID=unID+1
hotspot	a,b,1,unID,ZZYZX,3 : unID=unID+1
hotspot	a,b,-ZZYZX,unID,ZZYZX,2 : unID=unID+1

ADDz -ZZYZX

mulx a/0.821
muly b/0.821

addz zzyzx
		HOTSPOT -5.801673967426E-017,        0.361,0
		HOTSPOT 0.2300001987041, 0.5910001987041,0
		HOTSPOT 0.4600003974082, 0.8210003974082,0
		HOTSPOT        0.821,        0.361,0
		HOTSPOT         0.46, -2.775557561563E-017,0
		HOTSPOT 0.4834314575051, 0.3375685424949,0


		MATERIAL gs_sink_mat

		IF gs_detlevel_3D_m = 1 then		!!TOP

			addz 0.002
			POLY_      18,
						0,     0.0,      1,
						0,     0.327863,      1,
						0,     0.361,      1,
						0.460000397408, 0.821000397408,      1,
						0.821,        0.821,    1,
						0.821,        0.361,	1,
						0.46,        0.361,	1,
						0.46,        0,	1,
						0,     0.0,      -1,
						0.04,         0.04, 1,
						0.42,         0.04,	1,
						0.42,        0.361,	1,
						0.04,        0.361,	1,
						0.04,         0.04, -1,
						0.096569,        0.401, 1,
						0.42,        0.401,	1,
						0.42,     0.724431,	1,
						0.096569,        0.401, -1
			DEL 1

		ELSE

		RESOL gs_resol
		PRISM_      59,      0.002,
					0.08,     0.0,      79,
					0.08,     0.08,    900,
					0.0,     -90.0,   4001,
					0.0,     0.08,      79,
				   -0.0,     0.327863,      79,
					0.08,     0.327863,    900,
					0.0,     -45.0,   4001,
					0.023431,     0.384431,      79,
					0.436569,     0.797569,      79,
					0.493137,     0.741001,    900,
					0.0,     -44.8194,   4001,
					0.492885,     0.821,      79,
					0.741,     0.821,      79,
					0.741,     0.741,    900,
					0.0,     -90.0,   4001,
					0.821,     0.741,      79,
					0.821,     0.441,      79,
					0.741,     0.441,    900,
					0.0,     -90.0,   4001,
					0.741,     0.361,      79,
					0.54,     0.361,      79,
					0.54,     0.281,    900,
					0.0,      90.0,   4001,
					0.46,     0.281,      79,
					0.46,     0.08,      79,
					0.38,     0.08,    900,
					0.0,     -90.0,   4001,
					0.38,     0.0,      79,
					0.08,     0.0,     -1,

					0.08,     0.04,      79,
					0.08,     0.08,    900,
					0.0,     -90.0,   4001,
					0.04,     0.08,      79,
					0.04,     0.321,      79,
					0.08,     0.321,    900,
					0.0,     -90.0,   4001,
					0.08,     0.361,      79,
					0.38,     0.361,      79,
					0.38,     0.321,    900,
					0.0,     -90.0,   4001,
					0.42,     0.321,      79,
					0.42,     0.08,      79,
					0.38,     0.08,    900,
					0.0,     -90.0,   4001,
					0.38,     0.04,      79,
					0.08,     0.04,     -1,

					0.42,     0.441,      79,
					0.38,     0.441,    900,
					0.0,     -90.0,   4001,
					0.38,     0.401,      79,
					0.193137,     0.401,      79,
					0.193137,     0.441,    900,
					0.0,    -135.0,   4001,
					0.164853,     0.469284,      79,
					0.351716,     0.656147,      79,
					0.38,     0.627863,    900,
					0.0,    -135.0,   4001,
					0.42,     0.627863,      79,
					0.42,     0.441,     -1
		ENDIF
		!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
		addz 0.002
		IF gs_detlevel_3D_m = 2 then
			PRISM_      5,      0.002,
						0.58301,     0.401,      15,
						0.639579,     0.401,      15,
						0.781,     0.542421,      15,
						0.781,     0.59899,      15,
						0.58301,     0.401,     -1

			PRISM_      5,      0.002,
						0.752716,     0.401,      15,
						0.696147,     0.401,      15,
						0.781,     0.485853,      15,
						0.781,     0.429284,      15,
						0.752716,     0.401,     -1

			PRISM_      5,      0.002,
						0.781,     0.655558,      15,
						0.781,     0.712127,      15,
						0.469873,     0.401,      15,
						0.526442,     0.401,      15,
						0.781,     0.655558,     -1

			PRISM_        6,      0.002,
						0.46,     0.504264,      15,
						0.46,     0.447696,      15,
						0.781,     0.768696,      15,
						0.781,     0.781,      15,
						0.736736,     0.781,      15,
						0.46,     0.504264,     -1

			PRISM_      5,      0.002,
						0.680167,     0.781,      15,
						0.623599,     0.781,      15,
						0.46,     0.617401,      15,
						0.46,     0.560833,      15,
						0.680167,     0.781,     -1


			PRISM_      5,      0.002,
						0.56703,     0.781,      15,
						0.510462,     0.781,      15,
						0.46,     0.730538,      15,
						0.46,     0.67397,      15,
						0.56703,     0.781,     -1
		ENDIF
del 2
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

	IF gs_detlevel_3D_m = 1 THEN		!!TOP
		EXTRUDE     5,      0,      0,    zzyzx+0.002, 1+addStatus+4+16+32,
						0.04,         0.04, 0,
						0.42,         0.04,	0,
						0.42,        0.361,	0,
						0.04,        0.361,	0,
						0.04,         0.04, -1

		EXTRUDE     4,      0,      0,    zzyzx+0.002, 1+addStatus+4+16+32,
						0.096569,        0.401, 0,
						0.42,        0.401,	0,
						0.42,     0.724431,	0,
						0.096569,        0.401, -1
	ELSE
		EXTRUDE     17,      0,      0,    zzyzx, 1+addStatus+4+16+32,
					0.08,     0.04,      1,
					0.08,     0.08,    900,
					0.0,     -90.0,   4001,
					0.04,     0.08,      1,
					0.04,     0.321,      1,
					0.08,     0.321,    900,
					0.0,     -90.0,   4001,
					0.08,     0.361,      1,
					0.38,     0.361,      1,
					0.38,     0.321,    900,
					0.0,     -90.0,   4001,
					0.42,     0.321,      1,
					0.42,     0.08,      1,
					0.38,     0.08,    900,
					0.0,     -90.0,   4001,
					0.38,     0.04,      1,
					0.08,     0.04,     -1

		EXTRUDE     13,      0,      0,    zzyzx, 1+addStatus+4+16+32,
					0.193137,     0.401,      1,
					0.193137,     0.441,    900,
					0.0,    -135.0,   4001,
					0.164853,     0.469284,      1,
					0.351716,     0.656147,      1,
					0.38,     0.627863,    900,
					0.0,    -135.0,   4001,
					0.42,     0.627863,      1,
					0.42,     0.441,      1,
					0.38,     0.441,    900,
					0.0,     -90.0,   4001,
					0.38,     0.401,      1,
					0.193137,     0.401,     -1

		if GLOB_CONTEXT>40 and GLOB_CONTEXT<50 then
			addz -0.005
				extrude 17, 0, 0, zzyzx +0.01, 1+addStatus+16,
					0.08,	0.035,	1,
					0.08,	0.08,	900,
					0.0,	-90.0,	4001,
					0.035,	0.08,	1,

					0.035,     0.321,      1,
					0.08,     0.321,    900,
					0.0,     -90.0,   4001,
					0.08,     0.366,      1,

					0.38,     0.366,      1,
					0.38,     0.321,    900,
					0.0,     -90.0,   4001,
					0.425,     0.321,      1,

					0.425,     0.08,      1,
					0.38,     0.08,    900,
					0.0,     -90.0,   4001,
					0.38,     0.035,      1,
					0.08,     0.035,     -1

				extrude 13, 0, 0, zzyzx +0.01, 1+addStatus+16,
					0.193137,     0.396,      1,
					0.193137,     0.441,    900,
					0.0,    -135.0,   4001,
					0.161317,     0.47282,      1,

					0.34818,     0.659683,      1,
					0.38,     0.627863,    900,
					0.0,    -135.0,   4001,
					0.425,     0.627863,      1,

					0.425,     0.441,      1,
					0.38,     0.441,    900,
					0.0,     -90.0,   4001,
					0.38,     0.396,      1,
					0.193137,     0.396,     -1

			del 1
		endif
	ENDIF
del 2


! --- TAPS ---------------------------------------------------------------------

aa=a/0.821* 0.46
bb=b/0.821* 0.46
alfa=atn(bb/aa)


if gs_tap_type_m=0 then o=0
if gs_tap_type_m<>0 then o=1


MATERIAL gs_tap_mat
ADD (a/0.821*0.23)-0.04*sin(alfa), (b/0.821* 0.591)+0.04*cos(alfa), zzyzx
	GOSUB 50+O
DEL 1
del 1
END

50:
RETURN
51:
add -0.087, -0.206, 0.002
rotz alfa

call "tapType_m" parameters all	gs_tap_type_m		= tempTapType,
								bEnableTapEdit		= 0,
								bSinkTap			= 1,
								useOldSimpleTaps	= 0,
								iTapGroup			= 1

del 2
RETURN
