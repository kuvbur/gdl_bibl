
! ==============================================================================
! Multi-Basin Counter
! ==============================================================================

ac_toplevel = h_top
ac_bottomlevel = ac_toplevel - zzyzx
parameters ac_toplevel = ac_toplevel, ac_bottomlevel = ac_bottomlevel

call "FM_types" parameters all

dim st_detail3D[4]
	st_detail3D[1] = `Детальный`
	st_detail3D[2] = `Простой`
	st_detail3D[3] = `Упрощенный`
	st_detail3D[4] = `Откл.`

values "gs_detlevel_3D" st_detail3D		! Detailed, Simple, Draft, Off
values "gs_detlevel_3D_m" 2, 1, 3, 0

if GLOB_MODPAR_NAME = "gs_detlevel_3D" OR gs_detlevel_3D_m = -1 then
	gs_detlevel_3D_m = 2	! Detailed
	if gs_detlevel_3D = st_detail3D[4] then gs_detlevel_3D_m = 0
	if gs_detlevel_3D = st_detail3D[2] then gs_detlevel_3D_m = 1
	if gs_detlevel_3D = st_detail3D[3] then gs_detlevel_3D_m = 3
	parameters gs_detlevel_3D_m = gs_detlevel_3D_m
else
	gs_detlevel_3D = st_detail3D[1]
	if gs_detlevel_3D_m = 0 then gs_detlevel_3D = st_detail3D[4]
	if gs_detlevel_3D_m = 1 then gs_detlevel_3D = st_detail3D[2]
	if gs_detlevel_3D_m = 3 then gs_detlevel_3D = st_detail3D[3]
	parameters gs_detlevel_3D = gs_detlevel_3D
endif

values "nSink" range [1, int(A/sink_width)]
values "A" range [sink_width, )
values "A2" range [sink_width/2, )

if GLOB_MODPAR_NAME = "A2" then
	A = 2 * A2
	parameters A = A
else
	A2 = A/2
	parameters A2 = A2
endif

if GLOB_MODPAR_NAME = "A" | GLOB_MODPAR_NAME = "B" | GLOB_MODPAR_NAME = "nSink" then
	for hi = 1 to nSink
		sinkPos[hi][1] = 0
		parameters sinkPos[hi][1] = sinkPos[hi][1]

		tapPos[hi][1] = 0
		tapPos[hi][2] = 0
		tapPos[hi][3] = 0
		parameters tapPos[hi][1] = tapPos[hi][1]
		parameters tapPos[hi][2] = tapPos[hi][2]
		parameters tapPos[hi][3] = tapPos[hi][3]
	next hi
endif

if GLOB_MODPAR_NAME = "A" | GLOB_MODPAR_NAME = "A2" | GLOB_MODPAR_NAME = "nSink"\
 | GLOB_MODPAR_NAME = "sink_width" | GLOB_MODPAR_NAME = "gs_sink_type" | GLOB_MODPAR_NAME = "gs_sink_type_m"\
 | (gs_sink_type_m = 1 & GLOB_MODPAR_NAME = "sink_depth") then
	if A < nSink * sink_width then
		nSink = int(A/sink_width)
		parameters nSink = nSink
	endif
	sinkDistL = (A - nSink * sink_width) / (2 * nSink)
	sinkDistR = (A - nSink * sink_width) / (2 * nSink)
	sinkSpacing = (A - nSink * sink_width) / (nSink)
	parameters sinkSpacing = sinkSpacing, sinkDistL = sinkDistL, sinkDistR = sinkDistR
endif

call "2dDetailLevel" parameters	all enable2dDetLevels	= 2 + 4 + 8 + 16

call "tapType_m" parameters	all	enableTapGroups			= 2 + 4 + 8 + 16 + 32 + 64,
								enableSingleLevelTaps	= 2 + 2**3 + 2**5,
								enableTwoHandleTaps		= 2 + 2**4 + 2**8 + 2**11 + 2**12 + 2**13,
								enableTraditionalTaps	= 2 + 2**10,
								enableSensorFaucets		= 2 + 2**15 + 2**22,
								enableWallMountedTaps	= 2 + 2**23 + 2**24 + 2**25,
								enableCustomTaps		= 0,
								bEnableTapEdit			= 0,
								bShower 				= 0,
								enableTapSymbols		= 2 + 4 + 8 + 32

if gs_tap_type_m = 0 or not(bWallMountedTap) then
	lock "tapHeight"
	hideparameter "tapHeight"
else
	values "tapHeight" range[h_top + 0.1,]
endif

DIM st_sinktype[3]
	st_sinktype[1] = `Овальная`
	st_sinktype[2] = `Круглые`
	st_sinktype[3] = `Прямоугольный`

if GLOB_MODPAR_NAME = "gs_sink_type" then
	gs_sink_type_m = 2
	if gs_sink_type = st_sinktype[2] then gs_sink_type_m = 1
	if gs_sink_type = st_sinktype[3] then gs_sink_type_m = 3
	parameters gs_sink_type_m = gs_sink_type_m
else
	gs_sink_type = st_sinktype[1]
	if gs_sink_type_m = 1 then gs_sink_type = st_sinktype[2]
	if gs_sink_type_m = 3 then gs_sink_type = st_sinktype[3]
	parameters gs_sink_type = gs_sink_type
endif

VALUES "gs_sink_type" st_sinktype
VALUES "gs_sink_type_m" 1, 2, 3

dim st_countertype[2]
	st_countertype[1] = `Прямоугольный`
	st_countertype[2] = `Скругленные`

values "gs_count_type" st_countertype
values "gs_count_type_m" 1, 2

if GLOB_MODPAR_NAME = "gs_count_type" then
	gs_count_type_m = 1
	if gs_count_type = st_countertype[2] then gs_count_type_m = 2
	parameters gs_count_type_m = gs_count_type_m
else
	gs_count_type = st_countertype[1]
	if gs_count_type_m = 2 then gs_count_type = st_countertype[2]
	parameters gs_count_type = gs_count_type
endif


! ==============================================================================
! Handling mirroring issues
! ==============================================================================

dim st_sideVis[4]
	st_sideVis[1] = `Нет`
	st_sideVis[2] = `Слева`
	st_sideVis[3] = `Справа`
	st_sideVis[4] = `Обе`

VALUES "side_vis" st_sideVis
VALUES "side_vis_mirror" st_sideVis
VALUES "side_vis_m" 1, 2, 3, 4

VALUES "side_vis2D" st_sideVis
VALUES "side_vis2D_mirror" st_sideVis
VALUES "side_vis2D_m" 1, 2, 3, 4

if SYMB_MIRRORED then
	hideparameter "side_vis"
	lock "side_vis"
	if GLOB_MODPAR_NAME = "side_vis_mirror" then
		side_vis_m = 1
		if side_vis_mirror = st_sideVis[2] then side_vis_m = 3
		if side_vis_mirror = st_sideVis[3] then side_vis_m = 2
		if side_vis_mirror = st_sideVis[4] then side_vis_m = 4
		parameters side_vis_m = side_vis_m
	else
		side_vis = st_sideVis[1]
		if side_vis_m = 2 then side_vis_mirror = st_sideVis[3]
		if side_vis_m = 3 then side_vis_mirror = st_sideVis[2]
		if side_vis_m = 4 then side_vis_mirror = st_sideVis[4]
		parameters side_vis_mirror = side_vis_mirror
	endif
	side_vis = st_sideVis[1]
	if side_vis_mirror = st_sideVis[2] then side_vis = st_sideVis[3]
	if side_vis_mirror = st_sideVis[3] then side_vis = st_sideVis[2]
	if side_vis_mirror = st_sideVis[4] then side_vis = st_sideVis[4]
	parameters side_vis = side_vis

	if GLOB_MODPAR_NAME = "side_vis2D_mirror" then
		side_vis2D_m = 1
		if side_vis2D_mirror = st_sideVis[2] then side_vis2D_m = 3
		if side_vis2D_mirror = st_sideVis[3] then side_vis2D_m = 2
		if side_vis2D_mirror = st_sideVis[4] then side_vis2D_m = 4
		parameters side_vis2D_m = side_vis2D_m
	else
		side_vis2D = st_sideVis[1]
		if side_vis2D_m = 2 then side_vis2D_mirror = st_sideVis[3]
		if side_vis2D_m = 3 then side_vis2D_mirror = st_sideVis[2]
		if side_vis2D_m = 4 then side_vis2D_mirror = st_sideVis[4]
		parameters side_vis2D_mirror = side_vis2D_mirror
	endif
	hideparameter "side_vis2D"
	lock "side_vis2D"
	side_vis2D = st_sideVis[1]
	if side_vis2D_mirror = st_sideVis[2] then side_vis2D = st_sideVis[3]
	if side_vis2D_mirror = st_sideVis[3] then side_vis2D = st_sideVis[2]
	if side_vis2D_mirror = st_sideVis[4] then side_vis2D = st_sideVis[4]
	parameters side_vis2D = side_vis2D
else
	hideparameter "side_vis_mirror"
	lock "side_vis_mirror"
	side_vis_mirror = st_sideVis[1]
	if side_vis = st_sideVis[2] then side_vis_mirror = st_sideVis[3]
	if side_vis = st_sideVis[3] then side_vis_mirror = st_sideVis[2]
	if side_vis = st_sideVis[4] then side_vis_mirror = st_sideVis[4]
	parameters side_vis_mirror = side_vis_mirror

	hideparameter "side_vis2D_mirror"
	lock "side_vis2D_mirror"
	side_vis2D_mirror = st_sideVis[1]
	if side_vis2D = st_sideVis[2] then side_vis2D_mirror = st_sideVis[3]
	if side_vis2D = st_sideVis[3] then side_vis2D_mirror = st_sideVis[2]
	if side_vis2D = st_sideVis[4] then side_vis2D_mirror = st_sideVis[4]
	parameters side_vis2D_mirror = side_vis2D_mirror

	if GLOB_MODPAR_NAME = "side_vis" then
		side_vis_m = 1
		if side_vis = st_sideVis[2] then side_vis_m = 2
		if side_vis = st_sideVis[3] then side_vis_m = 3
		if side_vis = st_sideVis[4] then side_vis_m = 4
		parameters side_vis_m = side_vis_m
	else
		side_vis = st_sideVis[1]
		if side_vis_m = 2 then side_vis = st_sideVis[2]
		if side_vis_m = 3 then side_vis = st_sideVis[3]
		if side_vis_m = 4 then side_vis = st_sideVis[4]
		parameters side_vis = side_vis
	endif

	if GLOB_MODPAR_NAME = "side_vis2D" then
		side_vis2D_m = 1
		if side_vis2D = st_sideVis[2] then side_vis2D_m = 2
		if side_vis2D = st_sideVis[3] then side_vis2D_m = 3
		if side_vis2D = st_sideVis[4] then side_vis2D_m = 4
		parameters side_vis2D_m = side_vis2D_m
	else
		side_vis2D = st_sideVis[1]
		if side_vis2D_m = 2 then side_vis2D = st_sideVis[2]
		if side_vis2D_m = 3 then side_vis2D = st_sideVis[3]
		if side_vis2D_m = 4 then side_vis2D = st_sideVis[4]
		parameters side_vis2D = side_vis2D
	endif
endif


! ==============================================================================
! Limitation
! ==============================================================================

if gs_sink_type_m = 1 then
	lock "sink_width"
	hideparameter "sink_width"
endif
if not(bFrontFacePanel) then
	lock "frontFacePanelHeight", "frontFacePanelOvg"
	hideparameter "frontFacePanelHeight", "frontFacePanelOvg"
endif

for hi = 1 to nSink
	if tapPos[hi][1] < -sink_width/2 + 0.04 then parameters tapPos[hi][1] = -sink_width/2 + 0.04
	if tapPos[hi][1] >  sink_width/2 - 0.04 then parameters tapPos[hi][1] =  sink_width/2 - 0.04
	if tapPos[hi][2] < 0 then parameters tapPos[hi][2] = 0
	if tapPos[hi][2] > B/2 - yBasinPos - sink_depth/2 - 0.065 - 0.02 * bBackSplash then parameters tapPos[hi][2] = B/2 - yBasinPos - sink_depth/2 - 0.065 - 0.02 * bBackSplash
next hi
if nSink = 1 then
	if sinkPos[1][1] < - sinkDistL then parameters sinkPos[1][1] = - sinkDistL
	if sinkPos[1][1] > sinkDistR then parameters sinkPos[1][1] = sinkDistR
else
	for hi = 1 to nSink
		if hi = 1 & (GLOB_MODPAR_NAME = "sinkPos" | GLOB_MODPAR_NAME = "sink_width" | \
			GLOB_MODPAR_NAME = "sink_depth" | GLOB_MODPAR_NAME = "gs_sink_type" | GLOB_MODPAR_NAME = "gs_sink_type_m") then
			if sinkPos[1][1] < - sinkDistL then parameters sinkPos[1][1] = - sinkDistL
			if sinkPos[1][1] > sinkSpacing + sinkPos[2][1] then parameters sinkPos[1][1] = sinkSpacing + sinkPos[2][1]
		endif
		if hi > 1 & hi < nSink & nSink > 2 & (GLOB_MODPAR_NAME = "sinkPos" | GLOB_MODPAR_NAME = "sink_width" | \
			GLOB_MODPAR_NAME = "sink_depth" | GLOB_MODPAR_NAME = "gs_sink_type" | GLOB_MODPAR_NAME = "gs_sink_type_m") then
			if sinkPos[hi][1] < - sinkSpacing + sinkPos[hi-1][1] then parameters sinkPos[hi][1] = - sinkSpacing + sinkPos[hi-1][1]
			if sinkPos[hi][1] > sinkSpacing + sinkPos[hi+1][1] then parameters sinkPos[hi][1] = sinkSpacing + sinkPos[hi+1][1]
		endif
		if hi = nSink & (GLOB_MODPAR_NAME = "sinkPos" | GLOB_MODPAR_NAME = "sink_width" | \
			GLOB_MODPAR_NAME = "sink_depth" | GLOB_MODPAR_NAME = "gs_sink_type" | GLOB_MODPAR_NAME = "gs_sink_type_m") then
			if sinkPos[nSink][1] < - sinkSpacing + sinkPos[hi-1][1] then parameters sinkPos[nSink][1] = - sinkSpacing + sinkPos[hi-1][1]
			if sinkPos[nSink][1] > sinkDistR then parameters sinkPos[nSink][1] = sinkDistR
		endif
	next hi
endif

if gs_cont_pen=0 then parameters gs_cont_pen=75
if gs_fill_pen=0 then parameters gs_fill_pen=19
VALUES "gs_resol" RANGE [4,)

if gs_detlevel_3D_m = 1 then lock "gs_resol"

values "B" range [0.5, )
values "sink_width" range [0.2, )
values "sink_depth" range [0.2, B-0.10]
values "yBasinPos" range [-B/2 + sink_depth/2 + 0.03, B/2 - sink_depth/2 - 0.07]
values "sinkSpacing" range [0, )
values "sinkDistL" range [0, )
values "sinkDistR" range [0, )
values "h_top" range [0, )
values "count_th" range [0.005, )
values "bs_h" range (0, )
values "frontFacePanelHeight" range (0, )
values "frontFacePanelOvg" range [0, B/2 - sink_depth/2]

parameters ZZYZX = count_th
lock "ZZYZX"

if MSFront < 0 then
	MSFront = 0
	parameters MSFront = MSFront
endif


! ==============================================================================
! MEP
! ==============================================================================

IF isMEPEnabled THEN

	bLockConMat = (not(ConStatus_1) & not(ConStatus_2) & not(ConStatus_3))
	if nSink > 1 & bLockConMat then
		bLockConMat = bLockConMat & (not(ConStatus_4) & not(ConStatus_5) & not(ConStatus_6))

		if nSink > 2 & bLockConMat then
			bLockConMat = bLockConMat & (not(ConStatus_7) & not(ConStatus_8) & not(ConStatus_9))

			if nSink > 3 & bLockConMat then
				bLockConMat = bLockConMat & (not(ConStatus_10) & not(ConStatus_11) & not(ConStatus_12))

				if nSink > 4 & bLockConMat then
					bLockConMat = bLockConMat & (not(ConStatus_13) & not(ConStatus_14) & not(ConStatus_15))

					if nSink > 5 & bLockConMat then
						bLockConMat = bLockConMat & (not(ConStatus_16) & not(ConStatus_17) & not(ConStatus_18))
					endif
				endif
			endif
		endif
	endif

	IF bLockConMat THEN
		LOCK "gs_con_mat"
		HIDEPARAMETER "gs_con_mat"
	ENDIF

	DIM shape_typ_to_validation[3]
		shape_typ_to_validation[1] = 0		! Rectangle
		shape_typ_to_validation[2] = 1		! Circle
		shape_typ_to_validation[3] = 0		! Oval

					! --- CONNECTIONS --- !

	parameters MEP_NumberConnections = 18


					! --- 1st CONNECTION --- !

	ConID = 1
	ConName = `Подключение Горячей Воды 1`

	ConDVecX = 0
	if bWallmountedTap then
		ConDVecY = 1
		ConDVecZ = 0
	else
		ConDVecY = 0
		ConDVecZ = -1
	endif
	ConWVecX = -1
	ConWVecY = 0
	ConWVecZ = 0

	IF ConWidth_1 < 0.001 THEN
		ConWidth_1 = 0.001
		parameters ConWidth_1 = ConWidth_1
	ENDIF
	IF ConWidth_1 > MIN(sink_width/4, B/4) THEN
		ConWidth_1 = MIN(sink_width/4, B/4)
		parameters ConWidth_1 = ConWidth_1
	ENDIF
	VALUES "ConWidth_1" RANGE (0, MIN(sink_width/4, B/4)]
	parameters ConDepth_1 = ConWidth_1
	VALUES "ConLength_1" RANGE [0, ]

	! Default Position
	if (GLOB_MODPAR_NAME = "gs_tap_type" | GLOB_MODPAR_NAME = "gs_tap_type_m" | \
	GLOB_MODPAR_NAME = "tapGroup" | GLOB_MODPAR_NAME = "iTapGroup") then
		if bWallmountedTap then
			ConPosX_1 = posTap + widthTap/2
		else
			ConPosX_1 = -0.1
		endif
		parameters ConPosX_1 = ConPosX_1
	endif

	if bWallmountedTap then
		pos1st = -posTap - widthTap + ConWidth_1/2
		pos2nd = -posTap - ConWidth_1/2

		pos3rd = +posTap + ConWidth_1/2
		pos4th = +posTap + widthTap - ConWidth_1/2

		! --- X Range

		values "ConPosX_1"	range [pos1st, pos2nd],
							range [pos3rd, pos4th]


		! --- Change Connection Side
		if GLOB_MODPAR_NAME = "ConPosX_2" | (GLOB_MODPAR_NAME = "" & sgn(ConPosX_1) = sgn(ConPosX_2)) then
			if ConPosX_2 < 0 & ConPosX_1 < 0 then
				ConPosX_1 = posTap + widthTap/2
				parameters 	ConPosX_1 = ConPosX_1
			endif
			if ConPosX_2 > 0 & ConPosX_1 > 0 then
				ConPosX_1 = -(posTap + widthTap/2)
				parameters 	ConPosX_1 = ConPosX_1
			endif
		endif

		ConPosY_1 = 0
		parameters	ConPosX_1 = ConPosX_1,
					ConPosY_1 = ConPosY_1
	else
		values "ConPosX_1" range [-A/2 + ((sink_width + sinkSpacing)/2)*(nSink - 1) - sinkPos[1][1] + ConWidth_1/2, A/2 + ((sink_width + sinkSpacing)/2)*(nSink - 1) - sinkPos[1][1] - ConWidth_1/2]
		if GLOB_MODPAR_NAME = "A" | GLOB_MODPAR_NAME = "nSink" then
			ConPosX_1 = - 0.1
			parameters ConPosX_1 = ConPosX_1
		endif
		VALUES "ConPosY_1" RANGE [-B+ConWidth_1/2, -ConWidth_1/2]
	endif


	parameters ConPosZ_1 = -count_th

	CALL "MEP_m_ConnectionsACL_4" parameters SetProgram = SetProgram,
		gs_Connections = gs_Connections,
		MEP_NumConnectionData = MEP_NumConnectionData,
		MEP_StrConnectionData = MEP_StrConnectionData,
		MEP_NumberConnections = MEP_NumberConnections,
		gs_AddConnections = gs_AddConnections,
		ConName = ConName,
		ConID = ConID,
		ConPosX = ConPosX_1 - A/2 + sinkDistL + sink_width/2 + sinkPos[1][1],
		ConPosY = ConPosY_1,
		ConPosZ = ConPosZ_1+h_top,
		ConDVecX = ConDVecX,
		ConDVecY = ConDVecY,
		ConDVecZ = ConDVecZ,
		ConWVecX = ConWVecX,
		ConWVecY = ConWVecY,
		ConWVecZ = ConWVecZ,

		ConNominalWidth = ConNominalWidth_1,
		ConNominalDepth = ConNominalDepth_1,
		ConWidth = ConWidth_1,
		ConDepth = ConDepth_1,
		ConLength = ConLength_1,
		ConWallThickness = ConWallThickness_1,
		ConConnectorWidth = ConConnectorWidth_1,
		ConConnectorDepth = ConConnectorDepth_1,
		ConConnectorWidth2 = ConConnectorWidth2_1,
		ConToolType = ConToolType_1,
		ConStatus = ConStatus_1,
		ConType_1 = ConType_1,
		ConConnectorType_1 = ConConnectorType_1,
		ConSystem_1 = ConSystem_1,
		ui_current_con = ui_current_con,
		shape_typ_to_validation = shape_typ_to_validation,
		MEP_enabled_geometry_mod = 1,
		gs_ui = 1

	parameters MEP_ConInfo[ConID][1] = STR(ConToolType_1, 1, 0)
	parameters MEP_ConInfo[ConID][2] = ConName
	parameters MEP_ConInfo[ConID][3] = "0"


					! --- 2nd CONNECTION --- !

	ConID = 2
	ConName = `Подключение Холодной Воды 1`

	ConDVecX = 0
	if bWallmountedTap then
		ConDVecY = 1
		ConDVecZ = 0
	else
		ConDVecY = 0
		ConDVecZ = -1
	endif

	ConWVecX = -1
	ConWVecY = 0
	ConWVecZ = 0

	IF ConWidth_2 < 0.001 THEN
		ConWidth_2 = 0.001
		parameters ConWidth_2 = ConWidth_2
	ENDIF
	IF ConWidth_2 > MIN(sink_width/4, B/4) THEN
		ConWidth_2 = MIN(sink_width/4, B/4)
		parameters ConWidth_2 = ConWidth_2
	ENDIF
	VALUES "ConWidth_2" RANGE (0, MIN(sink_width/4, B/4)]
	parameters ConDepth_2 = ConWidth_2
	VALUES "ConLength_2" RANGE [0, ]

	! Default Position
	if (GLOB_MODPAR_NAME = "gs_tap_type" | GLOB_MODPAR_NAME = "gs_tap_type_m" | \
	GLOB_MODPAR_NAME = "tapGroup" | GLOB_MODPAR_NAME = "iTapGroup") then
		if bWallmountedTap then
			ConPosX_2 = -posTap - widthTap/2
		else
			ConPosX_2 = 0.1
		endif
		parameters ConPosX_2 = ConPosX_2
	endif

	if bWallmountedTap then
		pos1st = -posTap - widthTap + ConWidth_2/2
		pos2nd = -posTap - ConWidth_2/2

		pos3rd = +posTap + ConWidth_2/2
		pos4th = +posTap + widthTap - ConWidth_2/2

		! --- X Range

		values "ConPosX_2"	range [pos1st, pos2nd],
							range [pos3rd, pos4th]


		! --- Change Connection Side
		if GLOB_MODPAR_NAME = "ConPosX_1" | (GLOB_MODPAR_NAME = "" & sgn(ConPosX_1) = sgn(ConPosX_2)) then
			if ConPosX_2 < 0 & ConPosX_1 < 0 then
				ConPosX_2 = posTap + widthTap/2
				parameters 	ConPosX_2 = ConPosX_2
			endif
			if ConPosX_2 > 0 & ConPosX_1 > 0 then
				ConPosX_2 = -(posTap + widthTap/2)
				parameters 	ConPosX_2 = ConPosX_2
			endif
		endif

		ConPosY_2 = 0
		parameters	ConPosX_2 = ConPosX_2,
					ConPosY_2 = ConPosY_2
	else
		values "ConPosX_2" range [-A/2 + ((sink_width + sinkSpacing)/2)*(nSink - 1) - sinkPos[1][1] + ConWidth_2/2, A/2 + ((sink_width + sinkSpacing)/2)*(nSink - 1) - sinkPos[1][1] - ConWidth_2/2]
		if GLOB_MODPAR_NAME = "A" | GLOB_MODPAR_NAME = "nSink" then
			ConPosX_2 = 0.1
			parameters ConPosX_2 = ConPosX_2
		endif
		VALUES "ConPosY_2" RANGE [-B+ConWidth_2/2, -ConWidth_2/2]
	endif

	parameters ConPosZ_2 = -count_th

	CALL "MEP_m_ConnectionsACL_4" parameters SetProgram = SetProgram,
		gs_Connections = gs_Connections,
		MEP_NumConnectionData = MEP_NumConnectionData,
		MEP_StrConnectionData = MEP_StrConnectionData,
		MEP_NumberConnections = MEP_NumberConnections,
		gs_AddConnections = gs_AddConnections,
		ConName = ConName,
		ConID = ConID,
		ConPosX = ConPosX_2 - A/2 + sinkDistL + sink_width/2 + sinkPos[1][1],
		ConPosY = ConPosY_2,
		ConPosZ = ConPosZ_2+h_top,
		ConDVecX = ConDVecX,
		ConDVecY = ConDVecY,
		ConDVecZ = ConDVecZ,
		ConWVecX = ConWVecX,
		ConWVecY = ConWVecY,
		ConWVecZ = ConWVecZ,

		ConNominalWidth = ConNominalWidth_2,
		ConNominalDepth = ConNominalDepth_2,
		ConWidth = ConWidth_2,
		ConDepth = ConDepth_2,
		ConLength = ConLength_2,
		ConWallThickness = ConWallThickness_2,
		ConConnectorWidth = ConConnectorWidth_2,
		ConConnectorDepth = ConConnectorDepth_2,
		ConConnectorWidth2 = ConConnectorWidth2_2,
		ConToolType = ConToolType_2,
		ConStatus = ConStatus_2,
		ConType_2 = ConType_2,
		ConConnectorType_2 = ConConnectorType_2,
		ConSystem_2 = ConSystem_2,
		shape_typ_to_validation = shape_typ_to_validation,
		MEP_enabled_geometry_mod = 1,
		gs_ui = 0

	parameters MEP_ConInfo[ConID][1] = STR(ConToolType_2, 1, 0)
	parameters MEP_ConInfo[ConID][2] = ConName
	parameters MEP_ConInfo[ConID][3] = "0"


					! --- 3rd CONNECTION --- !

	ConID = 3
	ConName = `Подключение Канализации 1`

	ConDVecX = 0
	ConDVecY = 0
	ConDVecZ = -1

	ConWVecX = -1
	ConWVecY = 0
	ConWVecZ = 0

	IF ConWidth_3 < 0.001 THEN
		ConWidth_3 = 0.001
		parameters ConWidth_3 = ConWidth_3
	ENDIF
	IF ConWidth_3 > MIN(sink_width/3, B/3) THEN
		ConWidth_3 = MIN(sink_width/3, B/3)
		parameters ConWidth_3 = ConWidth_3
	ENDIF
	VALUES "ConWidth_3" RANGE (0, MIN(sink_width/3, B/3)]
	parameters ConDepth_3 = ConWidth_3
	VALUES "ConLength_3" RANGE [0, ]

	parameters ConPosX_3 = 0
	parameters ConPosY_3 = -B/2 + yBasinPos + sink_depth/2 - sink_depth/2 * (0.9 * 0.79 * 0.63)
	parameters ConPosZ_3 = -0.142 - count_th * bUnderMounted + 0.037 * (gs_sink_type_m = 3)

	CALL "MEP_m_ConnectionsACL_4" parameters SetProgram = SetProgram,
		gs_Connections = gs_Connections,
		MEP_NumConnectionData = MEP_NumConnectionData,
		MEP_StrConnectionData = MEP_StrConnectionData,
		MEP_NumberConnections = MEP_NumberConnections,
		gs_AddConnections = gs_AddConnections,
		ConName = ConName,
		ConID = ConID,
		ConPosX = ConPosX_3 - A/2 + sinkDistL + sink_width/2 + sinkPos[1][1],
		ConPosY = ConPosY_3,
		ConPosZ = ConPosZ_3+h_top,
		ConDVecX = ConDVecX,
		ConDVecY = ConDVecY,
		ConDVecZ = ConDVecZ,
		ConWVecX = ConWVecX,
		ConWVecY = ConWVecY,
		ConWVecZ = ConWVecZ,

		ConNominalWidth = ConNominalWidth_3,
		ConNominalDepth = ConNominalDepth_3,
		ConWidth = ConWidth_3,
		ConDepth = ConDepth_3,
		ConLength = ConLength_3,
		ConWallThickness = ConWallThickness_3,
		ConConnectorWidth = ConConnectorWidth_3,
		ConConnectorDepth = ConConnectorDepth_3,
		ConConnectorWidth2 = ConConnectorWidth2_3,
		ConToolType = ConToolType_3,
		ConStatus = ConStatus_3,
		ConType_3 = ConType_3,
		ConConnectorType_3 = ConConnectorType_3,
		ConSystem_3 = ConSystem_3,
		shape_typ_to_validation = shape_typ_to_validation,
		MEP_enabled_geometry_mod = 1,
		gs_ui = 0

	parameters MEP_ConInfo[ConID][1] = STR(ConToolType_3, 1, 0)
	parameters MEP_ConInfo[ConID][2] = ConName
	parameters MEP_ConInfo[ConID][3] = "0"

					! --- 4st CONNECTION --- !

	ConID = 4
	ConName = `Подключение Горячей Воды 2`

	if nSink > 1 then
		IF ConWidth_4 < 0.001 THEN
			ConWidth_4 = 0.001
			parameters ConWidth_4 = ConWidth_4
		ENDIF
		IF ConWidth_4 > MIN(sink_width/4, B/4) THEN
			ConWidth_4 = MIN(sink_width/4, B/4)
			parameters ConWidth_4 = ConWidth_4
		ENDIF
		VALUES "ConWidth_4" RANGE (0, MIN(sink_width/4, B/4)]
		parameters ConDepth_4 = ConWidth_4
		VALUES "ConLength_4" RANGE [0, ]

		ConDVecX = 0
		if bWallmountedTap then
			ConDVecY = 1
			ConDVecZ = 0
		else
			ConDVecY = 0
			ConDVecZ = -1
		endif

		ConWVecX = -1
		ConWVecY = 0
		ConWVecZ = 0

		! Default Position
		if (GLOB_MODPAR_NAME = "gs_tap_type" | GLOB_MODPAR_NAME = "gs_tap_type_m" | \
		GLOB_MODPAR_NAME = "tapGroup" | GLOB_MODPAR_NAME = "iTapGroup") then
			if bWallmountedTap then
				ConPosX_4 = posTap + widthTap/2
			else
				ConPosX_4 = -0.1
			endif
			parameters ConPosX_4 = ConPosX_4
		endif


		if bWallmountedTap then
			pos1st = -posTap - widthTap + ConWidth_4/2
			pos2nd = -posTap - ConWidth_4/2

			pos3rd = +posTap + ConWidth_4/2
			pos4th = +posTap + widthTap - ConWidth_4/2

			! --- X Range

			values "ConPosX_4"	range [pos1st, pos2nd],
								range [pos3rd, pos4th]


			! --- Change Connection Side
			if GLOB_MODPAR_NAME = "ConPosX_5" | (GLOB_MODPAR_NAME = "" & sgn(ConPosX_4) = sgn(ConPosX_5)) then
				if ConPosX_4 < 0 & ConPosX_5 < 0 then
					ConPosX_4 = posTap + widthTap/2
					parameters 	ConPosX_4 = ConPosX_4
				endif
				if ConPosX_4 > 0 & ConPosX_5 > 0 then
					ConPosX_4 = -(posTap + widthTap/2)
					parameters 	ConPosX_4 = ConPosX_4
				endif
			endif

			ConPosY_4 = 0
			parameters	ConPosX_4 = ConPosX_4,
						ConPosY_4 = ConPosY_4
		else
			values "ConPosX_4" range[-A/2 + ((sink_width + sinkSpacing)/2)*(nSink - 3) - sinkPos[2][1] + ConWidth_4/2, A/2 + ((sink_width + sinkSpacing)/2)*(nSink - 3) - sinkPos[2][1] - ConWidth_4/2]
			if GLOB_MODPAR_NAME = "A" | GLOB_MODPAR_NAME = "nSink" then
				ConPosX_4 = - 0.1
				parameters ConPosX_4 = ConPosX_4
			endif
			values "ConPosY_4" range [-B + ConWidth_4/2, -ConWidth_4/2]
		endif
		parameters ConPosZ_4 = -count_th
	else
		ConStatus_4 = 0
		lock "ConStatus_4"
		hideparameter "ConStatus_4"
	endif

	CALL "MEP_m_ConnectionsACL_4" parameters SetProgram = SetProgram,
		gs_Connections = gs_Connections,
		MEP_NumConnectionData = MEP_NumConnectionData,
		MEP_StrConnectionData = MEP_StrConnectionData,
		MEP_NumberConnections = MEP_NumberConnections,
		gs_AddConnections = gs_AddConnections,
		ConName = ConName,
		ConID = ConID,
		ConPosX = ConPosX_4 - A/2 + sinkDistL + sink_width*1.5 + sinkSpacing + sinkPos[2][1],
		ConPosY = ConPosY_4,
		ConPosZ = ConPosZ_4+h_top,
		ConDVecX = ConDVecX,
		ConDVecY = ConDVecY,
		ConDVecZ = ConDVecZ,
		ConWVecX = ConWVecX,
		ConWVecY = ConWVecY,
		ConWVecZ = ConWVecZ,

		ConNominalWidth = ConNominalWidth_4,
		ConNominalDepth = ConNominalDepth_4,
		ConWidth = ConWidth_4,
		ConDepth = ConDepth_4,
		ConLength = ConLength_4,
		ConWallThickness = ConWallThickness_4,
		ConConnectorWidth = ConConnectorWidth_4,
		ConConnectorDepth = ConConnectorDepth_4,
		ConConnectorWidth2 = ConConnectorWidth2_4,
		ConToolType = ConToolType_4,
		ConStatus = ConStatus_4,
		ConType_4 = ConType_4,
		ConConnectorType_4 = ConConnectorType_4,
		ConSystem_4 = ConSystem_4,
		ui_current_con = ui_current_con,
		shape_typ_to_validation = shape_typ_to_validation,
		MEP_enabled_geometry_mod = 1,
		gs_ui = 1

	parameters MEP_ConInfo[ConID][1] = STR(ConToolType_4, 1, 0)
	parameters MEP_ConInfo[ConID][2] = ConName
	parameters MEP_ConInfo[ConID][3] = "0"


					! --- 5nd CONNECTION --- !

	ConID = 5
	ConName = `Подключение Холодной Воды 2`

	if nSink > 1 then
		ConDVecX = 0
		if bWallmountedTap then
			ConDVecY = 1
			ConDVecZ = 0
		else
			ConDVecY = 0
			ConDVecZ = -1
		endif

		ConWVecX = -1
		ConWVecY = 0
		ConWVecZ = 0

		IF ConWidth_5 < 0.001 THEN
			ConWidth_5 = 0.001
			parameters ConWidth_5 = ConWidth_5
		ENDIF
		IF ConWidth_5 > MIN(sink_width/4, B/4) THEN
			ConWidth_5 = MIN(sink_width/4, B/4)
			parameters ConWidth_5 = ConWidth_5
		ENDIF
		VALUES "ConWidth_5" RANGE (0, MIN(sink_width/4, B/4)]
		parameters ConDepth_5 = ConWidth_5
		VALUES "ConLength_5" RANGE [0, ]

		! Default Position
		if (GLOB_MODPAR_NAME = "gs_tap_type" | GLOB_MODPAR_NAME = "gs_tap_type_m" | \
		GLOB_MODPAR_NAME = "tapGroup" | GLOB_MODPAR_NAME = "iTapGroup") then
			if bWallmountedTap then
				ConPosX_5 = -posTap - widthTap/2
			else
				ConPosX_5 = 0.1
			endif
			parameters ConPosX_5 = ConPosX_5
		endif

		if bWallmountedTap then
			pos1st = -posTap - widthTap + ConWidth_5/2
			pos2nd = -posTap - ConWidth_5/2

			pos3rd = +posTap + ConWidth_5/2
			pos4th = +posTap + widthTap - ConWidth_5/2

			! --- X Range

			values "ConPosX_5"	range [pos1st, pos2nd],
								range [pos3rd, pos4th]


			! --- Change Connection Side
			if GLOB_MODPAR_NAME = "ConPosX_4" | (GLOB_MODPAR_NAME = "" & sgn(ConPosX_4) = sgn(ConPosX_5)) then
				if ConPosX_4 < 0 & ConPosX_5 < 0 then
					ConPosX_5 = posTap + widthTap/2
					parameters 	ConPosX_5 = ConPosX_5
				endif
				if ConPosX_4 > 0 & ConPosX_5 > 0 then
					ConPosX_5 = -(posTap + widthTap/2)
					parameters 	ConPosX_5 = ConPosX_5
				endif
			endif

			ConPosY_5 = 0
			parameters	ConPosX_5 = ConPosX_5,
						ConPosY_5 = ConPosY_5
		else
			values "ConPosX_5" range[-A/2 + ((sink_width + sinkSpacing)/2)*(nSink - 3) - sinkPos[2][1] + ConWidth_5/2, A/2 + ((sink_width + sinkSpacing)/2)*(nSink - 3) - sinkPos[2][1] - ConWidth_5/2]
			if GLOB_MODPAR_NAME = "A" | GLOB_MODPAR_NAME = "nSink" then
				ConPosX_5 = 0.1
				parameters ConPosX_5 = ConPosX_5
			endif
			values "ConPosY_5" range [-B + ConWidth_5/2, -ConWidth_5/2]
		endif
		parameters ConPosZ_5 = -count_th
	else
		ConStatus_5 = 0
		lock "ConStatus_5"
		hideparameter "ConStatus_5"
	endif

	CALL "MEP_m_ConnectionsACL_4" parameters SetProgram = SetProgram,
		gs_Connections = gs_Connections,
		MEP_NumConnectionData = MEP_NumConnectionData,
		MEP_StrConnectionData = MEP_StrConnectionData,
		MEP_NumberConnections = MEP_NumberConnections,
		gs_AddConnections = gs_AddConnections,
		ConName = ConName,
		ConID = ConID,
		ConPosX = ConPosX_5 - A/2 + sinkDistL + sink_width*1.5 + sinkSpacing + sinkPos[2][1],
		ConPosY = ConPosY_5,
		ConPosZ = ConPosZ_5+h_top,
		ConDVecX = ConDVecX,
		ConDVecY = ConDVecY,
		ConDVecZ = ConDVecZ,
		ConWVecX = ConWVecX,
		ConWVecY = ConWVecY,
		ConWVecZ = ConWVecZ,

		ConNominalWidth = ConNominalWidth_5,
		ConNominalDepth = ConNominalDepth_5,
		ConWidth = ConWidth_5,
		ConDepth = ConDepth_5,
		ConLength = ConLength_5,
		ConWallThickness = ConWallThickness_5,
		ConConnectorWidth = ConConnectorWidth_5,
		ConConnectorDepth = ConConnectorDepth_5,
		ConConnectorWidth2 = ConConnectorWidth2_5,
		ConToolType = ConToolType_5,
		ConStatus = ConStatus_5,
		ConType_5 = ConType_5,
		ConConnectorType_5 = ConConnectorType_5,
		ConSystem_5 = ConSystem_5,
		shape_typ_to_validation = shape_typ_to_validation,
		MEP_enabled_geometry_mod = 1,
		gs_ui = 0

	parameters MEP_ConInfo[ConID][1] = STR(ConToolType_5, 1, 0)
	parameters MEP_ConInfo[ConID][2] = ConName
	parameters MEP_ConInfo[ConID][3] = "0"


					! --- 6rd CONNECTION --- !

	ConID = 6
	ConName = `Подключение Канализации 2`

	if nSink > 1 then
		ConDVecX = 0
		ConDVecY = 0
		ConDVecZ = -1

		ConWVecX = -1
		ConWVecY = 0
		ConWVecZ = 0

		IF ConWidth_6 < 0.001 THEN
			ConWidth_6 = 0.001
			parameters ConWidth_6 = ConWidth_6
		ENDIF
		IF ConWidth_6 > MIN(sink_width/3, B/3) THEN
			ConWidth_6 = MIN(sink_width/3, B/3)
			parameters ConWidth_6 = ConWidth_6
		ENDIF
		VALUES "ConWidth_6" RANGE (0, MIN(sink_width/3, B/3)]
		parameters ConDepth_6 = ConWidth_6
		VALUES "ConLength_6" RANGE [0, ]

		parameters ConPosX_6 = 0
		parameters ConPosY_6 = -B/2 + yBasinPos + sink_depth/2 - sink_depth/2 * (0.9 * 0.79 * 0.63)
		parameters ConPosZ_6 = -0.142 - count_th * bUnderMounted + 0.037 * (gs_sink_type_m = 3)
	else
		ConStatus_6 = 0
		lock "ConStatus_6"
		hideparameter "ConStatus_6"
	endif

	CALL "MEP_m_ConnectionsACL_4" parameters SetProgram = SetProgram,
		gs_Connections = gs_Connections,
		MEP_NumConnectionData = MEP_NumConnectionData,
		MEP_StrConnectionData = MEP_StrConnectionData,
		MEP_NumberConnections = MEP_NumberConnections,
		gs_AddConnections = gs_AddConnections,
		ConName = ConName,
		ConID = ConID,
		ConPosX = ConPosX_6 - A/2 + sinkDistL + sink_width*1.5 + sinkSpacing + sinkPos[2][1],
		ConPosY = ConPosY_6,
		ConPosZ = ConPosZ_6+h_top,
		ConDVecX = ConDVecX,
		ConDVecY = ConDVecY,
		ConDVecZ = ConDVecZ,
		ConWVecX = ConWVecX,
		ConWVecY = ConWVecY,
		ConWVecZ = ConWVecZ,

		ConNominalWidth = ConNominalWidth_6,
		ConNominalDepth = ConNominalDepth_6,
		ConWidth = ConWidth_6,
		ConDepth = ConDepth_6,
		ConLength = ConLength_6,
		ConWallThickness = ConWallThickness_6,
		ConConnectorWidth = ConConnectorWidth_6,
		ConConnectorDepth = ConConnectorDepth_6,
		ConConnectorWidth2 = ConConnectorWidth2_6,
		ConToolType = ConToolType_6,
		ConStatus = ConStatus_6,
		ConType_6 = ConType_6,
		ConConnectorType_6 = ConConnectorType_6,
		ConSystem_6 = ConSystem_6,
		shape_typ_to_validation = shape_typ_to_validation,
		MEP_enabled_geometry_mod = 1,
		gs_ui = 0

	parameters MEP_ConInfo[ConID][1] = STR(ConToolType_6, 1, 0)
	parameters MEP_ConInfo[ConID][2] = ConName
	parameters MEP_ConInfo[ConID][3] = "0"

					! --- 7st CONNECTION --- !

	ConID = 7
	ConName = `Подключение Горячей Воды 3`

	if nSink > 2 then
	ConDVecX = 0
		if bWallmountedTap then
			ConDVecY = 1
			ConDVecZ = 0
		else
			ConDVecY = 0
			ConDVecZ = -1
		endif

		ConWVecX = -1
		ConWVecY = 0
		ConWVecZ = 0

		IF ConWidth_7 < 0.001 THEN
			ConWidth_7 = 0.001
			parameters ConWidth_7 = ConWidth_7
		ENDIF
		IF ConWidth_7 > MIN(sink_width/4, B/4) THEN
			ConWidth_7 = MIN(sink_width/4, B/4)
			parameters ConWidth_7 = ConWidth_7
		ENDIF
		VALUES "ConWidth_7" RANGE (0, MIN(sink_width/4, B/4)]
		parameters ConDepth_7 = ConWidth_7
		VALUES "ConLength_7" RANGE [0, ]

		! Default Position
		if (GLOB_MODPAR_NAME = "gs_tap_type" | GLOB_MODPAR_NAME = "gs_tap_type_m" | \
		GLOB_MODPAR_NAME = "tapGroup" | GLOB_MODPAR_NAME = "iTapGroup") then
			if bWallmountedTap then
				ConPosX_7 = posTap + widthTap/2
			else
				ConPosX_7 = -0.1
			endif
			parameters ConPosX_7 = ConPosX_7
		endif

		if bWallmountedTap then
			pos1st = -posTap - widthTap + ConWidth_7/2
			pos2nd = -posTap - ConWidth_7/2

			pos3rd = +posTap + ConWidth_7/2
			pos4th = +posTap + widthTap - ConWidth_7/2

			! --- X Range

			values "ConPosX_7"	range [pos1st, pos2nd],
								range [pos3rd, pos4th]


			! --- Change Connection Side
			if GLOB_MODPAR_NAME = "ConPosX_8" | (GLOB_MODPAR_NAME = "" & sgn(ConPosX_7) = sgn(ConPosX_8)) then
				if ConPosX_7 < 0 & ConPosX_8 < 0 then
					ConPosX_7 = posTap + widthTap/2
					parameters 	ConPosX_7 = ConPosX_7
				endif
				if ConPosX_7 > 0 & ConPosX_8 > 0 then
					ConPosX_7 = -(posTap + widthTap/2)
					parameters 	ConPosX_7 = ConPosX_7
				endif
			endif

			ConPosY_7 = 0
			parameters	ConPosX_7 = ConPosX_7,
						ConPosY_7 = ConPosY_7
		else
			values "ConPosX_7" range[-A/2 + ((sink_width + sinkSpacing)/2)*(nSink - 5) - sinkPos[3][1] + ConWidth_7/2, A/2 + ((sink_width + sinkSpacing)/2)*(nSink - 5) - sinkPos[3][1] - ConWidth_7/2]
			if GLOB_MODPAR_NAME = "A" | GLOB_MODPAR_NAME = "nSink" then
				ConPosX_7 = -0.1
				parameters ConPosX_7 = ConPosX_7
			endif
			values "ConPosY_7" range [-B + ConWidth_7/2, -ConWidth_7/2]
			parameters ConPosZ_7 = -count_th
		endif
	else
		ConStatus_7 = 0
		lock "ConStatus_7"
		hideparameter "ConStatus_7"
	endif

	CALL "MEP_m_ConnectionsACL_4" parameters SetProgram = SetProgram,
		gs_Connections = gs_Connections,
		MEP_NumConnectionData = MEP_NumConnectionData,
		MEP_StrConnectionData = MEP_StrConnectionData,
		MEP_NumberConnections = MEP_NumberConnections,
		gs_AddConnections = gs_AddConnections,
		ConName = ConName,
		ConID = ConID,
		ConPosX = ConPosX_7 - A/2 + sinkDistL + sink_width*2.5 + sinkSpacing*2 + sinkPos[3][1],
		ConPosY = ConPosY_7,
		ConPosZ = ConPosZ_7+h_top,
		ConDVecX = ConDVecX,
		ConDVecY = ConDVecY,
		ConDVecZ = ConDVecZ,
		ConWVecX = ConWVecX,
		ConWVecY = ConWVecY,
		ConWVecZ = ConWVecZ,

		ConNominalWidth = ConNominalWidth_7,
		ConNominalDepth = ConNominalDepth_7,
		ConWidth = ConWidth_7,
		ConDepth = ConDepth_7,
		ConLength = ConLength_7,
		ConWallThickness = ConWallThickness_7,
		ConConnectorWidth = ConConnectorWidth_7,
		ConConnectorDepth = ConConnectorDepth_7,
		ConConnectorWidth2 = ConConnectorWidth2_7,
		ConToolType = ConToolType_7,
		ConStatus = ConStatus_7,
		ConType_7 = ConType_7,
		ConConnectorType_7 = ConConnectorType_7,
		ConSystem_7 = ConSystem_7,
		ui_current_con = ui_current_con,
		shape_typ_to_validation = shape_typ_to_validation,
		MEP_enabled_geometry_mod = 1,
		gs_ui = 1

	parameters MEP_ConInfo[ConID][1] = STR(ConToolType_7, 1, 0)
	parameters MEP_ConInfo[ConID][2] = ConName
	parameters MEP_ConInfo[ConID][3] = "0"


					! --- 8nd CONNECTION --- !

	ConID = 8
	ConName = `Подключение Холодной Воды 3`

	if nSink > 2 then
	ConDVecX = 0
		if bWallmountedTap then
			ConDVecY = 1
			ConDVecZ = 0
		else
			ConDVecY = 0
			ConDVecZ = -1
		endif

		ConWVecX = -1
		ConWVecY = 0
		ConWVecZ = 0

		IF ConWidth_8 < 0.001 THEN
			ConWidth_8 = 0.001
			parameters ConWidth_8 = ConWidth_8
		ENDIF
		IF ConWidth_8 > MIN(sink_width/4, B/4) THEN
			ConWidth_8 = MIN(sink_width/4, B/4)
			parameters ConWidth_8 = ConWidth_8
		ENDIF
		VALUES "ConWidth_8" RANGE (0, MIN(sink_width/4, B/4)]
		parameters ConDepth_8 = ConWidth_8
		VALUES "ConLength_8" RANGE [0, ]

		! Default Position
		if (GLOB_MODPAR_NAME = "gs_tap_type" | GLOB_MODPAR_NAME = "gs_tap_type_m" | \
		GLOB_MODPAR_NAME = "tapGroup" | GLOB_MODPAR_NAME = "iTapGroup") then
			if bWallmountedTap then
				ConPosX_8 = -posTap - widthTap/2
			else
				ConPosX_8 = 0.1
			endif
			parameters ConPosX_8 = ConPosX_8
		endif

		if bWallmountedTap then
			pos1st = -posTap - widthTap + ConWidth_8/2
			pos2nd = -posTap - ConWidth_8/2

			pos3rd = +posTap + ConWidth_8/2
			pos4th = +posTap + widthTap - ConWidth_8/2

			! --- X Range

			values "ConPosX_8"	range [pos1st, pos2nd],
								range [pos3rd, pos4th]

			! --- Change Connection Side
			if GLOB_MODPAR_NAME = "ConPosX_7" | (GLOB_MODPAR_NAME = "" & sgn(ConPosX_7) = sgn(ConPosX_8)) then
				if ConPosX_7 < 0 & ConPosX_8 < 0 then
					ConPosX_8 = posTap + widthTap/2
					parameters 	ConPosX_8 = ConPosX_8
				endif
				if ConPosX_7 > 0 & ConPosX_8 > 0 then
					ConPosX_8 = -(posTap + widthTap/2)
					parameters 	ConPosX_8 = ConPosX_8
				endif
			endif

			ConPosY_8 = 0
			parameters	ConPosX_8 = ConPosX_8,
						ConPosY_8 = ConPosY_8
		else
			values "ConPosX_8" range[-A/2 + ((sink_width + sinkSpacing)/2)*(nSink - 5) - sinkPos[3][1] + ConWidth_8/2, A/2 + ((sink_width + sinkSpacing)/2)*(nSink - 5) - sinkPos[3][1] - ConWidth_8/2]
			if GLOB_MODPAR_NAME = "A" | GLOB_MODPAR_NAME = "nSink" then
				ConPosX_8 = 0.1
				parameters ConPosX_8 = ConPosX_8
			endif
			values "ConPosY_8" range [-B + ConWidth_8/2, -ConWidth_8/2]
			parameters ConPosZ_8 = -count_th
		endif
	else
		ConStatus_8 = 0
		lock "ConStatus_8"
		hideparameter "ConStatus_8"
	endif

	CALL "MEP_m_ConnectionsACL_4" parameters SetProgram = SetProgram,
		gs_Connections = gs_Connections,
		MEP_NumConnectionData = MEP_NumConnectionData,
		MEP_StrConnectionData = MEP_StrConnectionData,
		MEP_NumberConnections = MEP_NumberConnections,
		gs_AddConnections = gs_AddConnections,
		ConName = ConName,
		ConID = ConID,
		ConPosX = ConPosX_8 - A/2 + sinkDistL + sink_width*2.5 + sinkSpacing*2 + sinkPos[3][1],
		ConPosY = ConPosY_8,
		ConPosZ = ConPosZ_8+h_top,
		ConDVecX = ConDVecX,
		ConDVecY = ConDVecY,
		ConDVecZ = ConDVecZ,
		ConWVecX = ConWVecX,
		ConWVecY = ConWVecY,
		ConWVecZ = ConWVecZ,

		ConNominalWidth = ConNominalWidth_8,
		ConNominalDepth = ConNominalDepth_8,
		ConWidth = ConWidth_8,
		ConDepth = ConDepth_8,
		ConLength = ConLength_8,
		ConWallThickness = ConWallThickness_8,
		ConConnectorWidth = ConConnectorWidth_8,
		ConConnectorDepth = ConConnectorDepth_8,
		ConConnectorWidth2 = ConConnectorWidth2_8,
		ConToolType = ConToolType_8,
		ConStatus = ConStatus_8,
		ConType_8 = ConType_8,
		ConConnectorType_8 = ConConnectorType_8,
		ConSystem_8 = ConSystem_8,
		shape_typ_to_validation = shape_typ_to_validation,
		MEP_enabled_geometry_mod = 1,
		gs_ui = 0

	parameters MEP_ConInfo[ConID][1] = STR(ConToolType_8, 1, 0)
	parameters MEP_ConInfo[ConID][2] = ConName
	parameters MEP_ConInfo[ConID][3] = "0"


					! --- 9. CONNECTION --- !

	ConID = 9
	ConName = `Подключение Канализации 3`

	if nSink > 2 then
		ConDVecX = 0
		ConDVecY = 0
		ConDVecZ = -1

		ConWVecX = -1
		ConWVecY = 0
		ConWVecZ = 0

		IF ConWidth_9 < 0.001 THEN
			ConWidth_9 = 0.001
			parameters ConWidth_9 = ConWidth_9
		ENDIF
		IF ConWidth_9 > MIN(sink_width/3, B/3) THEN
			ConWidth_9 = MIN(sink_width/3, B/3)
			parameters ConWidth_9 = ConWidth_9
		ENDIF
		VALUES "ConWidth_9" RANGE (0, MIN(sink_width/3, B/3)]
		parameters ConDepth_9 = ConWidth_9
		VALUES "ConLength_9" RANGE [0, ]

		parameters ConPosX_9 = 0
		parameters ConPosY_9 = -B/2 + yBasinPos + sink_depth/2 - sink_depth/2 * (0.9 * 0.79 * 0.63)
		parameters ConPosZ_9 = -0.142 - count_th * bUnderMounted + 0.037 * (gs_sink_type_m = 3)
	else
		ConStatus_9 = 0
		lock "ConStatus_9"
		hideparameter "ConStatus_9"
	endif

	CALL "MEP_m_ConnectionsACL_4" parameters SetProgram = SetProgram,
		gs_Connections = gs_Connections,
		MEP_NumConnectionData = MEP_NumConnectionData,
		MEP_StrConnectionData = MEP_StrConnectionData,
		MEP_NumberConnections = MEP_NumberConnections,
		gs_AddConnections = gs_AddConnections,
		ConName = ConName,
		ConID = ConID,
		ConPosX = ConPosX_9 - A/2 + sinkDistL + sink_width*2.5 + sinkSpacing*2 + sinkPos[3][1],
		ConPosY = ConPosY_9,
		ConPosZ = ConPosZ_9+h_top,
		ConDVecX = ConDVecX,
		ConDVecY = ConDVecY,
		ConDVecZ = ConDVecZ,
		ConWVecX = ConWVecX,
		ConWVecY = ConWVecY,
		ConWVecZ = ConWVecZ,

		ConNominalWidth = ConNominalWidth_9,
		ConNominalDepth = ConNominalDepth_9,
		ConWidth = ConWidth_9,
		ConDepth = ConDepth_9,
		ConLength = ConLength_9,
		ConWallThickness = ConWallThickness_9,
		ConConnectorWidth = ConConnectorWidth_9,
		ConConnectorDepth = ConConnectorDepth_9,
		ConConnectorWidth2 = ConConnectorWidth2_9,
		ConToolType = ConToolType_9,
		ConStatus = ConStatus_9,
		ConType_9 = ConType_9,
		ConConnectorType_9 = ConConnectorType_9,
		ConSystem_9 = ConSystem_9,
		shape_typ_to_validation = shape_typ_to_validation,
		MEP_enabled_geometry_mod = 1,
		gs_ui = 0

	parameters MEP_ConInfo[ConID][1] = STR(ConToolType_9, 1, 0)
	parameters MEP_ConInfo[ConID][2] = ConName
	parameters MEP_ConInfo[ConID][3] = "0"

					! --- 10. CONNECTION --- !

	ConID = 10
	ConName = `Подключение Горячей Воды 4`

	if nSink > 3 then
		ConDVecX = 0
		if bWallmountedTap then
			ConDVecY = 1
			ConDVecZ = 0
		else
			ConDVecY = 0
			ConDVecZ = -1
		endif

		ConWVecX = -1
		ConWVecY = 0
		ConWVecZ = 0

		IF ConWidth_10 < 0.001 THEN
			ConWidth_10 = 0.001
			parameters ConWidth_10 = ConWidth_10
		ENDIF
		IF ConWidth_10 > MIN(sink_width/4, B/4) THEN
			ConWidth_10 = MIN(sink_width/4, B/4)
			parameters ConWidth_10 = ConWidth_10
		ENDIF
		VALUES "ConWidth_10" RANGE (0, MIN(sink_width/4, B/4)]
		parameters ConDepth_10 = ConWidth_10
		VALUES "ConLength_10" RANGE [0, ]

		! Default Position
		if (GLOB_MODPAR_NAME = "gs_tap_type" | GLOB_MODPAR_NAME = "gs_tap_type_m" | \
		GLOB_MODPAR_NAME = "tapGroup" | GLOB_MODPAR_NAME = "iTapGroup") then
			if bWallmountedTap then
				ConPosX_10 = posTap + widthTap/2
			else
				ConPosX_10 = -0.1
			endif
			parameters ConPosX_10 = ConPosX_10
		endif

		if bWallmountedTap then
			pos1st = -posTap - widthTap + ConWidth_10/2
			pos2nd = -posTap - ConWidth_10/2

			pos3rd = +posTap + ConWidth_10/2
			pos4th = +posTap + widthTap - ConWidth_10/2

			! --- X Range

			values "ConPosX_10"	range [pos1st, pos2nd],
								range [pos3rd, pos4th]

			! --- Change Connection Side
			if GLOB_MODPAR_NAME = "ConPosX_11" | (GLOB_MODPAR_NAME = "" & sgn(ConPosX_10) = sgn(ConPosX_11)) then
				if ConPosX_10 < 0 & ConPosX_11 < 0 then
					ConPosX_10 = posTap + widthTap/2
					parameters 	ConPosX_10 = ConPosX_10
				endif
				if ConPosX_10 > 0 & ConPosX_11 > 0 then
					ConPosX_10 = -(posTap + widthTap/2)
					parameters 	ConPosX_10 = ConPosX_10
				endif
			endif

			ConPosY_10 = 0
			parameters	ConPosX_10 = ConPosX_10,
						ConPosY_10 = ConPosY_10
		else
			values "ConPosX_10" range[-A/2 + ((sink_width + sinkSpacing)/2)*(nSink - 7) - sinkPos[4][1] + ConWidth_10/2, A/2 + ((sink_width + sinkSpacing)/2)*(nSink - 7) - sinkPos[4][1] - ConWidth_10/2]
			if GLOB_MODPAR_NAME = "A" | GLOB_MODPAR_NAME = "nSink" then
				ConPosX_10 = -0.1
				parameters ConPosX_10 = ConPosX_10
			endif
			values "ConPosY_10" range [-B + ConWidth_10/2, -ConWidth_10/2]
		endif
		parameters ConPosZ_10 = -count_th
	else
		ConStatus_10 = 0
		lock "ConStatus_10"
		hideparameter "ConStatus_10"
	endif

	CALL "MEP_m_ConnectionsACL_4" parameters SetProgram = SetProgram,
		gs_Connections = gs_Connections,
		MEP_NumConnectionData = MEP_NumConnectionData,
		MEP_StrConnectionData = MEP_StrConnectionData,
		MEP_NumberConnections = MEP_NumberConnections,
		gs_AddConnections = gs_AddConnections,
		ConName = ConName,
		ConID = ConID,
		ConPosX = ConPosX_10 - A/2 + sinkDistL + sink_width*3.5 + sinkSpacing*3 + sinkPos[4][1],
		ConPosY = ConPosY_10,
		ConPosZ = ConPosZ_10+h_top,
		ConDVecX = ConDVecX,
		ConDVecY = ConDVecY,
		ConDVecZ = ConDVecZ,
		ConWVecX = ConWVecX,
		ConWVecY = ConWVecY,
		ConWVecZ = ConWVecZ,

		ConNominalWidth = ConNominalWidth_10,
		ConNominalDepth = ConNominalDepth_10,
		ConWidth = ConWidth_10,
		ConDepth = ConDepth_10,
		ConLength = ConLength_10,
		ConWallThickness = ConWallThickness_10,
		ConConnectorWidth = ConConnectorWidth_10,
		ConConnectorDepth = ConConnectorDepth_10,
		ConConnectorWidth2 = ConConnectorWidth2_10,
		ConToolType = ConToolType_10,
		ConStatus = ConStatus_10,
		ConType_10 = ConType_10,
		ConConnectorType_10 = ConConnectorType_10,
		ConSystem_10 = ConSystem_10,
		ui_current_con = ui_current_con,
		shape_typ_to_validation = shape_typ_to_validation,
		MEP_enabled_geometry_mod = 1,
		gs_ui = 1

	parameters MEP_ConInfo[ConID][1] = STR(ConToolType_10, 1, 0)
	parameters MEP_ConInfo[ConID][2] = ConName
	parameters MEP_ConInfo[ConID][3] = "0"


					! --- 11. CONNECTION --- !

	ConID = 11
	ConName = `Подключение Холодной Воды 4`

	if nSink > 3 then
	ConDVecX = 0
		if bWallmountedTap then
			ConDVecY = 1
			ConDVecZ = 0
		else
			ConDVecY = 0
			ConDVecZ = -1
		endif

		ConWVecX = -1
		ConWVecY = 0
		ConWVecZ = 0

		IF ConWidth_11 < 0.001 THEN
			ConWidth_11 = 0.001
			parameters ConWidth_11 = ConWidth_11
		ENDIF
		IF ConWidth_11 > MIN(sink_width/4, B/4) THEN
			ConWidth_11 = MIN(sink_width/4, B/4)
			parameters ConWidth_11 = ConWidth_11
		ENDIF
		VALUES "ConWidth_11" RANGE (0, MIN(sink_width/4, B/4)]
		parameters ConDepth_11 = ConWidth_11
		VALUES "ConLength_11" RANGE [0, ]

		! Default Position
		if (GLOB_MODPAR_NAME = "gs_tap_type" | GLOB_MODPAR_NAME = "gs_tap_type_m" | \
		GLOB_MODPAR_NAME = "tapGroup" | GLOB_MODPAR_NAME = "iTapGroup") then
			if bWallmountedTap then
				ConPosX_11 = -posTap - widthTap/2
			else
				ConPosX_11 = 0.1
			endif
			parameters ConPosX_11 = ConPosX_11
		endif

		if bWallmountedTap then
			pos1st = -posTap - widthTap + ConWidth_11/2
			pos2nd = -posTap - ConWidth_11/2

			pos3rd = +posTap + ConWidth_11/2
			pos4th = +posTap + widthTap - ConWidth_11/2

			! --- X Range

			values "ConPosX_11"	range [pos1st, pos2nd],
								range [pos3rd, pos4th]

			! --- Change Connection Side
			if GLOB_MODPAR_NAME = "ConPosX_10" | (GLOB_MODPAR_NAME = "" & sgn(ConPosX_10) = sgn(ConPosX_11)) then
				if ConPosX_10 < 0 & ConPosX_11 < 0 then
					ConPosX_11 = posTap + widthTap/2
					parameters 	ConPosX_11 = ConPosX_11
				endif
				if ConPosX_10 > 0 & ConPosX_11 > 0 then
					ConPosX_11 = -(posTap + widthTap/2)
					parameters 	ConPosX_11 = ConPosX_11
				endif
			endif

			ConPosY_11 = 0
			parameters	ConPosX_11 = ConPosX_11,
						ConPosY_11 = ConPosY_11
		else
			values "ConPosX_11" range[-A/2 + ((sink_width + sinkSpacing)/2)*(nSink - 7) - sinkPos[4][1] + ConWidth_11/2, A/2 + ((sink_width + sinkSpacing)/2)*(nSink - 7) - sinkPos[4][1] - ConWidth_11/2]
			if GLOB_MODPAR_NAME = "A" | GLOB_MODPAR_NAME = "nSink" then
				ConPosX_11 = 0.1
				parameters ConPosX_11 = ConPosX_11
			endif
			values "ConPosY_11" range [-B + ConWidth_11/2, -ConWidth_11/2]
		endif
		parameters ConPosZ_11 = -count_th
	else
		ConStatus_11 = 0
		lock "ConStatus_11"
		hideparameter "ConStatus_11"
	endif

	CALL "MEP_m_ConnectionsACL_4" parameters SetProgram = SetProgram,
		gs_Connections = gs_Connections,
		MEP_NumConnectionData = MEP_NumConnectionData,
		MEP_StrConnectionData = MEP_StrConnectionData,
		MEP_NumberConnections = MEP_NumberConnections,
		gs_AddConnections = gs_AddConnections,
		ConName = ConName,
		ConID = ConID,
		ConPosX = ConPosX_11 - A/2 + sinkDistL + sink_width*3.5 + sinkSpacing*3 + sinkPos[4][1],
		ConPosY = ConPosY_11,
		ConPosZ = ConPosZ_11+h_top,
		ConDVecX = ConDVecX,
		ConDVecY = ConDVecY,
		ConDVecZ = ConDVecZ,
		ConWVecX = ConWVecX,
		ConWVecY = ConWVecY,
		ConWVecZ = ConWVecZ,

		ConNominalWidth = ConNominalWidth_11,
		ConNominalDepth = ConNominalDepth_11,
		ConWidth = ConWidth_11,
		ConDepth = ConDepth_11,
		ConLength = ConLength_11,
		ConWallThickness = ConWallThickness_11,
		ConConnectorWidth = ConConnectorWidth_11,
		ConConnectorDepth = ConConnectorDepth_11,
		ConConnectorWidth2 = ConConnectorWidth2_11,
		ConToolType = ConToolType_11,
		ConStatus = ConStatus_11,
		ConType_11 = ConType_11,
		ConConnectorType_11 = ConConnectorType_11,
		ConSystem_11 = ConSystem_11,
		shape_typ_to_validation = shape_typ_to_validation,
		MEP_enabled_geometry_mod = 1,
		gs_ui = 0

	parameters MEP_ConInfo[ConID][1] = STR(ConToolType_11, 1, 0)
	parameters MEP_ConInfo[ConID][2] = ConName
	parameters MEP_ConInfo[ConID][3] = "0"


					! --- 12. CONNECTION --- !

	ConID = 12
	ConName = `Подключение Канализации 4`

	if nSink > 3 then
		ConDVecX = 0
		ConDVecY = 0
		ConDVecZ = -1

		ConWVecX = -1
		ConWVecY = 0
		ConWVecZ = 0

		IF ConWidth_12 < 0.001 THEN
			ConWidth_12 = 0.001
			parameters ConWidth_12 = ConWidth_12
		ENDIF
		IF ConWidth_12 > MIN(sink_width/3, B/3) THEN
			ConWidth_12 = MIN(sink_width/3, B/3)
			parameters ConWidth_12 = ConWidth_12
		ENDIF
		VALUES "ConWidth_12" RANGE (0, MIN(sink_width/3, B/3)]
		parameters ConDepth_12 = ConWidth_12
		VALUES "ConLength_12" RANGE [0, ]

		parameters ConPosX_12 = 0
		parameters ConPosY_12 = -B/2 + yBasinPos + sink_depth/2 - sink_depth/2 * (0.9 * 0.79 * 0.63)
		parameters ConPosZ_12 = -0.142 - count_th * bUnderMounted + 0.037 * (gs_sink_type_m = 3)
	else
		ConStatus_12 = 0
		lock "ConStatus_12"
		hideparameter "ConStatus_12"
	endif

	CALL "MEP_m_ConnectionsACL_4" parameters SetProgram = SetProgram,
		gs_Connections = gs_Connections,
		MEP_NumConnectionData = MEP_NumConnectionData,
		MEP_StrConnectionData = MEP_StrConnectionData,
		MEP_NumberConnections = MEP_NumberConnections,
		gs_AddConnections = gs_AddConnections,
		ConName = ConName,
		ConID = ConID,
		ConPosX = ConPosX_12 - A/2 + sinkDistL + sink_width*3.5 + sinkSpacing*3 + sinkPos[4][1],
		ConPosY = ConPosY_12,
		ConPosZ = ConPosZ_12+h_top,
		ConDVecX = ConDVecX,
		ConDVecY = ConDVecY,
		ConDVecZ = ConDVecZ,
		ConWVecX = ConWVecX,
		ConWVecY = ConWVecY,
		ConWVecZ = ConWVecZ,

		ConNominalWidth = ConNominalWidth_12,
		ConNominalDepth = ConNominalDepth_12,
		ConWidth = ConWidth_12,
		ConDepth = ConDepth_12,
		ConLength = ConLength_12,
		ConWallThickness = ConWallThickness_12,
		ConConnectorWidth = ConConnectorWidth_12,
		ConConnectorDepth = ConConnectorDepth_12,
		ConConnectorWidth2 = ConConnectorWidth2_12,
		ConToolType = ConToolType_12,
		ConStatus = ConStatus_12,
		ConType_12 = ConType_12,
		ConConnectorType_12 = ConConnectorType_12,
		ConSystem_12 = ConSystem_12,
		shape_typ_to_validation = shape_typ_to_validation,
		MEP_enabled_geometry_mod = 1,
		gs_ui = 0

	parameters MEP_ConInfo[ConID][1] = STR(ConToolType_12, 1, 0)
	parameters MEP_ConInfo[ConID][2] = ConName
	parameters MEP_ConInfo[ConID][3] = "0"

					! --- 13. CONNECTION --- !

	ConID = 13
	ConName = `Подключение Горячей Воды 5`

	if nSink > 4 then
		ConDVecX = 0
		if bWallmountedTap then
			ConDVecY = 1
			ConDVecZ = 0
		else
			ConDVecY = 0
			ConDVecZ = -1
		endif

		ConWVecX = -1
		ConWVecY = 0
		ConWVecZ = 0

		IF ConWidth_13 < 0.001 THEN
			ConWidth_13 = 0.001
			parameters ConWidth_13 = ConWidth_13
		ENDIF
		IF ConWidth_13 > MIN(sink_width/4, B/4) THEN
			ConWidth_13 = MIN(sink_width/4, B/4)
			parameters ConWidth_13 = ConWidth_13
		ENDIF
		VALUES "ConWidth_13" RANGE (0, MIN(sink_width/4, B/4)]
		parameters ConDepth_13 = ConWidth_13
		VALUES "ConLength_13" RANGE [0, ]

		! Default Position
		if (GLOB_MODPAR_NAME = "gs_tap_type" | GLOB_MODPAR_NAME = "gs_tap_type_m" | \
		GLOB_MODPAR_NAME = "tapGroup" | GLOB_MODPAR_NAME = "iTapGroup") then
			if bWallmountedTap then
				ConPosX_13 = posTap + widthTap/2
			else
				ConPosX_13 = -0.1
			endif
			parameters ConPosX_13 = ConPosX_13
		endif

		if bWallmountedTap then
			pos1st = -posTap - widthTap + ConWidth_13/2
			pos2nd = -posTap - ConWidth_13/2

			pos3rd = +posTap + ConWidth_13/2
			pos4th = +posTap + widthTap - ConWidth_13/2

			! --- X Range

			values "ConPosX_13"	range [pos1st, pos2nd],
								range [pos3rd, pos4th]

			! --- Change Connection Side
			if GLOB_MODPAR_NAME = "ConPosX_14" | (GLOB_MODPAR_NAME = "" & sgn(ConPosX_13) = sgn(ConPosX_14)) then
				if ConPosX_13 < 0 & ConPosX_14 < 0 then
					ConPosX_13 = posTap + widthTap/2
					parameters 	ConPosX_13 = ConPosX_13
				endif
				if ConPosX_13 > 0 & ConPosX_14 > 0 then
					ConPosX_13 = -(posTap + widthTap/2)
					parameters 	ConPosX_13 = ConPosX_13
				endif
			endif

			ConPosY_13 = 0
			parameters	ConPosX_13 = ConPosX_13,
						ConPosY_13 = ConPosY_13
		else
			values "ConPosX_13" range[-A/2 + ((sink_width + sinkSpacing)/2)*(nSink - 9) - sinkPos[5][1] + ConWidth_13/2, A/2 + ((sink_width + sinkSpacing)/2)*(nSink - 9) - sinkPos[5][1] - ConWidth_13/2]
			if GLOB_MODPAR_NAME = "A" | GLOB_MODPAR_NAME = "nSink" then
				ConPosX_13 = -0.1
				parameters ConPosX_13 = ConPosX_13
			endif
			values "ConPosY_13" range [-B + ConWidth_13/2, -ConWidth_13/2]
		endif
		parameters ConPosZ_13 = -count_th
	else
		ConStatus_13 = 0
		lock "ConStatus_13"
		hideparameter "ConStatus_13"
	endif

	CALL "MEP_m_ConnectionsACL_4" parameters SetProgram = SetProgram,
		gs_Connections = gs_Connections,
		MEP_NumConnectionData = MEP_NumConnectionData,
		MEP_StrConnectionData = MEP_StrConnectionData,
		MEP_NumberConnections = MEP_NumberConnections,
		gs_AddConnections = gs_AddConnections,
		ConName = ConName,
		ConID = ConID,
		ConPosX = ConPosX_13 - A/2 + sinkDistL + sink_width*4.5 + sinkSpacing*4 + sinkPos[5][1],
		ConPosY = ConPosY_13,
		ConPosZ = ConPosZ_13+h_top,
		ConDVecX = ConDVecX,
		ConDVecY = ConDVecY,
		ConDVecZ = ConDVecZ,
		ConWVecX = ConWVecX,
		ConWVecY = ConWVecY,
		ConWVecZ = ConWVecZ,

		ConNominalWidth = ConNominalWidth_13,
		ConNominalDepth = ConNominalDepth_13,
		ConWidth = ConWidth_13,
		ConDepth = ConDepth_13,
		ConLength = ConLength_13,
		ConWallThickness = ConWallThickness_13,
		ConConnectorWidth = ConConnectorWidth_13,
		ConConnectorDepth = ConConnectorDepth_13,
		ConConnectorWidth2 = ConConnectorWidth2_13,
		ConToolType = ConToolType_13,
		ConStatus = ConStatus_13,
		ConType_13 = ConType_13,
		ConConnectorType_13 = ConConnectorType_13,
		ConSystem_13 = ConSystem_13,
		ui_current_con = ui_current_con,
		shape_typ_to_validation = shape_typ_to_validation,
		MEP_enabled_geometry_mod = 1,
		gs_ui = 1

	parameters MEP_ConInfo[ConID][1] = STR(ConToolType_13, 1, 0)
	parameters MEP_ConInfo[ConID][2] = ConName
	parameters MEP_ConInfo[ConID][3] = "0"


					! --- 14. CONNECTION --- !

	ConID = 14
	ConName = `Подключение Холодной Воды 5`

	if nSink > 4 then
	ConDVecX = 0
		if bWallmountedTap then
			ConDVecY = 1
			ConDVecZ = 0
		else
			ConDVecY = 0
			ConDVecZ = -1
		endif

		ConWVecX = -1
		ConWVecY = 0
		ConWVecZ = 0

		IF ConWidth_14 < 0.001 THEN
			ConWidth_14 = 0.001
			parameters ConWidth_14 = ConWidth_14
		ENDIF
		IF ConWidth_14 > MIN(sink_width/4, B/4) THEN
			ConWidth_14 = MIN(sink_width/4, B/4)
			parameters ConWidth_14 = ConWidth_14
		ENDIF
		VALUES "ConWidth_14" RANGE (0, MIN(sink_width/4, B/4)]
		parameters ConDepth_14 = ConWidth_14
		VALUES "ConLength_14" RANGE [0, ]

		! Default Position
		if (GLOB_MODPAR_NAME = "gs_tap_type" | GLOB_MODPAR_NAME = "gs_tap_type_m" | \
		GLOB_MODPAR_NAME = "tapGroup" | GLOB_MODPAR_NAME = "iTapGroup") then
			if bWallmountedTap then
				ConPosX_14 = -posTap - widthTap/2
			else
				ConPosX_14 = 0.1
			endif
			parameters ConPosX_14 = ConPosX_14
		endif

		if bWallmountedTap then
			pos1st = -posTap - widthTap + ConWidth_14/2
			pos2nd = -posTap - ConWidth_14/2

			pos3rd = +posTap + ConWidth_14/2
			pos4th = +posTap + widthTap - ConWidth_14/2

			! --- X Range

			values "ConPosX_14"	range [pos1st, pos2nd],
								range [pos3rd, pos4th]

			! --- Change Connection Side
			if GLOB_MODPAR_NAME = "ConPosX_13" | (GLOB_MODPAR_NAME = "" & sgn(ConPosX_13) = sgn(ConPosX_14)) then
				if ConPosX_13 < 0 & ConPosX_14 < 0 then
					ConPosX_14 = posTap + widthTap/2
					parameters 	ConPosX_14 = ConPosX_14
				endif
				if ConPosX_13 > 0 & ConPosX_14 > 0 then
					ConPosX_14 = -(posTap + widthTap/2)
					parameters 	ConPosX_14 = ConPosX_14
				endif
			endif

			ConPosY_14 = 0
			parameters	ConPosX_14 = ConPosX_14,
						ConPosY_14 = ConPosY_14
		else
			values "ConPosX_14" range[-A/2 + ((sink_width + sinkSpacing)/2)*(nSink - 9) - sinkPos[5][1] + ConWidth_14/2, A/2 + ((sink_width + sinkSpacing)/2)*(nSink - 9) - sinkPos[5][1] - ConWidth_14/2]
			if GLOB_MODPAR_NAME = "A" | GLOB_MODPAR_NAME = "nSink" then
				ConPosX_14 = 0.1
				parameters ConPosX_14 = ConPosX_14
			endif
			values "ConPosY_14" range [-B + ConWidth_14/2, -ConWidth_14/2]
		endif
		parameters ConPosZ_14 = -count_th
	else
		ConStatus_14 = 0
		lock "ConStatus_14"
		hideparameter "ConStatus_14"
	endif

	CALL "MEP_m_ConnectionsACL_4" parameters SetProgram = SetProgram,
		gs_Connections = gs_Connections,
		MEP_NumConnectionData = MEP_NumConnectionData,
		MEP_StrConnectionData = MEP_StrConnectionData,
		MEP_NumberConnections = MEP_NumberConnections,
		gs_AddConnections = gs_AddConnections,
		ConName = ConName,
		ConID = ConID,
		ConPosX = ConPosX_14 - A/2 + sinkDistL + sink_width*4.5 + sinkSpacing*4 + sinkPos[5][1],
		ConPosY = ConPosY_14,
		ConPosZ = ConPosZ_14+h_top,
		ConDVecX = ConDVecX,
		ConDVecY = ConDVecY,
		ConDVecZ = ConDVecZ,
		ConWVecX = ConWVecX,
		ConWVecY = ConWVecY,
		ConWVecZ = ConWVecZ,

		ConNominalWidth = ConNominalWidth_14,
		ConNominalDepth = ConNominalDepth_14,
		ConWidth = ConWidth_14,
		ConDepth = ConDepth_14,
		ConLength = ConLength_14,
		ConWallThickness = ConWallThickness_14,
		ConConnectorWidth = ConConnectorWidth_14,
		ConConnectorDepth = ConConnectorDepth_14,
		ConConnectorWidth2 = ConConnectorWidth2_14,
		ConToolType = ConToolType_14,
		ConStatus = ConStatus_14,
		ConType_14 = ConType_14,
		ConConnectorType_14 = ConConnectorType_14,
		ConSystem_14 = ConSystem_14,
		shape_typ_to_validation = shape_typ_to_validation,
		MEP_enabled_geometry_mod = 1,
		gs_ui = 0

	parameters MEP_ConInfo[ConID][1] = STR(ConToolType_14, 1, 0)
	parameters MEP_ConInfo[ConID][2] = ConName
	parameters MEP_ConInfo[ConID][3] = "0"


					! --- 15. CONNECTION --- !

	ConID = 15
	ConName = `Подключение Канализации 5`

	if nSink > 4 then
		ConDVecX = 0
		ConDVecY = 0
		ConDVecZ = -1

		ConWVecX = -1
		ConWVecY = 0
		ConWVecZ = 0

		IF ConWidth_15 < 0.001 THEN
			ConWidth_15 = 0.001
			parameters ConWidth_15 = ConWidth_15
		ENDIF
		IF ConWidth_15 > MIN(sink_width/3, B/3) THEN
			ConWidth_15 = MIN(sink_width/3, B/3)
			parameters ConWidth_15 = ConWidth_15
		ENDIF
		VALUES "ConWidth_15" RANGE (0, MIN(sink_width/3, B/3)]
		parameters ConDepth_15 = ConWidth_15
		VALUES "ConLength_15" RANGE [0, ]

		parameters ConPosX_15 = 0
		parameters ConPosY_15 = -B/2 + yBasinPos + sink_depth/2 - sink_depth/2 * (0.9 * 0.79 * 0.63)
		parameters ConPosZ_15 = -0.142 - count_th * bUnderMounted + 0.037 * (gs_sink_type_m = 3)
	else
		ConStatus_15 = 0
		lock "ConStatus_15"
		hideparameter "ConStatus_15"
	endif

	CALL "MEP_m_ConnectionsACL_4" parameters SetProgram = SetProgram,
		gs_Connections = gs_Connections,
		MEP_NumConnectionData = MEP_NumConnectionData,
		MEP_StrConnectionData = MEP_StrConnectionData,
		MEP_NumberConnections = MEP_NumberConnections,
		gs_AddConnections = gs_AddConnections,
		ConName = ConName,
		ConID = ConID,
		ConPosX = ConPosX_15 - A/2 + sinkDistL + sink_width*4.5 + sinkSpacing*4 + sinkPos[5][1],
		ConPosY = ConPosY_15,
		ConPosZ = ConPosZ_15+h_top,
		ConDVecX = ConDVecX,
		ConDVecY = ConDVecY,
		ConDVecZ = ConDVecZ,
		ConWVecX = ConWVecX,
		ConWVecY = ConWVecY,
		ConWVecZ = ConWVecZ,

		ConNominalWidth = ConNominalWidth_15,
		ConNominalDepth = ConNominalDepth_15,
		ConWidth = ConWidth_15,
		ConDepth = ConDepth_15,
		ConLength = ConLength_15,
		ConWallThickness = ConWallThickness_15,
		ConConnectorWidth = ConConnectorWidth_15,
		ConConnectorDepth = ConConnectorDepth_15,
		ConConnectorWidth2 = ConConnectorWidth2_15,
		ConToolType = ConToolType_15,
		ConStatus = ConStatus_15,
		ConType_15 = ConType_15,
		ConConnectorType_15 = ConConnectorType_15,
		ConSystem_15 = ConSystem_15,
		shape_typ_to_validation = shape_typ_to_validation,
		MEP_enabled_geometry_mod = 1,
		gs_ui = 0

	parameters MEP_ConInfo[ConID][1] = STR(ConToolType_15, 1, 0)
	parameters MEP_ConInfo[ConID][2] = ConName
	parameters MEP_ConInfo[ConID][3] = "0"

					! --- 16. CONNECTION --- !

	ConID = 16
	ConName = `Подключение Горячей Воды 6`

	if nSink > 5 then
	ConDVecX = 0
		if bWallmountedTap then
			ConDVecY = 1
			ConDVecZ = 0
		else
			ConDVecY = 0
			ConDVecZ = -1
		endif

		ConWVecX = -1
		ConWVecY = 0
		ConWVecZ = 0

		IF ConWidth_16 < 0.001 THEN
			ConWidth_16 = 0.001
			parameters ConWidth_16 = ConWidth_16
		ENDIF
		IF ConWidth_16 > MIN(sink_width/4, B/4) THEN
			ConWidth_16 = MIN(sink_width/4, B/4)
			parameters ConWidth_16 = ConWidth_16
		ENDIF
		VALUES "ConWidth_16" RANGE (0, MIN(sink_width/4, B/4)]
		parameters ConDepth_16 = ConWidth_16
		VALUES "ConLength_16" RANGE [0, ]

		if bWallmountedTap then
			pos1st = -posTap - widthTap + ConWidth_16/2
			pos2nd = -posTap - ConWidth_16/2

			pos3rd = +posTap + ConWidth_16/2
			pos4th = +posTap + widthTap - ConWidth_16/2

			! --- X Range

			values "ConPosX_16"	range [pos1st, pos2nd],
								range [pos3rd, pos4th]

			! --- Change Connection Side
			if GLOB_MODPAR_NAME = "ConPosX_17" | (GLOB_MODPAR_NAME = "" & sgn(ConPosX_16) = sgn(ConPosX_17)) then
				if ConPosX_16 < 0 & ConPosX_17 < 0 then
					ConPosX_16 = posTap + widthTap/2
					parameters 	ConPosX_16 = ConPosX_16
				endif
				if ConPosX_16 > 0 & ConPosX_17 > 0 then
					ConPosX_16 = -(posTap + widthTap/2)
					parameters 	ConPosX_16 = ConPosX_16
				endif
			endif

			ConPosY_16 = 0
			parameters	ConPosX_16 = ConPosX_16,
						ConPosY_16 = ConPosY_16
		else
			values "ConPosX_16" range[-A/2 + ((sink_width + sinkSpacing)/2)*(nSink - 11) - sinkPos[6][1] + ConWidth_16/2, A/2 + ((sink_width + sinkSpacing)/2)*(nSink - 11) - sinkPos[6][1] - ConWidth_16/2]
			if GLOB_MODPAR_NAME = "A" | GLOB_MODPAR_NAME = "nSink" then
				ConPosX_16 = -0.1
				parameters ConPosX_16 = ConPosX_16
			endif
			values "ConPosY_16" range [-B + ConWidth_16/2, -ConWidth_16/2]
		endif
		parameters ConPosZ_16 = -count_th
	else
		ConStatus_16 = 0
		lock "ConStatus_16"
		hideparameter "ConStatus_16"
	endif

	CALL "MEP_m_ConnectionsACL_4" parameters SetProgram = SetProgram,
		gs_Connections = gs_Connections,
		MEP_NumConnectionData = MEP_NumConnectionData,
		MEP_StrConnectionData = MEP_StrConnectionData,
		MEP_NumberConnections = MEP_NumberConnections,
		gs_AddConnections = gs_AddConnections,
		ConName = ConName,
		ConID = ConID,
		ConPosX = ConPosX_16 - A/2 + sinkDistL + sink_width*5.5 + sinkSpacing*5 + sinkPos[6][1],
		ConPosY = ConPosY_16,
		ConPosZ = ConPosZ_16+h_top,
		ConDVecX = ConDVecX,
		ConDVecY = ConDVecY,
		ConDVecZ = ConDVecZ,
		ConWVecX = ConWVecX,
		ConWVecY = ConWVecY,
		ConWVecZ = ConWVecZ,

		ConNominalWidth = ConNominalWidth_16,
		ConNominalDepth = ConNominalDepth_16,
		ConWidth = ConWidth_16,
		ConDepth = ConDepth_16,
		ConLength = ConLength_16,
		ConWallThickness = ConWallThickness_16,
		ConConnectorWidth = ConConnectorWidth_16,
		ConConnectorDepth = ConConnectorDepth_16,
		ConConnectorWidth2 = ConConnectorWidth2_16,
		ConToolType = ConToolType_16,
		ConStatus = ConStatus_16,
		ConType_16 = ConType_16,
		ConConnectorType_16 = ConConnectorType_16,
		ConSystem_16 = ConSystem_16,
		ui_current_con = ui_current_con,
		shape_typ_to_validation = shape_typ_to_validation,
		MEP_enabled_geometry_mod = 1,
		gs_ui = 1

	parameters MEP_ConInfo[ConID][1] = STR(ConToolType_16, 1, 0)
	parameters MEP_ConInfo[ConID][2] = ConName
	parameters MEP_ConInfo[ConID][3] = "0"


					! --- 17. CONNECTION --- !

	ConID = 17
	ConName = `Подключение Холодной Воды 6`

	if nSink > 5 then
	ConDVecX = 0
		if bWallmountedTap then
			ConDVecY = 1
			ConDVecZ = 0
		else
			ConDVecY = 0
			ConDVecZ = -1
		endif

		ConWVecX = -1
		ConWVecY = 0
		ConWVecZ = 0

		IF ConWidth_17 < 0.001 THEN
			ConWidth_17 = 0.001
			parameters ConWidth_17 = ConWidth_17
		ENDIF
		IF ConWidth_17 > MIN(sink_width/4, B/4) THEN
			ConWidth_17 = MIN(sink_width/4, B/4)
			parameters ConWidth_17 = ConWidth_17
		ENDIF
		VALUES "ConWidth_17" RANGE (0, MIN(sink_width/4, B/4)]
		parameters ConDepth_17 = ConWidth_17
		VALUES "ConLength_17" RANGE [0, ]

		if bWallmountedTap then
			pos1st = -posTap - widthTap + ConWidth_17/2
			pos2nd = -posTap - ConWidth_17/2

			pos3rd = +posTap + ConWidth_17/2
			pos4th = +posTap + widthTap - ConWidth_17/2

			! --- X Range

			values "ConPosX_17"	range [pos1st, pos2nd],
								range [pos3rd, pos4th]

			! --- Change Connection Side
			if GLOB_MODPAR_NAME = "ConPosX_16" | (GLOB_MODPAR_NAME = "" & sgn(ConPosX_16) = sgn(ConPosX_17)) then
				if ConPosX_16 < 0 & ConPosX_17 < 0 then
					ConPosX_17 = posTap + widthTap/2
					parameters 	ConPosX_17 = ConPosX_17
				endif
				if ConPosX_16 > 0 & ConPosX_17 > 0 then
					ConPosX_17 = -(posTap + widthTap/2)
					parameters 	ConPosX_17 = ConPosX_17
				endif
			endif

			ConPosY_17 = 0
			parameters	ConPosX_17 = ConPosX_17,
						ConPosY_17 = ConPosY_17
		else
			values "ConPosX_17" range[-A/2 + ((sink_width + sinkSpacing)/2)*(nSink - 11) - sinkPos[6][1] + ConWidth_17/2, A/2 + ((sink_width + sinkSpacing)/2)*(nSink - 11) - sinkPos[6][1] - ConWidth_17/2]
			if GLOB_MODPAR_NAME = "A" | GLOB_MODPAR_NAME = "nSink" then
				ConPosX_17 = 0.1
				parameters ConPosX_17 = ConPosX_17
			endif
			values "ConPosY_17" range [-B + ConWidth_17/2, -ConWidth_17/2]
		endif
		parameters ConPosZ_17 = -count_th
	else
		ConStatus_17 = 0
		lock "ConStatus_17"
		hideparameter "ConStatus_17"
	endif

	CALL "MEP_m_ConnectionsACL_4" parameters SetProgram = SetProgram,
		gs_Connections = gs_Connections,
		MEP_NumConnectionData = MEP_NumConnectionData,
		MEP_StrConnectionData = MEP_StrConnectionData,
		MEP_NumberConnections = MEP_NumberConnections,
		gs_AddConnections = gs_AddConnections,
		ConName = ConName,
		ConID = ConID,
		ConPosX = ConPosX_17 - A/2 + sinkDistL + sink_width*5.5 + sinkSpacing*5 + sinkPos[6][1],
		ConPosY = ConPosY_17,
		ConPosZ = ConPosZ_17+h_top,
		ConDVecX = ConDVecX,
		ConDVecY = ConDVecY,
		ConDVecZ = ConDVecZ,
		ConWVecX = ConWVecX,
		ConWVecY = ConWVecY,
		ConWVecZ = ConWVecZ,

		ConNominalWidth = ConNominalWidth_17,
		ConNominalDepth = ConNominalDepth_17,
		ConWidth = ConWidth_17,
		ConDepth = ConDepth_17,
		ConLength = ConLength_17,
		ConWallThickness = ConWallThickness_17,
		ConConnectorWidth = ConConnectorWidth_17,
		ConConnectorDepth = ConConnectorDepth_17,
		ConConnectorWidth2 = ConConnectorWidth2_17,
		ConToolType = ConToolType_17,
		ConStatus = ConStatus_17,
		ConType_17 = ConType_17,
		ConConnectorType_17 = ConConnectorType_17,
		ConSystem_17 = ConSystem_17,
		shape_typ_to_validation = shape_typ_to_validation,
		MEP_enabled_geometry_mod = 1,
		gs_ui = 0

	parameters MEP_ConInfo[ConID][1] = STR(ConToolType_17, 1, 0)
	parameters MEP_ConInfo[ConID][2] = ConName
	parameters MEP_ConInfo[ConID][3] = "0"


					! --- 18. CONNECTION --- !

	ConID = 18
	ConName = `Подключение Канализации 6`

	if nSink > 5 then
		ConDVecX = 0
		ConDVecY = 0
		ConDVecZ = -1

		ConWVecX = -1
		ConWVecY = 0
		ConWVecZ = 0

		IF ConWidth_18 < 0.001 THEN
			ConWidth_18 = 0.001
			parameters ConWidth_18 = ConWidth_18
		ENDIF
		IF ConWidth_18 > MIN(sink_width/3, B/3) THEN
			ConWidth_18 = MIN(sink_width/3, B/3)
			parameters ConWidth_18 = ConWidth_18
		ENDIF
		VALUES "ConWidth_18" RANGE (0, MIN(sink_width/3, B/3)]
		parameters ConDepth_18 = ConWidth_18
		VALUES "ConLength_18" RANGE [0, ]

		parameters ConPosX_18 = 0
		parameters ConPosY_18 = -B/2 + yBasinPos + sink_depth/2 - sink_depth/2 * (0.9 * 0.79 * 0.63)
		parameters ConPosZ_18 = -0.142 - count_th * bUnderMounted + 0.037 * (gs_sink_type_m = 3)
	else
		ConStatus_18 = 0
		lock "ConStatus_18"
		hideparameter "ConStatus_18"
	endif

	CALL "MEP_m_ConnectionsACL_4" parameters SetProgram = SetProgram,
		gs_Connections = gs_Connections,
		MEP_NumConnectionData = MEP_NumConnectionData,
		MEP_StrConnectionData = MEP_StrConnectionData,
		MEP_NumberConnections = MEP_NumberConnections,
		gs_AddConnections = gs_AddConnections,
		ConName = ConName,
		ConID = ConID,
		ConPosX = ConPosX_18 - A/2 + sinkDistL + sink_width*5.5 + sinkSpacing*5 + sinkPos[6][1],
		ConPosY = ConPosY_18,
		ConPosZ = ConPosZ_18+h_top,
		ConDVecX = ConDVecX,
		ConDVecY = ConDVecY,
		ConDVecZ = ConDVecZ,
		ConWVecX = ConWVecX,
		ConWVecY = ConWVecY,
		ConWVecZ = ConWVecZ,

		ConNominalWidth = ConNominalWidth_18,
		ConNominalDepth = ConNominalDepth_18,
		ConWidth = ConWidth_18,
		ConDepth = ConDepth_18,
		ConLength = ConLength_18,
		ConWallThickness = ConWallThickness_18,
		ConConnectorWidth = ConConnectorWidth_18,
		ConConnectorDepth = ConConnectorDepth_18,
		ConConnectorWidth2 = ConConnectorWidth2_18,
		ConToolType = ConToolType_18,
		ConStatus = ConStatus_18,
		ConType_18 = ConType_18,
		ConConnectorType_18 = ConConnectorType_18,
		ConSystem_18 = ConSystem_18,
		shape_typ_to_validation = shape_typ_to_validation,
		MEP_enabled_geometry_mod = 1,
		gs_ui = 0

	parameters MEP_ConInfo[ConID][1] = STR(ConToolType_18, 1, 0)
	parameters MEP_ConInfo[ConID][2] = ConName
	parameters MEP_ConInfo[ConID][3] = "0"


	IF gs_ui_current_page = 4 THEN
		ac_mep_connectionpage_active = 1
	ELSE
		ac_mep_connectionpage_active = 0
	ENDIF
	parameters ac_mep_connectionpage_active = ac_mep_connectionpage_active

	IF SetProgram THEN
		SetProgram = 0
		parameters SetProgram = SetProgram
	ENDIF
ELSE
	hideparameter "gs_connection", "gs_con_mat", "useSysMat"

	ac_mep_connectionpage_active = 0
	parameters ac_mep_connectionpage_active = ac_mep_connectionpage_active
ENDIF

call "ui_plumbingfixtures" parameters iObjectType 		= 16,
								gs_ui_current_page = gs_ui_current_page

! =============================================================================
! Onorm list Settings
! =============================================================================
if LibraryLangCode = "AUT" or LibraryLangCode = "CHE" or LibraryLangCode = "GER" then
	call "Onorm_Plumbing" parameters all
else
	hideparameter "gs_onorm_Title"
endif

END

parameters ac_bottomlevel = h_top - zzyzx
parameters ac_toplevel = h_top
