
! ==============================================================================
! Basin Corner
! ==============================================================================


unID = 1
DrawingNum = 1
IF DrawingNum = 1 THEN	! Top

	! ==========================================================================
	! Scale
	! ==========================================================================

	call "2dDetailLevel" parameters gs_detlevel_2D_m = gs_detlevel_2D_m,
					returned_parameters gs_detlevel_2D_m


	! === 2D =============================================================

	pen gs_cont_pen
	fill gs_fill_type
	hotspot2 0,0, unID : unID = unID + 1
	drawindex 20

	! --- Symbolic ---------------------------------------------------
	if iSymbolType = 1 then
		mul2 a/defSizeA, b/defSizeB
		poly2_b 5, 1+2+4+64,gs_fill_pen,gs_back_pen,
				0, 0,      1,
				0, -0.3688414085413,      1,
				0.1522516509855, -0.1522516509855,    900,
				0, 160.2105598449,   4001,
				0.3688414085413, 0,      1

		hotspot2 0, 0
		hotspot2 0.339457003882, -0.339457003882
		hotspot2 0.152251650986, -0.417
		hotspot2 0.417, -0.152251650986
		hotspot2 0.368841408541, 0
		hotspot2 0, -0.368841408541

		circle2  0.045289782188, -0.157073749871, 0.00937747471339
		circle2  0.045289782188, -0.157073749871, 0.0178514302699
		arc2     0.164377342478, -0.164377342478, 0.208109294757, 251.5651108061, 18.43488919419
		arc2     0.392754404255, -0.392754404255, 0.384215620786, 114.3842607479, 155.6157392524
		arc2     0.128221696788, -0.272844655826, 0.093774747134, 155.6157392524, 251.5651108061
		circle2  0.164377342478, -0.164377342478, 0.0324772636532
		circle2  0.164377342478, -0.164377342478, 0.0248155454808
		arc2     0.272844655826, -0.128221696788, 0.093774747134, 18.43488919419, 114.3842607479
		circle2  0.157073749871, -0.045289782188, 0.00937747471339
		circle2  0.157073749871, -0.045289782188, 0.0178514302699

		del 1
	endif

	! --- Model Based ---------------------------------------------------
	if iSymbolType = 2 then
		mul2 a/defSizeA, b/defSizeB

		poly2_b 4, 1+2+4+64,gs_fill_pen,gs_back_pen,
				0, -0.4045436328574,      1,
				0.09003232141373, -0.09029528355607,    900,
				0, 122.0220233211,   4001,
				0, 0,      1

		hotspot2 0,            	0
		hotspot2 0.202227499,  	0
		hotspot2 0,				-0.202263687
		hotspot2 0.321275994846, -0.3213455106389
		hotspot2 0.416923501988, -0.0902952835561
		hotspot2 0.202227499, 	-0.202263687
		hotspot2 0.404205212837, 0
		hotspot2 0, 			-0.404543632857
		hotspot2 0.103064194439, -0.103150477055
		hotspot2 0.0900323214137, -0.417186464131

		! --- 1/50 ---
		if gs_detlevel_2D_m = 3 then
			circle2  0.1732, -0.1732, 0.023871333
		endif

		! --- 1/100 + 1/50 ---
		if gs_detlevel_2D_m >= 2 then
			line2    0.0804386828177, -0.348375156157, 0.0635990249387, -0.173647647134
			line2    0.348343449446, -0.0805758794473, 0.173622586047, -0.0636674087958
			arc2     0.111000884534, -0.111424988569, 0.282201122322, 274.8252723364, 355.261359365
			arc2     0.129467349328, -0.34364993587, 0.0492588986663, 185.5049749794, 276.1434021514
			arc2     0.168526004015, -0.116332089797, 0.0529107151093, 84.47245984821, 124.9875615118
			arc2     0.343598920245, -0.129602681191, 0.0492588986663, 353.8340326763, 84.47245984821
			arc2     0.318986565072, -0.319015795011, 0.305320005299, 126.3107172163, 143.6920076418
			arc2     0.116265709076, -0.168571806773, 0.0529107151093, 144.9898733158, 185.5049749794
		endif

		del 1
	endif

	reqBMinSpace = 0
	if MSFront > EPS and MSWidth > EPS  then
		call "fa_minimalspace" parameters all MSType = 0, unID = 3000,
								returned_parameters reqBMinSpace,
													MSFillType,
													MSFillPen,
													MSFillBackPen,
													MSContLineType,
													MSContLinePen
	endif

	if reqBMinSpace <> 0 then            !! MINIMAL SPACE
		rot2 -90
		add2 bOffset * (b/defSizeB), aOffset * (A/defSizeA)

		add2 bb * cos(45), aa * sin (45)
		rot2 -atn(aa/bb)

		unID = 3000
		drawindex 10
		FILL MSFillType
		line_type MSContLineType
		pen MSContLinePen

		hotspot2  0, 0, unID : unID = unID + 1

		if abs(a-b) < EPS then			!A and B are equal
			if (sqr(aMod^2 + bMod^2) - MSWidth) > EPS then
				delta = rrr - sqr (rrr^2 - (MSWidth / 2)^2)

				put	-MSWidth / 2, -delta, 0,
					 0, 			-rrr, 		900,
					 MSWidth / 2, 	-delta, 	3001,
					 MSWidth / 2, 	MSFront, 	1,
					-MSWidth / 2, 	MSFront, 	1,
					-MSWidth / 2, 	-delta, 	-1

				hotspot2 -MSWidth / 2, 0, unID : unID = unID + 1
				hotspot2  MSWidth / 2, 0, unID : unID = unID + 1

			else
				maxWidth = 2 * (radOrigo + MSFront)
				minWidth = sqr(aMod^2 + bMod^2)
				deltaAdd = maxWidth/2 - MSWidth/2
				deltaMax = radOrigo - (minWidth/2)

				put	-minWidth / 2, 	-deltaMax, 0,
					 0, 			-rrr, 		900,
					 minWidth / 2, 	-deltaMax, 	3001,
					 MSWidth / 2, 	MSFront - deltaAdd, 	1,
					 MSWidth / 2, 	MSFront, 	1,
					-MSWidth / 2, 	MSFront, 	1,
					-MSWidth / 2, 	MSFront - deltaAdd, 	1,
					-MSWidth / 2, 	-deltaMax, 	-1

				hotspot2 -MSWidth / 2, MSFront - deltaAdd, unID : unID = unID + 1
				hotspot2  MSWidth / 2, MSFront - deltaAdd, unID : unID = unID + 1
			endif
		else
			if (minWidth/2 - MSWidth/2) > EPS then
				put	-MSWidth / 2, 0, 		1,
					 MSWidth / 2, 0, 		1,
					 MSWidth / 2, MSFront,  1,
					-MSWidth / 2, MSFront,  1,
					-MSWidth / 2, 0, 		-1
			else
				put	-minWidth/2, 	0, 		1,
					-MSWidth/2, 	MSFront-delta1, 1,
					-MSWidth/2, 	MSFront, 1,
					MSWidth/2, 		MSFront, 1,
					MSWidth/2, 		MSFront-delta2, 1,
					minWidth/2, 	0, 		1,
					-minWidth/2, 	0, 		-1

				hotspot2 -MSWidth / 2, MSFront - delta1, unID : unID = unID + 1
				hotspot2  MSWidth / 2, MSFront - delta2, unID : unID = unID + 1
			endif
		endif
		drawindex 10

		poly2_b nsp/3, 1+2+4+64, MSFillPen, MSFillBackPen,
				get(nsp)

		hotspot2  MSWidth / 2, MSFront, unID : unID = unID + 1
		hotspot2 -MSWidth / 2, MSFront, unID : unID = unID + 1

		del 4
	endif

	pen gs_fill_pen
	line_type 1
	!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
	!!!!!!!!!!!!!!!!!!!!!!!!!!!! *** TAP *** !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
	!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

	alfa=atn(b/a)

	drawindex 30

	if gs_tap_type_m <> 0 then

		ADD2 a/0.416924*0.103064-0.04*cos(alfa), -b/0.417186*0.10315+0.04*sin(alfa)
		rot2 90-alfa

		call "tapType_m" parameters all bShower 			= 0,
										yWallPos 			= yWallPos,
										bEnableTapEdit		= 1,
										bSinkTap			= 0

		DEL 2
	endif

ENDIF


! --- start of modifying to Shaft

if isMEPEnabled then

	drawindex 20

	PEN gs_cont_pen

				! --- OTHER VIEWS --- !

	ROT2 -SYMB_ROTANGLE * (DrawingNum > 1 AND NOT(SYMB_MIRRORED))+SYMB_ROTANGLE * (DrawingNum > 1 AND SYMB_MIRRORED)

	IF DrawingNum = 2 THEN PROJECT2 -3, 90, 2	! Bottom
	IF DrawingNum = 3 THEN PROJECT2 4, 270, 2	! Front
	IF DrawingNum = 4 THEN PROJECT2 4, 90, 2	! Back
	IF DrawingNum = 5 THEN PROJECT2 4, 180*(SYMB_MIRRORED), 2		! Right
	IF DrawingNum = 6 THEN PROJECT2 4, 180*NOT(SYMB_MIRRORED), 2	! Left


				! --- CONNECTIONS --- !

	CALL "MEP_m_ConnectionsACL_4" PARAMETERS SetProgram = SetProgram,
		ui_current_con = ui_current_con,
		MEP_NumberConnections = MEP_NumberConnections,
		MEP_NumConnectionData = gs_Connections,
		gs_AddConnections = gs_AddConnections,
		DrawingNum = DrawingNum,
		MEP_InsShow = 0,
		MEP_cline_show = 0,
		gs_cont_pen = gs_cont_pen,
		gs_fill_type=gs_fill_type,
		gs_fill_pen=gs_fill_pen,
		gs_back_pen=gs_back_pen,
		ConPosX_1=ConPosX_1, ConPosY_1=ConPosY_1, ConLength_1=ConLength_1, ConEdit_1 = 12,
		ConPosX_2=ConPosX_2, ConPosY_2=ConPosY_2, ConLength_2=ConLength_2, ConEdit_2 = 12,
		ConPosX_3=ConPosX_3, ConPosY_3=ConPosY_3, ConLength_3=ConLength_3, ConEdit_3 = 0

	DEL 1
ENDIF

! --- end of modifying to Shaft

END
