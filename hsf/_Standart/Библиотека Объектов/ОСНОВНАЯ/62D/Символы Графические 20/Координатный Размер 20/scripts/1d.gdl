
EPS = 0.00001
DOT_IN_MM = 72 / 25.4

dim strCoorSystem_strings[3]
	strCoorSystem_strings[1] = `Координаты Проекта`
	strCoorSystem_strings[2] = `Мировые Координаты из Расположения Объекта`
	strCoorSystem_strings[3] = `Специальные Мировые Координаты`

dim strHeightRef_strings[4]
	strHeightRef_strings[1] = `Проектный Нуль`
	strHeightRef_strings[2] = `1-й Уровень Привязки`
	strHeightRef_strings[3] = `2-й Уровень Привязки`
	strHeightRef_strings[4] = `Высота`

dim strApplyFontTo_strings[4]
	strApplyFontTo_strings[1] = `Заголовок`
	strApplyFontTo_strings[2] = `Координаты`
	strApplyFontTo_strings[3] = `ID Маркера`
	strApplyFontTo_strings[4] = `Специальное Начало`

dim stTypeTextRotation[3]
	stTypeTextRotation[1] = `Выровнять по Маркеру`
	stTypeTextRotation[2] = `Читаемый`
	stTypeTextRotation[3] = `Всегда Горизонтально`
	
dim strMarkerStyle_strings[5]
	strMarkerStyle_strings[1] = `Крест`
	strMarkerStyle_strings[2] = `Крест с Окружностью`
	strMarkerStyle_strings[3] = `Крест в Окружности`
	strMarkerStyle_strings[4] = `Пустой Треугольник`
	strMarkerStyle_strings[5] = `Треугольник с Заливкой`

CROSS				= 1
CROSS_WITH_CIRCLE 	= 2
CROSS_IN_CIRCLE 	= 3
TRIANGLE_EMPTY 		= 4
TRIANGLE_FILLED		= 5

!=============================================================================
! String-Integer Parameter Link
!=============================================================================

PROJECT_COOR 	= 1
WORLD_COOR_PROJ = 2
WORLD_COOR_CUST = 3

PROJECT_ZERO 	= 1
FIRST_REF 		= 2
SECOND_REF 		= 3
ALTITUDE_REF	= 4

LAT_NORTH	= 1
LAT_SOUTH	= 2

LONG_EAST	= 1
LONG_WEST	= 2

APPLY_TO_HEADER 	= 1
APPLY_TO_COOR 		= 2
APPLY_TO_ID 		= 3
APPLY_TO_CUSTORIG	= 4

MARKER_CONE		= 1
MARKER_PYRAMID 	= 2
MARKER_PIN		= 3

ORIENTATION_ALIGNED		= 1
ORIENTATION_READABLE	= 2
ORIENTATION_HORIZONTAL	= 3

!=============================================================================
! Calculations
!=============================================================================

dim pageIds[]
	pageIds[1] = 1
	pageIds[2] = 2
	pageIds[3] = 3

nTabs = vardim1(pageIds)

if GLOB_SCRIPT_TYPE <> 5 then
	if iCoorSystem = WORLD_COOR_PROJ or strCoorSystem = strCoorSystem_strings[2] then
		if GLOB_PROJECT_LATITUDE < 0 then
			iLatitudeDegree = ceil(GLOB_PROJECT_LATITUDE)
		else
			iLatitudeDegree = int(GLOB_PROJECT_LATITUDE)
		endif

		elevWorldCoor = GLOB_PROJECT_ALTITUDE
	endif
endif

! --------- Working unit

requestWorkingUnit = REQUEST ("Working_length_unit", "", workingLengthUnit)


customOrigSize3D		= 0.05
customOrigThk3D			= customOrigSize3D / 10

! ----------- Elevation

elev_zero  = 0
elev_ref1  = 0
elev_ref2  = 0
elev_altitude = 0
ref_height = 0

req_refelev = REQUEST ("REFERENCE_LEVEL_DATA", "", name_zero, elev_zero, name_ref1, elev_ref1, name_ref2, elev_ref2, name_altitude, elev_altitude)

if iHeightRef = PROJECT_ZERO 	then ref_height = elev_zero
if iHeightRef = FIRST_REF 		then ref_height = elev_ref1
if iHeightRef = SECOND_REF 		then ref_height = elev_ref2
if iHeightRef = ALTITUDE_REF	then ref_height = elev_altitude

if iCoorSystem = WORLD_COOR_CUST or iCoorSystem = WORLD_COOR_PROJ  then

	! --------- Error

	errorBase   = ""
	errorOnBase = ""
	errorString = ""

	! -------- Foot - meter conversions

	foot_meter = 0.3048

	! -------- 100 meter/feet is the base of the error

	!errorBase = "100"
	unitBase  = "'"


	unitError = ""

	if STRSTR (workingLengthUnit,"m")  > 0 then
		foot_meter = 1
		unitError  = `м`
		unitBase   = `м`
	endif

	if STRSTR (workingLengthUnit,"cm") > 0 then
		foot_meter = 1
		unitError  = `см`
		unitBase   = `м`
	endif

	if STRSTR (workingLengthUnit,"mm") > 0 then
		foot_meter = 1
		unitError  = `мм`
		unitBase   = `м`
	endif


	! ------------- Probable maximum error calculation on 100 meter

	if abs(iLatitudeDegree) > -EPS 	and abs(iLatitudeDegree) < 10+EPS then ZONE_ERROR = 0.021
	if abs(iLatitudeDegree) > 10 	and abs(iLatitudeDegree) < 20+EPS then ZONE_ERROR = 0.050
	if abs(iLatitudeDegree) > 20 	and abs(iLatitudeDegree) < 30+EPS then ZONE_ERROR = 0.071
	if abs(iLatitudeDegree) > 30 	and abs(iLatitudeDegree) < 40+EPS then ZONE_ERROR = 0.085
	if abs(iLatitudeDegree) > 40 	and abs(iLatitudeDegree) < 50+EPS then ZONE_ERROR = 0.088
	if abs(iLatitudeDegree) > 50 	and abs(iLatitudeDegree) < 60+EPS then ZONE_ERROR = 0.085
	if abs(iLatitudeDegree) > 60 	and abs(iLatitudeDegree) < 70+EPS then ZONE_ERROR = 0.072
	if abs(iLatitudeDegree) > 70 	and abs(iLatitudeDegree) < 80+EPS then ZONE_ERROR = 0.052
	if abs(iLatitudeDegree) > 80 	and abs(iLatitudeDegree) < 90+EPS then ZONE_ERROR = 0.022

	ZONE_ERROR = ZONE_ERROR * foot_meter
	errorOnBase = STR(workingLengthUnit, ZONE_ERROR)

	errorString = errorOnBase + unitError + " " + `на 100` + unitBase

endif

!=============================================================================
! ID
!=============================================================================

id_text = GLOB_ID


