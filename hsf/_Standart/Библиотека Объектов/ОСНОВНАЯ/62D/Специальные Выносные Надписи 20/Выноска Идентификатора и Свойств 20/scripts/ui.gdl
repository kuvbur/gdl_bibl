
! ==============================================================================
! Tabpage IDs, Titles and Icons
! ==============================================================================

PAGE_ID_GENERAL		= 1
PAGE_ID_GEOMETRY	= 2

dim tabTitles[2]
	tabTitles[1] = `Общие Параметры`
	tabTitles[2] = `Геометрия Выноски`

dim tabIcons[2]
	tabIcons[1] = "uiTab_areaContent_flat(1)"
	tabIcons[2] = "uiTab_labelGeometry_flat(1)"

file_dependence "uiTab_areaContent_flat(1)"
file_dependence "uiTab_labelGeometry_flat(1)"

ui_current_page gs_ui_current_page
ui_page gs_ui_current_page

! ==============================================================================
! Call tabpage selector
! ==============================================================================
call "ui_tab_popup" parameters 	nTabs 				= vardim1(tabTitles),
								gs_ui_current_page 	= gs_ui_current_page,
								tabTitles			= tabTitles,
								tabIcons			= tabIcons


! ==============================================================================
! Property Request
! ==============================================================================

dim	parentPropertiesArray[]
n = request ("Properties_Of_Parent", "", parentPropertiesArray)


! ==============================================================================
! Tabpages
! ==============================================================================

ui_page PAGE_ID_GENERAL
	gosub "GeneralSettingsPage"

gosub "HeadStyleAndGeometryPage"


! ==============================================================================
end ! end ! end ! end ! end ! end ! end ! end ! end ! end ! end ! end ! end ! en
! ==============================================================================


! ==============================================================================
"GeneralSettingsPage":
! ------------------------------------------------------------------------------

	inFieldHeight = 19
	outFieldHeight = 15

	inFieldWidth = 135

	x1 = 5
	x2 = 160
	x3 = x2 + inFieldWidth
	x4 = 305
	x5 = x4 + infieldWidth


	yCurr = 40

	dy = 24

	ui_style 0,1
	ui_outfield `Расположение Данных`, x1, yCurr, x2-x1-1, outFieldHeight
	ui_style 0,0

	ui_infield{3} "iArrangeContent", x2, yCurr-4, x3-x2, inFieldHeight,
			8, "", 0, 0, 0, 0, 0, 0,
			"", _stArrangeContent[1], ARRANGE_COLUMN,
			"", _stArrangeContent[2], ARRANGE_ROW

	yCurr = yCurr + dy

	ui_outfield '1.', x2, yCurr, 14, outFieldHeight
	ui_infield{3} "i1stRowContent", x2+15, yCurr-4, x3-x2-15, inFieldHeight,
			8, "", 0, 0, 0, 0, 0, 0,
			"", _stRowContent[1], CONTENT_ID,
			"", _stRowContent[2], CONTENT_ELEMENT_NAME,
			"", _stRowContent[4], CONTENT_PROPERTY,
			"", _stRowContent[3], CONTENT_CUSTOM

	if i1stRowContent = CONTENT_ID then
		ui_infield{3} "iIDText1", x4, yCurr-4, x5-x4, inFieldHeight,
				8, "", 0, 0, 0, 0, 0, 0,
			"", sIDTextValues[1], IDVALUE_IDNUMBER,
			"",	sIDTextValues[4], IDVALUE_MASTERID,
			"", sIDTextValues[3], IDVALUE_FULLIDNUM
	else
		if i1stRowContent = CONTENT_CUSTOM then
			ui_infield{3} "stCustomText1", x4, yCurr-4, x5-x4, inFieldHeight
		endif

		if i1stRowContent = CONTENT_PROPERTY then
			_stSelected	= ""
			_stPropID	= stPropertyID1
			gosub "getPropertyName"

			ui_custom_popup_infield "stPropertyID1", x4, yCurr-4, x5-x4, inFieldHeight,
				1, 3, 1, _stSelected,
				parentPropertiesArray
		endif
	endif

	yCurr = yCurr + dy

	ui_infield{3} "b2ndRowContent", x2-25, yCurr-4, 19, inFieldHeight,
			7, "", 0, 0, 0, 0, 0, 0,
			"", "", 0,
			"", "", 1

	ui_outfield '2.', x2, yCurr, 14, outFieldHeight
	ui_infield{3} "i2ndRowContent", x2+15, yCurr-4, x3-x2-15, inFieldHeight,
			8, "", 0, 0, 0, 0, 0, 0,
			"", _stRowContent[1], CONTENT_ID,
			"", _stRowContent[2], CONTENT_ELEMENT_NAME,
			"", _stRowContent[4], CONTENT_PROPERTY,
			"", _stRowContent[3], CONTENT_CUSTOM

	if i2ndRowContent = CONTENT_ID then
		ui_infield{3} "iIDText2", x4, yCurr-4, x5-x4, inFieldHeight,
				8, "", 0, 0, 0, 0, 0, 0,
				"", sIDTextValues[1], IDVALUE_IDNUMBER,
				"",	sIDTextValues[4], IDVALUE_MASTERID,
				"", sIDTextValues[3], IDVALUE_FULLIDNUM
	else
		if i2ndRowContent = CONTENT_CUSTOM then
			ui_infield{3} "stCustomText2", x4, yCurr-4, x5-x4, inFieldHeight
		endif

		if i2ndRowContent = CONTENT_PROPERTY then
			_stSelected	= ""
			_stPropID	= stPropertyID2
			gosub "getPropertyName"

			ui_custom_popup_infield "stPropertyID2", x4, yCurr-4, x5-x4, inFieldHeight,
				1, 3, 1, _stSelected,
				parentPropertiesArray
		endif
	endif

	yCurr = yCurr + dy

	ui_infield{3} "b3rdRowContent", x2-25, yCurr-4, 19, inFieldHeight,
			7, "", 0, 0, 0, 0, 0, 0,
			"", "", 0,
			"", "", 1

	ui_outfield '3.', x2, yCurr, 14, outFieldHeight
	ui_infield{3} "i3rdRowContent", x2+15, yCurr-4, x3-x2-15, inFieldHeight,
			8, "", 0, 0, 0, 0, 0, 0,
			"", _stRowContent[1], CONTENT_ID,
			"", _stRowContent[2], CONTENT_ELEMENT_NAME,
			"", _stRowContent[4], CONTENT_PROPERTY,
			"", _stRowContent[3], CONTENT_CUSTOM

	if i3rdRowContent = CONTENT_ID then
		ui_infield{3} "iIDText3", x4, yCurr-4, x5-x4, inFieldHeight,
				8, "", 0, 0, 0, 0, 0, 0,
				"", sIDTextValues[1], IDVALUE_IDNUMBER,
				"",	sIDTextValues[4], IDVALUE_MASTERID,
				"", sIDTextValues[3], IDVALUE_FULLIDNUM
	else
		if i3rdRowContent = CONTENT_CUSTOM then
			ui_infield{3} "stCustomText3", x4, yCurr-4, x5-x4, inFieldHeight
		endif

		if i3rdRowContent = CONTENT_PROPERTY then
			_stSelected	= ""
			_stPropID	= stPropertyID3
			gosub "getPropertyName"

			ui_custom_popup_infield "stPropertyID3", x4, yCurr-4, x5-x4, inFieldHeight,
				1, 3, 1, _stSelected,
				parentPropertiesArray
		endif
	endif

	ui_separator 0, 135, 443, 135
	yCurr = 145

	ui_style 0,1
	ui_outfield `Ориентация`,	x1, yCurr, x2-x1-1, outFieldHeight
	ui_style 0,0
	ui_infield{3} "iLabelOrientation",		x2, yCurr, x3-x2, 40,
		2, "ui_label_orientation_flat(1)", 6, 2, ! UI_label_orientation.png
		35, 35, 32, 32,
		5, _stLabelOrientation[ORIENTATION_PARALLEL],	ORIENTATION_PARALLEL,
		2, _stLabelOrientation[ORIENTATION_VERTICAL],	ORIENTATION_VERTICAL,
		1, _stLabelOrientation[ORIENTATION_HORIZONTAL], ORIENTATION_HORIZONTAL,
		3, _stLabelOrientation[ORIENTATION_CUSTOM],		ORIENTATION_CUSTOM

	ui_infield{3} "bFlipLabel", x4, yCurr,	x5-x4, outFieldHeight,
			7, "", 2, 1, 0, 0, 0, 0,
			1, `Развернуть Выноску`, 0,
			2, `Развернуть Выноску`, 1

return


! =============================================================================
"HeadStyleAndGeometryPage":
! -----------------------------------------------------------------------------
	call "label_marker_form" parameters AC_CustomReadability = AC_CustomReadability,
		bUseBuiltinPointer			= not(LABEL_CUSTOM_ARROW),
		bEnableHeadWithPointer		= 1,

		! Position
		iReferencePoint				= 5,
		iLabelOrientation 			= iLabelOrientation,
		bFlipLabel 					= bFlipLabel,
		anglePosition 				= LABEL_ROTANGLE,

		! Paragraph Format
		bEnablePrefixColumn			= 0,
		bUsePrefixColumn			= 0,
		bWrapText					= LABEL_TEXT_WRAP,
		widthTextBoxContent_mm		= widthTextBoxContent_mm,
		widthTextBoxContent_pt		= widthTextBoxContent_pt,

		! Head apperance
		bEnableCustomHeaderStyle 	= 0,

		! Body skin list appearance
		bUseTextBoxOnLine			= 0,

		! Label Head Representation
		bEnableHeadSwitch			= 0,							! Enable to switch the Show Label Head ON-OFF
		bShowHead					= 1,
		iShapeHead					= iShapeHead,
		bFitFrameToText				= bFitFrameToText,
		widthHead_mm				= widthHead_mm,
		heightHead_mm				= heightHead_mm,
		bLinkSizes					= bLinkSizes,
		bShowHeadContour			= LABEL_FRAME_ON,
		bShowFill					= 1,
		penForeground				= LABEL_TEXT_BG_PEN,

		! Label Line Representation
		distanceLabelHead_mm		= distanceLabelHead_mm,
		distanceLabelHead_pt		= distanceLabelHead_pt,
		bEnableLeaderLine			= LABEL_CUSTOM_ARROW,
		bEnableSeparatorLine		= 1,
		bShowLeaderLine				= bShowLeaderLine,
		iLeaderLineStyle			= iLeaderLineStyle,
		thkLeaderLine_mm			= thkLeaderLine_mm,
		thkLeaderLine_pt			= thkLeaderLine_pt,
		iExtensionLineStyle 		= iExtensionLineStyle,
		lengthExtensionLine_mm		= lengthExtensionLine_mm,
		lengthExtensionLine_pt		= lengthExtensionLine_pt,
		thkExtensionLine_mm			= thkExtensionLine_mm,
		thkExtensionLine_pt			= thkExtensionLine_pt,
		iMyPage_Geometry 			= PAGE_ID_GEOMETRY,
		iMyPage_HeadStyle			= 0,
		iMyPage_CustomSkins			= 0

return


"getPropertyName":
	r = REQUEST ("Property_Name", _stPropID, _typeName, _groupName, _propertyName)

	if r > 2 then
		_stSelected = _propertyName
	else
		_stSelected = ""
	endif
return
