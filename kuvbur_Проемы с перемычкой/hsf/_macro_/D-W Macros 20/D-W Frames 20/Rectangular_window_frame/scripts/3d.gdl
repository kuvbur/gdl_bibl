

leftOvhg	=	max(gs_frame_ovhg_left_out, gs_frame_ovhg_left_in)
rightOvhg	=	max(gs_frame_ovhg_right_out, gs_frame_ovhg_right_in)
topOvhg		=	max(gs_frame_ovhg_top_out, gs_frame_ovhg_top_in)
bottomOvhg	=	max(gs_frame_ovhg_bottom_out, gs_frame_ovhg_bottom_in)


! =============================================================================
!
! =============================================================================

UppLeftHorDiv		= ((gs_UTrans & not(gs_bLeftSLight)) | (gs_UTrans & gs_bLeftSLight)) & gs_UTransom_toLeft
LowLeftHorDiv		= ((gs_LTrans & not(gs_bLeftSLight)) | (gs_LTrans & gs_bLeftSLight)) & gs_LTransom_toLeft
UppRightHorDiv		= ((gs_UTrans & not(gs_bSLight)) |  (gs_UTrans & gs_bSLight)) & gs_UTransom_toRight
LowRightHorDiv		= ((gs_LTrans & not(gs_bSLight)) | (gs_LTrans & gs_bSLight)) & gs_LTransom_toRight
UppLeftVerDiv		= ((gs_UTrans & gs_LeftMullion_Top) | (not(gs_UTrans) & gs_LeftMullion_Middle)) & gs_bLeftSLight
LowLeftVerDiv		= ((gs_LTrans & gs_LeftMullion_Bott) | (not(gs_LTrans) & gs_LeftMullion_Middle)) & gs_bLeftSLight
UppRightVerDiv		= ((gs_UTrans & gs_Mullion_Top) | (not(gs_UTrans) & gs_RightMullion_Middle)) & gs_bSLight
LowRightVerDiv		= ((gs_LTrans & gs_Mullion_Bott) | (not(gs_LTrans) & gs_RightMullion_Middle)) & gs_bSLight
MiddleLeftVerDiv	= gs_bLeftSLight & gs_LeftMullion_Middle
MiddleRightVerDiv	= gs_bSLight & gs_RightMullion_Middle
MiddleUppHorDiv		= gs_UTrans & gs_UTransom_Middle
MiddleLowHorDiv		= gs_LTrans & gs_LTransom_Middle


! =============================================================================
!
! =============================================================================

if not(gs_UTrans) then
	CasementIDArray[1][1] = 0
	CasementIDArray[1][2] = 0
	CasementIDArray[1][3] = 0
endif
if not(UppLeftVerDiv & UppLeftHorDiv) then
	CasementIDArray[1][1] = 0
endif
if not(UppRightVerDiv & UppRightHorDiv) then
	CasementIDArray[1][3] = 0
endif
if not(gs_LTrans) then
	CasementIDArray[3][1] = 0
	CasementIDArray[3][2] = 0
	CasementIDArray[3][3] = 0
endif
if not(LowLeftVerDiv & LowLeftHorDiv) then
	CasementIDArray[3][1] = 0
endif
if not(LowRightVerDiv & LowRightHorDiv) then
	CasementIDArray[3][3] = 0
endif
if not(gs_bLeftSLight) then
	CasementIDArray[1][1] = 0
	CasementIDArray[2][1] = 0
	CasementIDArray[3][1] = 0
else
	if CasementTypeArray[2][1] = 2 then
		CasementIDArray[2][1] = 0
	endif
endif
if not(gs_bSLight) then
	CasementIDArray[1][3] = 0
	CasementIDArray[2][3] = 0
	CasementIDArray[3][3] = 0
else
	if CasementTypeArray[2][3] = 3 then
		CasementIDArray[2][3] = 0
	endif
endif


! =============================================================================
!
! =============================================================================

dim	SimpleSashArray[3][3]
dim	SashOffsetArray[3][3]
dim	SashCutArray[3][3]

bFoundNonSlidingSash = 0

for i=1 to vardim1(CasementIDArray)
	for j=1 to vardim2(CasementIDArray)
		CasementID = CasementIDArray[i][j]
		if CasementID > 0 then
			optype_act = 0
			if CasementID =  1 then optype_act = gs_optype_m_01
			if CasementID =  2 then optype_act = gs_optype_m_02
			if CasementID =  3 then optype_act = gs_optype_m_03
			if CasementID =  4 then optype_act = gs_optype_m_04
			if CasementID =  5 then optype_act = gs_optype_m_05
			if CasementID =  6 then optype_act = gs_optype_m_06
			if CasementID =  7 then optype_act = gs_optype_m_07
			if CasementID =  8 then optype_act = gs_optype_m_08
			if CasementID =  9 then optype_act = gs_optype_m_09
			if CasementID = 10 then optype_act = gs_optype_m_10
			if CasementID = 11 then optype_act = gs_optype_m_11

! =============================================================================

			if lod3D = 1 | lod3D = 5 then
				iSimpleSashFrameType = SIMPLESASH_NORMAL
				if	optype_act = SASH_DOUBLE_SIDE_HUNG |\
					optype_act = SASH_DOUBLE_TILT_TURN |\
					optype_act = SASH_DOUBLE_TILT_TURN_M then iSimpleSashFrameType = SIMPLESASH_SIDEHUNG
				if	optype_act = SASH_SLIDING_HOR |\
					optype_act = SASH_SLIDING_HOR_M |\
					optype_act = SASH_DOUBLE_SLIDING_HOR |\
					optype_act = SASH_DOUBLE_SLIDING_HOR_M then iSimpleSashFrameType = SIMPLESASH_SLIDEHOR
				if	optype_act = SASH_SLIDING_VER |\
					optype_act = SASH_DOUBLE_SLIDING_VER then iSimpleSashFrameType = SIMPLESASH_SLIDEVER
				SimpleSashArray[i][j] = iSimpleSashFrameType
			else
				SimpleSashArray[i][j] = SIMPLESASH_NONE
			endif

! =============================================================================

			simp_mod = 0
			if lod3D = 1 | lod3D = 5 then ! Simple | Chinese
				if optype_act <> SASH_FIXED then simp_mod =  gs_sash_width - gs_rebate_width
				if	optype_act = SASH_HOR_PIVOT |\
					optype_act = SASH_VER_PIVOT |\
					optype_act = SASH_VER_PIVOT_M |\
					optype_act = SASH_SLIDING_HOR |\
					optype_act = SASH_SLIDING_HOR_M |\
					optype_act = SASH_DOUBLE_SLIDING_HOR |\
					optype_act = SASH_DOUBLE_SLIDING_HOR_M |\
					optype_act = SASH_SLIDING_VER |\
					optype_act = SASH_DOUBLE_SLIDING_VER then simp_mod = gs_sash_width
			else
				if	optype_act = SASH_SLIDING_HOR |\
					optype_act = SASH_SLIDING_HOR_M |\
					optype_act = SASH_DOUBLE_SLIDING_HOR |\
					optype_act = SASH_DOUBLE_SLIDING_HOR_M |\
					optype_act = SASH_SLIDING_VER |\
					optype_act = SASH_DOUBLE_SLIDING_VER then simp_mod = 0.0001
			endif
			SashOffsetArray[i][j] = simp_mod

! =============================================================================

			iSashCutType = SASHCUT_NONE
			if not(lod3D = 1 | lod3D = 5) then ! Simple | Chinese
				if	optype_act = SASH_FIXED_SCREW |\
					optype_act = SASH_SIDE_HUNG |\
					optype_act = SASH_SIDE_HUNG_M |\
					optype_act = SASH_TILT_TURN |\
					optype_act = SASH_TILT_TURN_M |\
					optype_act = SASH_BOTTOM_HUNG |\
					optype_act = SASH_TOP_HUNG |\
					optype_act = SASH_DOUBLE_SIDE_HUNG |\
					optype_act = SASH_DOUBLE_TILT_TURN |\
					optype_act = SASH_DOUBLE_TILT_TURN_M then iSashCutType = SASHCUT_REBATE
				if	optype_act = SASH_SLIDING_HOR |\
					optype_act = SASH_SLIDING_HOR_M |\
					optype_act = SASH_DOUBLE_SLIDING_HOR |\
					optype_act = SASH_DOUBLE_SLIDING_HOR_M |\
					optype_act = SASH_SLIDING_VER |\
					optype_act = SASH_DOUBLE_SLIDING_VER then iSashCutType = SASHCUT_MIDDLE
			endif
			SashCutArray[i][j] = iSashCutType

			if	optype_act <> SASH_SLIDING_HOR &\
				optype_act <> SASH_SLIDING_HOR_M &\
				optype_act <> SASH_DOUBLE_SLIDING_HOR &\
				optype_act <> SASH_DOUBLE_SLIDING_HOR_M &\
				optype_act <> SASH_SLIDING_VER &\
				optype_act <> SASH_DOUBLE_SLIDING_VER then bFoundNonSlidingSash = 1
		else
			SimpleSashArray[i][j]	= SIMPLESASH_NONE
			SashOffsetArray[i][j]	= 0
			SashCutArray[i][j]		= SASHCUT_NONE
		endif
	next j
next i

if not(bFoundNonSlidingSash) & lod3D = 2 then
	for i=1 to vardim1(CasementIDArray)
		for j=1 to vardim2(CasementIDArray)
			SashOffsetArray[i][j]	= 0
			SashCutArray[i][j]		= SASHCUT_NONE
		next j
	next i

	gs_rebate_depth = gs_frame_thk / 2
endif


! =============================================================================
!
! =============================================================================

leftOutX 			= -a/2 - leftOvhg
leftInX				= -a/2 + gs_frame_width_left
rightOutX  			=  a/2 + rightOvhg
rightInX			=  a/2 - gs_frame_width
bottomOutY			= -bottomOvhg
bottomInY			=  gs_frame_width_lower
topOutY				= b + topOvhg
topInY				= b - gs_frame_width_upper
RightmullionLeftX			= a/2 - gs_SLight_w - gs_Mullion_w/2
RightmullionRightX			= a/2 - gs_SLight_w + gs_Mullion_w/2
LeftmullionLeftX			= -a/2 + gs_LeftSLight_w - gs_Mullion_w_left/2
LeftmullionRightX			= -a/2 + gs_LeftSLight_w + gs_Mullion_w_left/2
upperTransomTopY			= gs_UTrans_h + gs_UTrans_w/2
upperTransomBottomY			= gs_UTrans_h - gs_UTrans_w/2
lowerTransomTopY			= gs_LTrans_h + gs_LTrans_w/2
lowerTransomBottomY			= gs_LTrans_h - gs_LTrans_w/2


dim SashLeftX[3][3]
dim SashRightX[3][3]
dim SashTopY[3][3]
dim SashBottomY[3][3]

if CasementIDArray[1][1] > 0 then
	if bLeftFrame then
		SashLeftX[1][1] = leftInX
	else
		SashLeftX[1][1] = leftOutX
	endif
	SashRightX[1][1]	= LeftmullionLeftX
	SashTopY[1][1]		= topInY
	SashBottomY[1][1]	= upperTransomTopY
endif
if CasementIDArray[2][1] > 0 then
	if bLeftFrame then
		SashLeftX[2][1] = leftInX
	else
		SashLeftX[2][1] = leftOutX
	endif
	SashRightX[2][1]	= LeftmullionLeftX
	if UppLeftHorDiv then
		SashTopY[2][1]		= upperTransomBottomY
	else
		SashTopY[2][1]		= topInY
	endif
	if LowLeftHorDiv then
		SashBottomY[2][1]	= lowerTransomTopY
	else
		SashBottomY[2][1]	= bottomInY
	endif
endif
if CasementIDArray[3][1] > 0 then
	if bLeftFrame then
		SashLeftX[3][1] = leftInX
	else
		SashLeftX[3][1] = leftOutX
	endif
	SashRightX[3][1]	= LeftmullionLeftX
	SashTopY[3][1]		= lowerTransomBottomY
	SashBottomY[3][1]	= bottomInY
endif


if CasementIDArray[1][2] > 0 then
	if UppLeftVerDiv then
		SashLeftX[1][2] = LeftmullionRightX
	else
		if bLeftFrame then
			SashLeftX[1][2] = leftInX
		else
			SashLeftX[1][2] = leftOutX
		endif
	endif
	if UppRightVerDiv then
		SashRightX[1][2] = RightmullionLeftX
	else
		if bRightFrame then
			SashRightX[1][2] = rightInX
		else
			SashRightX[1][2] = rightOutX
		endif
	endif
	SashTopY[1][2]		= topInY
	SashBottomY[1][2]	= upperTransomTopY
endif

if MiddleLeftVerDiv then
	SashLeftX[2][2] = LeftmullionRightX
else
	if bLeftFrame then
		SashLeftX[2][2] = leftInX
	else
		SashLeftX[2][2] = leftOutX
	endif
endif
if MiddleRightVerDiv then
	SashRightX[2][2] = RightmullionLeftX
else
	if bRightFrame then
		SashRightX[2][2] = rightInX
	else
		SashRightX[2][2] = rightOutX
	endif
endif
if MiddleUppHorDiv then
	SashTopY[2][2] = upperTransomBottomY
else
	SashTopY[2][2] = topInY
endif
if MiddleLowHorDiv then
	SashBottomY[2][2] = lowerTransomTopY
else
	SashBottomY[2][2] = bottomInY
endif

if CasementIDArray[3][2] > 0 then
	if LowLeftVerDiv then
		SashLeftX[3][2] = LeftmullionRightX
	else
		if bLeftFrame then
			SashLeftX[3][2] = leftInX
		else
			SashLeftX[3][2] = leftOutX
		endif
	endif

	if LowRightVerDiv then
		SashRightX[3][2] = RightmullionLeftX
	else
		if bRightFrame then
			SashRightX[3][2] = rightInX
		else
			SashRightX[3][2] = rightOutX
		endif
	endif
	SashTopY[3][2]		= lowerTransomBottomY
	SashBottomY[3][2]	= bottomInY
endif


if CasementIDArray[1][3] > 0 then
	if bRightFrame then
		SashRightX[1][3] = rightInX
	else
		SashRightX[1][3] = rightOutX
	endif
	SashLeftX[1][3]		= RightmullionRightX
	SashTopY[1][3]		= topInY
	SashBottomY[1][3]	= upperTransomTopY
endif
if CasementIDArray[2][3] > 0 then
	if bRightFrame then
		SashRightX[2][3] = rightInX
	else
		SashRightX[2][3] = rightOutX
	endif
	SashLeftX[2][3]	= RightmullionRightX
	if UppRightHorDiv then
		SashTopY[2][3]		= upperTransomBottomY
	else
		SashTopY[2][3]		= topInY
	endif
	if LowRightHorDiv then
		SashBottomY[2][3]	= lowerTransomTopY
	else
		SashBottomY[2][3]	= bottomInY
	endif
endif
if CasementIDArray[3][3] > 0 then
	if bRightFrame then
		SashRightX[3][3] = rightInX
	else
		SashRightX[3][3] = rightOutX
	endif
	SashLeftX[3][3]		= RightmullionRightX
	SashTopY[3][3]		= lowerTransomBottomY
	SashBottomY[3][3]	= bottomInY
endif

! =============================================================================
!
! =============================================================================

dim SashRelocateRow[3][3]
dim SashRelocateCol[3][3]

! -----------------------------------------------------------------------------

SashRelocateRow[2][2] = 2
SashRelocateCol[2][2] = 2

! -----------------------------------------------------------------------------

if CasementIDArray[1][2] > 0 then
	SashRelocateRow[1][2] = 1
	SashRelocateCol[1][2] = 2
else
	SashRelocateRow[1][2] = 2
	SashRelocateCol[1][2] = 2
endif

if CasementIDArray[2][1] > 0 then
	SashRelocateRow[2][1] = 2
	SashRelocateCol[2][1] = 1
else
	SashRelocateRow[2][1] = 2
	SashRelocateCol[2][1] = 2
endif

if CasementIDArray[2][3] > 0 then
	SashRelocateRow[2][3] = 2
	SashRelocateCol[2][3] = 3
else
	SashRelocateRow[2][3] = 2
	SashRelocateCol[2][3] = 2
endif

if CasementIDArray[3][2] > 0 then
	SashRelocateRow[3][2] = 3
	SashRelocateCol[3][2] = 2
else
	SashRelocateRow[3][2] = 2
	SashRelocateCol[3][2] = 2
endif

! -----------------------------------------------------------------------------

if CasementIDArray[1][1] > 0 then
	SashRelocateRow[1][1] = 1
	SashRelocateCol[1][1] = 1
else
	if not(UppLeftHorDiv) then
		SashRelocateRow[1][1] = 2
		SashRelocateCol[1][1] = 1
	endif
	if not(UppLeftVerDiv) then
		SashRelocateRow[1][1] = 1
		SashRelocateCol[1][1] = 2
	endif
	if CasementIDArray[SashRelocateRow[1][1]][SashRelocateCol[1][1]]= 0 then
		SashRelocateRow[1][1] = 2
		SashRelocateCol[1][1] = 2
	endif
endif

if CasementIDArray[3][1] > 0 then
	SashRelocateRow[3][1] = 3
	SashRelocateCol[3][1] = 1
else
	if not(LowLeftHorDiv) then
		SashRelocateRow[3][1] = 2
		SashRelocateCol[3][1] = 1
	endif
	if not(LowLeftVerDiv) then
		SashRelocateRow[3][1] = 3
		SashRelocateCol[3][1] = 2
	endif
	if CasementIDArray[SashRelocateRow[3][1]][SashRelocateCol[3][1]]= 0 then
		SashRelocateRow[3][1] = 2
		SashRelocateCol[3][1] = 2
	endif
endif

if CasementIDArray[1][3] > 0 then
	SashRelocateRow[1][3] = 1
	SashRelocateCol[1][3] = 3
else
	if not(UppRightHorDiv) then
		SashRelocateRow[1][3] = 2
		SashRelocateCol[1][3] = 3
	endif
	if not(UppRightVerDiv) then
		SashRelocateRow[1][3] = 1
		SashRelocateCol[1][3] = 2
	endif
	if CasementIDArray[SashRelocateRow[1][3]][SashRelocateCol[1][3]]= 0 then
		SashRelocateRow[1][3] = 2
		SashRelocateCol[1][3] = 2
	endif
endif

if CasementIDArray[3][3] > 0 then
	SashRelocateRow[3][3] = 3
	SashRelocateCol[3][3] = 3
else
	if not(LowRightHorDiv) then
		SashRelocateRow[3][3] = 2
		SashRelocateCol[3][3] = 3
	endif
	if not(LowRightVerDiv) then
		SashRelocateRow[3][3] = 3
		SashRelocateCol[3][3] = 2
	endif
	if CasementIDArray[SashRelocateRow[3][3]][SashRelocateCol[3][3]]= 0 then
		SashRelocateRow[3][3] = 2
		SashRelocateCol[3][3] = 2
	endif
endif


! =============================================================================
! Hotspot Editing
! =============================================================================

! --- Hotspot Editing of Lower Transom ---
if gs_LTrans then
	unID=1400
	hotspot a/2, 0, 0, unID, gs_LTrans_h, 1+128:unID=unID+1
	hotspot a/2, -1, 0, unID, gs_LTrans_h, 3:unID=unID+1
	hotspot a/2, gs_LTrans_h, 0, unID, gs_LTrans_h, 2:unID=unID+1

	unID=1410
	hotspot -a/2, 0, 0, unID, gs_LTrans_h, 1+128:unID=unID+1
	hotspot -a/2, -1, 0, unID, gs_LTrans_h, 3:unID=unID+1
	hotspot -a/2, gs_LTrans_h, 0, unID, gs_LTrans_h, 2:unID=unID+1
endif

! --- Hotspot Editing of Upper Transom ---
if gs_UTrans then
	unID=1420
	hotspot a/2, 0, 0, unID, gs_UTrans_h, 1+128:unID=unID+1
	hotspot a/2, -1, 0, unID, gs_UTrans_h, 3:unID=unID+1
	hotspot a/2, gs_UTrans_h, 0, unID, gs_UTrans_h, 2:unID=unID+1

	unID=1430
	hotspot -a/2, 0, 0, unID, gs_UTrans_h, 1+128:unID=unID+1
	hotspot -a/2, -1, 0, unID, gs_UTrans_h, 3:unID=unID+1
	hotspot -a/2, gs_UTrans_h, 0, unID, gs_UTrans_h, 2:unID=unID+1
endif

! --- Hotspot Editing of Sidelight ---
if gs_bSLight & bNeedOldSidelighHotspot then
	unID=1340
	if gs_Mullion_Top or not(gs_UTrans) then
		fels_mull = b-gs_frame_width
	else
		fels_mull = gs_UTrans_h-gs_UTrans_w/2
	endif
	if gs_Mullion_Bott or not(gs_LTrans) then
		als_mull = gs_frame_width
	else
		als_mull = gs_LTrans_h+gs_LTrans_w/2
	endif
	mull_middle = (fels_mull-als_mull)/2

	hotspot a/2, als_mull+Mull_middle, 0, unID, gs_SLight_w, 1+128 		:unID=unID+1
	hotspot a/2+1, als_mull+Mull_middle, 0, unID, gs_SLight_w, 3		:unID=unID+1
	hotspot a/2-gs_SLight_w, als_mull+Mull_middle, 0, unID, gs_SLight_w,2:unID=unID+1
endif


! =============================================================================
! Unit Hotspots
! =============================================================================

if bShowUnitHotspots then
	unID = 100

	hotspot  a/2, 0, 0,				unID: unID=unID+1
	hotspot -a/2, 0, 0,				unID: unID=unID+1
	hotspot  a/2, 0, gs_frame_thk,	unID: unID=unID+1
	hotspot -a/2, 0, gs_frame_thk,	unID: unID=unID+1

	hotspot  a/2, b, 0,				unID: unID=unID+1
	hotspot -a/2, b, 0,				unID: unID=unID+1
	hotspot  a/2, b, gs_frame_thk,	unID: unID=unID+1
	hotspot -a/2, b, gs_frame_thk,	unID: unID=unID+1

endif


! =============================================================================
! Frame
! =============================================================================

if gs_frame_pen_cont < 0.5 then gs_frame_pen_cont = SYMB_SECT_PEN
if gs_fillFr < 0.5 then gs_fillFr = SYMB_FILL
if gs_penFr_bg < 0.5 then gs_penFr_bg = SYMB_FBGD_PEN
if gs_penFr_fg < 0.5 then gs_penFr_fg = SYMB_FILL_PEN

group "frame"

	cutnum = 0

	pen gs_frame_pen_cont
	sect_fill gs_fillFr, gs_penFr_bg, gs_penFr_fg, gs_frame_pen_cont

	pen gs_frame_pen

	! --- Cutting in case of corner window -----------------------------------------
	halfA = A / 2

	if abs(gs_frame_ovhg_left_out - gs_frame_ovhg_left_in) > EPS then
		addx -halfA - gs_frame_ovhg_left_out
		rotz 90
		cutplane -90 + atn((gs_frame_ovhg_left_out - gs_frame_ovhg_left_in) / gs_frame_thk)
		del 2
		cutnum = cutnum + 1
	endif

	if abs(gs_frame_ovhg_right_out - gs_frame_ovhg_right_in) > EPS then
		addx halfA + gs_frame_ovhg_right_out
		rotz 90
		cutplane 90 - atn((gs_frame_ovhg_right_out - gs_frame_ovhg_right_in) / gs_frame_thk)
		del 2
		cutnum = cutnum + 1
	endif

	if abs(gs_frame_ovhg_top_out - gs_frame_ovhg_top_in) > EPS then
		addy B + gs_frame_ovhg_top_out
		rotz 90
		roty -90 - atn((gs_frame_ovhg_top_out - gs_frame_ovhg_top_in) / gs_frame_thk)
		cutplane 180
		del 3
		cutnum = cutnum + 1
	endif

	if abs(gs_frame_ovhg_bottom_out - gs_frame_ovhg_bottom_in) > EPS then
		addy -gs_frame_ovhg_bottom_out
		rotz 90
		roty 90 + atn((gs_frame_ovhg_bottom_out - gs_frame_ovhg_bottom_in) / gs_frame_thk)
		cutplane 180
		del 3
		cutnum = cutnum + 1
	endif

	! --- Handling Inner-outer Materials -------------------------------------------

	if (gs_frame_mat = gs_frame_mat2) | bNoRebate then				! One body, in case of similar materials or frame without rebate (Vent Window)
		if bNoRebate then
			if bOpeningDirectionInside then
				var_mater = gs_frame_mat
				var_mater2 = gs_frame_mat2
			else
				var_mater = gs_frame_mat2
				var_mater2 = gs_frame_mat
			endif
		else
			var_mater = gs_frame_mat
			var_mater2 = gs_frame_mat
		endif
	
		in_out_cikl = 1
		out_thk = 0
		part_thk = gs_frame_thk
	else												! two bodies
		in_out_cikl = 2

	! --- Inner-outer Material Control ---------------------------------------------

		temp_frame_mat	= gs_frame_mat
		temp_frame_mat2	= gs_frame_mat2

		if bOpeningDirectionInside then
			gs_frame_mat	= temp_frame_mat
			gs_frame_mat2	= temp_frame_mat2
		else
			gs_frame_mat	= temp_frame_mat2
			gs_frame_mat2	= temp_frame_mat
		endif

		var_mater	= gs_frame_mat
		var_mater2	= gs_frame_mat2

		if lod3D = 2 then	! Detailed
			out_thk = gs_frame_thk - gs_rebate_depth
			part_thk = out_thk
		else
			if lod3D = 5 then
				out_thk = gs_frame_thk/2
			else
				if bOpeningDirectionInside then
					out_thk = gs_frame_thk/2 - gs_glass_thk/2
				else
					out_thk = gs_frame_thk/2 + gs_glass_thk/2
				endif
			endif
			part_thk = out_thk
		endif
	endif


	for ijk = 1 to in_out_cikl
		material var_mater

	! --- Left Side ----------------------------------------------------------------
		if bLeftFrame then
			Row = 3: Col = 1: gosub 3000
			put SashLeftX[Row][Col] + SashOffsetArray[Row][Col], SashBottomY[Row][Col] + SashOffsetArray[Row][Col], 10

			if gs_SashText_typ_num = 1 then !mitered joint
				put	leftOutX,	bottomOutY,				15 - gs_stack_left * 7,
					leftOutX,	topOutY,				10 - gs_stack_left * 2
			else
				put leftOutX, SashBottomY[Row][Col] + SashOffsetArray[Row][Col], 13 - gs_stack_left * 5
				Row = 1: Col = 1: gosub 3000
				put leftOutX, SashTopY[Row][Col] - SashOffsetArray[Row][Col], 8
			endif

			Row = 1: Col = 1: gosub 3000
			put SashLeftX[Row][Col] + SashOffsetArray[Row][Col], SashTopY[Row][Col] - SashOffsetArray[Row][Col], 15

			if UppLeftHorDiv then
				Row = 1: Col = 1: gosub 3000
				if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEVER then
					simpleSashDivY = SashBottomY[Row][Col] + (SashTopY[Row][Col] - SashBottomY[Row][Col]) / 2
					put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	simpleSashDivY + gs_sash_width/2,	10,
						SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	simpleSashDivY - gs_sash_width/2,	15
				endif
			endif

			if UppLeftHorDiv then
				Row = 1: Col = 1: gosub 3000
				put SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],		10
				Row = 2: Col = 1: gosub 3000
				put SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	15
			endif

			Row = 2: Col = 1: gosub 3000
			if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEVER then
				simpleSashDivY = SashBottomY[Row][Col] + (SashTopY[Row][Col] - SashBottomY[Row][Col]) / 2
				put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	simpleSashDivY + gs_sash_width/2,	10,
					SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	simpleSashDivY - gs_sash_width/2,	15
			endif

			if LowLeftHorDiv then
				Row = 2: Col = 1: gosub 3000
				put SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],		10
				Row = 3: Col = 1: gosub 3000
				put SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	15
			endif

			if LowLeftHorDiv then
				Row = 3: Col = 1: gosub 3000
				if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEVER then
					simpleSashDivY = SashBottomY[Row][Col] + (SashTopY[Row][Col] - SashBottomY[Row][Col]) / 2
					put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	simpleSashDivY + gs_sash_width/2,	10,
						SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	simpleSashDivY - gs_sash_width/2,	15
				endif
			endif

			base
			cprism_ var_mater2,var_mater,var_mater,
					nsp/3, part_thk,
					get(nsp)
			gosub 1000
		endif

	! --- Right Side ---------------------------------------------------------------
		if bRightFrame then
			Row = 3: Col = 3: gosub 3000
			put SashRightX[Row][Col] - SashOffsetArray[Row][Col], SashBottomY[Row][Col] + SashOffsetArray[Row][Col], 10

			if gs_SashText_typ_num = 1 then !mitered joint
				put	rightOutX,	bottomOutY,				15 - gs_stack_right * 7,
					rightOutX,	topOutY,				10 - gs_stack_right * 2
			else
				Row = 3: Col = 3: gosub 3000
				put rightOutX, SashBottomY[Row][Col] + SashOffsetArray[Row][Col], 13 - gs_stack_right * 5
				Row = 1: Col = 3: gosub 3000
				put rightOutX, SashTopY[Row][Col] - SashOffsetArray[Row][Col], 8
			endif

			Row = 1: Col = 3: gosub 3000
			put SashRightX[Row][Col] - SashOffsetArray[Row][Col], SashTopY[Row][Col] - SashOffsetArray[Row][Col], 15

			if UppRightHorDiv then
				Row = 1: Col = 3: gosub 3000
				if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEVER then
					simpleSashDivY = SashBottomY[Row][Col] + (SashTopY[Row][Col] - SashBottomY[Row][Col]) / 2
					put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	simpleSashDivY + gs_sash_width/2,	10,
						SashRightX[Row][Col] - SashOffsetArray[Row][Col],	simpleSashDivY - gs_sash_width/2,	15
				endif
			endif

			if UppRightHorDiv then
				Row = 1: Col = 3: gosub 3000
				put SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],		10
				Row = 2: Col = 3: gosub 3000
				put SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	15
			endif

			Row = 2: Col = 3: gosub 3000
			if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEVER then
				simpleSashDivY = SashBottomY[Row][Col] + (SashTopY[Row][Col] - SashBottomY[Row][Col]) / 2
				put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	simpleSashDivY + gs_sash_width/2,	10,
					SashRightX[Row][Col] - SashOffsetArray[Row][Col],	simpleSashDivY - gs_sash_width/2,	15
			endif

			if LowRightHorDiv then
				Row = 2: Col = 3: gosub 3000
				put SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],		10
				Row = 3: Col = 3: gosub 3000
				put SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	15
			endif

			if LowRightHorDiv then
				Row = 3: Col = 3: gosub 3000
				if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEVER then
					simpleSashDivY = SashBottomY[Row][Col] + (SashTopY[Row][Col] - SashBottomY[Row][Col]) / 2
					put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	simpleSashDivY + gs_sash_width/2,	10,
						SashRightX[Row][Col] - SashOffsetArray[Row][Col],	simpleSashDivY - gs_sash_width/2,	15
				endif
			endif

			base
			cprism_ var_mater2,var_mater,var_mater,
					nsp/3, part_thk,
					get(nsp)
			gosub 1000
		endif

	! --- Center -------------------------------------------------------------------
		if lod3D = 1 | lod3D = 5 then ! Simple | Chinese

			if sash_num = 2 and gs_optype_m_01 <> SASH_FIXED then

				Row = 2: Col = 2: gosub 3000
				DoubleSashHgt = (SashTopY[Row][Col] - SashOffsetArray[Row][Col]) - (SashBottomY[Row][Col] + SashOffsetArray[Row][Col])

				addy SashBottomY[Row][Col] + SashOffsetArray[Row][Col]

				base
				if gs_SashText_typ_num = 1 then !mitered joint
					cprism_ var_mater2,var_mater,var_mater,
							6, part_thk,
							a_center - gs_sash_width,		 0,							10,
							a_center,						-gs_sash_width,				8,
							a_center + gs_sash_width,		 0,							15,
							a_center + gs_sash_width,		 DoubleSashHgt,					10,
							a_center,						 DoubleSashHgt +gs_sash_width,	8,
							a_center - gs_sash_width,		 DoubleSashHgt,					15
				else
					cprism_ var_mater2,var_mater,var_mater,
							4, part_thk,
							a_center-gs_sash_width,			0,							10,
							a_center+gs_sash_width,			0,							15,
							a_center+gs_sash_width,			DoubleSashHgt,					10,
							a_center-gs_sash_width,			DoubleSashHgt,					15
				endif
				gosub 1000

				del 1
			endif
		endif

	! --- Right Mullion ------------------------------------------------------------------
		if gs_bSLight then

			if gs_RightMullion_Middle then
				! Upper End
				if gs_Mullion_Top or not(gs_UTrans) then
					Row = 1: Col = 2: gosub 3000
					put SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col],		10
					Row = 1: Col = 3: gosub 3000
					put SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col],		15
				else
					Row = 2: Col = 2: gosub 3000
					put SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col],		10
					Row = 2: Col = 3: gosub 3000
					put SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col],		15
				endif

				if UppRightHorDiv & UppRightVerDiv then
					Row = 1: Col = 3: gosub 3000
					if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEVER then
						simpleSashDivY = SashBottomY[Row][Col] + (SashTopY[Row][Col] - SashBottomY[Row][Col]) / 2
						put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	simpleSashDivY + gs_sash_width/2,	10,
							SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	simpleSashDivY - gs_sash_width/2,	15
					endif
				endif

				if gs_UTrans and gs_UTransom_toRight and gs_Mullion_Top then
					Row = 1: Col = 3: gosub 3000
					put SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],		10
					Row = 2: Col = 3: gosub 3000
					put SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	15
				endif

				Row = 2: Col = 3: gosub 3000
				if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEVER then
					simpleSashDivY = SashBottomY[Row][Col] + (SashTopY[Row][Col] - SashBottomY[Row][Col]) / 2
					put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	simpleSashDivY + gs_sash_width/2,	10,
						SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	simpleSashDivY - gs_sash_width/2,	15
				endif

				if gs_LTrans and gs_Mullion_Bott & gs_LTransom_toRight then
					Row = 2: Col = 3: gosub 3000
					put SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],		10
					Row = 3: Col = 3: gosub 3000
					put SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	15
				endif

				if LowRightHorDiv & LowRightVerDiv then
					Row = 3: Col = 3: gosub 3000
					if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEVER then
						simpleSashDivY = SashBottomY[Row][Col] + (SashTopY[Row][Col] - SashBottomY[Row][Col]) / 2
						put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	simpleSashDivY + gs_sash_width/2,	10,
							SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	simpleSashDivY - gs_sash_width/2,	15
					endif
				endif

				! Lower End
				if gs_Mullion_Bott or not(gs_LTrans) then
					Row = 3: Col = 3: gosub 3000
					put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	10
					Row = 3: Col = 2: gosub 3000
					put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	15
				else
					Row = 2: Col = 3: gosub 3000
					put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	10
					Row = 2: Col = 2: gosub 3000
					put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	15
				endif

				if MiddleLowHorDiv & LowRightVerDiv then
					Row = 3: Col = 2: gosub 3000
					if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEVER then
						simpleSashDivY = SashBottomY[Row][Col] + (SashTopY[Row][Col] - SashBottomY[Row][Col]) / 2
						put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	simpleSashDivY - gs_sash_width/2,	10,
							SashRightX[Row][Col] - SashOffsetArray[Row][Col],	simpleSashDivY + gs_sash_width/2,	15
					endif
				endif

				if gs_LTrans & gs_LTransom_Middle and gs_Mullion_Bott then
					Row = 3: Col = 2: gosub 3000
					put SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col],		10
					Row = 2: Col = 2: gosub 3000
					put SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	15
				endif

				Row = 2: Col = 2: gosub 3000
				if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEVER then
					simpleSashDivY = SashBottomY[Row][Col] + (SashTopY[Row][Col] - SashBottomY[Row][Col]) / 2
					put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	simpleSashDivY - gs_sash_width/2,	10,
						SashRightX[Row][Col] - SashOffsetArray[Row][Col],	simpleSashDivY + gs_sash_width/2,	15
				endif

				if gs_UTrans & gs_UTransom_Middle and gs_Mullion_Top then
					Row = 2: Col = 2: gosub 3000
					put SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col],		10
					Row = 1: Col = 2: gosub 3000
					put SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	15
				endif

				if MiddleUppHorDiv & UppRightVerDiv then
					Row = 1: Col = 2: gosub 3000
					if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEVER then
						simpleSashDivY = SashBottomY[Row][Col] + (SashTopY[Row][Col] - SashBottomY[Row][Col]) / 2
						put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	simpleSashDivY - gs_sash_width/2,	10,
							SashRightX[Row][Col] - SashOffsetArray[Row][Col],	simpleSashDivY + gs_sash_width/2,	15
					endif
				endif

				base
				cprism_ var_mater2,var_mater,var_mater,
						nsp/3, part_thk,
						get (nsp)
				gosub 1000
			else
				if gs_Mullion_Top then
					Row = 1: Col = 2: gosub 3000
					put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	15

					if MiddleUppHorDiv then
						if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEVER then
							simpleSashDivY = SashBottomY[Row][Col] + (SashTopY[Row][Col] - SashBottomY[Row][Col]) / 2
							put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	simpleSashDivY - gs_sash_width/2,	10,
								SashRightX[Row][Col] - SashOffsetArray[Row][Col],	simpleSashDivY + gs_sash_width/2,	15
						endif
					endif
					put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	10

					Row = 1: Col = 3: gosub 3000
					put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	15

					if UppRightHorDiv then
						if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEVER then
							simpleSashDivY = SashBottomY[Row][Col] + (SashTopY[Row][Col] - SashBottomY[Row][Col]) / 2
							put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	simpleSashDivY + gs_sash_width/2,	10,
								SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	simpleSashDivY - gs_sash_width/2,	15
						endif
					endif
					put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	10

					base
					cprism_ var_mater2,var_mater,var_mater,
							nsp/3, part_thk,
							get (nsp)
					gosub 1000
				endif
				if gs_Mullion_Bott then
					Row = 3: Col = 2: gosub 3000
					put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	15

					if MiddleLowHorDiv then
						if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEVER then
							simpleSashDivY = SashBottomY[Row][Col] + (SashTopY[Row][Col] - SashBottomY[Row][Col]) / 2
							put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	simpleSashDivY - gs_sash_width/2,	10,
								SashRightX[Row][Col] - SashOffsetArray[Row][Col],	simpleSashDivY + gs_sash_width/2,	15
						endif
					endif
					put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	10

					Row = 3: Col = 3: gosub 3000
					put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	15

					if LowRightHorDiv then
						if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEVER then
							simpleSashDivY = SashBottomY[Row][Col] + (SashTopY[Row][Col] - SashBottomY[Row][Col]) / 2
							put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	simpleSashDivY + gs_sash_width/2,	10,
								SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	simpleSashDivY - gs_sash_width/2,	15
						endif
					endif
					put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	10

					base
					cprism_ var_mater2,var_mater,var_mater,
							nsp/3, part_thk,
							get (nsp)
					gosub 1000
				endif
			endif
		endif

	! --- Left Mullion ------------------------------------------------------------------
		if gs_bLeftSLight then

			if gs_LeftMullion_Middle then
				! Upper End
				if gs_LeftMullion_Top or not(gs_UTrans) then
					Row = 1: Col = 2: gosub 3000
					put SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col],		10
					Row = 1: Col = 1: gosub 3000
					put SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col],		15

				else
					Row = 2: Col = 2: gosub 3000
					put SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col],		10
					Row = 2: Col = 1: gosub 3000
					put SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col],		15
				endif

				if UppLeftHorDiv & UppLeftVerDiv then
					Row = 1: Col = 1: gosub 3000
					if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEVER then
						simpleSashDivY = SashBottomY[Row][Col] + (SashTopY[Row][Col] - SashBottomY[Row][Col]) / 2
						put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	simpleSashDivY + gs_sash_width/2,	10,
							SashRightX[Row][Col] - SashOffsetArray[Row][Col],	simpleSashDivY - gs_sash_width/2,	15
					endif
				endif

				if gs_UTrans and gs_UTransom_toLeft and gs_LeftMullion_Top then
					Row = 1: Col = 1: gosub 3000
					put SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],		10
					Row = 2: Col = 1: gosub 3000
					put SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	15
				endif

				Row = 2: Col = 1: gosub 3000
				if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEVER then
					simpleSashDivY = SashBottomY[Row][Col] + (SashTopY[Row][Col] - SashBottomY[Row][Col]) / 2
					put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	simpleSashDivY + gs_sash_width/2,	10,
						SashRightX[Row][Col] - SashOffsetArray[Row][Col],	simpleSashDivY - gs_sash_width/2,	15
				endif

				if gs_LTrans and gs_LTransom_toLeft and gs_LeftMullion_Bott then
					Row = 2: Col = 1: gosub 3000
					put SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],		10
					Row = 3: Col = 1: gosub 3000
					put SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	15
				endif

				if LowLeftHorDiv & LowLeftVerDiv then
					Row = 3: Col = 1: gosub 3000
					if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEVER then
						simpleSashDivY = SashBottomY[Row][Col] + (SashTopY[Row][Col] - SashBottomY[Row][Col]) / 2
						put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	simpleSashDivY + gs_sash_width/2,	10,
							SashRightX[Row][Col] - SashOffsetArray[Row][Col],	simpleSashDivY - gs_sash_width/2,	15
					endif
				endif

				! Lower End
				if gs_LeftMullion_Bott or not(gs_LTrans) then
					Row = 3: Col = 1: gosub 3000
					put SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	10
					Row = 3: Col = 2: gosub 3000
					put SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	15
				else
					Row = 2: Col = 1: gosub 3000
					put SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	10
					Row = 2: Col = 2: gosub 3000
					put SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	15
				endif

				if MiddleLowHorDiv & LowLeftVerDiv then
					Row = 3: Col = 2: gosub 3000
					if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEVER then
						simpleSashDivY = SashBottomY[Row][Col] + (SashTopY[Row][Col] - SashBottomY[Row][Col]) / 2
						put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	simpleSashDivY - gs_sash_width/2,	10,
							SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	simpleSashDivY + gs_sash_width/2,	15
					endif
				endif

				if gs_LTrans & gs_LTransom_Middle and gs_LeftMullion_Bott then
					Row = 3: Col = 2: gosub 3000
					put SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col],		10
					Row = 2: Col = 2: gosub 3000
					put SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	15
				endif

				Row = 2: Col = 2: gosub 3000
				if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEVER then
					simpleSashDivY = SashBottomY[Row][Col] + (SashTopY[Row][Col] - SashBottomY[Row][Col]) / 2
					put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	simpleSashDivY - gs_sash_width/2,	10,
						SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	simpleSashDivY + gs_sash_width/2,	15
				endif

				if gs_UTrans & gs_UTransom_Middle and gs_LeftMullion_Top then
					Row = 2: Col = 2: gosub 3000
					put SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col],		10
					Row = 1: Col = 2: gosub 3000
					put SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	15
				endif

				if MiddleUppHorDiv & UppLeftVerDiv then
					Row = 1: Col = 2: gosub 3000
					if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEVER then
						simpleSashDivY = SashBottomY[Row][Col] + (SashTopY[Row][Col] - SashBottomY[Row][Col]) / 2
						put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	simpleSashDivY - gs_sash_width/2,	10,
							SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	simpleSashDivY + gs_sash_width/2,	15
					endif
				endif

				base
				cprism_ var_mater2,var_mater,var_mater,
						nsp/3, part_thk,
						get (nsp)

				gosub 1000
			else
				if gs_LeftMullion_Top then
					Row = 1: Col = 2: gosub 3000
					put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	15

					if MiddleUppHorDiv then
						if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEVER then
							simpleSashDivY = SashBottomY[Row][Col] + (SashTopY[Row][Col] - SashBottomY[Row][Col]) / 2
							put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	simpleSashDivY - gs_sash_width/2,	10,
								SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	simpleSashDivY + gs_sash_width/2,	15
						endif
					endif
					put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	10

					Row = 1: Col = 1: gosub 3000
					put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	15

					if UppRightHorDiv then
						if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEVER then
							simpleSashDivY = SashBottomY[Row][Col] + (SashTopY[Row][Col] - SashBottomY[Row][Col]) / 2
							put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	simpleSashDivY + gs_sash_width/2,	10,
								SashRightX[Row][Col] - SashOffsetArray[Row][Col],	simpleSashDivY - gs_sash_width/2,	15
						endif
					endif
					put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	10

					base
					cprism_ var_mater2,var_mater,var_mater,
							nsp/3, part_thk,
							get (nsp)
					gosub 1000
				endif
				if gs_LeftMullion_Bott then
					Row = 3: Col = 2: gosub 3000
					put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	15

					if MiddleLowHorDiv then
						if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEVER then
							simpleSashDivY = SashBottomY[Row][Col] + (SashTopY[Row][Col] - SashBottomY[Row][Col]) / 2
							put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	simpleSashDivY - gs_sash_width/2,	10,
								SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	simpleSashDivY + gs_sash_width/2,	15
						endif
					endif
					put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	10

					Row = 3: Col = 1: gosub 3000
					put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	15

					if LowRightHorDiv then
						if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEVER then
							simpleSashDivY = SashBottomY[Row][Col] + (SashTopY[Row][Col] - SashBottomY[Row][Col]) / 2
							put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	simpleSashDivY + gs_sash_width/2,	10,
								SashRightX[Row][Col] - SashOffsetArray[Row][Col],	simpleSashDivY - gs_sash_width/2,	15
						endif
					endif
					put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	10

					base
					cprism_ var_mater2,var_mater,var_mater,
							nsp/3, part_thk,
							get (nsp)
					gosub 1000
				endif
			endif
		endif

	! --- Upper Transom ------------------------------------------------------------
		if gs_UTrans then
			if gs_bSLight & gs_UTransom_toRight & ( gs_Mullion_Top | not(gs_UTransom_Middle)) & gs_RightMullion_Middle then
				Row = 2: Col = 3: gosub 3000
				put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	10
				Row = 1: Col = 3: gosub 3000
				put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	15

				if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEHOR | SimpleSashArray[Row][Col] = SIMPLESASH_SIDEHUNG then
					simpleSashDivx = SashLeftX[Row][Col] + (SashRightX[Row][Col] - SashLeftX[Row][Col]) / 2
					if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEHOR then
						put	simpleSashDivx + gs_sash_width/2,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	10,
							simpleSashDivx - gs_sash_width/2,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	15
					else
						put	simpleSashDivx + gs_sash_width,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	10,
							simpleSashDivx - gs_sash_width,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	15
					endif
				endif
				put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	10


				Row = 2: Col = 3: gosub 3000
				put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	15

				if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEHOR | SimpleSashArray[Row][Col] = SIMPLESASH_SIDEHUNG then
					simpleSashDivx = SashLeftX[Row][Col] + (SashRightX[Row][Col] - SashLeftX[Row][Col]) / 2
					if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEHOR then
						put	simpleSashDivx - gs_sash_width/2,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	10,
							simpleSashDivx + gs_sash_width/2,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	15
					else
						put	simpleSashDivx - gs_sash_width,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	10,
							simpleSashDivx + gs_sash_width,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	15
					endif
				endif

				base
				cprism_ var_mater2,var_mater,var_mater,
					nsp/3, part_thk,
					get(nsp)
				gosub 2000
			endif

			if gs_UTransom_Middle then
				if not(gs_UTransom_toRight) then
					Row = 1: Col = 2: gosub 3000
					if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEHOR | SimpleSashArray[Row][Col] = SIMPLESASH_SIDEHUNG then
						simpleSashDivx = SashLeftX[Row][Col] + (SashRightX[Row][Col] - SashLeftX[Row][Col]) / 2
						if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEHOR then
							put	simpleSashDivx - gs_sash_width/2,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	10,
								simpleSashDivx + gs_sash_width/2,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	15
						else
							put	simpleSashDivx - gs_sash_width,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	10,
								simpleSashDivx + gs_sash_width,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	15
						endif
					endif

					if not(gs_Mullion_Top) | not(gs_RightMullion_Middle) then

						if gs_Mullion_Top then
!!							Row = 1: Col = 2: gosub 3000
							put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	10
						endif
						Row = 1: Col = 3: gosub 3000
						put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	15

						if gs_RightMullion_Middle then
							Row = 2: Col = 3: gosub 3000
							put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col], 8
							Row = 2: Col = 2: gosub 3000
							put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col], 15
						else
							Row = 2: Col = 3: gosub 3000
							put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col], 15
						endif
					else
						Row = 1: Col = 2: gosub 3000
						put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	10
						Row = 2: Col = 2: gosub 3000
						put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col], 15
					endif
				else
					if (not(gs_Mullion_Top) | not(gs_RightMullion_Middle)) | not(gs_bSLight) then

						if gs_Mullion_Top & gs_bSLight then
							Row = 1: Col = 2: gosub 3000
							put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	10
						endif

						Row = 1: Col = 3: gosub 3000
						put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	15

						Row = 1: Col = 3: gosub 3000
						if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEHOR | SimpleSashArray[Row][Col] = SIMPLESASH_SIDEHUNG then
							simpleSashDivx = SashLeftX[Row][Col] + (SashRightX[Row][Col] - SashLeftX[Row][Col]) / 2
							if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEHOR then
								put	simpleSashDivx - gs_sash_width/2,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	10,
									simpleSashDivx + gs_sash_width/2,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	15
							else
								put	simpleSashDivx - gs_sash_width,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	10,
									simpleSashDivx + gs_sash_width,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	15
							endif
						endif

						Row = 1: Col = 3: gosub 3000
						put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	10
						Row = 2: Col = 3: gosub 3000
						put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	15

						if MiddleRightVerDiv then
							if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEHOR | SimpleSashArray[Row][Col] = SIMPLESASH_SIDEHUNG then
								simpleSashDivx = SashLeftX[Row][Col] + (SashRightX[Row][Col] - SashLeftX[Row][Col]) / 2
								if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEHOR then
									put	simpleSashDivx + gs_sash_width/2,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	10,
										simpleSashDivx - gs_sash_width/2,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	15
								else
									put	simpleSashDivx + gs_sash_width,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	10,
										simpleSashDivx - gs_sash_width,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	15
								endif
							endif
						endif

						if gs_RightMullion_Middle & gs_bSLight then
							Row = 2: Col = 3: gosub 3000
							put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col], 10
							Row = 2: Col = 2: gosub 3000
							put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col], 15
						endif
					else
						Row = 1: Col = 2: gosub 3000
						put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	10
						Row = 2: Col = 2: gosub 3000
						put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col], 15
					endif
				endif

				Row = 2: Col = 2: gosub 3000
				if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEHOR | SimpleSashArray[Row][Col] = SIMPLESASH_SIDEHUNG then
					simpleSashDivx = SashLeftX[Row][Col] + (SashRightX[Row][Col] - SashLeftX[Row][Col]) / 2
					if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEHOR then
						put	simpleSashDivx + gs_sash_width/2,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	10,
							simpleSashDivx - gs_sash_width/2,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	15
					else
						put	simpleSashDivx + gs_sash_width,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	10,
							simpleSashDivx - gs_sash_width,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	15
					endif
				endif

				if lod3D = 1 | lod3D = 5 then ! Simple | Chinese
					if sash_num = 2 & gs_optype_m_01 <> SASH_FIXED then
						put	a_center+gs_sash_width,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	10,
							a_center-gs_sash_width,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	15
					endif
				endif

				if not(gs_UTransom_toLeft) then
					if not(gs_LeftMullion_Top) | not(gs_LeftMullion_Middle) then
						if gs_LeftMullion_Middle then
							Row = 2: Col = 2: gosub 3000
							put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col], 10
						endif
						Row = 2: Col = 1: gosub 3000
						put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col], 15


						if gs_LeftMullion_Top then
							Row = 1: Col = 1: gosub 3000
							put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col], 8
							Row = 1: Col = 2: gosub 3000
							put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col], 15
						else
							Row = 1: Col = 1: gosub 3000
							put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col], 15
						endif
					else
						Row = 2: Col = 2: gosub 3000
						put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col], 10
						Row = 1: Col = 2: gosub 3000
						put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col], 15
					endif
				else
					if (not(gs_LeftMullion_Top) | not(gs_LeftMullion_Middle)) | not(gs_bLeftSLight) then
						if gs_LeftMullion_Middle & gs_bLeftSLight then
							Row = 2: Col = 2: gosub 3000
							put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col], 10
							Row = 2: Col = 1: gosub 3000
							put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col], 15
						endif

						Row = 2: Col = 1: gosub 3000
						if MiddleLeftVerDiv then
							if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEHOR | SimpleSashArray[Row][Col] = SIMPLESASH_SIDEHUNG then
								simpleSashDivx = SashLeftX[Row][Col] + (SashRightX[Row][Col] - SashLeftX[Row][Col]) / 2
								if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEHOR then
									put	simpleSashDivx + gs_sash_width/2,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	10,
										simpleSashDivx - gs_sash_width/2,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	15
								else
									put	simpleSashDivx + gs_sash_width,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	10,
										simpleSashDivx - gs_sash_width,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	15
								endif
							endif
						endif

						put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	10

						Row = 1: Col = 1: gosub 3000
						put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	15

						if gs_Mullion_Top & gs_bSLight & gs_UTransom_toRight then
							Row = 1: Col = 1: gosub 3000
							if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEHOR | SimpleSashArray[Row][Col] = SIMPLESASH_SIDEHUNG then
								simpleSashDivx = SashLeftX[Row][Col] + (SashRightX[Row][Col] - SashLeftX[Row][Col]) / 2
								if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEHOR then
									put	simpleSashDivx - gs_sash_width/2,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	10,
										simpleSashDivx + gs_sash_width/2,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	15
								else
									put	simpleSashDivx - gs_sash_width,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	10,
										simpleSashDivx + gs_sash_width,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	15
								endif
							endif
						endif

						if gs_LeftMullion_Top & gs_bLeftSLight then
							Row = 1: Col = 1: gosub 3000
							put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col], 10
							Row = 1: Col = 2: gosub 3000
							put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col], 13
						endif
					else
							Row = 2: Col = 2: gosub 3000
							put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col], 10
							Row = 1: Col = 2: gosub 3000
							put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col], 15
					endif
				endif

				base
				cprism_ var_mater2,var_mater,var_mater,
						nsp/3, part_thk,
						get(nsp)
				gosub 2000
			endif


			if gs_bLeftSLight & gs_UTransom_toLeft & ( gs_LeftMullion_Top | not(gs_UTransom_Middle)) & gs_LeftMullion_Middle then
				Row = 2: Col = 1: gosub 3000
				put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	10
				Row = 1: Col = 1: gosub 3000
				put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	15

				if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEHOR | SimpleSashArray[Row][Col] = SIMPLESASH_SIDEHUNG then
					simpleSashDivx = SashLeftX[Row][Col] + (SashRightX[Row][Col] - SashLeftX[Row][Col]) / 2
					if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEHOR then
						put	simpleSashDivx - gs_sash_width/2,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	10,
							simpleSashDivx + gs_sash_width/2,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	15
					else
						put	simpleSashDivx - gs_sash_width,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	10,
							simpleSashDivx + gs_sash_width,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	15
					endif
				endif

				Row = 1: Col = 1: gosub 3000
				put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col], 10
				Row = 2: Col = 1: gosub 3000
				put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col], 15

				if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEHOR | SimpleSashArray[Row][Col] = SIMPLESASH_SIDEHUNG then
					simpleSashDivx = SashLeftX[Row][Col] + (SashRightX[Row][Col] - SashLeftX[Row][Col]) / 2
					if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEHOR then
						put	simpleSashDivx + gs_sash_width/2,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	10,
							simpleSashDivx - gs_sash_width/2,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	15
					else
						put	simpleSashDivx + gs_sash_width,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	10,
							simpleSashDivx - gs_sash_width,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	15
					endif
				endif

				base
				cprism_ var_mater2,var_mater,var_mater,
					nsp/3, part_thk,
					get(nsp)
				gosub 2000
			endif


		endif

	! --- Lower Transom ------------------------------------------------------------

		if gs_LTrans then
			if gs_bSLight & gs_LTransom_toRight &  ( gs_Mullion_Bott | not(gs_LTransom_Middle)) & gs_RightMullion_Middle then

				Row = 2: Col = 3: gosub 3000
				put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	10
				Row = 3: Col = 3: gosub 3000
				put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	15

				if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEHOR | SimpleSashArray[Row][Col] = SIMPLESASH_SIDEHUNG then
					simpleSashDivx = SashLeftX[Row][Col] + (SashRightX[Row][Col] - SashLeftX[Row][Col]) / 2
					if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEHOR then
						put	simpleSashDivx + gs_sash_width/2,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	10,
							simpleSashDivx - gs_sash_width/2,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	15
					else
						put	simpleSashDivx + gs_sash_width,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	10,
							simpleSashDivx - gs_sash_width,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	15
					endif
				endif
				put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	10


				Row = 2: Col = 3: gosub 3000
				put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	15

				if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEHOR | SimpleSashArray[Row][Col] = SIMPLESASH_SIDEHUNG then
					simpleSashDivx = SashLeftX[Row][Col] + (SashRightX[Row][Col] - SashLeftX[Row][Col]) / 2
					if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEHOR then
						put	simpleSashDivx - gs_sash_width/2,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	10,
							simpleSashDivx + gs_sash_width/2,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	15
					else
						put	simpleSashDivx - gs_sash_width,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	10,
							simpleSashDivx + gs_sash_width,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	15
					endif
				endif

				base
				cprism_ var_mater2,var_mater,var_mater,
					nsp/3, part_thk,
					get(nsp)
				gosub 2000
			endif

			if gs_LTransom_Middle then
				if not(gs_LTransom_toRight) then
					Row = 3: Col = 2: gosub 3000
					if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEHOR | SimpleSashArray[Row][Col] = SIMPLESASH_SIDEHUNG then
						simpleSashDivx = SashLeftX[Row][Col] + (SashRightX[Row][Col] - SashLeftX[Row][Col]) / 2
						if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEHOR then
							put	simpleSashDivx - gs_sash_width/2,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	10,
								simpleSashDivx + gs_sash_width/2,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	15
						else
							put	simpleSashDivx - gs_sash_width,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	10,
								simpleSashDivx + gs_sash_width,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	15
						endif
					endif

					if not(gs_Mullion_Bott) | not(gs_RightMullion_Middle) then

						if gs_Mullion_Bott then
!!							Row = 3: Col = 2: gosub 3000
							put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	10
						endif
						Row = 3: Col = 3: gosub 3000
						put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	15

						if gs_RightMullion_Middle then
							Row = 2: Col = 3: gosub 3000
							put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col], 8
							Row = 2: Col = 2: gosub 3000
							put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col], 15
						else
							Row = 2: Col = 3: gosub 3000
							put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col], 15
						endif
					else
						Row = 3: Col = 2: gosub 3000
						put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	10
						Row = 2: Col = 2: gosub 3000
						put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col], 15
					endif
				else
					if (not(gs_Mullion_Bott) | not(gs_RightMullion_Middle)) | not(gs_bSLight) then

						if gs_Mullion_Bott & gs_bSLight then
							Row = 3: Col = 2: gosub 3000
							put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	10
						endif

						Row = 3: Col = 3: gosub 3000
						put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	15

						Row = 3: Col = 3: gosub 3000
						if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEHOR | SimpleSashArray[Row][Col] = SIMPLESASH_SIDEHUNG then
							simpleSashDivx = SashLeftX[Row][Col] + (SashRightX[Row][Col] - SashLeftX[Row][Col]) / 2
							if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEHOR then
								put	simpleSashDivx - gs_sash_width/2,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	10,
									simpleSashDivx + gs_sash_width/2,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	15
							else
								put	simpleSashDivx - gs_sash_width,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	10,
									simpleSashDivx + gs_sash_width,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	15
							endif
						endif

						Row = 3: Col = 3: gosub 3000
						put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	10

						Row = 2: Col = 3: gosub 3000
						put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	15

						if MiddleRightVerDiv then
							if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEHOR | SimpleSashArray[Row][Col] = SIMPLESASH_SIDEHUNG then
								simpleSashDivx = SashLeftX[Row][Col] + (SashRightX[Row][Col] - SashLeftX[Row][Col]) / 2
								if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEHOR then
									put	simpleSashDivx + gs_sash_width/2,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	10,
										simpleSashDivx - gs_sash_width/2,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	15
								else
									put	simpleSashDivx + gs_sash_width,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	10,
										simpleSashDivx - gs_sash_width,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	15
								endif
							endif
						endif

						if gs_RightMullion_Middle & gs_bSLight then
							Row = 2: Col = 3: gosub 3000
							put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col], 10
							Row = 2: Col = 2: gosub 3000
							put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col], 15
						endif
					else
						Row = 3: Col = 2: gosub 3000
						put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	10
						Row = 2: Col = 2: gosub 3000
						put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col], 15
					endif
				endif

				Row = 2: Col = 2: gosub 3000
				if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEHOR | SimpleSashArray[Row][Col] = SIMPLESASH_SIDEHUNG then
					simpleSashDivx = SashLeftX[Row][Col] + (SashRightX[Row][Col] - SashLeftX[Row][Col]) / 2
					if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEHOR then
						put	simpleSashDivx + gs_sash_width/2,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	10,
							simpleSashDivx - gs_sash_width/2,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	15
					else
						put	simpleSashDivx + gs_sash_width,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	10,
							simpleSashDivx - gs_sash_width,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	15
					endif
				endif

				if lod3D = 1 | lod3D = 5 then ! Simple | Chinese
					if sash_num = 2 & gs_optype_m_01 <> SASH_FIXED then
						Row = 2: Col = 2: gosub 3000
						put	a_center+gs_sash_width,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	10,
							a_center-gs_sash_width,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	15
					endif
				endif

				if not(gs_LTransom_toLeft) then
					if not(gs_LeftMullion_Bott) | not(gs_LeftMullion_Middle) then
						if gs_LeftMullion_Middle then
							Row = 2: Col = 2: gosub 3000
							put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col], 10
						endif
						Row = 2: Col = 1: gosub 3000
						put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col], 15


						if gs_LeftMullion_Top then
							Row = 3: Col = 1: gosub 3000
							put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col], 8
							Row = 3: Col = 2: gosub 3000
							put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col], 15
						else
							Row = 3: Col = 1: gosub 3000
							put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col], 15
						endif
					else
						Row = 2: Col = 2: gosub 3000
						put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col], 10
						Row = 3: Col = 2: gosub 3000
						put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col], 15
					endif
				else
					if (not(gs_LeftMullion_Bott) | not(gs_LeftMullion_Middle)) | not(gs_bLeftSLight) then
						if gs_LeftMullion_Middle & gs_bLeftSLight then
							Row = 2: Col = 2: gosub 3000
							put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col], 10
							Row = 2: Col = 1: gosub 3000
							put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col], 15
						endif

						Row = 2: Col = 1: gosub 3000
						if MiddleLeftVerDiv then
							if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEHOR | SimpleSashArray[Row][Col] = SIMPLESASH_SIDEHUNG then
								simpleSashDivx = SashLeftX[Row][Col] + (SashRightX[Row][Col] - SashLeftX[Row][Col]) / 2
								if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEHOR then
									put	simpleSashDivx + gs_sash_width/2,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	10,
										simpleSashDivx - gs_sash_width/2,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	15
								else
									put	simpleSashDivx + gs_sash_width,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	10,
										simpleSashDivx - gs_sash_width,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	15
								endif
							endif
						endif

						put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	10

						Row = 3: Col = 1: gosub 3000
						put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	15

						if gs_Mullion_Bott & gs_bSLight & gs_LTransom_toRight then
							Row = 3: Col = 1: gosub 3000
							if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEHOR | SimpleSashArray[Row][Col] = SIMPLESASH_SIDEHUNG then
								simpleSashDivx = SashLeftX[Row][Col] + (SashRightX[Row][Col] - SashLeftX[Row][Col]) / 2
								if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEHOR then
									put	simpleSashDivx - gs_sash_width/2,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	10,
										simpleSashDivx + gs_sash_width/2,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	15
								else
									put	simpleSashDivx - gs_sash_width,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	10,
										simpleSashDivx + gs_sash_width,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	15
								endif
							endif
						endif

						if gs_LeftMullion_Top & gs_bLeftSLight then
							Row = 3: Col = 1: gosub 3000
							put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col], 10
							Row = 3: Col = 2: gosub 3000
							put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col], 13
						endif
					else
							Row = 2: Col = 2: gosub 3000
							put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col], 10
							Row = 3: Col = 2: gosub 3000
							put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col], 15
					endif
				endif

				base
				cprism_ var_mater2,var_mater,var_mater,
						nsp/3, part_thk,
						get(nsp)
				gosub 2000
			endif


			if gs_bLeftSLight & gs_LTransom_toLeft & ( gs_LeftMullion_Bott | not(gs_LTransom_Middle)) & gs_LeftMullion_Middle then
				Row = 2: Col = 1: gosub 3000
				put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	10
				Row = 3: Col = 1: gosub 3000
				put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	15

				if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEHOR | SimpleSashArray[Row][Col] = SIMPLESASH_SIDEHUNG then
					simpleSashDivx = SashLeftX[Row][Col] + (SashRightX[Row][Col] - SashLeftX[Row][Col]) / 2
					if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEHOR then
						put	simpleSashDivx - gs_sash_width/2,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	10,
							simpleSashDivx + gs_sash_width/2,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	15
					else
						put	simpleSashDivx - gs_sash_width,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	10,
							simpleSashDivx + gs_sash_width,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	15
					endif
				endif

				Row = 3: Col = 1: gosub 3000
				put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col], 10
				Row = 2: Col = 1: gosub 3000
				put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col], 15

				if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEHOR | SimpleSashArray[Row][Col] = SIMPLESASH_SIDEHUNG then
					simpleSashDivx = SashLeftX[Row][Col] + (SashRightX[Row][Col] - SashLeftX[Row][Col]) / 2
					if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEHOR then
						put	simpleSashDivx + gs_sash_width/2,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	10,
							simpleSashDivx - gs_sash_width/2,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	15
					else
						put	simpleSashDivx + gs_sash_width,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	10,
							simpleSashDivx - gs_sash_width,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	15
					endif
				endif

				base
				cprism_ var_mater2,var_mater,var_mater,
					nsp/3, part_thk,
					get(nsp)
				gosub 2000
			endif
		endif

	! --- Bottom -------------------------------------------------------------------
		Row = 3: Col = 1: gosub 3000

		if bLeftFrame then
			put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col], 10
		else
			if gs_SashText_typ_num = 1 then ! mitered joint
				put	leftOutX,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col], 15
			endif
		endif

		if gs_SashText_typ_num = 2 then ! butt joint
			put	leftOutX,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col], 13 - gs_stack_left * 5
		endif

	! --- Masking corners ---
		bottom_mask = 15
		if gs_stack_left then bottom_mask = 13
		if gs_stack_bottom then bottom_mask = 8

		bottom_mask_2 = 15
		if gs_SashText_typ_num = 2 or not (bRightFrame) then
			if gs_stack_right then
				bottom_mask_2 = 8
			else
				if gs_stack_bottom then
					bottom_mask_2 = 13
				else
					bottom_mask_2 = 15
				endif
			endif
		endif
		if gs_SashText_typ_num = 1 and bRightFrame then
			if gs_stack_right or gs_stack_bottom then
				bottom_mask_2 = 8
			else
				bottom_mask_2 = 10
			endif
		endif

		put			leftOutX,		bottomOutY,				bottom_mask,
					rightOutX,		bottomOutY,				bottom_mask_2

		Row = 3: Col = 3: gosub 3000
		if gs_SashText_typ_num = 2 then ! butt joint
			put	rightOutX,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col], 15 - bRightFrame * 7
		endif

		if bRightFrame then
			put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col], 15
		else
			if gs_SashText_typ_num = 1 then ! mitered joint
				put	rightOutX,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col], 15
			endif
		endif

		if LowRightVerDiv then
			if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEHOR | SimpleSashArray[Row][Col] = SIMPLESASH_SIDEHUNG then
				simpleSashDivx = SashLeftX[Row][Col] + (SashRightX[Row][Col] - SashLeftX[Row][Col]) / 2
				if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEHOR then
					put	simpleSashDivx + gs_sash_width/2,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	10,
						simpleSashDivx - gs_sash_width/2,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	15
				else
					put	simpleSashDivx + gs_sash_width,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	10,
						simpleSashDivx - gs_sash_width,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	15
				endif
			endif
		endif


		if (gs_bSLight & gs_Mullion_Bott) | (not(gs_LTrans) & gs_bSLight & gs_RightMullion_Middle) then
			put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col], 10
			Row = 3: Col = 2: gosub 3000
			put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col], 15
		endif

		Row = 3: Col = 2: gosub 3000
		if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEHOR | SimpleSashArray[Row][Col] = SIMPLESASH_SIDEHUNG then
			simpleSashDivx = SashLeftX[Row][Col] + (SashRightX[Row][Col] - SashLeftX[Row][Col]) / 2
			if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEHOR then
				put	simpleSashDivx + gs_sash_width/2,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	10,
					simpleSashDivx - gs_sash_width/2,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	15
			else
				put	simpleSashDivx + gs_sash_width,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	10,
					simpleSashDivx - gs_sash_width,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	15
			endif
		endif

		if (gs_bLeftSLight & gs_LeftMullion_Bott) | (not(gs_LTrans) & gs_bLeftSLight & gs_LeftMullion_Middle) then
			Row = 3: Col = 2: gosub 3000
			put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col], 10
			Row = 3: Col = 1: gosub 3000
			put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashBottomY[Row][Col] + SashOffsetArray[Row][Col], 15
		endif

		if lod3D = 1 | lod3D = 5 then ! Simple | Chinese
			if not(gs_LTrans) & sash_num = 2 & gs_optype_m_01 <> SASH_FIXED then
				Row = 2: Col = 2: gosub 3000
				put	a_center+gs_sash_width,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col], 10

				if gs_SashText_typ_num = 1 then !mitered joint
					put	a_center, SashBottomY[Row][Col] + SashOffsetArray[Row][Col] - gs_sash_width, 8

				endif

				put	a_center-gs_sash_width,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col], 15
			endif
		endif

		Row = 3: Col = 1: gosub 3000
		if LowLeftVerDiv then
			if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEHOR | SimpleSashArray[Row][Col] = SIMPLESASH_SIDEHUNG then
				simpleSashDivx = SashLeftX[Row][Col] + (SashRightX[Row][Col] - SashLeftX[Row][Col]) / 2
				if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEHOR then
					put	simpleSashDivx + gs_sash_width/2,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	10,
						simpleSashDivx - gs_sash_width/2,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	15
				else
					put	simpleSashDivx + gs_sash_width,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	10,
						simpleSashDivx - gs_sash_width,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	15
				endif
			endif
		endif

		base
		cprism_ var_mater2,var_mater,var_mater,
				nsp/3, part_thk,
				get (nsp)
		gosub 2000

	! --- Top -------------------------------------------------------------------
		Row = 1: Col = 1: gosub 3000

		if bLeftFrame then
			put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col], 10
		else
			if gs_SashText_typ_num = 1 then ! mitered joint
				put	leftOutX,	SashTopY[Row][Col] - SashOffsetArray[Row][Col], 15
			endif
		endif

		if gs_SashText_typ_num = 2 then ! butt joint
			put	leftOutX,	SashTopY[Row][Col] - SashOffsetArray[Row][Col], 13 - gs_stack_left * 5
		endif

	! --- Masking corners ---
		top_mask = 15
		if gs_stack_left then top_mask = 13
		if gs_stack_top then top_mask = 8

		top_mask_2 = 15
		if gs_SashText_typ_num = 2 or not (bRightFrame) then
			if gs_stack_right then
				top_mask_2 = 8
			else
				if gs_stack_top then
					top_mask_2 = 13
				else
					top_mask_2 = 15
				endif
			endif
		endif
		if gs_SashText_typ_num = 1 and bRightFrame then
			if gs_stack_right or gs_stack_top then
				top_mask_2 = 8
			else
				top_mask_2 = 10
			endif
		endif

		put			leftOutX,		topOutY,				top_mask,
					rightOutX,		topOutY,				top_mask_2

		Row = 1: Col = 3: gosub 3000
		if gs_SashText_typ_num = 2 then ! butt joint
			put	rightOutX,	SashTopY[Row][Col] - SashOffsetArray[Row][Col], 15 - bRightFrame * 7
		endif

		if bRightFrame then
			put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col], 15
		else
			if gs_SashText_typ_num = 1 then ! mitered joint
				put	rightOutX,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	15
			endif
		endif

		if UppRightVerDiv then
			if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEHOR | SimpleSashArray[Row][Col] = SIMPLESASH_SIDEHUNG then
				simpleSashDivx = SashLeftX[Row][Col] + (SashRightX[Row][Col] - SashLeftX[Row][Col]) / 2
				if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEHOR then
					put	simpleSashDivx + gs_sash_width/2,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	10,
						simpleSashDivx - gs_sash_width/2,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	15
				else
					put	simpleSashDivx + gs_sash_width,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	10,
						simpleSashDivx - gs_sash_width,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	15
				endif
			endif
		endif


		if (gs_bSLight & gs_Mullion_Top) | (not(gs_UTrans) & gs_bSLight & gs_RightMullion_Middle) then
			put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col], 10
			Row = 1: Col = 2: gosub 3000
			put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col], 15
		endif

		Row = 1: Col = 2: gosub 3000
		if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEHOR | SimpleSashArray[Row][Col] = SIMPLESASH_SIDEHUNG then
			simpleSashDivx = SashLeftX[Row][Col] + (SashRightX[Row][Col] - SashLeftX[Row][Col]) / 2
			if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEHOR then
				put	simpleSashDivx + gs_sash_width/2,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	10,
					simpleSashDivx - gs_sash_width/2,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	15
			else
				put	simpleSashDivx + gs_sash_width,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	10,
					simpleSashDivx - gs_sash_width,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	15
			endif
		endif

		if (gs_bLeftSLight & gs_LeftMullion_Top) | (not(gs_UTrans) & gs_bLeftSLight & gs_LeftMullion_Middle) then
			Row = 1: Col = 2: gosub 3000
			put	SashLeftX[Row][Col] + SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col], 10
			Row = 1: Col = 1: gosub 3000
			put	SashRightX[Row][Col] - SashOffsetArray[Row][Col],	SashTopY[Row][Col] - SashOffsetArray[Row][Col], 15
		endif

		if lod3D = 1 | lod3D = 5 then ! Simple | Chinese
			if not(gs_UTrans) & sash_num = 2 & gs_optype_m_01 <> SASH_FIXED then
				Row = 2: Col = 2: gosub 3000
				put	a_center+gs_sash_width,	SashTopY[Row][Col] - SashOffsetArray[Row][Col], 10

				if gs_SashText_typ_num = 1 then !mitered joint
					put	a_center,	SashTopY[Row][Col] - SashOffsetArray[Row][Col] + gs_sash_width, 8
				endif

				put	a_center-gs_sash_width,	SashTopY[Row][Col] - SashOffsetArray[Row][Col], 15
			endif
		endif

		Row = 1: Col = 1: gosub 3000
		if UppLeftVerDiv then
			if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEHOR | SimpleSashArray[Row][Col] = SIMPLESASH_SIDEHUNG then
				simpleSashDivx = SashLeftX[Row][Col] + (SashRightX[Row][Col] - SashLeftX[Row][Col]) / 2
				if SimpleSashArray[Row][Col] = SIMPLESASH_SLIDEHOR then
					put	simpleSashDivx + gs_sash_width/2,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	10,
						simpleSashDivx - gs_sash_width/2,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	15
				else
					put	simpleSashDivx + gs_sash_width,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	10,
						simpleSashDivx - gs_sash_width,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],	15
				endif
			endif
		endif

		base
		cprism_ var_mater2,var_mater,var_mater,
				nsp/3, part_thk,
				get (nsp)
		gosub 2000


! Double Sash Dividers --------------------------------------------------------

		if lod3D = 1 | lod3D = 5 then
			for i=1 to vardim1(CasementIDArray)
				for j=1 to vardim2(CasementIDArray)

					CasementID = CasementIDArray[i][j]
					if CasementID > 0 then
						Row = i: Col = j: gosub 3000

						iSimpleSashFrameType = SimpleSashArray[Row][Col]
						if iSimpleSashFrameType = SIMPLESASH_SIDEHUNG then
							simpleSashDivx = SashLeftX[Row][Col] + (SashRightX[Row][Col] - SashLeftX[Row][Col]) / 2
							base
							cprism_ var_mater2,var_mater,var_mater,
								4, part_thk,
								simpleSashDivx - gs_sash_width,	sashBottomY[Row][Col] + SashOffsetArray[Row][Col],	10,
								simpleSashDivx + gs_sash_width,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	15,
								simpleSashDivx + gs_sash_width,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],		10,
								simpleSashDivx - gs_sash_width,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],		15
							gosub 1000
						endif
						if iSimpleSashFrameType = SIMPLESASH_SLIDEHOR then
							simpleSashDivx = SashLeftX[Row][Col] + (SashRightX[Row][Col] - SashLeftX[Row][Col]) / 2
							base
							cprism_ var_mater2,var_mater,var_mater,
								4, part_thk,
								simpleSashDivx - gs_sash_width/2,	sashBottomY[Row][Col] + SashOffsetArray[Row][Col],	10,
								simpleSashDivx + gs_sash_width/2,	SashBottomY[Row][Col] + SashOffsetArray[Row][Col],	15,
								simpleSashDivx + gs_sash_width/2,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],		10,
								simpleSashDivx - gs_sash_width/2,	SashTopY[Row][Col] - SashOffsetArray[Row][Col],		15
							gosub 1000
						endif
						if iSimpleSashFrameType = SIMPLESASH_SLIDEVER then
							simpleSashDivY = SashBottomY[Row][Col] + (SashTopY[Row][Col] - SashBottomY[Row][Col]) / 2
							base
							cprism_ var_mater2,var_mater,var_mater,
								4, part_thk,
								SashLeftX[Row][Col]  + SashOffsetArray[Row][Col], simpleSashDivy - gs_sash_width/2,	10,
								SashLeftX[Row][Col]  + SashOffsetArray[Row][Col], simpleSashDivy + gs_sash_width/2,	15,
								SashRightX[Row][Col] - SashOffsetArray[Row][Col], simpleSashDivy + gs_sash_width/2,	10,
								SashRightX[Row][Col] - SashOffsetArray[Row][Col], simpleSashDivy - gs_sash_width/2,	15
							gosub 2000
						endif
					endif
				next j
			next i
		endif

! -----------------------------------------------------------------------------

		addz part_thk
		part_thk= gs_frame_thk-out_thk

		var_mater = gs_frame_mat2
		var_mater2 = gs_frame_mat2
	next ijk
	del in_out_cikl

	for kj = 1 to cutnum
		cutend
	next kj
	cutnum = 0
endgroup


! ==============================================================================
! Sash cavities in Frame
! ==============================================================================

group "harcsi"
	if lod3D = 2 then
		if GLOB_CONTEXT = 4 | GLOB_CONTEXT = 6 then
			pen gs_frame_pen_cont
		else
			pen gs_frame_pen
		endif
		sect_fill gs_fillFr, gs_penFr_bg, gs_penFr_fg, gs_frame_pen_cont

		for i=1 to vardim1(CasementIDArray)
			for j=1 to vardim2(CasementIDArray)

				CasementID = CasementIDArray[i][j]
				if CasementID > 0 then

					iSashCutType = SashCutArray[i][j]
					if iSashCutType = SASHCUT_REBATE then
						addz gs_frame_thk - gs_rebate_depth
						material gs_frame_mat2
						prism_ 4, gs_frame_thk,
							SashLeftX[i][j] - gs_rebate_width,	sashBottomY[i][j] - gs_rebate_width,	15,
							SashRightX[i][j] + gs_rebate_width,	SashBottomY[i][j] - gs_rebate_width,	15,
							SashRightX[i][j] + gs_rebate_width,	SashTopY[i][j] + gs_rebate_width,		15,
							SashLeftX[i][j] - gs_rebate_width,	SashTopY[i][j] + gs_rebate_width,		15
						del 1
					endif
					if iSashCutType = SASHCUT_MIDDLE &\
						abs(SashLeftX[i][j] - SashRightX[i][j]) > EPS &\
						abs(sashBottomY[i][j] - SashTopY[i][j]) > EPS then
						addz gs_frame_thk/2
						material gs_frame_mat2
						prism_ 4, gs_frame_thk,
							SashLeftX[i][j],	sashBottomY[i][j],	14,
							SashRightX[i][j],	SashBottomY[i][j],	14,
							SashRightX[i][j],	SashTopY[i][j],		14,
							SashLeftX[i][j],	SashTopY[i][j],		14
						material gs_frame_mat
						prism_ 4, -gs_frame_thk,
							SashLeftX[i][j],	sashBottomY[i][j],	11,
							SashRightX[i][j],	SashBottomY[i][j],	11,
							SashRightX[i][j],	SashTopY[i][j],		11,
							SashLeftX[i][j],	SashTopY[i][j],		11
						del 1
					endif
				endif
			next j
		next i
	endif
endgroup

pen gs_frame_pen
sect_fill gs_fillFr, gs_penFr_bg, gs_penFr_fg, gs_frame_pen_cont

if lod3D = 2 then	! Detailed
	placegroup subgroup("frame","harcsi")
else
	placegroup "frame"
endif


! =============================================================================
end ! end ! end ! end ! end ! end ! end ! end ! end ! end ! end ! end ! end
! =============================================================================


1000:
! --- Texture directions -------------------------------------------------------

vert 0, 0, 0
vert 0, 1, 0
vert 1, 0, 0
vert 0, 0, 1
coor 2, -1, -2, -3, -4
body 1

return

2000:
! --- Texture directions -------------------------------------------------------

vert 0, 0, 0
vert 1, 0, 0
vert 0, 1, 0
vert 0, 0, 1
coor 2, -1, -2, -3, -4
body 1

return


3000:
	tempRow = SashRelocateRow[Row][Col]
	Col = SashRelocateCol[Row][Col]
	Row	= tempRow
return


