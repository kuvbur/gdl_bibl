<?xml version="1.0" encoding="UTF-8"?>
<Symbol IsArchivable="false" IsPlaceable="true" MainGUID="01B0A7F5-7A4F-41D6-A57F-0169FA8AFA3F" MigrationValue="Normal" Owner="0" Signature="1196644685" Version="38">
<!-- GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT -->

<Script_2D SectVersion="20" SectionFlags="0" SubIdent="0">
<![CDATA[
L=0.01*GLOB_SCALE
MUL2   L,L
DEFINE STYLE "текст20-5"  fontType, r205, 5, r205type
n = REQUEST ("HomeDB_info", "", homeDBIntId, homeDBUserId, homeDBName, homeContext)
pen_error=19
if _bERROR then
	pen_small = pen_error
	pen_osn = pen_error
	pen_podp = pen_error
	pen_text = pen_error
endif
hotspot2 0,0
SET STYLE "текст20-5"
TEXT2  0, 0, current_date
END

]]>
</Script_2D>

<!-- GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT -->

<Script_VL SectVersion="20" SectionFlags="0" SubIdent="0">
<![CDATA[
values{2} "r205type" irtype, trtype
]]>
</Script_VL>

<ParamSection SectVersion="26" SectionFlags="0" SubIdent="0">
	<ParamSectHeader>
		<Version>26</Version>
		<AutoHotspots>true</AutoHotspots>
		<WDLeftFrame>0</WDLeftFrame>
		<WDRightFrame>0</WDRightFrame>
		<WDTopFrame>0</WDTopFrame>
		<WDBotFrame>0</WDBotFrame>
		<LayFlags>65535</LayFlags>
		<WDMirrorThickness>0</WDMirrorThickness>
		<WDWallInset>0</WDWallInset>
		<SymbolColor>0</SymbolColor>
	</ParamSectHeader>
	<Parameters>
		<Length Name="A">
			<Description><![CDATA[""]]></Description>
			<Fix/>
			<Flags>
				<ParFlg_Hidden/>
			</Flags>
			<Value>84.1</Value>
		</Length>
		<Length Name="B">
			<Description><![CDATA[""]]></Description>
			<Fix/>
			<Flags>
				<ParFlg_Hidden/>
			</Flags>
			<Value>59.4</Value>
		</Length>
		<String Name="fontType">
			<Description><![CDATA["Шрифт"]]></Description>
			<Flags>
				<ParFlg_Child/>
			</Flags>
			<Value><![CDATA["ISOCPEUR"]]></Value>
		</String>
		<RealNum Name="r205">
			<Description><![CDATA["Размер шрифта доп. графы"]]></Description>
			<Flags>
				<ParFlg_Child/>
			</Flags>
			<Value>2.6</Value>
		</RealNum>
		<Integer Name="r205type">
			<Description><![CDATA["Тип шрифта доп. графы"]]></Description>
			<Flags>
				<ParFlg_Child/>
			</Flags>
			<Value>0</Value>
		</Integer>
		<PenColor Name="pen_small">
			<Description><![CDATA["Перо тонких линий"]]></Description>
			<Flags>
				<ParFlg_Child/>
			</Flags>
			<Value>1</Value>
		</PenColor>
	</Parameters>
</ParamSection>

<Picture MIME="image/png" SectVersion="19" SectionFlags="0" SubIdent="0" length_in_bytes="2334" platform="Win">
	<![CDATA[
	696D6167652F706E670089504E470D0A1A0A0000000D49484452000000F60000
	007408020000003908584C000000017352474200AECE1CE90000000467414D41
	0000B18F0BFC6105000000097048597300000B1200000B1201D2DD7EFC000008
	A949444154785EED9DBF6E153B10C6F7DEC700096A7A5250A447A2A048C30B9C
	D3D144F4283D4A43072F90868202893E458AD05383145E23F73B77ADD5C6E3DD
	E31DDBBBF6F0FD14DDEBC0D97FE3CFE3F18CF7F0CFFDFD7D47885DFE75FF27C4
	289438310E254E8C438913E350E2C4389438310E254E8C438913E350E2C43894
	38310E254E8C438913E350E2C4389438310E254E8C438913E350E2C438943831
	0E254E8C438913E350E2C4387FC11BF8DFBF771F3F1E1ACF9F771717FFFF5102
	3F7F76D7D7DDDD5DF7E7CFE167E0D1A3EEE4A43B3DED9E3D737F5215198D8053
	DDDCB8671F5B00C0086767DDCB97EED73AB02EF14F9FBAAF5F5D1BBC7EDDEDF7
	AEBD1474ED972F7EA74AD0CDE7E775093D8B11221FBF278B37C9846989BF7FDF
	FDF8E1DA3D3AD32FEADD9EB76F6B7166E946503C3EA866A81B8DC5114EBC7AE5
	77AD0EB8404CF14B3B18874019DB92C50818218AC70738E4DDBBC33D6C8D4589
	4394306E90172F5C2392DDEEC114BF082863C30ECE620439032CE5F2D235B6C3
	9CC4E745F9F4A96BC4805329BCD798AB2BD758992C46C020499F0661409C6753
	0CC5E2080CFAA4C114880E3F7F76EDA3CCE85BE60DE0ADA1E6A020560ECA7319
	61E63CFDE3639C8CE36C58E0D7AFC990FDDB37D7D8022B128F9952E3330953FA
	96E21E836E96B1C19AB9858C4640102FC1B3BC79736405191C1B9B2EBEDB0F54
	202C2832664A7DF2C435E6815082FA4607C3FFCD7415FAFEC307D71E489FEB63
	C86B846068019962AC1ECD90C03E18451E3737AEB1058D4B1C3E038E732AA2F0
	887124530168DFC147810230123CA0BFA26437828CE3A1DA78377C7AEA1A75D0
	B2C4FB7C5610E94810631C055A0CAED2E09BE33BF8F163D75887EC46902E1C83
	7651A9487AFAC8E1578636253E3F2F4391723A3E39718D19B06092E06C4767E7
	4D286484DB5BD71840FCDD326D4A7C6A5E8697C2E21D8A94C15FCCEC29B36988
	4FEAD4372861040C1BEF9C70E1E91688993D8AD1A0C4A7F2AC9897877498ECFB
	987EC267C691F4A20074E0EECE35064A0C924246B8BE768D81A5C53280B581C7
	CAC1DB431A5F6E0EC0DD0EF162D01545823525A6789C0DFF55EC55025EE4107F
	E974D28D20A39445C5B29EDFBF5D6320329755860625EECDB6980421C7B1BB95
	21F5222F025787B3E95CAF74AE0A2F18436923F4E0B40A3BC871A2980CF3D1A0
	C4617474277C123AA09F97BD6ED005E2E9C071CA844CA1DE2D640419DB2C0551
	8A7712DCDEA658DC4CEB55E62082213C2D8AAC89A27775D14E3A3A23A49B4E1A
	0143513115E4C34A2C3E0057EA817E5A81604D742B7DAB8DE07D6CA9539746C0
	3CB3A9BE81398967C9092C055D2BF3D358FC6D85DA087224C8F4C81441235490
	5337277199B32BBDD609D6FC11A26CB8C6521B418E848F11BBDEF1816011AA02
	170ECCC5E22B07E2D0B75C6296BEE851528CE01DDB83330437D062BAB8BD9D8C
	6736DD433B604BE29855BD0D1B45177CF27260737D271A213868156CBDCA1CB0
	15A8AC5974A853DF20D108180C788A44AAD137B025F1D58A0E98A3A5BEC1E6FA
	06E9464891388EAD49DFC096C465C6AA04D0B77CBB07A06B6B20C5087834C4E2
	72E11809AE85415E93BE812189CBF456A1DD3F53FAAEA16B538C8063838FD638
	8624BE4EDD3E9870A867CFADDA08C1A5C552E0FEE518DB1A431915593ACE9EB4
	929700D0F78629700F9D11A6422F80D85A7E57233E3FF5BE7D0D0BEE8758F1E2
	307A4A0C1A43FDFA561B21F8853EFDC2117ADDEFFD390ABFE2A9F157B2828B1B
	A8CC915B9178E9BA7D700BCAB6254C89CE0850A47CB4C885231E1F46F09059CB
	4DB1227159B256ECE59F22B8FBA268514987CE0888373CA0EFF8EF7E91B1BECC
	5A6E8A15897B12C4249B6BFD17DC820211D4A66FA0308274E1386AD1771BE112
	38A4624C481C31A847CCABE63104ABD98B9CDC6AE88C2033306767AE61051312
	97316896BA3D3C5C708B5585FA063A2348C7AF585DC850BE264C48BC44DD1EFA
	AE730BCA140A23C8D48762F693B34765718B0989CB683211745BB55B50A65018
	214BB12CCB7BD025695FE2595CD118E8BBE62D2841744690A342B1465FA7A89C
	40FB129759D81413CFE83B578AA6040A23E049B3CC7EE5725999685FE232064D
	31718BFA060A23642996551F8883C6252E5D5164C93AC86EE71A63EAD9623585
	CE08595E722D5D54CE41E312CFB8D6A97F0BCA143A23C8004341895C566E1A97
	78AEB54E50DFB56D41994261845CE9C22CD17C611A97B834B122A898DA625561
	893E481623288A65324A49CC6595A1658967F122C12D56756E4109A23382CCC0
	2876ADC9D26F65E9C29E96259EBED699DA625567893E48AE059F0CE8E781E93C
	60B72AD7E52D4B3C312710DC620517D890BE81CE08322C59B4C91B5387345D7D
	B9949E96259E9213C07A2BA8EF9A4BF441B2244680CC8D4C017DCBEA01AE5BEB
	D2BC5989A7E40470ECCA5BAC208BDDEEF06A337EE414AF466D04294704F45896
	1C059F0956C72ADE82DBACC4E5C41A991380DAD6DF6205590C8B42CC1EB8872C
	A88D0064790813423F02BDDBC3AF184B10F7D457ACE0541567579B7D035F66B2
	135F355700C77F7E7E7C8D25278D5C15259D117A7299A2FAE8AE592FEE75ADF4
	494132EA1BE01E624E284B33B9DE2BD519A1072353BE59ACA0FAD54B9B129731
	684CC93A63103CE668D4E109116449AEE98C3066BF5F362A3CE0BFEBF87AE579
	DA94B862EF2890F9B57548F1B533E88CE07171A1BC1FCC008D649FDA94B8D797
	7027317EB150E2F6E8A5717B6372DD86CE0812A81C6B03EF266780B8E1BC5BA9
	FE36BCDC44787079797090E89B98355F4FB05CAF26F2D2C3AD82BC5B5F744698
	0267BBBA3A9CCD9B767072FC60647AFF4A442398FB8750087948B3191542E2A0
	C489712871621C4A9C18871227C6A1C489712871621C4A9C18871227C6A1C489
	712871621C4A9C18871227C6A1C489712871621C4A9C18871227C6A1C4897128
	71621C4A9C18871227C6A1C489712871621C4A9C18871227C6A1C48971287162
	1C4A9C18871227C6A1C489712871621C4A9C18871227C6A1C489712871621C4A
	9C18871227A6E9BAFF004B04A6F87E89B6650000000049454E44AE426082
	]]>
</Picture>

<Ancestry SectVersion="1" SectionFlags="0" SubIdent="0" Template="false">
	<MainGUID>F938E33A-329D-4A36-BE3E-85E126820996</MainGUID>
	<MainGUID>B176ABF1-5813-478F-926B-28EE7C5DC1F7</MainGUID>
	<MainGUID>4FD10D67-2F29-4844-A65A-6597589B0CB5</MainGUID>
</Ancestry>

<CalledMacros SectVersion="2" SectionFlags="0" SubIdent="0">
</CalledMacros>

<Copyright SectVersion="1" SectionFlags="0" SubIdent="0">
	<Author></Author>
	<License>
		<Type>CC0</Type>
		<Version>1.0</Version>
	</License>
</Copyright>

<!-- GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT -->

<Script_3D SectVersion="20" SectionFlags="0" SubIdent="0">
<![CDATA[]]>
</Script_3D>

<!-- GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT -->

<Script_1D SectVersion="20" SectionFlags="0" SubIdent="0">
<![CDATA[
dim error[ ]
dim position_info[ ][ ]
dim change_info[ ][ ]
dim arr1[ ]
dim arr2[ ][ ]
!------------------------------------------------------------------------------------------------
! Check global existence
!------------------------------------------------------------------------------------------------

dim irtype[] : dim trtype[] : i=0
i=i+1 : trtype[i] = "Обычный" : irtype[i] = 0
i=i+1 : trtype[i] = "Полужирный" : irtype[i] = 1
i=i+1 : trtype[i] = "Курсив" : irtype[i] = 2
i=i+1 : trtype[i] = "Полужирный курсив" : irtype[i] = 3

ROW_PHASE_PART = 2
ROW_DATE = 8
ROW_IZM_N_DOC = 7
ROW_IZM_SUR = 9
FAM_START_CHANGE = 11
FAM_START_LAYUOT = 6

dim GlobIssueScheme[2][]
dim GlobChangeScheme[2][]
dim LayoutRevHistory[][]
dim LayoutChangeHistory[][]

_bEmptyGlobIssues = 0
_bEmptyGlobChanges = 0
_bEmptyLayoutRevHistory = 0
_bEmptyLayoutChHistory = 0
_bfirstchange = 0
_bEmptychange = 0
_bERROR = 0
n_izm = 0
n_err = 0

current_phase = " "
current_part = " "
current_date = " "
surname = " " 
delim = " "

if vardim2(GLOB_ISSUE_SCHEME) > 0 then
	! global exists
	GlobIssueScheme	= GLOB_ISSUE_SCHEME
else
	_bEmptyGlobIssues = 1
endif

if vardim2(GLOB_CHANGE_SCHEME) > 0 then
	! global exists
	GlobChangeScheme = GLOB_CHANGE_SCHEME
else
	_bEmptyGlobChanges = 1
endif

if GLOB_SCRIPT_TYPE = 2 then
	_bLayoutContext = (GLOB_CONTEXT = 8 | GLOB_CONTEXT = 28)
	if _bLayoutContext then
		! Layout context or Layout Editing feedback: use globals from Issue Manager
		LayoutRevHistory = LAYOUT_REVISION_HISTORY
		LayoutChangeHistory	= LAYOUT_CHANGE_HISTORY
		last_change_inx = vardim1(LayoutChangeHistory)
		last_rev_inx = vardim1(LayoutRevHistory)
		if vardim2(LayoutRevHistory) > 1 then
			if STRSTR(LayoutRevHistory[last_rev_inx][3], "Отсутствует в Выпуске") then 
				txt = "Макет добавлен в выпуск?"
				gosub "write_error"
			endif
		else
			txt = "Макет добавлен в выпуск?"
			gosub "write_error"
		endif
	else
		text2 0.05, 0.05,  "!! Работает только на макетах !!"
	endif
endif
if vardim2(LayoutRevHistory) <> vardim2(GlobIssueScheme) then
	! if global exists, must have same number of columns as GLOB_ISSUE_SCHEME
	_bEmptyLayoutRevHistory = 1
endif
if vardim2(LayoutChangeHistory) <> vardim2(GlobChangeScheme) then
	! if global exists, must have same number of columns as GLOB_CHANGE_SCHEME
	_bEmptyLayoutChHistory = 1
endif
if not(_bEmptyLayoutRevHistory) & _bEmptyLayoutChHistory then
	! if has revision data but no change attached, create 1 dummy empty change row
	for _iChangeCol = 1 to vardim2(GLOB_CHANGE_SCHEME)
		if _iChangeCol = 1 then
			LayoutChangeHistory[1][1] = LayoutRevHistory[1][1]
		else
			LayoutChangeHistory[1][_iChangeCol] = ""
		endif
	next _iChangeCol
endif

if not(_bEmptyLayoutRevHistory) then
	!---------------------- Поиск изм. 0 ------------------------	
	zero_change_inx = 0 : flag = 0
	for i = 1 to last_change_inx
		if STRSTR(LayoutChangeHistory[i][ROW_PHASE_PART], "Изм 0") then
			zero_change_inx = i
			if flag = 1 then
				txt = "У макета должен быть только один Изм 0."
				gosub "write_error"
			else
				flag = 1
			endif
		endif
	next i
	!------------------------------------------------------------
	if zero_change_inx then
		phase_part = LayoutChangeHistory[zero_change_inx][ROW_PHASE_PART]
		current_phase = "" : current_part = "" : current_type = "" : current_nizm = 0
		n = SPLIT (phase_part, "%s %s %s %n", current_phase, current_part, current_type, current_nizm)
		if n<>4 then 
			txt = "Проверьте название -" + phase_part
			gosub "write_error"
		else
			if current_type<>"Изм" and current_type<>"Зам" and current_type<>"Нов" then
				txt = "Может быть только Изм/Зам/Нов" + phase_part
				gosub "write_error"
			endif
		endif
		if strlen(current_phase)>2 then
			txt = "Слишком длинное название стадии."
			gosub "write_error"
		endif
		current_date = LayoutChangeHistory[zero_change_inx][ROW_DATE]
	else
		txt = "Добавьте Изм 0"
		gosub "write_error"
	endif
endif
if n_err > 0 then _bERROR = 1
goto 20
"write_error":
	n_err = n_err + 1
return
20:
]]>
</Script_1D>

<!-- GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT -->

<Script_PR SectVersion="20" SectionFlags="0" SubIdent="0">
<![CDATA[]]>
</Script_PR>

<!-- GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT -->

<Script_UI SectVersion="20" SectionFlags="0" SubIdent="0">
<![CDATA[]]>
</Script_UI>

<!-- GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT -->

<Script_FWM SectVersion="20" SectionFlags="0" SubIdent="0">
<![CDATA[]]>
</Script_FWM>

<!-- GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT -->

<Script_BWM SectVersion="20" SectionFlags="0" SubIdent="0">
<![CDATA[]]>
</Script_BWM>

<Keywords SectVersion="1" SectionFlags="0" SubIdent="0">
<![CDATA[]]>
</Keywords>

<!-- GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT -->

<Comment SectVersion="20" SectionFlags="0" SubIdent="0">
<![CDATA[]]>
</Comment>

</Symbol>
