<?xml version="1.0" encoding="UTF-8"?>
<Symbol IsArchivable="false" IsPlaceable="false" MainGUID="9599AE52-02BC-4724-BF8E-B034D735D7E1" MigrationValue="Normal" Owner="1196638531" Signature="776753997" Version="38">
<Ancestry SectVersion="1" SectionFlags="0" SubIdent="0" Template="false">
	<MainGUID>F938E33A-329D-4A36-BE3E-85E126820996</MainGUID>
	<MainGUID>103E8D2C-8230-42E1-9597-46F84CCE28C0</MainGUID>
	<MainGUID>B2970E4C-8680-4061-8670-2F4B638F3953</MainGUID>
</Ancestry>

<CalledMacros SectVersion="2" SectionFlags="0" SubIdent="0">
</CalledMacros>

<!-- GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT -->

<Script_2D SectVersion="20" SectionFlags="0" SubIdent="0">
<![CDATA[]]>
</Script_2D>

<!-- GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT -->

<Script_1D SectVersion="20" SectionFlags="0" SubIdent="0">
<![CDATA[]]>
</Script_1D>

<!-- GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT -->

<Script_PR SectVersion="20" SectionFlags="0" SubIdent="0">
<![CDATA[]]>
</Script_PR>

<!-- GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT -->

<Script_UI SectVersion="20" SectionFlags="0" SubIdent="0">
<![CDATA[]]>
</Script_UI>

<!-- GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT -->

<Script_VL SectVersion="20" SectionFlags="0" SubIdent="0">
<![CDATA[
EPS = 0.00001

IF GLOB_MODPAR_NAME = "RotationAroundDAxis" OR GLOB_MODPAR_NAME = "RotationAroundWAxis" OR GLOB_MODPAR_NAME = "RotationAroundZAxis" THEN
	AX = RotationAroundDAxis
	AY = -RotationAroundWAxis
	AZ = RotationAroundZAxis

	MEP_Position[2][1] = COS(AY)*COS(AZ)
	PARAMETERS MEP_Position[2][1] = MEP_Position[2][1]
	MEP_Position[2][2] = COS(AY)*SIN(AZ)
	PARAMETERS MEP_Position[2][2] = MEP_Position[2][2]
	MEP_Position[2][3] = -SIN(AY)
	PARAMETERS MEP_Position[2][3] = MEP_Position[2][3]

	MEP_Position[3][1] = SIN(AX)*SIN(AY)*COS(AZ) - COS(AX)*SIN(AZ)
	PARAMETERS MEP_Position[3][1] = MEP_Position[3][1]
	MEP_Position[3][2] = SIN(AX)*SIN(AY)*SIN(AZ) + COS(AX)*COS(AZ)
	PARAMETERS MEP_Position[3][2] = MEP_Position[3][2]
	MEP_Position[3][3] = SIN(AX)*COS(AY)
	PARAMETERS MEP_Position[3][3] = MEP_Position[3][3]

ELSE

	! --------------------------------- !
	! --- rotation around Y (Pitch) --- !
	! --------------------------------- !

	IF MEP_Position[2][3] > 1 THEN MEP_Position[2][3] = 1
	IF MEP_Position[2][3] < -1 THEN MEP_Position[2][3] = -1

	RotationAroundWAxis = ASN(-MEP_Position[2][3])
	IF ABS(RotationAroundWAxis) < EPS THEN RotationAroundWAxis = 0

	RotationAroundWAxis = -RotationAroundWAxis
	PARAMETERS RotationAroundWAxis = RotationAroundWAxis


	IF ABS(ABS(MEP_Position[2][3]) - 1) > EPS THEN
		! none of ATAN2 functions are undefined

		! ---------------- !
		! --- Z vector --- !
		! ---------------- !

		dZx = -MEP_Position[3][2]*MEP_Position[2][3]+MEP_Position[3][3]*MEP_Position[2][2]
		dZy = -MEP_Position[3][3]*MEP_Position[2][1]+MEP_Position[3][1]*MEP_Position[2][3]
		dZz = -MEP_Position[3][1]*MEP_Position[2][2]+MEP_Position[3][2]*MEP_Position[2][1]

		! -------------------------------- !
		! --- rotation around X (Roll) --- !
		! -------------------------------- !

		atan2_param1 = MEP_Position[3][3]
		atan2_param2 = dZz

			! ***** atan2 function *****

			IF ABS(atan2_param1) > EPS THEN
				IF ABS(atan2_param2) > EPS THEN
					fi = ATN(ABS(atan2_param1/atan2_param2))
				ENDIF

				IF ABS(atan2_param2) < EPS THEN
					ang = 90*(SGN(atan2_param1))
				ELSE
					IF atan2_param2 > EPS THEN
						ang = fi*(SGN(atan2_param1))
					ELSE
						ang = (180 - fi)*(SGN(atan2_param1))
					ENDIF
				ENDIF
			ELSE
				IF ABS(atan2_param2) < EPS THEN
					ang = 0
				ELSE
					IF atan2_param2 > EPS THEN
						ang = 0
					ELSE
						ang = 180
					ENDIF
				ENDIF
			ENDIF

		RotationAroundDAxis = ang
		IF ABS(RotationAroundDAxis) < EPS THEN RotationAroundDAxis = 0
		PARAMETERS RotationAroundDAxis = RotationAroundDAxis

		! ------------------------------- !
		! --- rotation around Z (Yaw) --- !
		! ------------------------------- !

		atan2_param1 = MEP_Position[2][2]
		atan2_param2 = MEP_Position[2][1]

			! ***** atan2 function *****

			IF ABS(atan2_param1) > EPS THEN
				IF ABS(atan2_param2) > EPS THEN
					fi = ATN(ABS(atan2_param1/atan2_param2))
				ENDIF

				IF ABS(atan2_param2) < EPS THEN
					ang = 90*(SGN(atan2_param1))
				ELSE
					IF atan2_param2 > EPS THEN
						ang = fi*(SGN(atan2_param1))
					ELSE
						ang = (180 - fi)*(SGN(atan2_param1))
					ENDIF
				ENDIF
			ELSE
				IF ABS(atan2_param2) < EPS THEN
					ang = 0
				ELSE
					IF atan2_param2 > EPS THEN
						ang = 0
					ELSE
						ang = 180
					ENDIF
				ENDIF
			ENDIF

		RotationAroundZAxis = ang
		IF ABS(RotationAroundZAxis) < EPS THEN RotationAroundZAxis = 0
		PARAMETERS RotationAroundZAxis = RotationAroundZAxis

	ELSE
		! both ATAN2 functions are undefined

		! -------------------------------- !
		! --- rotation around X (Roll) --- !
		! -------------------------------- !

		RotationAroundDAxis = 0
		PARAMETERS RotationAroundDAxis = RotationAroundDAxis

		! ------------------------------- !
		! --- rotation around Z (Yaw) --- !
		! ------------------------------- !

		IF MEP_Position[3][1] > 1 THEN MEP_Position[3][1] = 1
		IF MEP_Position[3][1] < -1 THEN MEP_Position[3][1] = -1

		RotationAroundZAxis = ASN(-MEP_Position[3][1])
		IF ABS(RotationAroundZAxis) < EPS THEN RotationAroundZAxis = 0
		PARAMETERS RotationAroundZAxis = RotationAroundZAxis
	ENDIF

ENDIF
]]>
</Script_VL>

<!-- GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT -->

<Comment SectVersion="20" SectionFlags="0" SubIdent="0">
<![CDATA[]]>
</Comment>

<ParamSection SectVersion="26" SectionFlags="0" SubIdent="0">
	<ParamSectHeader>
		<Version>26</Version>
		<AutoHotspots>false</AutoHotspots>
		<StatBits>
			<STBit_FixSize/>
		</StatBits>
		<WDLeftFrame>0</WDLeftFrame>
		<WDRightFrame>0</WDRightFrame>
		<WDTopFrame>0</WDTopFrame>
		<WDBotFrame>0</WDBotFrame>
		<LayFlags>65535</LayFlags>
		<WDMirrorThickness>0</WDMirrorThickness>
		<WDWallInset>0</WDWallInset>
		<SymbolColor>0</SymbolColor>
	</ParamSectHeader>
	<Parameters>
		<Length Name="A">
			<Description><![CDATA[""]]></Description>
			<Fix/>
			<Value>1</Value>
		</Length>
		<Length Name="B">
			<Description><![CDATA[""]]></Description>
			<Fix/>
			<Value>1</Value>
		</Length>
		<Length Name="ZZYZX">
			<Description><![CDATA["Height"]]></Description>
			<Fix/>
			<Value>1</Value>
		</Length>
		<Boolean Name="AC_show2DHotspotsIn3D">
			<Description><![CDATA["Show 2D Hotspots in 3D"]]></Description>
			<Fix/>
			<Flags>
				<ParFlg_Hidden/>
			</Flags>
			<Value>1</Value>
		</Boolean>
		<Length Name="ac_bottomlevel">
			<Description><![CDATA["Bottom Level"]]></Description>
			<Fix/>
			<Flags>
				<ParFlg_Hidden/>
			</Flags>
			<Value>1</Value>
		</Length>
		<Length Name="ac_toplevel">
			<Description><![CDATA["Top Level"]]></Description>
			<Fix/>
			<Flags>
				<ParFlg_Hidden/>
			</Flags>
			<Value>0</Value>
		</Length>
		<Angle Name="RotationAroundDAxis">
			<Description><![CDATA['Rotation around "X" Axis']]></Description>
			<Value>0</Value>
		</Angle>
		<Angle Name="RotationAroundWAxis">
			<Description><![CDATA['Rotation around "Y" Axis']]></Description>
			<Value>0</Value>
		</Angle>
		<Angle Name="RotationAroundZAxis">
			<Description><![CDATA['Rotation around "Z" Axis']]></Description>
			<Value>0</Value>
		</Angle>
		<Length Name="MEP_Position">
			<Description><![CDATA["Position"]]></Description>
			<ArrayValues FirstDimension="3" SecondDimension="3">
				<AVal Column="1" Row="1">0</AVal>
				<AVal Column="2" Row="1">0</AVal>
				<AVal Column="3" Row="1">0</AVal>
				<AVal Column="1" Row="2">1</AVal>
				<AVal Column="2" Row="2">0</AVal>
				<AVal Column="3" Row="2">0</AVal>
				<AVal Column="1" Row="3">0</AVal>
				<AVal Column="2" Row="3">1</AVal>
				<AVal Column="3" Row="3">0</AVal>
			</ArrayValues>
		</Length>
	</Parameters>
</ParamSection>

<!-- GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT -->

<Script_3D SectVersion="20" SectionFlags="0" SubIdent="0">
<![CDATA[]]>
</Script_3D>

<Copyright SectVersion="1" SectionFlags="0" SubIdent="0">
	<Author>GRAPHISOFT</Author>
	<License>
		<Type>CC BY-ND</Type>
		<Version>3.0</Version>
	</License>
</Copyright>

</Symbol>
