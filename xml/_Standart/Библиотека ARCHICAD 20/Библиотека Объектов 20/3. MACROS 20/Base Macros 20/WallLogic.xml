<?xml version="1.0" encoding="UTF-8"?>
<Symbol IsArchivable="false" IsPlaceable="false" MainGUID="465B6401-0C74-439B-B408-8E5C94744FF4" MigrationValue="Normal" Owner="1196638531" Signature="1196644685" Version="43">
<Ancestry SectVersion="1" SectionFlags="0" SubIdent="0" Template="false">
	<MainGUID>F938E33A-329D-4A36-BE3E-85E126820996</MainGUID>
	<MainGUID>103E8D2C-8230-42E1-9597-46F84CCE28C0</MainGUID>
	<MainGUID>B2970E4C-8680-4061-8670-2F4B638F3953</MainGUID>
</Ancestry>

<!-- GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT -->

<Script_3D SectVersion="20" SectionFlags="0" SubIdent="0">
<![CDATA[]]>
</Script_3D>

<!-- GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT -->

<Script_2D SectVersion="20" SectionFlags="0" SubIdent="0">
<![CDATA[]]>
</Script_2D>

<!-- GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT -->

<Script_1D SectVersion="20" SectionFlags="0" SubIdent="0">
<![CDATA[
! Contact person: <JT, TZs>

! ==============================================================================
! The macro returns some basic data about
!	the opening orientation and the wall geometry.
! ------------------------------------------------------------------------------
! Input parameters:
!	WOD:			distance of the wall-origin from the chord of the window panel
!	EPS:			tolerance
!
! Macro Version 9:
! Output: (on the GDL stack in the following order)
!	[1]:	multiplier for X axis to return to default direction (1 / -1)
!	[2]:	multiplier for Y axis to return to default direction (1 / -1)
!	[3]:	wall is curved (0 / 1)
!	[4]:	wall's reference line is on the left (0 / 1)
!	[5]:	rotation angle of the bottom left corner (angle in degrees)
!	[6]:	inner radius of the curved wall (length value)
!	[7]:	X offset of the bottom left corner (length value)
!	[8]:	Y offset of the bottom left corner (length value)
!	[ ... NSP]:	original stack elements
!
! Macro Version 10:
! Returned parameters:
!	mirrorX:		multiplier for X axis to return to default direction (1 / -1)
!	mirrorY:		multiplier for Y axis to return to default direction (1 / -1)
!	curvedWall:		wall is curved (0 / 1)
!	wallIsLeft:		wall's reference line is on the left (0 / 1)
!	angOrig:		rotation angle of the bottom left corner (angle in degrees)
!	innerRadius:	inner radius of the curved wall (length value)
!	ofsX:			X offset of the bottom left corner (length value)
!	ofsY:			Y offset of the bottom left corner (length value)
! ==============================================================================

! ===== basic wall geometry =====

bRotAngle180 = SYMB_ROTANGLE > EPS
wallIsLeft	= bRotAngle180 exor WIDO_REVEAL_SIDE
curvedWall	= WOD > EPS

! ===== compute tranformation for default orientation =====

if not(SYMB_MIRRORED) then
	if not(bRotAngle180) then
		if not(WIDO_REVEAL_SIDE) then
			if not(curvedWall) then
				mirrorX = 1
				mirrorY = -1
			else
				mirrorX = -1
				mirrorY = -1
			endif
		else
			if not(curvedWall) then
				mirrorX = 1
				mirrorY = 1
			else
				mirrorX = -1
				mirrorY = -1
			endif
		endif
	else
		if not(WIDO_REVEAL_SIDE) then
			if not(curvedWall) then
				mirrorX = -1
				mirrorY = -1
			else
				mirrorX = 1
				mirrorY = 1
			endif
		else
			if not(curvedWall) then
				mirrorX = -1
				mirrorY = 1
			else
				mirrorX = 1
				mirrorY = 1
			endif
		endif
	endif
else
	if not(bRotAngle180) then
		if not(WIDO_REVEAL_SIDE) then
			if not(curvedWall) then
				mirrorX = -1
				mirrorY = -1
			else
				mirrorX = 1
				mirrorY = -1
			endif
		else
			if not(curvedWall) then
				mirrorX = -1
				mirrorY = 1
			else
				mirrorX = 1
				mirrorY = -1
			endif
		endif
	else
		if not(WIDO_REVEAL_SIDE) then
			if not(curvedWall) then
				mirrorX = 1
				mirrorY = -1
			else
				mirrorX = -1
				mirrorY = 1
			endif
		else
			if not(curvedWall) then
				mirrorX = 1
				mirrorY = 1
			else
				mirrorX = -1
				mirrorY = 1
			endif
		endif
	endif
endif


! ===== compute origin tranformation =====

if not(curvedWall) then
	angOrig = 0
	innerRadius = 0
	ofsX = -A / 2
	ofsY = -WIDO_SILL - WIDO_REVEAL_SIDE * WIDO_FRAME_THICKNESS
else
	if WIDO_REVEAL_SIDE then
		if SYMB_ROTANGLE > EPS then
			angOrig = atn (A / 2 / (WOD - WIDO_FRAME_THICKNESS))
			innerRadius = sqr((WOD - WIDO_FRAME_THICKNESS) * (WOD - WIDO_FRAME_THICKNESS) + (A / 2) * (A / 2)) - WIDO_SILL
			dy = WIDO_FRAME_THICKNESS
		else
			angOrig = atn (A / 2 / WOD)
			innerRadius = sqr((WOD + WIDO_FRAME_THICKNESS) * (WOD + WIDO_FRAME_THICKNESS) + (A / 2) * (A / 2)) + WIDO_SILL - WALL_THICKNESS
			dy = -WIDO_FRAME_THICKNESS
		endif
	else
		if SYMB_ROTANGLE > EPS then
			angOrig = atn (A / 2 / (WOD - WIDO_FRAME_THICKNESS))
			innerRadius = sqr((WOD) * (WOD) + (A / 2) * (A / 2)) + WIDO_SILL - WALL_THICKNESS
			dy = 0
		else
			angOrig = atn (A / 2 / WOD)
			innerRadius = sqr(WOD * WOD + (A / 2) * (A / 2)) - WIDO_SILL
			dy = 0
		endif
	endif

	ofsX = -sin (angOrig) * innerRadius
	ofsY =  cos (angOrig) * innerRadius - WOD + dy
endif


if gs_macro_version = 9 then
	! === save the current parameter buffer
	dim savedQueueValues[]
	call "SaveQueue" parameters returned_parameters savedQueueValues

	put	mirrorX,
		mirrorY,
		curvedWall,
		wallIsLeft,
		angOrig,
		innerRadius,
		ofsX,
		ofsY

	! === restore the saved parameter buffer
	call "LoadQueue" parameters savedQueueValues = savedQueueValues
endif

if gs_macro_version >= 10 then
	end mirrorX,
		mirrorY,
		curvedWall,
		wallIsLeft,
		angOrig,
		innerRadius,
		ofsX,
		ofsY
endif


]]>
</Script_1D>

<!-- GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT -->

<Script_PR SectVersion="20" SectionFlags="0" SubIdent="0">
<![CDATA[]]>
</Script_PR>

<!-- GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT -->

<Script_UI SectVersion="20" SectionFlags="0" SubIdent="0">
<![CDATA[]]>
</Script_UI>

<!-- GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT -->

<Script_VL SectVersion="20" SectionFlags="0" SubIdent="0">
<![CDATA[]]>
</Script_VL>

<Comment SectVersion="20" SectionFlags="0" SubIdent="0">
<![CDATA[]]>
</Comment>

<ParamSection SectVersion="22" SectionFlags="0" SubIdent="0">
	<ParamSectHeader>
		<AutoHotspots>false</AutoHotspots>
		<StatBits>
			<STBit_FixSize/>
		</StatBits>
		<WDLeftFrame>0</WDLeftFrame>
		<WDRightFrame>0</WDRightFrame>
		<WDTopFrame>0</WDTopFrame>
		<WDBotFrame>0</WDBotFrame>
		<LayFlags>65535</LayFlags>
		<WDMirrorThickness>0</WDMirrorThickness>
		<WDWallInset>0</WDWallInset>
	</ParamSectHeader>
	<Parameters>
		<Length Name="A">
			<Description><![CDATA["X Dimension of Sub-Window"]]></Description>
			<Fix/>
			<Value>0.001</Value>
		</Length>
		<Length Name="B">
			<Description><![CDATA["Unused"]]></Description>
			<Fix/>
			<Value>0.001</Value>
		</Length>
		<Length Name="ZZYZX">
			<Description><![CDATA["Unused"]]></Description>
			<Fix/>
			<Value>0.001</Value>
		</Length>
		<Boolean Name="AC_show2DHotspotsIn3D">
			<Description><![CDATA["Show 2D Hotspots in 3D"]]></Description>
			<Fix/>
			<Flags>
				<ParFlg_Hidden/>
			</Flags>
			<Value>0</Value>
		</Boolean>
		<Length Name="ac_bottomlevel">
			<Description><![CDATA["Bottom Level"]]></Description>
			<Fix/>
			<Flags>
				<ParFlg_Hidden/>
			</Flags>
			<Value>1</Value>
		</Length>
		<Length Name="ac_toplevel">
			<Description><![CDATA["Top Level"]]></Description>
			<Fix/>
			<Flags>
				<ParFlg_Hidden/>
			</Flags>
			<Value>0</Value>
		</Length>
		<Integer Name="gs_macro_version">
			<Description><![CDATA["Macro Version"]]></Description>
			<Value>9</Value>
		</Integer>
		<Length Name="WOD">
			<Description><![CDATA["Origo Distance of SubWindow"]]></Description>
			<Value>0</Value>
		</Length>
		<RealNum Name="EPS">
			<Description><![CDATA["Tolerance"]]></Description>
			<Value>0.1</Value>
		</RealNum>
	</Parameters>
</ParamSection>

<CalledMacros SectVersion="2" SectionFlags="0" SubIdent="0">
	<Macro>
		<MName><![CDATA["SaveQueue"]]></MName>
		<MainGUID>94152DAD-3888-4DAC-AC2E-EB7988A1C356</MainGUID>
	</Macro>
	<Macro>
		<MName><![CDATA["LoadQueue"]]></MName>
		<MainGUID>76C49CD5-2439-4953-8829-5B7914C1A082</MainGUID>
	</Macro>
</CalledMacros>

<Copyright SectVersion="1" SectionFlags="0" SubIdent="0">
	<Author>GRAPHISOFT</Author>
	<License>
		<Type>CC BY-ND</Type>
		<Version>3.0</Version>
	</License>
</Copyright>

</Symbol>
